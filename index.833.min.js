"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},__createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var a=Object.getOwnPropertyDescriptor(t,o);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,a)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var n=e(t),a=0;a<n.length;a++)"default"!==n[a]&&__createBinding(o,t,n[a]);return __setModuleDefault(o,t),o}}();define("utility/Type",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.as=function(e,t){return typeof t===e?t:void 0},e.not=function(e,t){return typeof t===e?void 0:t},e.assert=function(){}}(o||(o={})),t.default=o})),define("utility/EventManager",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0,o=__importDefault(o);class n{static global=n.make();static make(){return new n({})}static emit(e,t,o){return o instanceof Event&&(t=o),"string"==typeof t&&(t=new Event(t,{cancelable:!0})),"function"==typeof o?o?.(t):o&&t!==o&&Object.assign(t,o),e?.dispatchEvent(t),t}host;_target;get target(){return this._target instanceof WeakRef?this._target.deref():this._target}constructor(e,t=new EventTarget){this.host=new WeakRef(e),this._target=t}subscribe(e,t){Array.isArray(e)||(e=[e]);for(const o of e)this.target?.addEventListener(o,t);return this.host.deref()}subscriptions={};subscribeOnce(e,t){if(Array.isArray(e)||(e=[e]),this.target){const o=this.target,n=this.subscriptions;function a(i){t.call(this,i);for(const i of e)n[i]?.delete(t),o?.removeEventListener(i,a)}for(const i of e)n[i]??=new WeakMap,n[i].set(t,a),this.target?.addEventListener(i,a)}return this.host.deref()}unsubscribe(e,t){Array.isArray(e)||(e=[e]);for(const o of e){this.target?.removeEventListener(o,t);const e=this.subscriptions[o]?.get(t);e&&(this.target?.removeEventListener(o,e),this.subscriptions[o].delete(t))}return this.host.deref()}async waitFor(e){return new Promise((t=>this.subscribeOnce(e,t)))}until(e,t){"object"!=typeof e&&(e=this.waitFor(e));const n={subscribe:(t,a)=>{this.subscribe(t,a);const i=()=>this.unsubscribe(t,a);return e instanceof Promise?e.then(i):o.default.Owner.getOwnershipState(e)?.matchManual(!0,i),n},subscribeOnce:(t,a)=>{this.subscribeOnce(t,a);return e instanceof Promise?e.then((()=>this.unsubscribe(t,a))):o.default.Owner.getOwnershipState(e)?.matchManual(!0,(()=>this.unsubscribe(t,a))),n}};return t?.(n),this.host.deref()}emit(e,t){return e=n.emit(this.target,e,t),this.host.deref()}}t.EventManager=n})),define("ui/InputBus",["require","exports","ui/Component","utility/EventManager"],(function(e,t,o,n){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.HandlesMouseEvents=t.HandlesKeyboardEvents=void 0,o=__importDefault(o),function(e){e.ReceiveFocusedClickEvents="_receieve-focused-click-events"}(a||(a={})),o.default.extend((e=>{e.extend((e=>({receiveFocusedClickEvents:()=>e.classes.add(a.ReceiveFocusedClickEvents)})))})),t.HandlesKeyboardEvents=o.default.Tag().setName("HandlesKeyboardEvents"),t.HandlesMouseEvents=o.default.Tag().setName("HandlesMouseEvents");const i={0:"MouseLeft",1:"MouseMiddle",2:"MouseRight",3:"Mouse3",4:"Mouse4",5:"Mouse5",undefined:"Mouse?"};let r=0;const l={},u=Object.assign(n.EventManager.make(),{getPressStart:e=>l[e],getPressDuration:e=>void 0===l[e]?void 0:Date.now()-l[e],isDown:e=>!!l[e],isUp:e=>!l[e]});function s(e){const n=e.target,s=n?.closest("input[type=text], textarea, [contenteditable]")??null;let d=!!s;if(!(d||"keydown"!==e.type||"Enter"!==e.key&&" "!==e.key||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||!n?.classList.contains(a.ReceiveFocusedClickEvents))){const t=n?.component?.event.emit("click");if(!0===t?.stoppedPropagation?e.stopPropagation():"immediate"===t?.stoppedPropagation&&e.stopImmediatePropagation(),t?.defaultPrevented)return void e.preventDefault()}const c=e.key??i[e.button],p="mousedown"===e.type?"keydown":"mouseup"===e.type?"keyup":e.type;"keydown"===p&&(l[c]=Date.now());let f=!1;const m={key:c,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,used:d,input:s,targetElement:n,targetComponent:n?.component??null,use:(e,...t)=>{if(m.used)return!1;const o=m.matches(e,...t);return o&&(m.used=!0),o},useOverInput:(e,...t)=>{if(m.used&&!d)return!1;const o=m.matches(e,...t);return o&&(m.used=!0,d=!1),o},matches:(e,...t)=>c===e&&!!t.every((e=>m[e])),cancelInput:()=>f=!0,hovering:e=>{const t=[...document.querySelectorAll(":hover")];return e?t[t.length-1]?.closest(e)??void 0:t[t.length-1]}};if("keyup"===p&&(m.usedAnotherKeyDuring=r>(l[c]??0),delete l[c]),u.emit("keydown"===p?"down":"up",m),(m.used&&!d||d&&f)&&(e.preventDefault(),r=Date.now()),d&&"keydown"===e.type&&"Enter"===c&&!m.shift&&!m.alt){const a=n?.closest("form");!a||"input"!==n?.tagName.toLowerCase()&&!n?.closest("[contenteditable]")||m.ctrl?a?.requestSubmit():o.default.closest(t.HandlesKeyboardEvents,n)||e.preventDefault()}}document.addEventListener("keydown",s,{capture:!0}),document.addEventListener("keyup",s,{capture:!0}),document.addEventListener("mousedown",s),document.addEventListener("mouseup",s),document.addEventListener("click",s),Object.defineProperty(MouseEvent.prototype,"used",{get(){return this._used??!1}}),Object.defineProperty(MouseEvent.prototype,"use",{value:function(e,...t){if(this._used)return!1;const o=this.matches(e,...t);return o&&(this._used=!0,r=Date.now()),o}}),Object.defineProperty(MouseEvent.prototype,"matches",{value:function(e,...t){return i[this.button]===e&&!!t.every((e=>this[`${e}Key`]))}}),t.default=u})),define("ui/utility/BrowserListener",["require","exports","utility/State"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.isWebkit=(0,o.default)(/AppleWebKit/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent))}(n||(n={})),t.default=n})),define("ui/utility/FontsListener",["require","exports","utility/State"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.loaded=(0,o.default)(!1),e.listen=async function(){await document.fonts.ready,e.loaded.asMutable?.setValue(!0)}}(n||(n={})),t.default=n})),define("utility/Define",["require","exports"],(function(e,t){function o(e,t,o){try{Object.defineProperty(e,t,{configurable:!0,writable:!0,value:o})}catch{}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.all=function(t,o,n){for(const a of t)e(a,o,n)},e.magic=function(e,t,o){try{Object.defineProperty(e,t,{configurable:!0,...o})}catch{}},e.set=function(e,t,o){try{Object.defineProperty(e,t,{configurable:!0,writable:!0,value:o})}catch{}return o}}(o||(o={})),t.default=o})),define("utility/Arrays",["require","exports","utility/Define"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.NonNullish=function(e){return null!=e},t.Truthy=function(e){return!!e},o=__importDefault(o),function(e){e.EMPTY=[],e.resolve=function(e){return Array.isArray(e)?e:void 0===e?[]:[e]},e.includes=function(e,t){return Array.isArray(e)?e.includes(t):e===t},e.slice=function(e){return Array.isArray(e)?e.slice():void 0===e?[]:[e]},e.remove=function(e,...t){if(!e)return!1;let o=!1;for(const n of t){const t=e.indexOf(n);-1!==t&&(e.splice(t,1),o=!0)}return o},e.removeAll=function(e,...t){if(!e)return!1;let o=!1,n=0;for(let a=0;a<e.length;a++)t.includes(e[a])?o=!0:(n!==a&&(e[n]=e[a]),n++);return e.length=n,o},e.removeWhere=function(e,t){if(!e)return!1;let o=!1,n=0;for(let a=0;a<e.length;a++)t(e[a],a,e)?o=!0:(n!==a&&(e[n]=e[a]),n++);return e.length=n,o},e.add=function(e,...t){if(!e)return!1;let o=!1;for(const n of t)e.includes(n)||(o=!0,e.push(n));return o},e.tuple=function(...e){return e},e.range=function(e,t,o){if(0===o)throw new Error("Invalid step for range");const n=[];void 0===t&&(t=e,e=0),o=t<e?-1:1;for(let a=e;o>0?a<t:a>t;a+=o)n.push(a);return n},e.mergeSorted=function(...e){return e.reduce(((e,t)=>function(e,t){const o=[];let n=0,a=0;for(;n<e.length||a<t.length;){const i=n<e.length?e[n]:void 0,r=a<t.length?t[a]:void 0;if(i===r){o.push(i),n++,a++;continue}if(void 0===i&&void 0!==r){o.push(r),a++;continue}if(void 0===r&&void 0!==i){o.push(i),n++;continue}-1===t.indexOf(i,a)?(o.push(i),n++):(o.push(r),a++)}return o}(e,t)),[])},e.applyPrototypes=function(){(0,o.default)(Array.prototype,"findLast",(function(e){if(this.length>0)for(let t=this.length-1;t>=0;t--)if(e(this[t],t,this))return this[t]})),(0,o.default)(Array.prototype,"findLastIndex",(function(e){if(this.length>0)for(let t=this.length-1;t>=0;t--)if(e(this[t],t,this))return t;return-1}));const t=Array.prototype.sort;(0,o.default)(Array.prototype,"sort",(function(...e){return this.length<=1?this:e.length?t.call(this,((t,o)=>{for(const n of e)if(1===n.length){const e=n,a=e(o)-e(t);if(a)return a}else{const e=n(t,o);if(e)return e}return 0})):t.call(this)})),(0,o.default)(Array.prototype,"collect",(function(e,...t){return e?.(this,...t)})),(0,o.default)(Array.prototype,"splat",(function(e,...t){return e?.(...this,...t)})),(0,o.default)(Array.prototype,"toObject",(function(e){return Object.fromEntries(e?this.map(e):this)})),(0,o.default)(Array.prototype,"toMap",(function(e){return new Map(e?this.map(e):this)})),(0,o.default)(Array.prototype,"distinct",(function(e){const t=[],o=e?[]:t;for(const n of this){const a=e?e(n):n;o.includes(a)||(e&&o.push(a),t.push(n))}return t})),(0,o.default)(Array.prototype,"distinctInPlace",(function(e){const t=[];let o=0;for(const n of this){const a=e?e(n):n;t.includes(a)||(t.push(a),this[o++]=n)}return this.length=o,this})),(0,o.default)(Array.prototype,"findMap",(function(e,t){for(let o=0;o<this.length;o++)if(e(this[o],o,this))return t(this[o],o,this)})),(0,o.default)(Array.prototype,"groupBy",(function(e){const t={};for(let o=0;o<this.length;o++)(t[String(e(this[o],o,this))]??=[]).push(this[o]);return Object.entries(t)})),(0,o.default)(Array.prototype,"filterInPlace",(function(t){return e.removeWhere(this,((e,o,n)=>!t(e,o,n))),this})),(0,o.default)(Array.prototype,"mapInPlace",(function(e){return this.splice(0,1/0,...this.map(e))}))}}(n||(n={})),t.default=n})),define("utility/DevServer",["require","exports","utility/Env"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const n={};let a;const i={connect(){if(a)return;if("dev"!==o.default.ENVIRONMENT)return;const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}`;a=new WebSocket(e),a.addEventListener("message",(e=>{try{const t=JSON.parse(e.data),{type:o,data:a}="object"==typeof t&&null!==t?t:{},i=n[o];if(!i?.length)return void console.warn("No handler for devserver message type:",o);for(const e of i)e(o,a)}catch{console.warn("Unsupported devserver message:",e.data)}}))},onMessage(e,t){n[e]??=[],n[e].push(t)},close(){a?.close(),a=void 0}};t.default=i})),define("utility/Script",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.allowModuleRedefinition=function(...e){for(const t of e)window.allowRedefine(t)},e.reload=async function(e){document.querySelector(`script[src^="${e}"]`)?.remove();const t=document.createElement("script");return t.src=`${e}?${Date.now()}`,new Promise(((e,o)=>{t.onload=()=>e(),t.onerror=o,document.head.appendChild(t)}))}}(o||(o={})),t.default=o})),define("utility/Async",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){async function t(e,t){return t?!!t.aborted||new Promise((o=>{let n;const a=()=>{window.clearTimeout(n),o(!0)};n=window.setTimeout((()=>{t.removeEventListener("abort",a),o(!1)}),e),t.addEventListener("abort",a,{once:!0})})):new Promise((t=>{window.setTimeout((()=>t(void 0)),e)}))}function o(...e){let o,i;return"function"==typeof e[0]?([i,...e]=e,function(e,...t){const o=a.get(e);if(o?.nextQueued)return o.promise;const n=new WeakRef(e);e=void 0;const i=()=>{try{const e=n.deref();if(!e)return;const o=e(...t),i=Promise.resolve(o);return a.set(e,{promise:i,nextQueued:!1}),e=void 0,i.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:i,reason:e}))})),i}catch(e){return void window.dispatchEvent(new ErrorEvent("error",{error:e}))}};return o?(o.nextQueued=!0,o.promise.catch(i).then(i)):i()}(i,...e)):([o,i,...e]=e,function(e,o,...a){let i=n.get(o);if(i&&Date.now()-i.last<e){const n=new WeakRef(o);o=void 0;const r=new AbortController;return i.queued=t(Date.now()-i.last+e,r.signal).then((e=>e?i?.queued:(delete i.queued,delete i.abortController,i.last=Date.now(),n.deref()?.(...a)))),i.abortController?.abort(),i.abortController=r,i.queued}i||n.set(o,i={last:0});return i.last=Date.now(),o(...a)}(o,i,...e))}e.sleep=t,e.debounce=o;const n=new WeakMap;const a=new WeakMap;function i(...e){let t,n,a=0,i=!1;"function"==typeof e[0]?[t,...e]=e:"function"==typeof e[1]?[a,t,...e]=e:"function"==typeof e[2]?"object"==typeof e[1]?[a,n,t,...e]=e:[a,i,t,...e]=e:[a,i,n,t,...e]=e,!0===i&&(i=a);const r=[];let l;const u={cancelled:!1,completed:!1,cancel:()=>{if(!u.cancelled&&!u.completed){n?.removeEventListener("abort",u.cancel),u.cancelled=!0,window.clearTimeout(l);for(const t of r)try{const o=t(...e),n=Promise.resolve(o);n.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:n,reason:e}))}))}catch(e){window.dispatchEvent(new ErrorEvent("error",{error:e}))}r.length=0,e.length=0}},onCancel:t=>{if(u.completed)return u;if(u.cancelled)try{const o=t(...e),n=Promise.resolve(o);n.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:n,reason:e}))}))}catch(e){window.dispatchEvent(new ErrorEvent("error",{error:e}))}else r.push(t);return u}};return n?.addEventListener("abort",u.cancel,{once:!0}),l=window.setTimeout((()=>{if(!u.cancelled){n?.removeEventListener("abort",u.cancel),u.completed=!0,r.length=0;try{const n=i?o(i,t,...e):t(...e),a=Promise.resolve(n);a.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:a,reason:e}))}))}catch(e){window.dispatchEvent(new ErrorEvent("error",{error:e}))}}}),a),u}e.schedule=i,e.timeout=function(e,t=new AbortController,o=`Timed out after ${e} ms`){return i(e,(()=>t.abort(o))),t.signal}}(o||(o={})),t.default=o})),define("utility/string/Strings",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return e.toLowerCase().replace(/\W+/g," ")}function o(e,t,o=1/0){let n=0,a=-1;for(;n<o;){const o=e.indexOf(t,a+1);if(-1===o)return n;n++,a=o}return n}function n(e){const t=[e];return t.push(e+"d",e+"ed"),e.endsWith("d")&&t.push(...n(e.slice(0,-1))),e.endsWith("ed")&&t.push(...n(e.slice(0,-2))),e.endsWith("ing")?(t.push(e.slice(0,-3)),e[e.length-4]===e[e.length-5]&&t.push(e.slice(0,-4))):(t.push(e+"ing",e+e[e.length-1]+"ing"),e.endsWith("y")&&t.push(e.slice(0,-1)+"ing")),e.endsWith("ion")?(t.push(...n(e.slice(0,-3))),e[e.length-4]===e[e.length-5]&&t.push(e.slice(0,-4))):t.push(e+"ion"),e.endsWith("er")?t.push(e.slice(0,-1),e.slice(0,-2)):(t.push(e+"r",e+"er"),e.endsWith("y")&&t.push(e.slice(0,-1)+"ier")),e.endsWith("ier")&&t.push(e.slice(0,-3)+"y"),t.push(e+"s",e+"es"),e.endsWith("s")?t.push(e.slice(0,-1)):e.endsWith("y")&&t.push(e.slice(0,-1)+"ies"),t}e.uid=function(){return`_${Date.now().toString(36)}${Math.random().toString(36).slice(2)}`},e.optionalParseJSON=function(e,t){if(e)try{const o=JSON.parse(e);if(t&&!t(o))return;return o}catch{return}},e.optionalParseRegex=function(e,t){if(e)try{return new RegExp(e,t)}catch{return}},e.simplify=t,e.areSameWords=function(e,o){return void 0!==e&&void 0!==o&&t(e)===t(o)},e.includesAt=function(e,t,o){if(o<0&&(o=e.length+o),o+t.length>e.length)return!1;for(let n=0;n<t.length;n++)if(e[n+o]!==t[n])return!1;return!0},e.splitOnce=function(e,t){const o=e.indexOf(t);return-1===o?[e]:[e.slice(0,o),e.slice(o+t.length)]},e.sliceTo=function(e,t,o){const n=e.indexOf(t,o);return-1===n?e:e.slice(0,n)},e.sliceAfter=function(e,t,o){const n=e.indexOf(t,o);return-1===n?e:e.slice(n+t.length)},e.trimTextMatchingFromStart=function(e,t,o){if(e.length<t.length)return e;const n=e.indexOf(t,o);return 0!==n?e:e.slice(n+t.length)},e.trimTextMatchingFromEnd=function(e,t,o){if(e.length<t.length)return e;const n=e.lastIndexOf(t,o);return n!==e.length-t.length?e:e.slice(0,n)},e.extractFromQuotes=function(e){let t=(e??"").trim();return'"'===t[0]&&(t=t.slice(1)),'"'===t[t.length-1]&&(t=t.slice(0,-1)),t.trim()},e.extractFromSquareBrackets=function(e){let t=e??"";return"["===t[0]&&(t=t.slice(1).trimStart()),"]"===t[t.length-1]&&(t=t.slice(0,-1).trimEnd()),t},e.mergeRegularExpressions=function(e,...t){let o="";for(const e of t)o+="|"+e.source;return new RegExp(o.slice(1),e)},e.count=o,e.includesOnce=function(e,t){return 1===o(e,t,2)},e.getVariations=n,e.shiftLine=function(e,t=1){for(let o=0;o<t;o++){const t=e.indexOf("\n");if(-1===t)return e;e=e.slice(t+1)}return e};const a=/'/g,i=/\W+/g;function r(e){return e.toLowerCase().replace(a,"").split(i).filter(Boolean)}e.getWords=r,e.fuzzyMatches=function(e,t,o){o??={},o.missingWordsThreshold??=.4,o.maxMissingWordsForFuzzy=4;const a=r(e).map(n),i=r(t).map(n);let l=0,u=0,s=0,d=0;e:for(;;){const e=a[s],t=i[d];if(!e&&!t)break;if(!e||!t){s++,d++,u++;continue}let n=0;for(let e=s;e<a.length&&n<=o.maxMissingWordsForFuzzy;e++){if(a[e].some((e=>t.includes(e)))){s=e+1,d++,l++,u+=n;continue e}n++}n=0;for(let t=d;t<i.length&&n<=o.maxMissingWordsForFuzzy;t++){if(i[t].some((t=>e.includes(t)))){s++,d=t+1,l++,u+=n;continue e}n++}u++,s++,d++}return l/(l+u)>=o.missingWordsThreshold};const l=/(?<=\W+)/g;e.toTitleCase=function(e){return e.split(l).map((e=>e[0].toUpperCase()+e.slice(1))).join("")},e.indent=function(e,t="\t"){return e.split("\n").map((e=>t+e)).join("\n")}}(o||(o={})),t.default=o})),define("utility/Time",["require","exports","utility/string/Strings"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){function t(e){return 1e3*e}function n(e){return 1e3*e*60}function a(e){return 1e3*e*60*60}function i(e){return 1e3*e*60*60*24}function r(e){return 1e3*e*60*60*24*7}function l(e){return Math.floor(1e3*e*60*60*24*(365.2422/12))}function u(e){return Math.floor(1e3*e*60*60*24*365.2422)}e.floor=function(e){return Math.floor(Date.now()/e)*e},e.frame=t(1)/144,e.ms=function(e){return e},e.seconds=t,e.minutes=n,e.hours=a,e.days=i,e.weeks=r,e.months=l,e.years=u,e.decades=function(e){return Math.floor(1e3*e*60*60*24*365.2422*10)},e.centuries=function(e){return Math.floor(1e3*e*60*60*24*365.2422*10*10)},e.millenia=function(e){return Math.floor(1e3*e*60*60*24*365.2422*10*10*10)},e.relative=function(e,s={}){let d=e-Date.now();const c=navigator.language||"en-NZ";if(!c.startsWith("en"))return function(e,o,s){const d=new Intl.RelativeTimeFormat(o,s);let c=e;return c=Math.trunc(e/u(1)),c?d.format(c,"year"):(c=Math.trunc(e/l(1)),c?d.format(c,"month"):(c=Math.trunc(e/r(1)),c?d.format(c,"week"):(c=Math.trunc(e/i(1)),c?d.format(c,"day"):(c=Math.trunc(e/a(1)),c?d.format(c,"hour"):(c=Math.trunc(e/n(1)),c?d.format(c,"minute"):(c=Math.trunc(e/t(1)),d.format(c,"second")))))))}(d,c,s);if(Math.abs(d)<t(1))return"now";const p=d<0;p&&(d=Math.abs(d));let f=s.components??1/0,m=d,v=p||!1===s.label?"":"in ";return m=Math.floor(d/u(1)),d-=m*u(1),m&&f-- >0&&(v+=`${m} year${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/l(1)),d-=m*l(1),m&&f-- >0&&(v+=`${m} month${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/r(1)),d-=m*r(1),m&&f-- >0&&(v+=`${m} week${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/i(1)),d-=m*i(1),m&&f-- >0&&(v+=`${m} day${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/a(1)),d-=m*a(1),m&&f-- >0&&(v+=`${m} hour${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/n(1)),d-=m*n(1),m&&f-- >0&&(v+=`${m} minute${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/t(1)),!(m&&f-- >0)||s.secondsExclusive&&v.includes(",")||(v+=`${m} second${1===m?"":"s"}`),v=o.default.trimTextMatchingFromEnd(v,", "),`${v}${p&&!1!==s.label?" ago":""}`},e.absolute=function(e,t={dateStyle:"full",timeStyle:"medium"}){const o=navigator.language||"en-NZ";return new Intl.DateTimeFormat(o,t).format(e)}}(n||(n={})),Object.assign(window,{Time:n}),t.default=n})),define("utility/Task",["require","exports","utility/Async","utility/Time"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const a=(n=__importDefault(n)).default.seconds(1)/144;class i{interval;static async yield(e=!1){if("undefined"!=typeof scheduler&&"function"==typeof scheduler.yield)return scheduler.yield();e||await o.default.sleep(1)}static post(e,t){return"undefined"==typeof scheduler||"function"!=typeof scheduler.postTask?e():scheduler.postTask(e,{priority:t})}lastYieldEnd=Date.now();constructor(e=a){this.interval=e}reset(){this.lastYieldEnd=Date.now()}async yield(e=!1){Date.now()-this.lastYieldEnd>this.interval&&(await i.yield(e),this.lastYieldEnd=Date.now())}}t.default=i})),define("utility/Style",["require","exports","utility/State","utility/Task"],(function(e,t,o,n){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),function(e){e.properties=o.default.JIT((()=>window.getComputedStyle(document.documentElement)));const t={};e.measure=function(a){return t[a]?t[a]:e.properties.mapManual((e=>{const i=e.getPropertyValue(a),r=document.createElement("div");r.style.width=i,r.style.pointerEvents="none",r.style.opacity="0",r.style.position="fixed",document.body.appendChild(r);const l=t[a]=(0,o.default)(0);return n.default.yield().then((()=>{l.value=r.clientWidth,r.remove()})),t[a]}))},e.reload=async function(e){const t=document.querySelector(`link[rel=stylesheet][href^="${e}"]`),o=document.createElement("link");return o.rel="stylesheet",o.href=`${e}?${Date.now()}`,new Promise(((e,t)=>{o.onload=()=>e(),o.onerror=t,document.head.appendChild(o)})).finally((()=>t?.remove()))}}(a||(a={})),t.default=a})),define("ui/utility/StyleManipulator",["require","exports","style","utility/Arrays","utility/DevServer","utility/Env","utility/Script","utility/State","utility/Style"],(function(e,t,o,n,a,i,r,l,u){function s(){for(const e of[...document.documentElement.attributes])e.name.startsWith("chiridata:")&&document.documentElement.removeAttribute(e.name);for(const e in t.style.value){const o=t.style.value[e];o.length&&document.documentElement.setAttribute(`chiridata:${e}`,JSON.stringify(o))}}Object.defineProperty(t,"__esModule",{value:!0}),t.style=void 0,o=__importDefault(o),n=__importStar(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),t.style=(0,l.default)(o.default),a.default.onMessage("updateStyle",(async()=>{r.default.allowModuleRedefinition("style"),u.default.reload(`${i.default.URL_ORIGIN}style/index.css`),await r.default.reload(`${i.default.URL_ORIGIN}style/index.js`),t.style.value=await new Promise(((t,o)=>{e(["style"],t,o)})).then(__importStar).then((e=>e.default))})),i.default.onLoad("dev",(()=>{Object.assign(window,{writeChiridata:s})})),t.default=function(e){const o=new Set,a=[],r=new WeakMap,u={},s=l.default.JIT((()=>o)),d=[];i.default.isDev&&t.style.subscribe(e,(()=>p()));const c=Object.assign(((...t)=>{for(const e of t)o.add(e);return p(),e}),{get:()=>[...o].sort(),has:e=>o.has(e),getState:(e,t)=>s.map(e,(e=>e.has(t))),remove(...t){for(const e of t)o.delete(e);return p(),e},toggle(t,...n){if(t)for(const e of n)o.add(e);else for(const e of n)o.delete(e);return p(),e},bind(t,...n){if(!l.default.is(t))return c.toggle(t,...n);c.unbind(t);const a=t.use(e,(e=>{if(e)for(const e of n)o.add(e);else for(const e of n)o.delete(e);p()}));return r.set(t,[a,n]),e},bindFrom(t){c.unbind(t);const n=[],a=t.use(e,((e,t)=>{Array.isArray(e)||(e=e?[e]:[]),Array.isArray(t)||(t=t?[t]:[]);for(const e of t??[])o.delete(e);for(const t of e)o.add(t);n.splice(0,1/0,...e),p()}));return r.set(t,[a,n]),e},unbind(t){const o=t&&r.get(t);if(!o)return e;const[n,a]=o;return n?.(),r.delete(t),c.remove(...a),e},combine:(t,o)=>(d.push({combined:t,requirements:o}),e),uncombine:t=>(d.filterInPlace((e=>e.combined!==t)),c.remove(t),e),refresh:()=>p(),hasProperty:t=>""!==e.element.style.getPropertyValue(t),setProperty:(t,o)=>(u[t]?.(),f(t,o),e),setProperties(t){for(let[e,o]of Object.entries(t))u[e]?.(),e=e.replaceAll(/[a-z][A-Z]/g,(e=>`${e[0]}-${e[1].toLowerCase()}`)).toLowerCase(),f(e,o);return e},toggleProperty:(e,t,o)=>(e??=!c.hasProperty(t),!0===e?c.setProperty(t,e?o:void 0):c.removeProperties(t)),setVariable:(e,t)=>c.setProperty(`--${e}`,t),bindProperty:(t,o)=>(u[t]?.(),l.default.is(o)?u[t]=o.use(e,(e=>f(t,e))):(f(t,o),u[t]=void 0),e),bindVariable:(e,t)=>c.bindProperty(`--${e}`,t),removeProperties(...t){for(const o of t)e.element.style.removeProperty(o);return e},removeVariables(...t){for(const o of t)e.element.style.removeProperty(`--${o}`);return e}});return c;function p(){const i=[...o];for(const e of d){e.requirements.every((e=>o.has(e)))?(o.add(e.combined),i.push(e.combined)):(o.delete(e.combined),n.default.remove(i,e.combined))}e.attributes.has("component")||e.attributes.insertBefore("class","component"),e.attributes.set("component",i.join(" "));const r=i.flatMap((e=>t.style.value[e])).filter(n.NonNullish),l=a.filter((e=>!r.includes(e)));return l&&e.element.classList.remove(...l),e.element.classList.add(...r),a.push(...r),s.markDirty(),e}function f(t,o){null==o?e.element.style.removeProperty(t):e.element.style.setProperty(t,`${o}`)}}})),define("navigation/Route",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const o=(e.startsWith("/")?e.slice(1):e).split("/"),n=[];let a="^";for(const e of o)a+="/+","$"===e[0]?"$"!==e[1]?(n.push(e.slice(1)),a+="([^/]+)"):(n.push(e.slice(2)),a+="(.*)"):a+=e;a+="$";const i=new RegExp(a),r=e;return{path:e,..."function"==typeof t?{handler:t}:t,match:e=>{const t=e.match(i);if(!t)return;const o={};for(let e=0;e<n.length;e++){const a=n[e],i=t[e+1];if(void 0===i)return void console.warn(`${r} matched, but $${a} was unset`);o[a]=decodeURIComponent(i)}return o}}}})),define("ui/component/core/ActionRow",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const n=(o=__importDefault(o)).default.Builder((e=>{e.style("action-row");let t=!1;return e.extend((e=>({left:void 0,middle:void 0,right:void 0}))).extendJIT("left",(e=>(0,o.default)().style("action-row-left").prependTo(e))).extendJIT("middle",(e=>{const n=(0,o.default)().style("action-row-middle");return t?n.insertTo(e,"before",e.right):n.appendTo(e)})).extendJIT("right",(e=>(t=!0,(0,o.default)().style("action-row-right").appendTo(e))))}));t.default=n})),define("utility/string/MarkdownItHTML",["require","exports","entities"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const n=Object.assign(((e,t)=>{const o={block:void 0,inline:void 0,i:0,l:0,e:0,src:"",silent:!1,options:{...n.defaultOptions,...t}};e.block.ruler.at("html_block",((e,t,a,i)=>{o.block=e,o.src=o.block.src,o.l=t,o.i=o.block.bMarks[o.l]+o.block.tShift[o.l],o.e=o.src.length,o.silent=i;const r=o.block.blkIndent,l=n.consumeBlock(o);return o.block.blkIndent=r,o.block=void 0,l}),{alt:["paragraph"]}),e.inline.ruler.at("html_inline",((e,t)=>{o.inline=e,o.e=e.posMax,o.i=e.pos,o.src=e.src,o.silent=t;const a=n.consumeInline(o);return o.inline=void 0,a})),e.renderer.rules.html_inline=(e,t)=>e[t].content||e[t].raw}),{regexCSSProperty:/^[-a-zA-Z_][a-zA-Z0-9_-]*$/,defaultOptions:{voidElements:["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr"],allowedTags:["hgroup","h1","h2","h3","h4","h5","h6","div","p","br","wbr","hr","details","summary","label","ol","ul","li","table","tr","th","td","caption","thead","tbody","tfoot","span","i","b","u","s","strike","sup","sub","em","mark","small","strong","q","cite","blockquote","a","abbr","dfn","dd","dt","dl","code","samp","kbd","img","figure","figcaption","area","map"],allTagsAllowedAttributes:["title","name","id","style","aria-label","aria-labelledby","aria-describedby","aria-hidden"],allTagsAllowedAttributeValues:{},perTagAllowedAttributes:{a:["href"],img:["src","alt","usemap","width","height"],area:["shape","coords"],details:["open"],ol:["type","start","reversed"],li:["value"],th:["colspan","rowspan","headers","scope","abbr"],td:["colspan","rowspan","headers"],q:["cite"]},perTagAllowedAttributeValues:{a:{href:/^https?:/},img:{src:/^https?:/},area:{href:/^https?:/},q:{cite:/^https?:/},blockquote:{cite:/^https?:/}},allTagsAllowedStyleProperties:["color","text-align","font-family","font-style","font-weight","text-decoration","text-transform","line-height","letter-spacing","word-spacing","vertical-align","background-color","opacity","margin","padding","width","height","vertical-align","box-shadow","border-width","border-style","border-color","border-radius","text-indent","display","position"],allTagsAllowedStylePropertyValues:{position:["relative","absolute","sticky"]},perTagAllowedStyleProperties:{},perTagAllowedStylePropertyValues:{}},Options(e){const t=Object.assign({...structuredClone(n.defaultOptions),...e},{disallowTags(...e){const o=e.map((e=>e.toLowerCase()));return t.allowedTags=t.allowedTags.filter((e=>!o.includes(e))),t},allowTags:(...e)=>(t.allowedTags=[...new Set([...t.allowedTags,...e.map((e=>e.toLowerCase()))])],t),disallowAttributes(...e){const o=e.map((e=>e.toLowerCase()));t.allTagsAllowedAttributes=t.allTagsAllowedAttributes.filter((e=>!o.includes(e)));for(const[e,n]of Object.entries(t.perTagAllowedAttributes))t.perTagAllowedAttributes[e]=n.filter((e=>!o.includes(e)));return t},allowAttributes:(...e)=>(t.allTagsAllowedAttributes=[...new Set([...t.allTagsAllowedAttributes,...e.map((e=>e.toLowerCase()))])],t)});return t},use:(e,t)=>e.use(n,t),consumeBlock(e){if(!e.block)return!1;if(n.consumeInlineWhitespace(e),e.silent)return n.consumeTerminator(e);if(!n.consumeTagsLine(e))return!1;e.l++,e.block.line=e.l;const t=n.consumeInlineWhitespace(e)||0;return t>=e.block.blkIndent+4?e.block.blkIndent=t-4:e.block.blkIndent=t,!0},consumeInline(e){if(!e.inline||"<"!==e.src[e.i])return!1;return!!n.consumeTag(e)&&(e.inline.pos=e.i,!0)},consumeTerminator(e){const t=(new Error).stack?.split("\n")?.at(4)?.includes("Array.lheading"),o=n.consumeInlineWhitespace(e)||0;return!!n.consumeTagsLine(e)&&(!t&&e.block&&(e.block.blkIndent=o),!0)},consumeTagsLine(e){let t=!1;const o=[];let a;for(;a=n.consumeTag(e);)"object"==typeof a&&o.push(a),t=!0,n.consumeInlineWhitespace(e);if(t){if(!(e.i<e.src.length)||n.consumeNewline(e))return{tokens:o};o.length&&e.block?.tokens.splice(0,1/0,...e.block.tokens.filter((e=>!o.includes(e))))}},consumeNewline:e=>!e.inline&&("\n"===e.src[e.i]?(e.i++,!0):"\r"===e.src[e.i]&&(e.i++,"\n"===e.src[e.i]&&e.i++,!0)),consumeWhitespace(e){if(e.inline)return!!n.consumeInlineWhitespace(e);const t=e.i;if(e.i>=e.e)return!1;for(e.i;e.i<e.e&&n.isWhitespace(e);e.i++)n.consumeNewline(e)&&(e.l++,e.i--);return e.i>t},consumeInlineWhitespace(e){if(e.i>=e.e)return;let t=0;for(e.i;e.i<e.e;e.i++)if(" "===e.src[e.i])t++;else{if("\t"!==e.src[e.i])break;t+=4}return t||void 0},consumeTag(e){if("<"===e.src[e.i])return e.i++,n.consumeOpenTag(e)??n.consumeCloseTag(e)},consumeOpenTag(e){const t=e.i,a=n.consumeTagName(e);if(!a)return;const i=a.toLowerCase(),r=e.options;if(!r.allowedTags.includes(i))return void(e.i=t);const l=[];let u;for(;n.consumeWhitespace(e);){const t=n.consumeAttribute(e);if(!t)break;let[a,s]=t;if(a=a.toLowerCase(),!r.allTagsAllowedAttributes.includes(a)&&!r.perTagAllowedAttributes[i]?.includes(a))continue;if(s=o.default.decodeHTML5Strict(s),"style"!==a){const e=r.perTagAllowedAttributeValues[i]?.[a]??r.allTagsAllowedAttributeValues[a];if(void 0!==e&&!n.matchesAllowedValues(s,e))continue;l.push(t);continue}u=n.parseStyleAttributeValue(s);let d="";for(let[e,t]of u){if(e=e.toLowerCase(),!r.allTagsAllowedStyleProperties.includes(e)&&!r.perTagAllowedStyleProperties[i]?.includes(e))continue;const o="!important",a=t.slice(-o.length).toLowerCase()===o;a&&(t=t.slice(0,-o.length).trim());const l=r.perTagAllowedStylePropertyValues[i]?.[e]??r.allTagsAllowedStylePropertyValues[e];(void 0===l||n.matchesAllowedValues(t,l))&&(d+=`${e}:${t}${a?o:""};`)}d.length&&l.push(["style",d.slice(0,-1)])}if("/"===e.src[e.i]&&e.i++,">"!==e.src[e.i])return void(e.i=t);e.i++;const s=e.options.voidElements.includes(i)?0:1;if(e.silent)return!0;let d=`html_${e.block?"block":"inline"}${s?"_open":""}`;"br"===i&&(d="softbreak");const c=(e.block??e.inline).push(d,i,s);Object.assign(c,{style:u,raw:e.src.slice(t-1,e.i)});for(const e of l)c.attrPush(e);return c},consumeCloseTag(e){const t=e.i;if("/"!==e.src[e.i])return;e.i++;const o=n.consumeTagName(e);if(!o)return;if(">"!==e.src[e.i])return void(e.i=t);e.i++;const a=o.toLowerCase();if(!e.options.allowedTags.includes(a))return void(e.i=t);if(e.silent||e.options.voidElements.includes(a))return!0;const i=`html_${e.block?"block":"inline"}_close`,r=(e.block??e.inline).push(i,a,-1);return Object.assign(r,{raw:e.src.slice(t-1,e.i)}),e.inline&&!e.inline.delimiters&&(e.inline.delimiters=[]),r},consumeTagName(e){const t=e.i;if(!(e.i>=e.e)&&n.isAlpha(e)){for(e.i++;e.i<e.e&&n.isAlphaNumeric(e);e.i++);return e.src.slice(t,e.i)}},consumeAttribute(e){const t=e.i,o=n.consumeAttributeName(e);if(!o)return;const a=e.i;if(n.consumeWhitespace(e),"="!==e.src[e.i])return e.i=a,[o,""];e.i++,n.consumeWhitespace(e);const i=n.consumeAttributeValue(e);if(i)return[o,i];e.i=t},consumeAttributeName(e){const t=e.i;if(!(e.i>=e.e)){for(e.i;e.i<e.e;e.i++){const t=e.src.charCodeAt(e.i);if(32===t||34===t||39===t||62===t||47===t||61===t||n.isNonCharacter(e,t)||n.isControl(e,t))break}return e.i>t?e.src.slice(t,e.i):void 0}},consumeAttributeValue:e=>n.consumeUnquotedAttributeValue(e)||n.consumeQuotedAttributeValue(e)||void 0,consumeUnquotedAttributeValue(e){let t="";for(;e.i<e.e;){const o=e.src.charCodeAt(e.i);if(34===o||39===o||61===o||60===o||62===o||96===o||n.isWhitespace(e,o))break;if(38!==o){t+=e.src[e.i],e.i++;continue}const a=n.consumeCharacterReference(e);a?t+=a:(t+="&amp;",e.i++)}return t||void 0},consumeQuotedAttributeValue(e){const t=e.i,o=e.src[e.i];if("'"!==o&&'"'!==o)return;e.i++;let a="";for(;e.i<e.e;){const i=e.src.charCodeAt(e.i);if(e.src[e.i]===o)return e.i++,a;if(38!==i){const o=e.i;if(n.consumeNewline(e)){e.l++,a+=e.src.slice(o,e.i);continue}if(e.inline&&n.isWhitespace(e)&&" "!==e.src[e.i]&&"\t"!==e.src[e.i])return void(e.i=t);a+=e.src[e.i],e.i++;continue}const r=n.consumeCharacterReference(e);r?a+=r:(a+="&amp;",e.i++)}e.i=t},consumeCharacterReference(e){const t=e.i;if("&"!==e.src[e.i])return;e.i++;if(n.consumeNumericCharacterReference(e)||n.consumeNamedCharacterReference(e))return e.src.slice(t,e.i);e.i=t},consumeNamedCharacterReference(e){const t=e.i;for(e.i;e.i<e.e&&n.isAlpha(e);e.i++);return e.i!==t&&";"===e.src[e.i]&&(e.i++,!0)},consumeNumericCharacterReference(e){if("#"!==e.src[e.i])return!1;e.i++;const t="x"===e.src[e.i]||"X"===e.src[e.i];t&&e.i++;const o=e.i;for(e.i;e.i<e.e&&(t?n.isHexadecimal(e):n.isNumeric(e));e.i++);if(e.i===o||";"!==e.src[e.i])return!1;const a=parseInt(e.src.slice(o,e.i),t?16:10);return!(13===a||n.isNonCharacter(e,a)||n.isControl(e,a)&&!n.isWhitespace(e,a))&&(e.i++,!0)},parseStyleAttributeValue:e=>{if(null==e)return;const t=new Map;let o="",a="",i=!1,r=!1,l=!1,u=!1,s="",d=0;for(let c=0;c<e.length;c++){const p=e[c];if(u){if("*"!==p&&"/"!==e[c+1])continue;u=!1,c++}else if("\\"!==p)if(r)a+=p,r=!1;else if(u||"/"!==p||"*"!==e[c+1]){if(l){if(p===s){l=!1,a+=p;continue}}else if('"'===p||"'"===p){l=!0,s=p,a+=p;continue}"("!==p||l?")"!==p||l?":"!==p||l||0!==d?";"!==p||l||0!==d?i?a+=p:o+=p:(o&&a&&(o=o.trim(),n.regexCSSProperty.test(o)?t.set(o,a.trim()):console.warn(`Invalid CSS property "${o}"`),o="",a=""),i=!1):i=!0:(d--,a+=p):(d++,a+=p)}else u=!0,c++;else r=!0}return o&&a&&(o=o.trim(),n.regexCSSProperty.test(o)?t.set(o,a.trim()):console.warn(`Invalid CSS property "${o}"`)),t},isAlpha:(e,t=e.src.charCodeAt(e.i))=>t>=65&&t<=90||t>=97&&t<=122,isNumeric:(e,t=e.src.charCodeAt(e.i))=>t>=48&&t<=57,isHexadecimal:(e,t=e.src.charCodeAt(e.i))=>t>=65&&t<=70||t>=97&&t<=102||n.isNumeric(e,t),isAlphaNumeric:(e,t=e.src.charCodeAt(e.i))=>n.isAlpha(e,t)||n.isNumeric(e,t),isNonCharacter:(e,t=e.src.charCodeAt(e.i))=>t>=64976&&t<=65007||65534===t||65535===t||131070===t||131071===t||196606===t||196607===t||262142===t||262143===t||327678===t||327679===t||393214===t||393215===t||458750===t||458751===t||524286===t||524287===t||589822===t||589823===t||655358===t||655359===t||720894===t||720895===t||786430===t||786431===t||851966===t||851967===t||917502===t||917503===t||983038===t||983039===t||1048574===t||1048575===t||1114110===t||1114111===t,isControl:(e,t=e.src.charCodeAt(e.i))=>t>=0&&t<=31||t>=127&&t<=159,isWhitespace:(e,t=e.src.charCodeAt(e.i))=>9===t||10===t||12===t||13===t||32===t,matchesAllowedValues:(e,t)=>Array.isArray(t)?t.some((t=>n.matchesAllowedValues(e,t))):"string"==typeof t?e===t:"function"==typeof t?t(e):t.test(e)}),a=n;t.default=a})),define("utility/string/Markdown",["require","exports","markdown-it","utility/string/MarkdownItHTML"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new o.default("commonmark",{html:!0,breaks:!0});return n.default.use(e,n.default.Options().disallowTags("img","figure","figcaption","map","area")),e.inline.ruler.enable("strikethrough"),e.inline.ruler2.enable("strikethrough"),e.inline.ruler.before("emphasis","underline",(function(e,t){const o=e.pos,n=e.src.charCodeAt(o);if(t||95!==n)return!1;const a=e.scanDelims(e.pos,!0);let i=a.length;if(i<2)return!1;const r=String.fromCharCode(n);let l;i%2&&(l=e.push("text","",0),l.content=r,i--);for(let t=0;t<i;t+=2)l=e.push("text","",0),l.content=r+r,e.delimiters.push({marker:n,length:0,token:e.tokens.length-1,end:-1,open:a.can_open,close:a.can_close});return e.pos+=a.length,!0})),e.inline.ruler2.before("emphasis","underline",(function(e){const t=e.tokens_meta,o=e.tokens_meta.length;n(e,e.delimiters);for(let a=0;a<o;a++){const o=t[a]?.delimiters;o&&n(e,o)}for(const t of e.delimiters)95===t.marker&&(t.marker=-999999);return!0;function n(e,t){let o;const n=[],a=t.length;for(let i=0;i<a;i++){const a=t[i];if(95!==a.marker)continue;if(-1===a.end)continue;const r=t[a.end];o=e.tokens[a.token],o.type="u_open",o.tag="u",o.nesting=1,o.markup="__",o.content="",o=e.tokens[r.token],o.type="u_close",o.tag="u",o.nesting=-1,o.markup="__",o.content="","text"===e.tokens[r.token-1].type&&"_"===e.tokens[r.token-1].content&&n.push(r.token-1)}for(;n.length;){const t=n.pop()??0;let a=t+1;for(;a<e.tokens.length&&"u_close"===e.tokens[a].type;)a++;a--,t!==a&&(o=e.tokens[a],e.tokens[a]=e.tokens[t],e.tokens[t]=o)}}})),e},o=__importDefault(o),n=__importDefault(n)})),define("ui/utility/MarkdownContent",["require","exports","lang/en-nz","ui/Component","ui/utility/StringApplicator","utility/string/Markdown","utility/string/MarkdownItHTML"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=[],u=Object.entries({SPAN:["DIV","P","UL","OL","LI"],STRONG:["H1","H2","H3","H4","H5","H6"],EM:["BLOCKQUOTE"],CODE:["PRE"]}).flatMap((([e,t])=>t.map((t=>[t,e])))).toObject(),s=new Set(["IMG","HR","BR","TABLE"]),d=/(?<=<mention[^>]*>)/g;var c;n.default.extend((e=>{let t;function r(t,o,a){if(!t)return void(e.element.innerHTML="");"string"==typeof t&&(t={body:t}),e.classes.add("markdown");const r=(0,i.default)().render(t.body);e.element.innerHTML=r.replace(d,"</mention>"),o&&function(e,t,o){let n=0,a=!1;const i=[],r=[];let l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);for(;l.nextNode();){const e=l.currentNode,d=e.tagName;if(s.has(d)){i.push(e);continue}if(n>=t){i.push(e),a=!0;continue}if(e.nodeType===Node.TEXT_NODE){const o=e.textContent?.length??0;n+=o;const i=Math.max(0,n-t);i&&(a=!0,e.textContent=e.textContent?.slice(0,o-i)??null,n=t)}u[d]&&o&&r.push(e)}for(let e=i.length-1;e>=0;e--)i[e].parentNode?.removeChild(i[e]);if(o)for(let e=r.length-1;e>=0;e--){const t=r[e],o=u[t.tagName],n=document.createElement(o);n.replaceChildren(...t.childNodes),t.replaceWith(n)}const d=[];if(l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),o)for(;l.nextNode();){const e=l.currentNode;"SPAN"!==e.tagName&&(e.parentElement?.closest(e.tagName)&&d.push(e))}for(let e=d.length-1;e>=0;e--)d[e].replaceWith(...d[e].childNodes);if(a){const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let o=null;for(;t.nextNode();)o=t.currentNode;o?o.nodeValue+="…":e.append("…")}}(e.element,o,a??!!o);const c=[],p=document.createTreeWalker(e.element,NodeFilter.SHOW_ELEMENT);for(;p.nextNode();)for(const e of l){const o=e(p.currentNode,t);o&&c.push(o)}for(const e of c)e();2===e.element.lastElementChild?.tagName.length&&"H"===e.element.lastElementChild.tagName[0]&&(0,n.default)("p").appendTo(e)}e.extend((e=>({setMarkdownContent:(o,n,a)=>(t?.(),t=void 0,r(o,n,a),e),useMarkdownContent:(i,l,u)=>(t?.(),t=void 0,t=a.Quilt.State.use(e,(t=>{const s=[],d=(a.QuiltHelper,"string"==typeof i?t[i]():"string"==typeof i?.body?t[i.body]():i?.body(t,a.QuiltHelper))?.content.map((function e(t){if(!t.tag)return Array.isArray(t.content)?t.content.map(e).join(""):"object"==typeof t.content&&t.content&&!o.WeavingArg.isRenderable(t.content)?a.QuiltHelper.isWeave(t.content)?t.content.content.map(e).join(""):e(t):"string"==typeof t.content||"number"==typeof t.content?String(t.content):n.default.is(t.content)?(s.push(t.content),`<weave tag="component:${s.length-1}"></weave>`):"";return`<weave tag="${t.tag}">${e({content:t.content})}</weave>`})).join("");r(d&&"string"!=typeof i?{body:d,mentions:i?.mentions}:d,l,u);for(const t of[...e.element.querySelectorAll('span[data-tag^="component:"]')]){const e=t.dataset.tag?.slice(10),o=e?Number(e):NaN,n=isNaN(o)?void 0:s[o];n?t.replaceWith(n.element):t.remove()}})),e)})))})),function(e){e.handle=function(e){l.push(e)},e.trim=function(e){return e.trim().replace(/^(?:\s|<br>)+/,"").replace(/(?:\s|<br>)+$/,"")},e.registerMarkdownHandlers=function(){r.default.defaultOptions.allowedTags.push("weave"),r.default.defaultOptions.perTagAllowedAttributes.weave=["tag"],e.handle(((e,t)=>{if("WEAVE"===e.tagName)return()=>{const t=e.getAttribute("tag");let o=t?a.QuiltHelper.createTagElement(t):void 0;o||(o=document.createElement("span"),t&&o.setAttribute("data-tag",t)),e.childNodes.length&&o.replaceChildren(...e.childNodes),e.replaceWith(o)}}))}}(c||(c={})),t.default=c})),define("utility/maths/Maths",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isIncrementing=function(e){for(let t=1;t<e.length;t++)if(e[t]!==e[t-1]+1)return!1;return!0},e.sum=function(...e){let t=0;for(const o of e)t+=o;return t},e.average=function(...e){let t=0;for(const o of e)t+=o;return t/e.length},e.bits=function(e){const o=new t;for(let t=52;t>=0;t--){const n=1<<t;e&n&&o.add(n)}return o};class t extends Set{everyIn(e){const t=e??0;for(const e of this)if(!(t&e))return!1;return!0}someIn(e){const t=e??0;for(const e of this)if(t&e)return!0;return!1}every(e){for(const t of this)if(!e(t))return!1;return!0}some(e){for(const t of this)if(e(t))return!0;return!1}}e.BitsSet=t,e.bitsn=function(e){const t=new o;for(let o=52n;o>=0n;o--){const n=1n<<o;e&n&&t.add(n)}return t};class o extends Set{everyIn(e){const t=e??0n;for(const e of this)if(!(t&e))return!1;return!0}someIn(e){const t=e??0n;for(const e of this)if(t&e)return!0;return!1}every(e){for(const t of this)if(!e(t))return!1;return!0}some(e){for(const t of this)if(e(t))return!0;return!1}}e.BitsSetN=o,e.lerp=function(e,t,o){return(1-o)*e+o*t},e.unlerp=function(e,t,o){const n=e>t;if(n){const o=t;t=e,e=o}const a=o<=e?0:o>=t?1:(o-e)/(t-e);return n?1-a:a},e.parseIntOrUndefined=function(e){const t=parseFloat(e);return isNaN(t)||!Number.isInteger(t)?void 0:t},e.clamp1=function(e){return e<0?0:e>1?1:e}}(o||(o={})),t.default=o})),define("ui/component/core/Heading",["require","exports","ui/Component","ui/utility/MarkdownContent","ui/utility/TextManipulator","utility/Define","utility/maths/Maths","utility/State"],(function(e,t,o,n,a,i,r,l){var u;Object.defineProperty(t,"__esModule",{value:!0}),t.HeadingClasses=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),function(e){e._ContainsHeading="_contains-heading"}(u||(t.HeadingClasses=u={})),o.default.extend((e=>e.extend((e=>({containsHeading:()=>e.classes.has(u._ContainsHeading),setContainsHeading:()=>(e.classes.add(u._ContainsHeading),e)})))));const s=o.default.Builder("h1",(e=>{e.style("heading");const t=(0,o.default)().style("heading-text").appendTo(e);i.default.set(e,"text",(0,a.default)(e,t));let n,u,s=!0;const c=(0,l.default)(void 0);let m;l.default.Map(e,[e.text.state,c],((...e)=>e)).use(e,(([o,n])=>{if(e.setId(o?.toString().toLowerCase().replace(/\W+/g,"-")),!n)return;const a=o?.length??0,i=1-r.default.clamp1(r.default.unlerp(n.minLength,n.maxLength,a));t.style.setProperty("--font-size-multiplier",`${i}`)})),e.tabIndex("programmatic"),e.receiveInsertEvents(),e.receiveAncestorInsertEvents(),e.event.subscribe(["insert","ancestorInsert"],g),e.rooted.subscribeManual(g);const v=(0,l.default)(null,!1),h=(e,t)=>{const o=e?.at(t);if("number"!=typeof o)return;const n=`#${o.toString(16).padStart(6,"0")}`;return`light-dark(\n\t\t\toklch(from ${n} max(var(--heading-colour-light-min), min(var(--heading-colour-light-max), L)) C H),\n\t\t\toklch(from ${n} max(var(--heading-colour-dark-min), min(var(--heading-colour-dark-max), L)) C H)\n\t\t)`};return e.style.bindVariable("heading-colour-1",v.map(e,(e=>h(e,0)))),e.style.bindVariable("heading-colour-2",v.map(e,(e=>h(e,-1)))),e.extend((o=>({textWrapper:t,setAestheticLevel(t){const a=u??"heading",i=p(e.element);return!1!==a&&f(i)&&e.style.remove(`${a}-${i}`),!1!==a&&n&&e.style.remove(`${a}-${n}`),n=t,!1!==a&&f(n)&&e.style(`${a}-${n}`),o},setAestheticStyle(t){const a=n??p(e.element);return!1!==u&&f(a)&&e.style.remove(`${u??"heading"}`,`${u??"heading"}-${a}`),u=t,!1!==t&&f(a)&&e.style(`${t??"heading"}`,`${t??"heading"}-${a}`),o},updateLevel:()=>(g(),o),setResizeRange:(e,t)=>(l.default.is(t)?c.bind(o,t.map(o,(function(t){return void 0===e||void 0===t?void 0:{minLength:e,maxLength:t}}))):c.value=void 0===e||void 0===t?void 0:{minLength:e,maxLength:t},o),clearResizeRange:()=>(c.value=void 0,o),setUnderlineColours:e=>(m?.(),m=v.bind(o,l.default.get(e)),o)})));function g(){const t=function(e){let t=e,o=!1;for(;t;){if(t.nodeType===Node.ELEMENT_NODE&&"NAV"===t.tagName)return 2;const e=d(t);if(e){const t=p(e);return o||1===t?void 0===t||t>6?t:t+1:t}t=t.parentNode??void 0,o||=!0}return 1}(e.element),o=p(e.element),a=t===o;if(a&&!s)return;const i=u??"heading";s=!1,!1!==i&&f(o)&&e.style.remove(`${i}-${o}`);const r=f(t);!1!==i&&!n&&r&&e.style(`${i}-${t}`),!1!==i&&n&&e.style(`${i}-${n}`),a||(e.event.unsubscribe(["insert","ancestorInsert"],g),e.replaceElement(r?`h${t}`:"span"),e.attributes.toggle(!r,"role","heading"),e.attributes.toggle(!r&&"number"==typeof t,"aria-level",`${t}`),e.event.subscribe(["insert","ancestorInsert"],g))}}));function d(e){let t=e;for(;t;){if(t=t.previousSibling??void 0,t?.nodeType!==Node.ELEMENT_NODE)continue;const e=t;if(c(e))return e;if("heading"===e.getAttribute("role"))return e;if("HGROUP"===e.tagName){const[t]=e.querySelectorAll("h1, h2, h3, h4, h5, h6, [role='heading']");if(t)return t}if(e.component?.containsHeading()){const[t]=e.querySelectorAll("h1, h2, h3, h4, h5, h6, [role='heading']");if(t)return t}}}function c(e){if(!e||"object"!=typeof e||!("tagName"in e))return!1;const t=e;return"H"===t.tagName[0]&&2===t.tagName.length&&!isNaN(+t.tagName[1])}function p(e){return+e.tagName.slice(1)||+e.getAttribute("aria-level")||void 0}function f(e){return"number"==typeof e&&e>=1&&e<=6}n.default.handle((e=>{if(c(e))return()=>{const t=p(e),n=s().setAestheticStyle("markdown-heading");o.default.removeContents(n.element),n.element.replaceChildren(...e.childNodes),e.replaceWith(n.element),n.emitInsert(),f(t)&&n.setAestheticLevel(t)}})),t.default=s})),define("ui/utility/EventManipulator",["require","exports","utility/Arrays","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=Symbol("REGISTERED_FUNCTION");function i(e){if(!(e&&e instanceof Node))return;let t=e;do{const e=t.component;if(e)return e}while(t=t.parentNode)}t.default=function(e){const t=function(e){return"object"==typeof e&&null!==e&&"isComponent"in e}(e)?e:{element:document.createElement("span")},r={emit(e,...o){const n={result:[],params:o};let a=!1,i=!1;const r=Object.assign(new CustomEvent(e,{detail:n}),{preventDefault(){Event.prototype.preventDefault.call(this),i||=!0},stopPropagation(){a||=!0},stopImmediatePropagation(){a="immediate"}});return t.element.dispatchEvent(r),Object.assign(n.result,{defaultPrevented:r.defaultPrevented||i,stoppedPropagation:a})},bubble(e,...o){const n={result:[],params:o};let a=!1,i=!1;const r=Object.assign(new CustomEvent(e,{detail:n,bubbles:!0}),{preventDefault(){Event.prototype.preventDefault.call(this),i||=!0},stopPropagation(){a||=!0},stopImmediatePropagation(){a="immediate"}});return t.element.dispatchEvent(r),Object.assign(n.result,{defaultPrevented:r.defaultPrevented||i,stoppedPropagation:a})},subscribe:(e,t)=>l(t,e),subscribePassive:(e,t)=>l(t,e,{passive:!0}),subscribeCapture:(e,t)=>l(t,e,{capture:!0}),unsubscribe(n,i){const r=i[a];if(!r)return e;delete i[a];for(const e of o.default.resolve(n))t.element.removeEventListener(e,r);return e},until:(t,o)=>(o({subscribe(e,o){return r.subscribe(e,o),n.default.Owner.getOwnershipState(t).matchManual(!0,(()=>r.unsubscribe(e,o))),this},subscribeCapture(e,o){return r.subscribeCapture(e,o),n.default.Owner.getOwnershipState(t).matchManual(!0,(()=>r.unsubscribe(e,o))),this},subscribePassive(e,o){return r.subscribePassive(e,o),n.default.Owner.getOwnershipState(t).matchManual(!0,(()=>r.unsubscribe(e,o))),this}}),e)};return r;function l(n,r,l){if(n[a])return console.error(`Can't register handler for event(s) ${o.default.resolve(r).join(", ")}, already used for other events`,n),e;const u=t=>{const o=t instanceof CustomEvent?t:void 0,a=o?.detail,r=n(Object.assign(t,{host:e,targetComponent:i(t.target)}),...a?.params??[]);a?.result.push(r)};Object.assign(n,{[a]:u});for(const e of o.default.resolve(r))t.element.addEventListener(e,u,l);return e}}})),define("ui/component/core/Link",["require","exports","navigation/RoutePath","ui/Component","ui/InputBus","ui/utility/MarkdownContent","utility/Env","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=n.default.Builder("a",((e,t)=>{t=l.default.get(t),e.and(a.HandlesMouseEvents).style("link");const o=(0,l.default)(!0),n=e.extend((e=>({canNavigate:o,setNavigationDisabled:(t=!0)=>(o.value=!t,e)})));return t.use(n,(e=>{n.attributes.set("href",e&&`${r.default.URL_ORIGIN}${e.slice(1)}`)})),n.event.subscribe("click",(e=>{if(!t.value)return;if(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||0!==e.button)return;e.preventDefault();const a=e.targetComponent?.element.closest("button")?.component;a&&a!==n&&!a?.element.contains(n.element)||o.value&&(e.stopImmediatePropagation(),navigate.toURL(t.value),n.event.emit("Navigate"))})),n}));i.default.handle(((e,t)=>{if("A"!==e.tagName)return;let n=e.getAttribute("href");return n?.startsWith(r.default.URL_ORIGIN)&&(n=n.slice(r.default.URL_ORIGIN.length-1)),o.RoutePath.is(n)?()=>{const t=u(n).text.set(e.textContent??"");e.replaceWith(t.element)}:void 0})),t.default=u})),define("ui/component/core/Paragraph",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const n=(o=__importDefault(o)).default.Builder((e=>e.style("paragraph")));t.default=n})),define("ui/utility/TypeManipulator",["require","exports","utility/Arrays","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=Object.assign((function(e,t,o){const a=(0,n.default)(new Set);return Object.assign(i,{state:a,remove:r,toggle:(e,...t)=>e?i(...t):r(...t)});function i(...o){const n=a.value.size,i=o.filter((e=>!a.value.has(e)));for(const e of i)a.value.add(e);return t(i),a.value.size!==n&&a.emit(),e}function r(...t){const n=a.value.size,i=t.filter((e=>a.value.has(e)));for(const e of i)a.value.delete(e);return o(i),a.value.size!==n&&a.emit(),e}}),{Style:function(e,t){const i=Array.isArray(t)?t:[[e,t]],r=[];let l;return a(e,(e=>{r.push(...e),r.distinctInPlace(),l?.();const t=n.default.Owner.create();l=t.remove;for(const[a,l]of i)if(n.default.is(a))a.use(t,(e=>{for(const t of o.default.resolve(e))for(const e of r)t.style(l(e))}));else for(const t of e)for(const e of o.default.resolve(a))e.style(l(t))}),(e=>{r.filterInPlace((t=>!e.includes(t)));for(const t of e)for(let[e,a]of i){n.default.is(e)&&(e=e.value);for(const n of o.default.resolve(e))n.style.remove(a(t))}}))}});t.default=a})),define("ui/component/core/Block",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Paragraph","ui/utility/TypeManipulator","utility/State"],(function(e,t,o,n,a,i,r,l,u){var s;Object.defineProperty(t,"__esModule",{value:!0}),t.BlockClasses=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),function(e){e.Main="_block",e.Header="_block-header"}(s||(t.BlockClasses=s={}));const d=o.default.Builder((e=>{let t,d,c;const p=(0,u.default)(null,!1),f=p.mapManual((e=>!!e?.length)),m=e.supers.mapManual((()=>e.is(i.default)));return e.classes.add(s.Main).viewTransition("block").style("block").style.bind(m,"block--link").extend((n=>({title:void 0,header:void 0,description:void 0,primaryActions:void 0,content:(0,o.default)().style("block-content").appendTo(e),footer:void 0,type:(0,l.default)(n,(e=>{for(const o of e)n.style(`block--type-${o}`),t?.style(`block--type-${o}-header`),d?.style(`block--type-${o}-footer`)}),(e=>{for(const o of e)n.style.remove(`block--type-${o}`),t?.style.remove(`block--type-${o}-header`),d?.style.remove(`block--type-${o}-footer`)})),useGradient:e=>(c?.(),c=p.bind(n,u.default.get(e)),n)}))).tweak((e=>{const t=e.type.state.map(e,(e=>e.has("flush")));e.style.bindFrom(u.default.MapManual([m,e.type.state],((e,t)=>[...t].map((t=>`block${e?"--link":""}--type-${t}`))))),(0,o.default)().style("block-gradient").style.bind(t,"block-gradient--flush").style.bindVariable("block-gradient",p.map(e,(e=>e?.length?`${e.map((e=>`#${e.toString(16).padStart(6,"0")}`)).map((e=>`light-dark(\n\t\t\t\t\t\t\toklch(from ${e} max(var(--block-gradient-light-max), L) C H),\n\t\t\t\t\t\t\toklch(from ${e} min(var(--block-gradient-dark-min), L) C H)\n\t\t\t\t\t\t)`)).join(", ")}`:void 0))).prependToWhen(f,e)})).extendJIT("header",(e=>t=(0,o.default)("hgroup").style("block-header").style.bindFrom(e.type.state.mapManual((e=>[...e].map((e=>`block--type-${e}-header`))))).classes.add(s.Header).prependTo(e))).extendJIT("title",(e=>(0,a.default)().style("block-title").prependTo(e.header))).extendJIT("primaryActions",(e=>(0,o.default)().style("block-actions-primary").appendTo(e.header))).extendJIT("description",(e=>(0,r.default)().style("block-description").appendTo(e.header))).extendJIT("footer",(e=>d=(0,n.default)().style("block-footer").style.bindFrom(e.type.state.mapManual((e=>[...e].map((e=>`block--type-${e}-footer`))))).appendTo(e)))}));t.default=d})),define("ui/view/shared/ext/ViewTitle",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=o.default.Extension(((e,t)=>(t&&e.attributes.use("data-view-title",t),e)))})),define("utility/Objects",["require","exports","utility/string/Strings"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.mutable=function(e){return e},o=__importDefault(o),function(e){function t(e,t){return Object.fromEntries(Object.entries(e).filter(t))}function n(e,t,o){const n=()=>{const n=o();return delete e[t],e[t]=n,n instanceof Promise&&n.then((o=>e[t]=o)),n};n.compute=o,Object.defineProperty(e,t,{configurable:!0,get:n})}function a(e,t){return r(e,t)}e.EMPTY={},e.keys=function(e){return Object.keys(e)},e.values=function(e){return Object.values(e)},e.entries=function(e){return Object.entries(e)},e.inherit=function(e,t){return Object.setPrototypeOf(e,t.prototype),e},e.filterNullish=function(e){return t(e,(e=>null!==e[1]&&void 0!==e[1]))},e.filter=t,e.map=function(e,t){return Object.fromEntries(Object.entries(e).map(t))},e.mapAsync=async function(e,t){return Object.fromEntries(await Promise.all(Object.entries(e).map(t)))},e.followPath=function(e,t){for(const o of t)e=e?.[o];return e},e.applyJIT=n,e.copyJIT=function(e,t,o){const a=Object.getOwnPropertyDescriptor(t,o);if(!a)return;if("value"in a)return void(e[o]=t[o]);const i=a.get?.compute;i&&n(e,o,i)},e.assign=function(e,...t){for(const o of t)for(const t of Object.keys(o)){const n=Object.getOwnPropertyDescriptor(e,t);n&&!n.writable||(e[t]=o[t])}return e},e.merge=function e(t,o){if("object"!=typeof t||"object"!=typeof o||null===t||null===o||Array.isArray(t)||Array.isArray(o))return void 0===o?t:o;const n={};for(const a of new Set([...Object.keys(t),...Object.keys(o)]))n[a]=e(t[a],o[a]);return n},e.stringify=a;const i=Symbol("STRINGIFY_DISABLED");function r(e,t,n=[]){if(void 0===e)throw new Error("Cannot stringify undefined");if(null===e||"object"!=typeof e)return JSON.stringify(e);if(n.includes(e))return"[Circular]";if(n.push(e),Array.isArray(e)){const a=e.map((e=>"object"==typeof e&&e&&(e[i]||e instanceof Node)?"[Omitted]":"function"==typeof e?"[Function]":"symbol"==typeof e?e.description??"[Symbol]":r(e,t,n)));return t?`[\n${o.default.indent(a.join(",\n"),t)}\n]`:`[${a.join(",")}]`}const a=function(e){if(Object.getPrototypeOf(e)===Object.prototype)return Object.entries(e);const t={};let o=e;for(;o&&o!==Object.prototype;){for(const n of Object.getOwnPropertyNames(o))try{t[n]??=e[n]}catch{}o=Object.getPrototypeOf(o)}return Object.entries(t)}(e).filter((([,e])=>void 0!==e&&"function"!=typeof e&&"symbol"!=typeof e&&!("object"==typeof e&&e&&(e[i]||e instanceof Node)))).sort((([e],[t])=>e.localeCompare(t)));return t?`{\n${o.default.indent(a.map((([e,o])=>`${JSON.stringify(e)}: ${r(o,t,n)}`)).join(",\n"))}\n}`:`{${a.map((([e,o])=>`${JSON.stringify(e)}:${r(o,t,n)}`)).join(",")}}`}function l(e,t,o){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;if(!e||!t)return!1;if(o.includes(e)||o.includes(t))return!1;o.push(e,t);const n=Array.isArray(e);if(n!==Array.isArray(t))return!1;if(n){const n=t;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(!l(e[t],n[t],o))return!1;return!0}const a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return!1;for(const n of a){if(!i.includes(n))return!1;if(!l(e[n],t[n],o))return!1}return!0}!function(e){function t(e){return Object.defineProperty(e,i,{value:!0}),e}e.disable=t,t(window),t(document)}(a=e.stringify||(e.stringify={})),e.deepEquals=function(e,t){return l(e,t,[])},e.strip=function(e,...t){if(void 0!==e)for(const o of t)delete e[o];return e}}(n||(n={})),t.default=n})),define("ui/component/core/Tabinator",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/utility/TypeManipulator","ui/view/shared/ext/ViewTitle","utility/Objects","utility/State"],(function(e,t,o,n,a,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),t.Tab=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),u=__importDefault(u),t.Tab=o.default.Builder(((e,t)=>{const n=(0,o.default)().style("tabinator-panel").ariaRole("tabpanel").setRandomId(),i=e.and(a.default).type("flush").style("tabinator-tab").ariaRole("tab").setRandomId().ariaControls(n).extend((e=>({content:n,tabinator:void 0,tabId:t,tweakContent:(t,...o)=>(n.tweak(t,e,...o),e),addTo:t=>(t.addTab(e),e),addToWhen:(t,o)=>(o.addTabWhen(t,e),e),createNextButton:()=>(0,a.default)().text.use("shared/action/next").event.subscribe("click",r),showNextTab:r})));return n.ariaLabelledBy(i).setOwner(i),i;function r(){const e=i.tabinator?.tabs.value.indexOf(i)??-1;if(-1===e)return;const t=i.tabinator.tabs.value[e+1];t&&i.tabinator.showTab(t)}})).setName("Tab");const s=o.default.Builder((e=>{const t=(0,u.default)(void 0);let a=!0;const s=(0,u.default)([]),d=(0,u.default)(!1),c=()=>s.value.find((e=>!e.style.has("tabinator-tab--hidden"))),p=e.and(n.default).type("flush").style("tabinator").ariaRole("tablist").extend((e=>({tabType:i.default.Style(e,[[e,e=>`tabinator--type-${e}`],[e.header,e=>`tabinator--type-${e}-tab-list`],[s,e=>`tabinator--type-${e}-tab`]]),tab:t,tabs:s,allowNoneVisible:()=>(a=!1,e),showTab(o){if("string"==typeof o){const t=s.value.find((e=>e.tabId===o));if(!t)return e;o=t}return s.value.includes(o)&&!o.style.has("tabinator-tab--hidden")&&(t.value=o),e},showNone(){if(a)throw new Error("Cannot show none when `allowNoneVisible` is not set");return t.value=void 0,e},addTab(o){if(s.value.includes(o))return e;const n=t.map(o,(e=>e===o));return o.setOwner(e).attributes.bind(n,"aria-selected","true","false").style.bind(n,"tabinator-tab--active").event.subscribe("click",(()=>{t.value!==o||a?t.value=o:t.value=void 0})).appendTo(e.header),o.content.style("tabinator-panel--hidden").style.bind(d,"tabinator-panel--major").appendTo(e.content),(0,l.mutable)(o).tabinator=e,s.value.push(o),s.emit(),void 0===e.tab.value&&a&&(t.value=o),e},addTabWhen:(o,n)=>(e.addTab(n),n.style.bind(o.falsy,"tabinator-tab--hidden"),o.falsy.subscribe(n,(e=>{e&&t.value===n&&(t.value=a?c():void 0)})),e),removeTab:o=>s.value.includes(o)?((0,l.mutable)(o).tabinator=void 0,o.setOwner(void 0),o.remove(),s.value.filterInPlace((e=>e!==o)),s.emit(),t.value===o&&(t.value=a?c():void 0),e):e,bindURL:(t,o)=>(t&&e.showTab(t),e.tab.useManual((e=>navigate.setURL(o(e?.tabId,e)))),e),bindViewTitle(){return(0,o.default)().and(r.default).style("tabinator-view-title").tweak((e=>this.tab.use(e,(t=>e.text.bind(t?.text.state))))).appendTo(e.header),e},setMajor:(t=!0)=>(d.value=t,e)})));return p.header.style("tabinator-tab-list").style.bind(t.mapManual((e=>!e)),"tabinator-tab-list--no-tab-shown"),p.content.style("tabinator-content"),t.useManual(((e,t)=>{const o=s.value.indexOf(e)+1,n=s.value.indexOf(t)+1||o,a=Math.sign(o-n);t?.content.style("tabinator-panel--hidden").style.setVariable("page-direction",a),e?.content.style.remove("tabinator-panel--hidden").style.setVariable("page-direction",a)})),p}));t.default=s})),define("endpoint/changelogs/$changelog_id/EndpointChangelogs$changelogIdDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/changelogs/{changelog_id}/delete","post").noResponse()})),define("endpoint/changelogs/$changelog_id/EndpointChangelogs$changelogIdUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/changelogs/{changelog_id}/update","post").noResponse()})),define("endpoint/changelogs/EndpointChangelogsAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/changelogs/add","post").noResponse()})),define("endpoint/changelogs/EndpointChangelogsList",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/changelogs/list","get")})),define("endpoint/auth/EndpointAuthDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/delete","post").noResponse()})),define("endpoint/sessions/EndpointSessionsGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/sessions/get","get")})),define("endpoint/sessions/EndpointSessionsReset",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/sessions/reset","post").noResponse()})),define("utility/Store",["require","exports","utility/State"],(function(e,t,o){let n,a,i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);class r{static get items(){return n??=new Proxy({},{has:(e,t)=>r.has(t),get:(e,t)=>r.get(t),set:(e,t,o)=>r.set(t,o),deleteProperty:(e,t)=>r.delete(t)})}static get state(){const e=i??={};return a??=new Proxy({},{has:(e,t)=>r.has(t),get:(t,n)=>e[n]??=(0,o.default)(r.get(n))})}static get full(){const e={};for(const[t,o]of Object.entries(localStorage))e[t]=JSON.parse(o);return e}static has(e){return null!==localStorage.getItem(e)}static get(e){const t=localStorage.getItem(e);try{return null===t?null:JSON.parse(t)}catch{return localStorage.removeItem(e),null}}static set(e,t){void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t));const o=i?.[e];return o&&(o.value=t),!0}static delete(e){localStorage.removeItem(e);const t=i?.[e];return t&&(t.value=void 0),!0}}t.default=r,Object.assign(window,{Store:r})})),define("utility/Popup",["require","exports","ui/utility/StringApplicator","utility/State","utility/Store"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),a=__importDefault(a);t.default=function(e){return{...e,show(t,i){const r=i?.url??e.url;if(!r){console.error("Popup URL is not defined");return Object.assign(Promise.resolve(),{toastError:()=>Promise.resolve(!1)})}const l=i?.translation??e.translation,u=i?.width??e.width??600,s=i?.height??e.height??800,d=(window.innerWidth-u)/2+window.screenLeft,c=(window.innerHeight-s)/2+window.screenTop;let p=!1;const f=Object.assign(new Promise(((e,i)=>{delete a.default.items.popupError;const f="width="+u+",height="+s+",top="+c+",left="+d,m="string"==typeof l?o.quilt[l]():l?.(o.quilt,o.QuiltHelper),v=window.open(r,m?.toString(),f),h=n.default.Owner.getOwnershipState(t).matchManual(!0,(()=>v?.close())),g=setInterval((()=>{if(v?.closed){h(),clearInterval(g);const t=a.default.items.popupError;if(t){const e=Object.assign(new Error(t.message??"Internal Server Error"),{code:t.code});if(!p)return i(e);toast.handleError(e)}e(p?!t:void 0)}}),100)})),{toastError:()=>(p=!0,f)});return f}}}})),define("model/Session",["require","exports","endpoint/auth/EndpointAuthDelete","endpoint/sessions/EndpointSessionsGet","endpoint/sessions/EndpointSessionsReset","utility/Objects","utility/Popup","utility/State","utility/Store"],(function(e,t,o,n,a,i,r,l,u){var s;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),function(e){const t=(0,l.default)(void 0);e.state=t,e.has=t.mapManual((e=>!!e));const s=[];async function d(){const e=u.default.items.session?.author?.vanity,o=await n.default.query(),a=o.headers.get("State-Token");a&&(u.default.items.stateToken=a);const i=o?.data??void 0;if(u.default.items.session?.created!==i?.created)for(const e of s)"function"==typeof e?e():u.default.delete(e);u.default.items.session=i,t.value=i,e!==u.default.items.session?.author?.vanity&&navigate.fromURL(!0)}let c;e.setClearedWithSessionChange=function(...e){s.push(...e)},e.init=function(){t.value=u.default.items.session,d()},e.refresh=d,e.reset=async function(e=!1){const o=u.default.items.session?.author?.vanity;await a.default.query(),delete u.default.items.session,t.value=void 0,e||(await d(),o&&navigate.fromURL(!0))},e.setAuthor=function(e){const o=u.default.items.session?.author?.vanity,n=u.default.items.session;if(!n)return void d();const a={...n,author:{...e,authorisations:void 0},authorisations:e.authorisations??n.authorisations};u.default.items.session=a,t.value=a,o!==u.default.items.session?.author?.vanity&&navigate.fromURL(!0)},e.getStateToken=function(){return u.default.items.stateToken},function(t){t.state=e.state.mapManual((e=>e?.author?"logged-in":e?.partial_login?"partial-login":u.default.items.session?.authorisations?.length?"has-authorisations":"none")),t.loggedIn=t.state.mapManual((e=>"logged-in"===e)),t.authorisations=e.state.mapManual((e=>e?.author?.authorisations??e?.authorisations??[]),!1),t.account=e.state.mapManual((e=>e?.author),!1),t.author=t.account.mapManual((e=>e?i.default.strip({...e},"roles","settings","description","license","authorisations","patreon_campaign","patreon_patron","works","settings","roles","totp_state","auth_services_required","age","privileges","revoked_privileges"):void 0),i.default.deepEquals),t.partialLogin=e.state.mapManual((e=>e?.partial_login)),t.get=function(t){return _??e.Auth.account.value?.authorisations?.find((e=>e.service===t))??e.Auth.authorisations.value.find((e=>e.service===t))},t.loggedInAs=function(e,o){return o=l.default.get(o),l.default.Map(e,[t.author,o],((e,t)=>e?.vanity===t))},t.isAuthed=function(t){return e.Auth.account.value?.authorisations?.some((e=>e.service===t.name))||e.Auth.authorisations.value.some((e=>e.service===t.name))};const n={};t.privileged=new Proxy({},{get(t,o){const a=o;return n[a]??=e.Auth.account.mapManual((e=>e?.roles?.some((e=>e.privileges?.includes(a)))??!1))}});const a=Object.values({ModerationCensor:t.privileged.ModerationCensor,ModerationDelete:t.privileged.ModerationDelete,ModerationGrantSupporter:t.privileged.ModerationGrantSupporter,ModerationLock:t.privileged.ModerationLock,ModerationViewReport:t.privileged.ModerationViewReport,ModerationViewPatronOnly:t.privileged.ModerationViewPatronOnly,ModerationAuthorTag:t.privileged.ModerationAuthorTag,ModerationViewComments:t.privileged.ModerationViewComments,ModerationManageDefaultShelves:t.privileged.ModerationManageDefaultShelves,ModerationViewStatistics:t.privileged.ModerationViewStatistics});t.isModerator=l.default.Generator((()=>a.some((e=>e.value)))).observeManual(...a),t.unauth=async function(t){const n="string"==typeof t?t:t.id,a=await o.default.query({body:{id:n}});if(toast.handleError(a))return;const i=u.default.items.session,r=i?.author?.authorisations??i?.authorisations;r&&(r.filterInPlace((e=>e.id!==n)),!r.length&&i?.partial_login&&(i.authorisations=null,delete i?.partial_login),u.default.items.session=i,e.state.asMutable?.setValue(i))};const s=(0,r.default)({width:600,height:900});t.auth=async function(t,o){await s.show(t,{translation:e=>e["view/account/auth/popup/title"](o.name),url:o.url_begin}).toastError(),await e.refresh()},t.await=async function(e){return"logged-in"===t.state.value||new Promise((o=>{t.state.subscribe(e,(function e(n){if("logged-in"!==n)return;o(),t.state.unsubscribe(e)}))}))}}(c=e.Auth||(e.Auth={}))}(s||(s={})),Object.assign(window,{Session:s}),t.default=s})),define("ui/component/core/ext/ComponentInsertionTransaction",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=function(e,t){let n=e?.removed.useManual((e=>e&&u()));const a=(0,o.default)(!1);let i=!1;const r={isInsertionDestination:!0,closed:a,get size(){return e?.element.children.length??0},append:(...t)=>(a.value||e?.append(...t),r),prepend:(...t)=>(a.value||e?.prepend(...t),r),insert:(t,o,...n)=>(a.value||e?.insert(t,o,...n),r),abort(){a.value||l()},close(){a.value||(i||t?.(r),l())}};return r;function l(){a.value=!0,n?.(),n=void 0,e=void 0}function u(){n?.(),n=void 0,i=!0,r.close()}}})),define("ui/component/core/Dialog",["require","exports","ui/Component","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=new Set;function i(e){const t=!!a.size;a.add(e),t||o.default.getDocument().style("has-dialog")}function r(e){a.delete(e),a.size||o.default.getDocument().style.remove("has-dialog")}const l=Object.assign(o.default.Builder((()=>{const e=(0,n.default)(!1),t=(0,n.default)(!1),a=(0,n.default)(!1);let l,u=!0;return(0,o.default)("dialog").style("dialog").style.bind(e,"dialog--open").extend((o=>({opened:e,willClose:a,willOpen:t,setNotModal:(e=!0)=>(u=!e,o.style.toggle(e,"dialog--not-modal"),o),setFullscreen:(e=!0)=>o.style.toggle(e,"dialog--fullscreen"),open:()=>(t.value=!0,o.willOpen.value?(l?.(),i(o),o.element[u?"showModal":"show"](),e.value=!0,t.value=!1,o):o),close:()=>(a.value=!0,o.willClose.value?(l?.(),r(o),o.element.close(),e.value=!1,a.value=!1,o):o),toggle:(t=!o.opened.value)=>{const n=t?"willOpen":"willClose";return o[n].asMutable?.setValue(!0),o[n].value?(l?.(),t?(i(o),o.element[u?"showModal":"show"]()):(r(o),o.element.close()),e.value=t??!e.value,o[n].asMutable?.setValue(!1),o):o},bind:t=>(l?.(),l=t.use(o,(t=>{const n=t?"willOpen":"willClose";o[n].asMutable?.setValue(!0),t?(i(o),o.element[u?"showModal":"show"]()):(r(o),o.element.close()),e.value=t,o[n].asMutable?.setValue(!1)})),o),unbind:()=>(l?.(),o)})))})),{await(e){let t=!1;return e.rooted.value||(t=!0,e.appendTo(document.body)),new Promise((o=>{e.open(),e.event.subscribe("close",(n=>{n.host.event.subscribe("transitionend",(()=>{t&&e.remove(),o()}))})),navigate.event.until(e,(t=>t.subscribe("Navigate",(()=>e.close()))))}))}});t.default=l})),define("ui/utility/FocusListener",["require","exports","utility/State"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.hasFocus=(0,o.default)(!1),e.focused=(0,o.default)(void 0),e.focusedLast=(0,o.default)(void 0),e.focusedComponent=function(){return e.focused.value?.component},e.focus=function(e){!function(e){if(document.querySelector(":focus-visible")===e)return;if(n>100)return;n++,e.focus(),window.clearTimeout(t),window.setTimeout((()=>n=0))}(e)};let t,n=0;function a(){r()}function i(e){null===e.relatedTarget&&r()}function r(){document.activeElement&&document.activeElement!==document.body&&location.hash&&document.activeElement.id!==location.hash.slice(1)&&history.pushState(void 0,""," ");const t=document.querySelector(":focus-visible")??void 0;if(t===e.focused.value)return;const o=e.focusedLast.value?.component;if(o){o.hadFocusedLast.asMutable?.setValue(!1);for(const e of o.getAncestorComponents())e.hadFocusedLast.asMutable?.setValue(!1)}const n=e.focused.value?.component,a=t?.component,i=n?[...n.getAncestorComponents()]:void 0,r=a?[...a.getAncestorComponents()]:void 0,l=e.focused.value?.contains(t??null);if(e.focusedLast.value=e.focused.value,e.focused.value=t,e.hasFocus.value=!!t,n&&(l||(a||n.hadFocusedLast.asMutable?.setValue(!0),n.hasFocusedTime.asMutable?.setValue(void 0)),n.focusedTime.asMutable?.setValue(void 0)),a&&(a.focusedTime.asMutable?.setValue(Date.now()),a.hasFocusedTime.asMutable?.setValue(Date.now())),i)for(const e of i)r?.includes(e)||e&&(a||e.hadFocusedLast.asMutable?.setValue(!0),e.hasFocusedTime.asMutable?.setValue(void 0));if(r)for(const e of r)e&&e.hasFocusedTime.asMutable?.setValue(Date.now())}e.blur=function(e){!function(e){if(document.querySelector(":focus-visible")!==e)return;e.blur()}(e)},e.listen=function(){document.addEventListener("focusin",a),document.addEventListener("focusout",i)}}(n||(n={})),t.default=n,Object.assign(window,{FocusListener:n})})),define("utility/maths/Vector2",["require","exports"],(function(e,t){function o(e=0,t){return void 0===t&&(t=e),{x:e,y:t}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ZERO={x:0,y:0},e.ONE={x:1,y:1},e.mutable=function(e=0,t){return void 0===t&&(t=e),{x:e,y:t}},e.fromClient=function(e){return{x:e.clientX,y:e.clientY}},e.equals=function(e,t){return e.x===t.x&&e.y===t.y},e.distance=function(e,t){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)},e.distanceWithin=function(e,t,o){return(o.x-t.x)**2+(o.y-t.y)**2<e**2},e.add=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},e.addInPlace=function(e,t){return e.x+=t.x,e.y+=t.y,e},e.subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},e.subtractInPlace=function(e,t){return e.x-=t.x,e.y-=t.y,e},e.multiply=function(e,t){return{x:e.x*t,y:e.y*t}},e.multiplyInPlace=function(e,t){return e.x*=t,e.y*=t,e},e.divide=function(e,t){return{x:e.x/t,y:e.y/t}},e.divideInPlace=function(e,t){return e.x/=t,e.y/=t,e},e.modTruncate=function(e,t){return{x:e.x%t,y:e.y%t}},e.modTruncateInPlace=function(e,t){return e.x%=t,e.y%=t,e},e.modFloor=function(e,t){return{x:(e.x%t+t)%t,y:(e.y%t+t)%t}},e.modFloorInPlace=function(e,t){return e.x=(e.x%t+t)%t,e.y=(e.y%t+t)%t,e},e.dot=function(e,t){return e.x*t.x+e.y*t.y},e.magnitude=function(e){return Math.sqrt(e.x**2+e.y**2)},e.normalise=function(t){const o=e.magnitude(t);return e.divide(t,o)},e.normaliseInPlace=function(t){const o=e.magnitude(t);return e.divideInPlace(t,o)},e.angle=function(t,o){const n=e.dot(t,o),a=e.magnitude(t)*e.magnitude(o),i=Math.max(-1,Math.min(1,n/a));return Math.acos(i)},e.rotate=function(e,t){const o=Math.cos(t),n=Math.sin(t);return{x:e.x*o-e.y*n,y:e.x*n+e.y*o}},e.rotateInPlace=function(e,t){const o=Math.cos(t),n=Math.sin(t),a=e.x;return e.x=a*o-e.y*n,e.y=a*n+e.y*o,e},e.lerp=function(e,t,o){return{x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}},e.clamp=function(e,t,o){return{x:Math.min(Math.max(e.x,t.x),o.x),y:Math.min(Math.max(e.y,t.y),o.y)}},e.clampInPlace=function(e,t,o){return e.x=Math.min(Math.max(e.x,t.x),o.x),e.y=Math.min(Math.max(e.y,t.y),o.y),e}}(o||(o={})),t.default=o})),define("ui/utility/Mouse",["require","exports","utility/State"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){const t={x:0,y:0};e.state=(0,o.default)(t);const n=new Set;e.onMove=function(e){n.add(e)},e.offMove=function(e){n.delete(e)},e.listen=function(){document.addEventListener("mousemove",(o=>{if(t.x!==o.clientX||t.y!==o.clientY){t.x=o.clientX,t.y=o.clientY,e.state.emit();for(const e of n)e(t)}}))}}(n||(n={})),t.default=n})),define("ui/utility/HoverListener",["require","exports","ui/utility/Mouse"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){let t=[];e.allHovered=function(){return t},e.hovered=function(){return t.at(-1)},e.allHoveredComponents=function*(){for(const e of t){const t=e.component;t&&(yield t)}},e.hoveredComponent=function(){return t.at(-1)?.component},e.listen=function(){o.default.onMove((()=>{const e=[...document.querySelectorAll(":hover")],o=e[e.length-1];if(0!==o.clientWidth&&0!==o.clientHeight||e.filterInPlace((e=>"none"!==e.computedStyleMap().get("display")?.toString())),o===t[t.length-1])return;const n=e,a=t.filter((e=>!n.includes(e)));for(const e of a)e.component&&e.component.hoveredTime.asMutable?.setValue(void 0);const i=n.filter((e=>!t.includes(e)));for(const e of i)e.component&&e.component.hoveredTime.asMutable?.setValue(Date.now());t=n}))}}(n||(n={})),t.default=n,Object.assign(window,{HoverListener:n})})),define("ui/utility/Viewport",["require","exports","utility/State","utility/Style"],(function(e,t,o,n){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),function(e){e.size=o.default.JIT((()=>({w:window.innerWidth,h:window.innerHeight}))),e.mobile=o.default.JIT((t=>{const o=n.default.measure("--content-width"),a=e.size.value.w<o.value;return o.subscribe(t,e.mobile.markDirty),e.size.subscribe(t,e.mobile.markDirty),a})),e.tablet=o.default.JIT((t=>{const o=n.default.measure("--tablet-width"),a=e.size.value.w<o.value;return o.subscribe(t,e.tablet.markDirty),e.size.subscribe(t,e.tablet.markDirty),a})),e.laptop=o.default.JIT((t=>{const o=n.default.measure("--laptop-width"),a=e.size.value.w<o.value;return o.subscribe(t,e.laptop.markDirty),e.size.subscribe(t,e.laptop.markDirty),a})),e.state=o.default.JIT((t=>{const o=e.mobile.value?"mobile":e.tablet.value?"tablet":e.laptop.value?"laptop":"desktop";return e.mobile.subscribe(t,e.state.markDirty),e.tablet.subscribe(t,e.state.markDirty),e.laptop.subscribe(t,e.state.markDirty),o})),e.listen=function(){window.addEventListener("resize",e.size.markDirty)}}(a||(a={})),Object.assign(window,{Viewport:a}),t.default=a})),define("ui/component/core/Popover",["require","exports","ui/Component","ui/component/core/Dialog","ui/InputBus","ui/utility/FocusListener","ui/utility/HoverListener","ui/utility/Mouse","ui/utility/TypeManipulator","ui/utility/Viewport","utility/maths/Vector2","utility/Objects","utility/State","utility/Task"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f){Object.defineProperty(t,"__esModule",{value:!0}),o=__importStar(o),n=__importDefault(n),a=__importStar(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),p=__importDefault(p),f=__importDefault(f);var m;!function(e){let t;function n(){return t??=(0,o.default)().tabIndex("auto").ariaHidden().style.setProperty("display","none").prependTo(document.body)}e.show=function(){n().style.setProperty("display","inline")},e.hide=function(){n().style.setProperty("display","none")}}(m||(m={})),o.default.extend((e=>{e.extend((e=>({hasPopoverSet:()=>!!e.popover,clearPopover:()=>e.attributes.set("data-clear-popover","true"),setPopover:(t,i)=>{e.popover&&e.popover.remove(),e.style("has-popover");let u=!1;const c=v().anchor.from(e).tweak((e=>e.prepend((0,o.default)().style("popover-close-surface").event.subscribe("click",(()=>e.hide()))))).setOwner(e).setCloseDueToMouseInputFilter((t=>{const o=r.default.hovered()??null;return!e.element.contains(o)})).event.subscribe("toggle",(t=>{c.element.matches(":popover-open")||(u=!1,e.clickState=!1,l.default.offMove(D))})).tweak(i,e);let p,h;e.getStateForClosest(n.default).use(c,(e=>{c.appendTo(e()??document.body)}));let g=!1;function y(){g=!1,h=void 0,clearTimeout(p)}e.event.until(c,(t=>t.subscribe("touchstart",(t=>{if(h=d.default.fromClient(t.touches[0]),t.touches.length>1)return y();const o=[t.targetComponent,...t.targetComponent?.getAncestorComponents()??[]].find((e=>e?.hasPopoverSet()));o===e&&(p=window.setTimeout((()=>{g=!0,D(null,null,"longpress")}),800))})).subscribePassive("touchmove",(e=>{if(!h)return;if(e.touches.length>1)return y();const t=d.default.fromClient(e.touches[0]);return d.default.distanceWithin(20,h,t)?void 0:y()})).subscribe("touchend",(e=>{g&&e.preventDefault(),y()})).subscribe("contextmenu",(e=>{h||(e.preventDefault(),D(null,null,"longpress"))})))),c.visible.match(e,!0,(async()=>{c.hasContent()&&(c.show(),await f.default.yield(),c.rect.markDirty(),c.anchor.apply())})),c.style.bind(c.anchor.state.mapManual((e=>"bottom"===e?.preference?.yAnchor.side)),"popover--anchored-top");const _=e.hoveredOrFocused.delay(c,(e=>e?c.getDelay():0));"hover/click"!==t&&"hover/longpress"!==t&&"longpress"!==t||e.popover||_.subscribe(e,D);const b=e.ariaLabel.state.value,w=c.ariaLabel.state.map(c,(e=>b||e)),k=c.attributes.getUsing("role")??c.attributes.get("role");function T(){e.clickState=!1,c.hide()}return e.ariaLabel.bind(w.mapManual((e=>(t,{arg:o})=>t["popover/button"](o(e),o(k))))),c.ariaLabel.bind(w.mapManual((e=>(t,{arg:o})=>t.popover(o(e))))),navigate.event.subscribe("Navigate",T),c.removed.matchManual(!0,(()=>navigate.event.unsubscribe("Navigate",T))),e.clickState=!1,e.popover||(e.event.subscribe("click",(async o=>{if("hover/longpress"===t||"longpress"===t)return;const n=o.target.component?.closest(a.HandlesMouseEvents);n&&n?.element!==e.element&&e.element.contains(n.element)||(e.clickState=!e.clickState,o.stopPropagation(),o.preventDefault(),e.clickState?await x():c.hide())})),o.ComponentPerf.CallbacksOnInsertions.add(e,(function(){if(!e.popover)return;const t=e.popover.popoverParent.value;e.popover.popoverParent.asMutable?.setValue(e.closest(v)),t&&t!==e.popover.popoverParent.value&&t.popoverChildren.asMutable?.setValue(t.popoverChildren.value.filter((t=>t!==e.popover)));e.popover.popoverParent.value&&e.popover.popoverParent.value!==t&&e.popover.popoverParent.value.popoverChildren.asMutable?.setValue([...e.popover.popoverParent.value.popoverChildren.value,e.popover])}))),c.popoverHasFocus.subscribe(e,((t,o)=>{t||(e.clickState=!1,e.popover?.hide(),"no-focus"!==o&&e.focus())})),e.extend((e=>({popover:c,popoverDescendants:[],tweakPopover:t=>(t(e.popover,e),e),showPopover:()=>(x(),e),togglePopover:()=>(c.visible.value?c.hide():x(),e)})));async function x(){e.popover?.show(),e.popover?.focus(),e.popover?.style.removeProperties("left","top"),await f.default.yield(),e.popover?.rect.markDirty(),e.popover?.anchor.apply()}async function D(o,n,i){if(!e.popover)return;const d=_.value&&!("ontouchstart"in window||navigator.maxTouchPoints>0)&&!("longpress"===t&&s.default.tablet.value)||"longpress"===i||u&&("hover/longpress"===t||"longpress"===t)&&s.default.tablet.value||u&&(e.popover.isMouseWithin(!0)&&!function(){if(!e.popover)return!1;const t=r.default.hovered()??null;if(e.element.contains(t)||e.popover.element.contains(t))return!1;const o=t?.closest("[data-clear-popover]");if(!o)return!1;if(o.contains(e.element))return!1;const n=o.component?.closest(v);return!e.popover.containsPopoverDescendant(n)}()||a.default.isDown("F4"))||!!e.clickState;u!==d&&(_.value&&!u&&l.default.onMove(D),d||l.default.offMove(D),d||m.hide(),u=d,e.popover.toggle(d),d&&(m.show(),await f.default.yield(),e.popover?.rect.markDirty(),e.popover.anchor.apply()))}}})))}));const v=o.default.Builder((e=>{let t,n,d=0;const f=(0,p.default)(!1);let m,v=!0,h=!1;const g=[],y=e.style("popover").tabIndex("programmatic").attributes.set("popover","manual").extend((e=>({lastStateChangeTime:0,visible:f,type:u.default.Style(e,(e=>`popover--type-${e}`)),popoverChildren:(0,p.default)([]),popoverParent:(0,p.default)(void 0),popoverHasFocus:i.default.focused.map(e,(e=>e?f.value&&w(e)?"focused":void 0:"no-focus")),setCloseOnInput:(t=!0)=>(v=t,e),setCloseDueToMouseInputFilter:t=>(m=t,e),setMousePadding:o=>(t=o,e),setDelay:t=>(d=t,e),getDelay:()=>d,setNormalStacking:()=>(s.default.tablet.use(e,(t=>{const o=t();e.style.toggle(!o,"popover--normal-stacking"),e.attributes.toggle(o,"popover","manual"),h=!o,_(f.value)})),e),onShow:t=>(g.push(t),e),isMouseWithin:(o=!1)=>{if(e.rect.value.expand(t??100).intersects(l.default.state.value))return!0;if(o)for(const t of e.popoverChildren.value)if(t.isMouseWithin(!0))return!0;return!1},containsPopoverDescendant:w,show:()=>(n?.(),_(!0),e.visible.asMutable?.setValue(!0),e),hide:()=>(n?.(),_(!1),e.visible.asMutable?.setValue(!1),e),toggle:t=>(n?.(),_(t),e.visible.asMutable?.setValue(t??!e.visible.value),e),bind:t=>(n?.(),n=t.use(e,(t=>{_(t),e.visible.asMutable?.setValue(t)})),e),unbind:()=>(n?.(),e)})));return y.event.subscribe("toggle",(e=>{y.visible.asMutable?.setValue("open"===e.newState)})),y.onRooted((()=>{a.default.subscribe("down",b),y.removed.matchManual(!0,(()=>a.default.unsubscribe("down",b)))})),y;function _(e){if(e)for(const e of g)if(!1===e(y))return;y.hasContent()||(e=!1),h&&!s.default.tablet.value?y.style.toggle(!e,"popover--normal-stacking--hidden"):y.rooted.value&&y.style.remove("popover--normal-stacking--hidden").attributes.set("popover","manual").element.togglePopover(e),(0,c.mutable)(y).lastStateChangeTime=Date.now()}function b(e){y.visible.value&&v&&e.key.startsWith("Mouse")&&!y.containsPopoverDescendant(r.default.hovered())&&(m&&!m(e)||(y.rooted.value&&y.attributes.set("popover","manual").element.togglePopover(!1),y.visible.asMutable?.setValue(!1),(0,c.mutable)(y).lastStateChangeTime=Date.now()))}function w(e){if(!e)return!1;const t=o.default.is(e)?e.element:e;if(y.element.contains(t))return!0;for(const t of y.popoverChildren.value){if(t===e)return!0;if(t.containsPopoverDescendant(e))return!0}return!1}}));t.default=v})),define("utility/AbortPromise",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class o extends Promise{#e;constructor(e){const t=new AbortController;super(((o,n)=>e(o,n,t.signal))),this.#e=t,this.abort=this.abort.bind(this)}abort(){this.#e?.signal.aborted||this.#e?.abort()}}!function(e){e.asyncFunction=function(t){return(...o)=>new e(((e,n,a)=>{t(a,...o).then(e,n)}))}}(o||(o={})),t.default=o})),define("ui/component/core/Slot",["require","exports","ui/Component","ui/component/core/ext/ComponentInsertionTransaction","utility/AbortPromise","utility/State"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importStar(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),o.default.extend((e=>{e.extend((e=>({hasContent(){const t=document.createTreeWalker(e.element,NodeFilter.SHOW_TEXT);for(;t.nextNode();)if(t.currentNode.textContent?.trim())return!0;for(const t of e.getDescendants())if(!t.is(r))return!0;return!1},appendWhen(t,...n){let a=(0,o.default)().append(...n);return r().appendTo(e).preserveContents().if(t,(e=>{e.append(...n),a?.remove(),a=void 0})),e},prependWhen(t,...n){let a=(0,o.default)().append(...n);return r().prependTo(e).preserveContents().if(t,(e=>{e.append(...n),a?.remove(),a=void 0})),e},insertWhen(t,n,a,...i){let l=(0,o.default)().append(...i);return r().insertTo(e,n,a).preserveContents().if(t,(e=>{e.append(...i),l?.remove(),l=void 0})),e},appendToWhen(t,n){let a;return e.parent&&(a=(0,o.default)(),e.appendTo(a)),r().appendTo(n).preserveContents().if(t,(t=>{t.append(e),a?.remove(),a=void 0})),e},prependToWhen(t,n){let a;return e.parent&&(a=(0,o.default)(),e.appendTo(a)),r().prependTo(n).preserveContents().if(t,(t=>{t.append(e),a?.remove(),a=void 0})),e},insertToWhen(t,n,a,i){let l;return e.parent&&(l=(0,o.default)(),e.appendTo(l)),r().insertTo(n,a,i).preserveContents().if(t,(t=>{t.append(e),l?.remove(),l=void 0})),e}})))}));const r=Object.assign(o.default.Builder((e=>{let t,r,l,u;e.style("slot");const s=(0,i.default)({elseIfs:[]});let d,c,p=!1,f=!1;const m=(0,i.default)(!1);return e.style.bind(m,"slot--hidden").extend((e=>({preserveContents(){if(s.value.elseIfs.length||s.value.else)throw new Error("Cannot preserve contents when using elses");return p=!0,e},use:(a,s)=>{if(p)throw new Error('Cannot "use" when preserving contents');t?.(),t=void 0,l?.(),l=void 0,u?.(),u=void 0,c?.(),c=void 0,d?.(),d=void 0;const m=Array.isArray(a);if(m){const e=i.default.Owner.create();c=e.remove,a=i.default.Map(e,a,((...e)=>e))}else a=i.default.get(a);return t=a.use(e,(t=>{l?.(),l=void 0,r?.(),r=void 0,u?.(),u=void 0;const a=(0,o.default)(),i=(0,n.default)(a,(()=>{e.removeContents(),e.append(...a.element.children),f=!0}));Object.assign(i,{closed:a.removed}),u=i.abort,h(i,m?s(i,...t):s(i,t))})),e},if:(o,n)=>(t?.(),t=void 0,l?.(),l=void 0,u?.(),u=void 0,c?.(),c=void 0,d?.(),d=void 0,o.use(e,(t=>{if(l?.(),l=void 0,r?.(),r=void 0,u?.(),u=void 0,c?.(),c=void 0,d?.(),d=void 0,t)m.value=!1,p&&f||v(n);else{if(p)return void(m.value=!0);let t;const o=s.useManual((o=>{t=i.default.MapManual(o.elseIfs.map((({state:e})=>e)),((...e)=>e.indexOf(!0))).useManual((t=>{const n=-1===t?o.else:o.elseIfs[t].initialiser;n?v(n):e.removeContents()}))}));d=()=>{t?.(),o()}}})),e),elseIf(t,o){if(p)throw new Error("Cannot use else when preserving contents");return s.value.elseIfs.push({state:t,initialiser:o}),s.emit(),e},else(t){if(p)throw new Error("Cannot use else when preserving contents");return s.value.else=t,s.emit(),e}}))).tweak((e=>e.removed.matchManual(!0,(()=>r?.()))));function v(t){const a=(0,o.default)(),i=(0,n.default)(a,(()=>{e.removeContents(),e.append(...a.element.children),f=!0}));Object.assign(i,{closed:a.removed}),u=i.abort,h(i,t(i))}function h(e,t){if(!(t instanceof a.default))return g(e,t||void 0);l=t.abort,t.then((t=>g(e,t||void 0))).catch((e=>console.error("Slot initialiser promise rejection:",e)))}function g(t,n){if(n||=void 0,n===e&&(n=void 0),t.close(),u=void 0,o.default.is(n))return n.appendTo(e),f=!0,void(r=void 0);r=o.ComponentInsertionDestination.is(n)?void 0:n}})),{using:(e,t)=>r().use(i.default.get(e),t)});t.default=r})),define("ui/component/core/ext/CanHasActionsMenu",["require","exports","lang/en-nz","ui/Component","ui/component/core/Button","ui/component/core/Popover","ui/component/core/Slot","ui/utility/Viewport","utility/Objects","utility/State"],(function(e,t,o,n,a,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),s=__importDefault(s);const d=n.default.Builder((e=>{if(!e.is(i.default))throw new Error("ActionsMenu must be a Popover");const t=new Set,o={};return e.extend((e=>({actionsWrappers:o,anchorTweakers:t,appendAction:n((t=>t.appendTo(e))),prependAction:n((t=>t.prependTo(e))),insertAction:n(((t,n,a)=>t.insertTo(e,n,o[a]))),subscribeReanchor:o=>(t.add(o),e),unsubscribeReanchor:o=>(t.delete(o),e)})));function n(t){return function(...n){const[a]=n,[i,l]=n.slice(-2),u=n.slice(1,-2),s=(0,r.default)().tweak(t,...u);return o[a]=s,"function"==typeof i?(s.tweak(i),e):(s.use(i,l),e)}}})),c=n.default.Extension(((e,t)=>{let c;const p=(0,s.default)(!1);function f(){const e=o.default["shared/actions/empy"]().toString();p.value=!!c?.element.textContent?.replace(e,"").trim()}let m,v,h=!1;const g=e=>{c?(e(c),f()):(v??=[]).push(e)};return e.extend((e=>({actionsMenu:void 0,setActionsMenu:o=>(h=!0,m&&y(e),e.clearPopover().setPopover("longpress",((a,s)=>{a.onShow((t=>!e.closest(i.default))),c=(0,u.mutable)(e).actionsMenu=a.and(d).style("actions-menu-popover").style.bind(p.falsy,"actions-menu-popover--empy").prepend((0,n.default)().style("actions-menu-popover-close-surface").event.subscribe("click",(()=>a.hide()))).appendWhen(p.falsy,(0,n.default)().style("actions-menu-popover-empy-text").text.use("shared/actions/empy")).append((0,r.default)().style.remove("slot").style("actions-menu-popover-arrow")).tweak(t,s).tweak(o,s);for(const e of v??[])e(c);f(),l.default.tablet.use(c,(e=>{const t=e();c.anchor.reset(),t?c.type.remove("flush").anchor.add("aligned right","off bottom").anchor.add("aligned right","off top").anchor.orElseHide():c.type("flush").anchor.add("off right","centre").anchor.orElseHide();const{anchorTweakers:o}=c;for(const e of o)e(c,t)}))})),e),setActionsMenuButton:t=>(m=t??!0,h&&y(e),e),tweakActions:t=>(g((o=>o.tweak(t,e))),e),tweakActionsAnchor:t=>(g((e=>e.subscribeReanchor(t))),e),untweakActionsAnchor:t=>(g((e=>e.unsubscribeReanchor(t))),e)})));function y(e){const t=(0,a.default)().setIcon("ellipsis-vertical").type("icon").event.subscribe("click",(t=>{t.preventDefault(),t.stopImmediatePropagation(),l.default.tablet.value?e.togglePopover():e.showPopover()}));"function"==typeof m?m(t):t.appendTo(e)}}));t.default=c})),define("ui/component/core/Flag",["require","exports","ui/Component","utility/Arrays"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=o.default.Builder((e=>{const t=n.default.range(5).map((e=>(0,o.default)().style("flag-stripe",`flag-stripe-${i[e]}`,`flag-stripe-${e+1}`)));let a=1/0;const r=new Set;function l(e,o){o?function(e){if(!r.size){a=1/0;for(const e of t)e.style.remove("flag-stripe--animate-end-0","flag-stripe--animate-end-1"),e.style("flag-stripe--animate")}r.add(e)}(e):function(e){r.delete(e)}(e)}e.hoveredOrFocused.subscribe(e,(e=>l("focus",e)));for(const e of t){const o=e===t[0];let n=0;e.event.subscribe("animationstart",(()=>n=0)),e.event.subscribe("animationiteration",(()=>{n++,o&&!r.size&&(a=n),n>=a&&(e.style.remove("flag-stripe--animate"),e.style("flag-stripe--animate-end-"+n%2))}))}return e.style("flag").append(...t).extend((e=>({wave:(t,o)=>(l(t,o),e)})))}));t.default=a;const i=["blue","pink","white","pink","blue"]})),define("ui/component/core/Placeholder",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const n=(o=__importDefault(o)).default.Builder((e=>e.style("placeholder").extend((e=>({})))));t.default=n})),define("ui/component/core/Loading",["require","exports","ui/Component","ui/component/core/Flag","ui/component/core/Placeholder","utility/State"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i);const r=o.default.Builder((e=>{const t=(0,i.default)(!0),r=(0,i.default)(void 0),l=(0,n.default)().style("loading-flag").style.bind(t.falsy,"loading-flag--hidden").wave("loading",!0);let u,s;return e.style("loading").append(l).appendWhen(r.truthy,(0,o.default)().style("loading-progress").append((0,o.default)().style("loading-progress-bar").tweak((e=>e.style.bindVariable("progress",r.map(e,(e=>e?.progress??0))))),(0,a.default)().style("loading-progress-message").tweak((e=>e.text.bind(r.map(e,(e=>e?.message??""))))))).extend((e=>({enabled:t,flag:l,use:o=>(u?.(),u=t.bind(e,o.settled.falsy),s?.(),s=r.bind(e,o.progress),e)})))}));t.default=r})),define("ui/component/core/Form",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/Loading","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=o.default.Builder(((e,t)=>{const u=e.replaceElement("form").style("form").ariaRole("form").ariaLabelledBy(t??void 0);u.receiveDescendantInsertEvents(),u.event.subscribe("submit",(e=>e.preventDefault()));const s=l.default.Generator((()=>u.element.checkValidity()));u.event.subscribe(["input","change","descendantInsert"],(()=>s.refresh()));const d=(u.is(a.default)?u.content:(0,o.default)()).style("form-content"),c=(u.is(a.default)?u.footer:(0,n.default)()).style("form-footer");let p;const f=(0,l.default)(!1);let m;return u.append(d,c).extend((()=>({content:d,footer:c,submit:void 0,refreshValidity(){return s.refresh(),this},onSubmit(e){return m=e,this}}))).extendJIT("submit",(()=>(0,i.default)().type("primary").attributes.set("type","submit").bindDisabled(s.not,"invalid").appendToWhen(f.falsy,p??=(0,o.default)().event.subscribe("click",(()=>{u.element.checkValidity()||u.element.reportValidity()})).appendWhen(f,(0,r.default)().tweak((e=>{e.style("form-submit-loading"),e.enabled.bind(e,f),e.flag.style("form-submit-loading-flag")}))).appendTo(c.right)).tweak((e=>e.style.bind(l.default.Every(u,p.hovered,e.disabled),"button--disabled--hover").style.bind(l.default.Every(u,p.active,e.disabled),"button--disabled--active"))))).event.subscribe("submit",(async e=>{e.preventDefault(),f.value=!0,await(m?.(e)),f.value=!1}))}));t.default=u})),define("ui/component/core/InfiniteScroll",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Loading","ui/component/core/Slot","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder((e=>{const t=e.style("infinite-scroll"),l=(0,r.default)(!1),u=(0,r.default)(!1);let s,d,c=0;return t.extend((e=>({ended:l,set:t=>(s=t,e.reset(),e),setFromEndpoint:(t,o)=>(e.set((async(e,n)=>{const a=await t.query(void 0,{page:c},n);if(n.aborted)return!1;if(a instanceof Error)throw a;const i=o(a.data,e,n);return"object"==typeof i?i.then((e=>(c++,e??a.has_more))):(c++,i??a.has_more)})),e),reset:()=>(e.removeContents(),d?.abort(),d=void 0,l.value=!1,c=0,p(),e)})));async function p(){if(!s||u.value||l.value)return;u.value=!0;const e=(0,i.default)().appendTo(t);let r,c=!0;for(;e.removeContents(),d=new AbortController,r=d.signal,c=s(e,r),"boolean"!=typeof c;){const t=(0,a.default)().style("infinite-scroll-loading").appendTo(e);try{if(c=await c,r.aborted)return;t.remove();break}catch(o){toast.handleError(o),t.remove();const a=(0,n.default)().text.use("shared/action/retry").appendTo(e);if(await new Promise((e=>a.event.subscribe("click",(()=>e())))),d.signal.aborted)return;continue}}if(l.value=!c,u.value=!1,l.value)return;const f=(0,o.default)().style.setProperties({height:"1px",width:"100%",marginTop:"-1px"}).appendTo(e),m=new IntersectionObserver((([e])=>{e.isIntersecting&&(m.disconnect(),f.remove(),r.aborted||p())}),{root:null,rootMargin:"200px 0px",threshold:.01});m.observe(f.element),f.onRemoveManual((()=>m.disconnect()))}}));t.default=l})),define("ui/component/core/LabelledRow",["require","exports","ui/Component","ui/component/core/Label"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0});const a=(o=__importDefault(o)).default.Builder((e=>{e.style("labelled-row");let t=(0,n.AutoLabel)().style("labelled-row-label").appendTo(e),a=(0,o.default)().style("labelled-row-content").appendTo(e);return e.extend((e=>({label:t,content:a}))).extendMagic("label",(e=>({get:()=>t,set:e=>{t!==e&&(o.default.removeContents(t.element),t.element.replaceWith(e.element),t=e)}}))).extendMagic("content",(e=>({get:()=>a,set:e=>{a!==e&&(o.default.removeContents(a.element),a.element.replaceWith(e.element),a=e)}})))}));t.default=a})),define("ui/component/core/LabelledTable",["require","exports","ui/Component","ui/component/core/LabelledRow","ui/component/core/Slot"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder((e=>{let t,o;return e.style("labelled-table"),e.extend((e=>({label:i=>{let r;return t=i,o??={if:e=>(r=e,o),content:o=>{const i=t;t=void 0;const l=r;if(r=void 0,l){const t=(0,a.default)().appendTo(e);l.match(e,!0,(()=>{u().appendToWhen(l,t)}))}else u().appendTo(e);return e;function u(){const e=(0,n.default)().style("labelled-row--in-labelled-table");return e.label=i(e.label,e),e.content=o(e.content,e.label,e)??e.content,e}}}}})))}));t.default=i})),define("ui/component/core/Small",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const n=(o=__importDefault(o)).default.Builder("small",(e=>e.style("small").extend((e=>({})))));t.default=n})),define("ui/Announcer",["require","exports","ui/Component"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){let t,n;function a(e,t,n){const a=[];n((e=>{a.push((0,o.default)("p").attributes.set("data-id",t).text.use(e))}));const i=function(e,t){return[...e.element.querySelectorAll(`[data-id="${t}"]`)]}(e,t);if(i.length){const e=i.map((e=>e.textContent)).join("\n");if(a.map((e=>e.element.textContent)).join("\n")===e)return;for(const e of i)e.remove()}for(const t of a)t.appendTo(e)}e.interrupt=function(e,n){a(t??=(0,o.default)().attributes.set("aria-live","assertive").style.setProperty("opacity","0").style.setProperty("user-select","none").style.setProperty("pointer-events","none").style.setProperty("position","fixed").appendTo(document.body),e,n)},e.announce=function(e,t){a(n??=(0,o.default)().attributes.set("aria-live","polite").style.setProperty("opacity","0").style.setProperty("user-select","none").style.setProperty("pointer-events","none").style.setProperty("position","fixed").appendTo(document.body),e,t)}}(n||(n={})),t.default=n})),define("ui/component/core/ProgressWheel",["require","exports","ui/Component","ui/component/core/Slot","utility/State"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder((e=>e.style("progress-wheel").extend((e=>({set(t){e.removeContents(),(0,o.default)().style("progress-wheel-icon").tweak(t.initialiseIcon).appendTo(e);return(0,o.default)().style("progress-wheel-label").tweak(t.initialiseLabel).appendTo(e).text.bind(t.label),e.style.bindVariable("progress",t.progress),e}}))))),r=Object.assign(i,{Length(e,t){const o=a.default.MapManual([e,t],((e,t)=>void 0!==e&&t?1-e/t:void 0)),r=a.default.MapManual([e,t],((e,t)=>void 0!==e&&t?t-e:void 0));return n.default.using(a.default.UseManual({unusedPercent:o,unusedChars:r}),((e,{unusedPercent:t,unusedChars:o})=>void 0===t||void 0===o?void 0:i().set({progress:t,label:e=>e["shared/form/progress-wheel/remaining/label"](o),initialiseIcon:e=>e.style.bind(t<0,"progress-wheel-icon--overflowing")})))},Progress:e=>i().set({progress:e,label:e.mapManual((e=>t=>t["shared/form/progress-wheel/progress/label"](100*(e??0))))})});t.default=r})),define("ui/utility/AnchorManipulator",["require","exports","ui/utility/Mouse","ui/utility/Viewport","utility/Async","utility/State","utility/Time"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AllowXOffscreen=t.AllowYOffscreen=t.ANCHOR_LOCATION_ALIGNMENTS=t.ANCHOR_SIDE_VERTICAL=t.ANCHOR_SIDE_HORIZONTAL=t.ANCHOR_TYPES=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),t.ANCHOR_TYPES=["off","aligned"],t.ANCHOR_SIDE_HORIZONTAL=["left","right"],t.ANCHOR_SIDE_VERTICAL=["top","bottom"];const l=new Set(t.ANCHOR_TYPES.flatMap((e=>[t.ANCHOR_SIDE_HORIZONTAL,t.ANCHOR_SIDE_VERTICAL].flatMap((t=>t.map((t=>`${e} ${t}`)))))).flatMap((e=>[e,`sticky ${e}`])));function u(e){const t=e.startsWith("sticky");t&&(e=e.slice(7));const o=e;if("centre"===o)return{sticky:t,type:"centre",side:"centre",offset:0};const[n,a,i]=o.split(" ");return{sticky:t,type:n,side:a,offset:i?+i:0}}l.add("centre"),l.add("sticky centre"),t.ANCHOR_LOCATION_ALIGNMENTS=["left","centre","right"],t.AllowYOffscreen={allowYOffscreen:!0},t.AllowXOffscreen={allowXOffscreen:!0},t.default=function(e){let t,s;const d=(0,i.default)(void 0);let c,p,f,m=0;const v=[],h=e=>e&&v.push(e);let g,y=0;const _={state:d,isMouse:()=>!t?.length,from:t=>(g?.(),p=t,g=p?.removed.useManual((e=>{e&&(p=void 0,g?.(),g=void 0)})),e),reset:()=>(t=void 0,_.markDirty(),e),add:(...o)=>{const n="string"==typeof o[o.length-1]?void 0:o.pop();let[a,i,r,s]=o;return function(e){if(l.has(e))return!0;if("string"!=typeof e)return!1;const t=e.lastIndexOf(" ");if(-1===t)return!1;const o=e.slice(0,t);if(!l.has(o))return!1;const n=e.slice(t+1);return!isNaN(+n)}(i)&&(s=r,r=i,i="*"),s??="*",t??=[],t.push({xAnchor:u(a),xRefSelector:i,yAnchor:u(r),yRefSelector:s,options:n}),_.markDirty(),e},orElseHide:()=>(t?.push(!1),e),markDirty:()=>{const t=e?.rect.value;if(!t.width||!t.height)return e;if(d.value=void 0,m){const e=Date.now()-m;e>r.default.frame?_.apply():void 0===f&&(f=window.setTimeout(_.apply,r.default.frame-e))}return e},get:()=>{if(d.value)return d.value;for(const e of v)e();v.length=0;const a=e?.rect.value;if(!a.width||!a.height)return d.value=void 0,{x:0,y:0,mouse:!1};if(h(e?.rect.subscribe(e,_.markDirty)),a&&t&&p)for(const o of t){if(!o)return d.value??={mouse:!1,x:-1e4,y:-1e4,padX:!1};let t="left";const i=o.xAnchor,r=b(o.xRefSelector);if("*"!==o.xRefSelector&&!r)continue;const l=r?.rect.value;h(r?.rect.subscribe(e,_.markDirty));const u=(l?.left??0)+(l?.width??n.default.size.value.w)/2,s=("right"===i.side?l?.right:"left"===i.side?l?.left:u)??u;let c;switch(i.type){case"aligned":c="right"===i.side?s-a.width-i.offset:s+i.offset,t=i.side;break;case"off":c="right"===i.side?s+i.offset:s-a.width-i.offset,t="left"===i.side?"right":"left";break;case"centre":c=s-a.width/2,t="centre"}if(!1===o.options?.xValid?.(c,l,a))continue;if(!i.sticky&&a.width<n.default.size.value.w&&!o.options?.allowXOffscreen){if(c<0||c+a.width>n.default.size.value.w)continue}const p=o.yAnchor,f=b(o.yRefSelector);if("*"!==o.yRefSelector&&!f)continue;const m=f?.rect.value;h(f?.rect.subscribe(e,_.markDirty));const v=(m?.top??0)+(m?.height??n.default.size.value.h)/2,g=("bottom"===p.side?m?.bottom:"top"===p.side?m?.top:v)??v;let y;switch(p.type){case"aligned":y="bottom"===p.side?g-a.height-p.offset:g+p.offset;break;case"off":y="bottom"===p.side?g+p.offset:g-a.height-p.offset;break;case"centre":y=g-a.height/2}if(!1!==o.options?.yValid?.(y,m,a)){if(!p.sticky&&a.height<n.default.size.value.h&&!o.options?.allowYOffscreen){if(y<0||y+a.height>n.default.size.value.h)continue}return d.value??={mouse:!1,padX:"off"===i.type,alignment:t,x:c,y:y,yRefBox:m,xRefBox:l,preference:o}}}return d.value??={mouse:!0,padX:!0,...o.default.state.value}},apply:()=>{const t=_.get();let o=t.alignment??c;if(t.mouse){("centre"===c||("right"===c?t.x<n.default.size.value.w/2-200:t.x>n.default.size.value.w/2+200))&&(o="left"===c?"right":"left")}if(c!==o&&(c=o),e.element.style.left=`${t.x}px`,e.element.style.top=`${t.y}px`,t.mouse||0!==t.x||0!==t.y)e.style.removeProperties("opacity","transition-duration");else{const o=++y;e.style.setProperty("opacity","0"),e.style.setProperty("transition-duration","0s"),(async()=>{for(;0===t.x&&0===t.y;)if(await a.default.sleep(50),e.rect.markDirty(),y!==o)return})()}return f=void 0,m=Date.now(),e}};return _;function b(e){const t=s?.[e];let o;if(t)o=t.deref();else if(o=e.startsWith(">>")?p?.element.querySelector(e.slice(2))?.component:p?.element.closest(e)?.component,o){if("contents"===getComputedStyle(o.element).display){const e=o.element.children;e.length?(o=e[0].component??o,e.length>1&&console.warn("Anchor ref has display: contents and multiple children")):console.warn("Anchor ref has display: contents and no children")}s??={},s[e]=new WeakRef(o)}return o}}})),define("ui/component/core/ext/Input",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Popover","ui/component/core/ProgressWheel","ui/component/core/Slot","ui/utility/AnchorManipulator","ui/utility/StringApplicator","ui/utility/Viewport","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d){function c(e){return(0,o.default)().style("input-popover-hint-text").text.bind(e)}Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),u=__importStar(u),s=__importDefault(s),d=__importDefault(d);const p=Object.assign(o.default.Extension((e=>{const t=(0,d.default)(void 0),o=(0,d.default)(void 0),p=(0,d.default)(void 0),f=(0,d.default)(""),m=(0,d.default)(!1),v=d.default.MapManual([t,o,m],((e,t,o)=>o||!!e||!!t));let h;v.subscribeManual((u=>{if(!u)return h?.remove(),void(h=void 0);e.removed.value||(h=(0,a.default)().setNormalStacking().style("input-popover").setOwner(e).tweak((e=>{m.value||(r.default.using(t,((e,t)=>t?c(t):void 0)).appendTo(e),i.default.Length(p,o).appendTo(e))})).tweak(w,e).appendTo(document.body),s.default.tablet.use(h,(t=>{const o=t();h?.type.toggle(!o,"flush"),o?h?.anchor.reset().anchor.from(e).anchor.add("aligned left","aligned top").anchor.add("aligned left","aligned bottom").setCloseOnInput(!0):h?.anchor.reset().anchor.from(e).anchor.add("off right",`.${n.BlockClasses.Main}`,"aligned top",{...l.AllowYOffscreen,yValid:(e,t,o)=>o.height>(t?.height??0)}).anchor.add("off right",`.${n.BlockClasses.Main}`,"centre",l.AllowYOffscreen).setCloseOnInput(!1)})))}));let g=!1;e.hasFocused.subscribeManual((e=>{g||s.default.tablet.value||h?.toggle(e).anchor.apply()}));const y=(0,d.default)(void 0);let b,w;y.subscribe(e,(t=>{const o="function"==typeof t?t(u.quilt,u.QuiltHelper)?.toString():t,n=b?.element??e.element;n.setCustomValidity?.(o??"")})),e.event.subscribe(["input","change"],T);const k=e.extend((e=>({required:(0,d.default)(!1),hint:(0,u.default)(e,(e=>t.value=e)),maxLength:o,length:p,invalid:f,hasPopover:v,disableDefaultHintPopoverVisibilityHandling:()=>(g=!0,e),getPopover:()=>h,setMaxLength:t=>(d.default.is(t)?o.bind(e,t):o.value=t,e),setRequired:(t=!0)=>(e.attributes.toggle(t,"required"),e.required.asMutable?.setValue(t),e),setLabel:t=>(e.setName(t?.for),e.setId(t?.for),t?.setInput(e),e),tweakPopover:t=>(w=t,e),setCustomHintPopover:t=>(w=t,m.value=!0,e),pipeValidity:t=>(b=t,e),setCustomInvalidMessage:t=>(y.value=t,T(),e),refreshValidity:T})));return k;function T(){return f.value=_??y.value?.toString()??e.element.validationMessage??"",k}})),{createHintText:c});t.default=p})),define("ui/component/core/Checkbutton",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/ext/Input","utility/State"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i);const r=Symbol("CheckButton"),l=o.default.Builder("label",(e=>{const t=(0,o.default)("input").style("checkbutton-input").attributes.set("type","checkbox").setRandomId(),l=t.element,u=(0,i.default)(!1);let s;const d=e.and(n.default).and(a.default).style("checkbutton").tabIndex("auto").ariaChecked(u).ariaRole("checkbox").setIcon("check").attributes.bind("for",t.id).tweak((e=>e.icon?.style("checkbutton-icon").style.bind(u,"checkbutton-icon--checked"))).append(t).extend((()=>({[r]:!0,input:t,checked:u,isChecked:()=>l.checked,setChecked:e=>e===l.checked?d:s?(d.event.emit("TrySetChecked",e),d):(l.checked=e,c(),d),use:e=>(s?.(),s=e.use(d,(e=>{l.checked!==e&&(l.checked=e,c())})),d),unuse:()=>(s?.(),s=void 0,d)})));function c(){u.value=l.checked,d.style.toggle(l.checked,"checkbutton--checked"),d.event.emit("SetChecked",l.checked)}return d.pipeValidity(t),t.event.subscribe("change",(()=>{if(s){const e=l.checked;return l.checked=!e,void d.event.emit("TrySetChecked",e)}c()})),d}));t.default=l})),define("ui/component/core/RadioButton",["require","exports","ui/Component","ui/component/core/Checkbutton"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=Symbol("RadioButton"),i=o.default.Builder((()=>{const e=(0,n.default)();return e.ariaRole("radio"),e.input.attributes.set("type","radio"),e.extend((e=>({[a]:!0})))}));t.default=i})),define("ui/component/core/text-editor/TextEditorMSWordHandler",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isPasteHTML=function(e){return e.slice(0,300).includes('xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"')},e.fixPasteHTML=function(e){return e.replaceAll(/\bname(?=="_ftn)/g,"id")}}(o||(o={})),t.default=o})),define("ui/view/shared/ext/ViewTransition",["require","exports","ui/Component","utility/Arrays"],(function(e,t,o,n){function a(e){return e?.replace(/[^a-z0-9-]+/g,"-").toLowerCase()}var i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){const t="data-view-transition-name",i="data-subview-transition-name",r="data-view-transition-id",l="view-transition",u="subview-transition",s="view-transition-delay",d=100;o.default.extend((e=>e.extend((e=>({viewTransition:o=>(o?(o=o.replace(/[^a-z0-9-]+/g,"-").toLowerCase(),e.attributes.set(t,o),e.attributes.compute(r,(()=>""+p++))):(e.attributes.remove(t),e.attributes.remove(r)),e),getViewTransition:()=>e.attributes.get(t).value||void 0,subviewTransition:t=>(t?(t=a(t),e.attributes.set(i,t),e.attributes.compute(r,(()=>""+p++))):(e.attributes.remove(i),e.attributes.remove(r)),e),getSubviewTransition:()=>e.attributes.get(i).value||void 0})))));let c,p=0,f=0;function m(e,o){const n=g(e,o).filter(h);let a=0;if("view"===e)for(const e of n){e.classes.add(l);const o=e.attributes.get(t).value;e.style.setVariable("view-transition-delay",`${s}-${a}`),e.style.setProperty("view-transition-name",`${l}-${o}-${a++}`)}else for(const e of n){e.classes.add(u);const t=e.attributes.get(i).value,o=+e.attributes.get(r).value||0;e.style.setProperty("view-transition-name",`${u}-${t}-${o}`),e.style.setVariable("view-transition-delay",`${s}-${a++}`)}}function v(e){for(const e of[...g("view"),...g("subview")])e.classes.remove(l),e.classes.remove(u),e.style.removeProperties("view-transition-name"),e.style.removeVariables("view-transition-delay")}function h(e){const t=e.element.getBoundingClientRect();return t.bottom>-100&&t.top<window.innerHeight+d&&t.right>-100&&t.left<window.innerWidth+d}function g(e,o){return[...document.querySelectorAll(`[${"view"===e?t:i}${o?`="${o}"`:""}]`)].map((e=>e.component)).filter(n.NonNullish)}e.perform=function(e,t,o){async function n(){await o(),m(e,t)}c=void 0,"function"==typeof t&&(o=t,t=void 0),t=a(t),m(e,t);const i=document.startViewTransition(n),r=c=f++;return i.finished.catch((async e=>{String(e).includes("AbortError")?await n():console.error("Error during view transition:",e)})).finally((()=>{c===r&&v(e)})),{finished:i.finished.catch((()=>{})),ready:i.ready.catch((()=>{})),updateCallbackDone:i.updateCallbackDone.catch((()=>{})),skipTransition:()=>i.skipTransition()}},e.reapply=m,e.unapply=v}(i||(i={})),t.default=i})),define("ui/component/core/TextEditor",["require","exports","lang/en-nz","model/Session","prosemirror-commands","prosemirror-dropcursor","prosemirror-example-setup","prosemirror-gapcursor","prosemirror-history","prosemirror-inputrules","prosemirror-keymap","prosemirror-markdown","prosemirror-model","prosemirror-schema-list","prosemirror-state","prosemirror-transform","prosemirror-view","ui/Announcer","ui/Component","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/Dialog","ui/component/core/ext/Input","ui/component/core/Popover","ui/component/core/RadioButton","ui/component/core/Slot","ui/component/core/text-editor/TextEditorMSWordHandler","ui/InputBus","ui/utility/MarkdownContent","ui/utility/StringApplicator","ui/utility/Viewport","ui/view/shared/ext/ViewTransition","utility/Arrays","utility/Define","utility/Env","utility/Objects","utility/State","utility/Store","utility/string/Markdown","utility/Time","w3c-keyname"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x,D,E,O,M,S,I,C,R,$,P,A,j,N,q,B,L){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),E=__importDefault(E),M=__importDefault(M),S=__importDefault(S),I=__importDefault(I),C=__importDefault(C),R=__importDefault(R),$=__importDefault($),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N),q=__importDefault(q),B=__importDefault(B);const V=(L=__importDefault(L)).default.keyName;L.default.keyName=e=>{const t=e;if(t.code.startsWith("Numpad")&&!t.shiftKey&&(t.ctrlKey||t.altKey)){Object.defineProperty(e,"shiftKey",{value:!0});const o=t.code.slice(6);if("Decimal"===o)return".";if(!isNaN(+o))return o}return V(e)},(0,$.default)(p.ResolvedPos.prototype,"closest",(function(e,t,o){"number"==typeof t&&(o=t,t=void 0);const n=t;o??=this.depth;for(let t=o;t>=0;t--){const o=this.node(t);if(o.type===e&&(!n||o.hasAttrs(n)))return o}})),(0,$.default)(p.Node.prototype,"matches",(function(e,t){return(void 0===e||this.type===e)&&(void 0===t||this.hasAttrs(t))})),(0,$.default)(p.Node.prototype,"hasAttrs",(function(e){for(const[t,o]of Object.entries(e))if(this.attrs[t]!==o)return!1;return!0})),(0,$.default)(p.Node.prototype,"pos",(function(e){if(e===this)return 0;let t;return e.descendants(((e,o)=>void 0===t&&(e===this?(t=o,!1):void 0))),t})),(0,$.default)(p.Node.prototype,"parent",(function(e){if(e===this)return;const t=this;return function e(o){let n;return o.forEach((a=>{n??=(a===t?o:void 0)??e(a)})),n}(e)})),(0,$.default)(p.Node.prototype,"depth",(function(e){if(e===this)return 0;const t=this;return function e(o,n){let a;return o.forEach((o=>{a??=(o===t?n:void 0)??e(o,n+1)})),a}(e,1)})),(0,$.default)(p.Fragment.prototype,"pos",(function(e){let t;return e.descendants(((e,o)=>void 0===t&&(e.content===this?(t=o+1,!1):void 0))),t})),(0,$.default)(p.Fragment.prototype,"range",(function(e){const t=this.pos(e);if(!t)return;const o=e.resolve(t),n=e.resolve(t+this.size);return new p.NodeRange(o,n,Math.min(o.depth,n.depth))})),(0,$.default)(p.Fragment.prototype,"parent",(function(e){if(e.content===this)return e;let t;return e.descendants(((e,o)=>void 0===t&&(e.content===this?(t=e,!1):void 0))),t})),(0,$.default)(v.Transform.prototype,"stripNodeType",(function(e,t){const o=this;let n=e instanceof p.Fragment?e.range(o.doc):e;if(!n)return this;for(;a(););return this;function a(){let e=!1;return n.parent.forEach(((o,a,r)=>{if(!e&&r>=n.startIndex&&r<n.endIndex){if(o.type===t)return i(o),void(e=!0);if(function(e){let o=!1;return e.descendants(((e,n)=>{if(!o)return e.type===t?(i(e),void(o=!0)):void 0})),o}(o))return void(e=!0)}})),e}function i(e){const t=e.pos(o.doc);if(void 0===t)throw new Error("Unable to continue stripping, no pos");const a=e.content.range(o.doc);if(!a)throw new Error("Unable to continue stripping, unable to resolve node range");const i=(0,v.liftTarget)(a);if(null!==i&&o.lift(a,i),n){let a=n.$from.pos;a=a<=t?a:a-1;let i=n.$to.pos;i=i<t+e.nodeSize?i-1:i-2;const r=o.doc.resolve(a).blockRange(o.doc.resolve(i));if(!r)throw new Error("Unable to continue stripping, unable to resolve new range");n=r}}})),n.default.setClearedWithSessionChange("textEditorDrafts"),L.default.keyName;const W=new p.Schema({nodes:A.default.filterNullish({...c.schema.spec.nodes.toObject(),image:void 0,heading:{...c.schema.spec.nodes.get("heading"),content:"text*",toDOM(e){const t=(0,y.default)(`h${e.attrs.level}`);return t.style("markdown-heading",`markdown-heading-${e.attrs.level}`),{dom:t.element,contentDOM:t.element}}},text_align:{attrs:{align:{default:"left",validate:e=>"left"===e||"center"===e||"right"===e}},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"center",getAttrs:()=>({align:"center"}),consuming:!1},{tag:"*",getAttrs:e=>{const t=e.style.getPropertyValue("text-align");return!!t&&{align:"justify"===t||"start"===t?"left":"end"===t?"right":t}},consuming:!1,priority:51}],toDOM:e=>["div",A.default.filterNullish({class:"left"===e.attrs.align?"align-left":void 0,style:`text-align:${e.attrs.align}`}),0]},id_block:{attrs:{id:{validate:e=>"string"==typeof e&&e.length>0&&!e.startsWith("docs-internal-guid")}},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"*",getAttrs:e=>{const t=e.getAttribute("id");return!(!t?.length||t.startsWith("docs-internal-guid"))&&{id:t}},consuming:!1,priority:51}],toDOM:e=>["div",{id:e.attrs.id},0]}}),marks:{...c.schema.spec.marks.toObject(),underline:{parseDOM:[{tag:"u"},{style:"text-decoration=underline",clearMark:e=>"underline"===e.type.name}],toDOM:()=>["u"]},strikethrough:{parseDOM:[{tag:"s"},{style:"text-decoration=line-through",clearMark:e=>"strikethrough"===e.type.name}],toDOM(){const e=document.createElement("span");return e.style.setProperty("text-decoration","line-through"),e}},subscript:{parseDOM:[{tag:"sub"}],toDOM:()=>["sub"]},superscript:{parseDOM:[{tag:"sup"}],toDOM:()=>["sup"]},mention:{attrs:{vanity:{validate:e=>"string"==typeof e&&e.length>0}},parseDOM:[{tag:"a",getAttrs:e=>{const t=e.getAttribute("vanity");return!!t&&{vanity:t}},priority:51}],toDOM(e){const t=document.createElement("a");return t.setAttribute("vanity",e.attrs.vanity),t.href=`${P.default.URL_ORIGIN}author/${e.attrs.vanity}`,t.textContent=`@${e.attrs.vanity}`,t}},id_mark:{attrs:{id:{validate:e=>"string"==typeof e&&e.length>0&&!e.startsWith("docs-internal-guid")}},parseDOM:[{tag:"*",getAttrs:e=>{const t=e.getAttribute("id");return!(!t?.length||t.startsWith("docs-internal-guid"))&&{id:t}},consuming:!1,priority:51}],toDOM:e=>{const t=document.createElement("span");return t.id=e.attrs.id,t}}}}),G=(0,q.default)(),U=(new RegExp("([a-zA-Z_:][a-zA-Z0-9:._-]*)(?:\\s*=\\s*((?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\")))(?= |$)","g"),{text_align:{getAttrs:e=>{const t=e.style?.get("text-align");if(["left","center","right"].includes(t))return{align:t}}},id_block:{getAttrs:e=>{const t=e.attrGet("id");if(t?.length)return{id:t}}}}),F={subscript:{getAttrs:e=>"sub"===e.tag||void 0},superscript:{getAttrs:e=>"sup"===e.tag||void 0},mention:{getAttrs:e=>{const t=e.attrGet("vanity");if(t)return{vanity:t}},getChildren:e=>{const t=e.attrGet("vanity");if(!t)return[];const o=new(0,e.constructor);return o.content=`@${t}`,o.type="text",[o]}},id_mark:{getAttrs:e=>{const t=e.attrGet("id");if(t?.length)return{id:t}}},link:{getAttrs:e=>{if("a"!==e.tag)return;const t=e.attrGet("href");return t?{href:t}:void 0}}},H=G.parse;G.parse=(e,t)=>{const o=H.call(G,e,t);for(const e of o)"inline"===e.type&&e.children&&(e.children=a(n(e.children)));return n(o).flatMap((e=>{if("softbreak"===e.type){const t=e.constructor;return[Object.assign(new t,{nesting:1,tag:"p",type:"paragraph_open",block:!0,hidden:!1,level:0}),Object.assign(new t,{nesting:-1,tag:"p",type:"paragraph_close",block:!0,hidden:!1,level:0})]}return e}));function n(e){if(!e.length)return e;const t=[];let o=0;const a=e[0].constructor;for(let i of e){const e="html_inline"===i.type||"html_block"===i.type;if(e||"html_block_open"===i.type||"html_block_close"===i.type||"html_inline_open"===i.type||"html_inline_close"===i.type)if(!e&&i.nesting<0){const e=t.findLast((e=>e.level===o));if(!e){console.warn("Invalid HTML in markdown:",i.raw);continue}i.type=`${e.type.slice(0,-5)}_close`,t.push(i),o=i.level+i.nesting}else{for(const[e,t]of Object.entries(U)){const o=t.getAttrs(i);if(o){i.type=e,!0!==o&&(i.nodeAttrs=o);const n=t.getChildren?.(i);n&&(i.children=n);break}}for(const[e,t]of Object.entries(F)){const o=t.getAttrs(i);if(o){const r=i;"html_block"===i.type&&(i=new a,i.type="inline",i.level=1,i.nesting=0,i.tag="",i.block=!0,i.children=[r]),r.type=e,!0!==o&&(r.nodeAttrs=o);const l=t.getChildren?.(r);l&&(r.children=l),"inline"===i.type&&(i.children=n(i.children));break}}if(e||(i.type=i.type.endsWith("_open")?i.type:`${i.type}_open`,o=i.level),"inline"!==i.type)t.push(i);else{const e=new a;e.type="paragraph_open",e.nesting=1;const o=new a;o.type="paragraph_close",o.nesting=-1,t.push(e,i,o)}}else t.push(i)}return t.flatMap((e=>{const t=e.children;if(!t?.length||"inline"===e.type)return e;const o=new a;return o.type=`${e.type}_close`,e.type=`${e.type}_open`,e.children=null,[e,...t,o]}))}function a(e){for(const t of e)t.type.startsWith("html_inline")&&(t.type="text",t.content=t.raw??"");return e}};const Y=new c.MarkdownParser(W,G,A.default.filterNullish({...c.defaultMarkdownParser.tokens,image:void 0,u:{mark:"underline"},s:{mark:"strikethrough"},...Object.entries(U).toObject((([e,t])=>[e,{block:e,getAttrs:e=>e.nodeAttrs??Object.fromEntries(e.attrs??[])}])),...Object.entries(F).toObject((([e,t])=>[e,{mark:e,getAttrs:e=>e.nodeAttrs??Object.fromEntries(e.attrs??[])}]))})),J=new c.MarkdownSerializer({...c.defaultMarkdownSerializer.nodes,text_align:(e,t,o,n)=>{e.write(`<div style="text-align:${t.attrs.align}">\n`),e.renderContent(t),e.write("</div>"),e.closeBlock(t)},id_block:(e,t,o,n)=>{e.write(`<div id="${t.attrs.id}">\n`),e.renderContent(t),e.write("</div>"),e.closeBlock(t)},paragraph:(e,t,o,n)=>{0===t.content.size?e.write("<br>\n"):e.renderInline(t),e.closeBlock(t)}},{...c.defaultMarkdownSerializer.marks,strikethrough:{open:"~~",close:"~~",expelEnclosingWhitespace:!0},underline:{open:"__",close:"__",expelEnclosingWhitespace:!0},mention:{open:(e,t,o,n)=>`<mention vanity="${t.attrs.vanity}">`,close:(e,t,o,n)=>{const a=e,i=`<mention vanity="${t.attrs.vanity}">`,r=a.out.lastIndexOf(i);return-1===r||(a.out=a.out.slice(0,r+i.length)),""}},id_mark:{open:(e,t,o,n)=>`<span id="${t.attrs.id}">`,close:"</span>",expelEnclosingWhitespace:!0},subscript:{open:"<sub>",close:"</sub>",expelEnclosingWhitespace:!0},superscript:{open:"<sup>",close:"</sup>",expelEnclosingWhitespace:!0}});const z=["paragraph","code_block"];let K=0;const Q=Object.assign(y.default.Builder((e=>{const t=K++,n=(0,j.default)(!1),c=(0,j.default)(""),p=(0,j.default)(!1),$=(0,j.default)(!1),P=(0,j.default)(!1),A=j.default.Every(j.default.Owner.create(),P,p.falsy),q=(0,j.default)(!1),L=j.default.MapManual([q,c],((e,t)=>e&&!t.trim()));let V;const G=(0,j.default)(void 0);G.subscribe(e,(()=>{if(!V.mirror?.hasFocus()||!V.mirror.state.selection.empty)return;const e=V.mirror.state.selection.from+1,t=V.mirror.state.doc.resolve(e>V.mirror.state.doc.content.size?e-1:e);g.default.interrupt("text-editor/format/inline",(e=>{const o=Object.keys(W.marks);let n=!1;for(const a of o)"id_mark"!==a&&je(W.marks[a],t)&&(n=!0,e(`text-editor/formatting/${a}`));n||e("text-editor/formatting/none")}))}));const U=y.default.Extension(((e,t)=>{const o=W.marks[t];return e.ariaLabel.use(`text-editor/toolbar/button/${t}`).extend((()=>({mark:o})))})),F=y.default.Extension(((e,t)=>{const o=W.nodes[t.replaceAll("-","_")];return e.ariaLabel.use(`text-editor/toolbar/button/${t}`).extend((()=>({node:o})))})),H=y.default.Extension(((e,t)=>e.ariaLabel.use(`text-editor/toolbar/button/${t}`))),X=y.default.Builder((e=>e.ariaRole("group").style("text-editor-toolbar-button-group"))),Z=y.default.Builder(((e,t)=>(0,_.default)().style("text-editor-toolbar-button").clearPopover().receiveFocusedClickEvents().event.subscribe("click",(e=>{e.preventDefault(),t(e.host)})))),ee=y.default.Builder(((e,t,o)=>(0,b.default)().style("text-editor-toolbar-button").style.bind(t,"text-editor-toolbar-button--enabled").tweak((e=>e.icon?.style.remove("checkbutton-icon"))).use(t).clearPopover().receiveFocusedClickEvents().event.subscribe("click",(e=>{e.preventDefault(),o(e.host)})))),te=y.default.Builder(((e,t,o,n)=>(0,x.default)().style("text-editor-toolbar-button").setName(t).style.bind(o,"text-editor-toolbar-button--enabled").tweak((e=>e.icon?.style.remove("checkbutton-icon"))).use(o).clearPopover().receiveFocusedClickEvents().event.subscribe("click",(e=>{e.preventDefault(),n(e.host)})))),oe=y.default.Builder(((e,t)=>(0,_.default)().style("text-editor-toolbar-button","text-editor-toolbar-button--has-popover").clearPopover().setPopover("hover/click",((e,o)=>{e.style("text-editor-toolbar-popover").style.bind(e.popoverParent.nonNullish,"text-editor-toolbar-popover-sub",`text-editor-toolbar-popover-sub--${t}`).anchor.add("centre"===t?t:`aligned ${t}`,"off bottom").style.toggle("left"===t,"text-editor-toolbar-popover--left").style.toggle("right"===t,"text-editor-toolbar-popover--right").setMousePadding(20),o.style.bind(e.visible,"text-editor-toolbar-button--has-popover-visible")})).receiveInsertEvents().receiveAncestorInsertEvents().event.subscribe(["insert","ancestorInsert"],(e=>e.host.style.toggle(!!e.host.closest(T.default),"text-editor-toolbar-button--has-popover--within-popover"))))),ne=y.default.Builder(((t,o)=>{const n=W.marks[o],a=ce(n),i=G.map(e,(e=>je(n)));return ee(i,a).and(U,o)})),ae=y.default.Builder(((o,n)=>{const a=pe(W.nodes.text_align,{align:"centre"===n?"center":n}),i=G.map(e,(e=>Be(n)));return te(`text-editor-${t}-text-align`,i,a).and(H,`align-${n}`)})),ie=y.default.Builder(((o,n)=>{const a=W.nodes[n.replaceAll("-","_")],i=me(a),r=G.map(e,(e=>Ne(a)));return te(`text-editor-${t}-block-type`,r,i).and(F,n)})),re=y.default.Builder(((o,n)=>{const a=W.nodes.heading,i=me(a,{level:n}),r=G.map(e,(e=>Ne(a,{level:n})));return te(`text-editor-${t}-block-type`,r,i).setIcon(`${n}`)})),le=y.default.Builder(((e,t)=>Z(pe(W.nodes[t.replaceAll("-","_")])).and(F,t))),ue=y.default.Builder(((e,t)=>Z(ve(W.nodes[t.replaceAll("-","_")])).and(F,t)));let se=!1;function de(e){return t=>{G.value&&(se=!0,e(G.value,V.mirror?.dispatch,V.mirror),se=!1,t.hasFocused.value||V.document?.focus())}}function ce(e){return de((0,a.toggleMark)(e))}function pe(e,t){return de(fe(e,t))}function fe(e,t){return e===W.nodes.text_align?(o,n)=>{const{$from:a,$to:i}=o.selection;let r=a.blockRange(i);if(r){const e=a.closest(W.nodes.text_align,r.depth);if(e&&!r.startIndex&&r.endIndex===e.childCount){const a=e.pos(o.doc);return void 0!==a&&(n&&n(o.tr.setNodeMarkup(a,void 0,t).stripNodeType(e.content,W.nodes.text_align).scrollIntoView()),!0)}}const l=r&&(0,v.findWrapping)(r,e,t);if(!l)return!1;if(n){const e=o.tr;if(e.wrap(r,l),r=e.doc.resolve(a.pos+1).blockRange(e.doc.resolve(i.pos+1)),!r)throw new Error("Unable to strip nodes, unable to resolve new range");e.stripNodeType(r,W.nodes.text_align),e.scrollIntoView(),n(e)}return!0}:(0,a.wrapIn)(e,t)}function me(e,t){return de((0,a.setBlockType)(e,t))}function ve(e,t){return de((0,f.wrapInList)(e,t))}const he=(0,y.default)().style("text-editor-toolbar").style.bind(p,"text-editor-toolbar--fullscreen").style.bind(L,"text-editor-toolbar--minimal").ariaRole("toolbar").append((0,y.default)().style("text-editor-toolbar-left").append(X().ariaLabel.use("text-editor/toolbar/group/inline").append(ne("strong").setIcon("bold")).append(ne("em").setIcon("italic")).append(oe("left").and(H,"other-formatting").setIcon("other-formatting").tweakPopover((e=>e.append(ne("underline").setIcon("underline")).append(ne("strikethrough").setIcon("strikethrough")).append(ne("subscript").setIcon("subscript")).append(ne("superscript").setIcon("superscript")).append(ne("code").setIcon("code")))))).appendWhen(A.falsy,X().ariaLabel.use("text-editor/toolbar/group/block").append(oe("centre").tweakPopover((e=>e.ariaRole("radiogroup").append(ae("left").setIcon("align-left")).append(ae("centre").setIcon("align-center")).append(ae("right").setIcon("align-right")))).tweak((e=>{G.use(e,(()=>{const t=V?.mirror?.hasFocus()||se?Le()??"mixed":"left";e.ariaLabel.set(o.default["text-editor/toolbar/button/align"](o.default[`text-editor/toolbar/button/align/currently/${t}`]()).toString()),e.setIcon("mixed"===t?"asterisk":`align-${"centre"===t?"center":t}`)}))})))).appendWhen(A.falsy,X().ariaRole().append(oe("centre").tweakPopover((e=>e.ariaRole("radiogroup").append(ie("paragraph").setIcon("paragraph")).append(oe("centre").setIcon("heading").tweakPopover((e=>e.append(re(1)).append(re(2)).append(re(3)).append(re(4)).append(re(5)).append(re(6))))).append(ie("code-block").setIcon("code")))).tweak((e=>{G.use(e,(()=>{const t=V?.mirror?.hasFocus()||se?qe()??"mixed":"paragraph";e.ariaLabel.set(o.default["text-editor/toolbar/button/block-type"](o.default[`text-editor/toolbar/button/block-type/currently/${t}`]()).toString()),e.setIcon(("paragraph"===t?"paragraph":"code-block"===t&&"code")||"asterisk")}))})))).appendWhen(A.falsy,X().ariaLabel.use("text-editor/toolbar/group/wrapper").append(Z(de(a.lift)).and(H,"lift").setIcon("outdent").style.bind(G.map(e,(e=>!e||!(0,a.lift)(e))),"text-editor-toolbar-button--hidden")).append(le("blockquote").setIcon("quote-left")).append(ue("bullet-list").setIcon("list-ul")).append(ue("ordered-list").setIcon("list-ol"))).appendWhen(A.falsy,X().ariaLabel.use("text-editor/toolbar/group/insert").append(Z(de(((e,t)=>(t?.(e.tr.replaceSelectionWith(W.nodes.horizontal_rule.create())),!0)))).and(H,"hr").style("text-editor-toolbar-hr")))).append((0,y.default)().style("text-editor-toolbar-right").append(X().ariaLabel.use("text-editor/toolbar/group/actions").append(Z(de(u.undo)).and(H,"undo").setIcon("undo")).append(Z(de(u.redo)).and(H,"redo").setIcon("redo")).append(Z((function(){C.default.perform("subview",ke,(()=>{p.value=!p.value,y.default.getDocument().style.toggle(p.value,"has-fullscreen-text-editor"),Te.appendTo(p.value?Se:V),Te.rect.markDirty()}))})).bindIcon(p.map(e,(e=>e?"compress":"expand"))).ariaLabel.bind(p.map(e,(e=>o.default["text-editor/toolbar/button/"+(e?"unfullscreen":"fullscreen")]().toString()))))));let ge,ye,_e;const be=()=>{ge=void 0,_e?.(),_e=void 0,ye?.(),ye=void 0},we=(0,y.default)("input").style("text-editor-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`text-editor-validity-pipe-input-${Math.random().toString(36).slice(2)}`),ke="text-editor",Te=(0,y.default)().subviewTransition(ke).style("text-editor").style.bind(p,"text-editor--fullscreen").event.subscribe("click",(e=>{const t=y.default.get(e.target);(t===he||t?.is(Q))&&V.document?.focus()})).append(we).append(he);let xe=!1;V=e.and(D.default).and(k.default).and(O.HandlesKeyboardEvents).style.bind(L,"text-editor--minimal").append(Te).pipeValidity(we).extend((e=>({content:c,touched:$,default:(0,S.default)(e,(e=>Pe(e))),toolbar:he,editor:Te,setRequired:(t=!0)=>(e.style.toggle(t,"text-editor--required"),e.required.asMutable?.setValue(t),Re(),e),setLabel:t=>(be(),ge=t,Re(),_e=ge?.removed.use(e,(e=>e&&be())),ye=ge?.for.use(e,Ae),ge?.setInput(e),e),useMarkdown:()=>($e(),G.value?M.default.trim(J.serialize(G.value?.doc)):""),setDefaultToolbarVisibility:t=>(q.value=!t,e),setMinimal:(t=!0)=>(j.default.is(t)?P.bind(e,t):P.value=t,e),disablePersistence:()=>($e(),xe=!0,e),importMarkdown:t=>(Pe(t),e),ready:()=>(e.mirror?.domObserver?.flush(),e)})));const De=(0,D.default)();De.style.bind(p,"text-editor-document-slot--fullscreen").use(n,((e,o)=>{if(!o)return function(e){const o=new h.EditorView(e.element,{transformPastedHTML:(e,t)=>(E.default.isPasteHTML(e)&&(e=E.default.fixPasteHTML(e)),e.replaceAll(/(?<=<\/\s*p\s*>\s*)<\s*br\s*\/?\s*>(?=\s*<\s*p\b)/g,"<p></p>").replaceAll(/<\s*br\s*class="Apple-interchange-newline"\s*\/?\s*>/g,"")),state:m.EditorState.create({doc:Y.parse(c.value),plugins:[(0,r.buildInputRules)(W),(0,s.inputRules)({rules:[Ce({regex:/\*\*((?:(?!\*\*).)+)\*\*$/g,type:W.marks.strong,getContent:e=>e[1]}),Ce({regex:/__((?:(?!__).)+)__$/g,type:W.marks.underline,getContent:e=>e[1]}),Ce({regex:/\/\/((?:(?!\/\/).)+)\/\/$/g,type:W.marks.em,getContent:e=>e[1]}),Ce({regex:/~~((?:(?!~~).)+)~~$/g,type:W.marks.strikethrough,getContent:e=>e[1]}),Ce({regex:/`([^`]+?)`$/g,type:W.marks.code,getContent:e=>e[1]}),Ce({regex:/\[(.+?)\]\(([^ ]+?)(?:[  ](?:\((.+?)\)|["'“”‘’](.+?)["'“”‘’]))?\)$/g,type:W.marks.link,getAttrs:([e,t,o,n,a])=>({href:o,title:n||a||void 0}),getContent:e=>e[1]}),Ce({regex:/@([a-zA-Z0-9-]+)$/g,type:W.marks.mention,getAttrs:e=>({vanity:e[1]}),getContent:e=>`@${e[1]}`})]}),(0,d.keymap)((0,r.buildKeymap)(W,{})),(0,d.keymap)(a.baseKeymap),(0,d.keymap)({"Mod-s":(0,a.toggleMark)(W.marks.strikethrough),"Mod-S":(0,a.toggleMark)(W.marks.strikethrough),"Mod-.":(0,a.toggleMark)(W.marks.superscript),"Mod-,":(0,a.toggleMark)(W.marks.subscript),"Alt-Ctrl-0":(0,a.setBlockType)(W.nodes.paragraph),"Alt-ArrowLeft":fe(W.nodes.text_align,{align:"left"}),"Alt-ArrowDown":fe(W.nodes.text_align,{align:"center"}),"Alt-ArrowRight":fe(W.nodes.text_align,{align:"right"}),...R.default.range(1,7).toObject((e=>[`Alt-Ctrl-${e}`,(0,a.setBlockType)(W.nodes.heading,{level:e})]))}),(0,i.dropCursor)(),(0,l.gapCursor)(),(0,u.history)(),new m.Plugin({appendTransaction(e,t,o){const n=[];let a=!1;if(o.doc.descendants(((e,t)=>{const i=e.marks.find((e=>e.type===W.marks.mention));if(!i)return;let r,l=t+e.nodeSize;for(;(r=o.doc.nodeAt(l))&&r.marks.find((e=>e.type===W.marks.mention&&e.attrs.vanity==e.attrs.vanity));)l+=r.nodeSize;let u,s=o.doc.textBetween(t,l);return!!s.startsWith("@")&&(s=s.slice(1),[,s,u]=s.match(/^([a-zA-Z0-9-]+)(.*)$/)??[],!!s&&(l-=u.length,i.attrs.vanity!==s&&(n.push({start:t,end:l,vanity:s,textAfter:u}),a=!0),!1))})),!a)return null;const i=o.tr;for(const{start:e,end:t,vanity:o,textAfter:a}of n.reverse()){const n=W.marks.mention.create({vanity:o});i.removeMark(e,t+a.length,W.marks.mention),i.insertText(a,t),i.replaceWith(e,t+a.length,W.text(`@${o}`)),i.addMark(i.mapping.map(e),i.mapping.map(t),n)}return i},view:()=>({update(e,t){G.value=e.state,G.value===t&&G.emit()}})})]})});return V.mirror=o,V.document=(0,y.default)().and(k.default).replaceElement(V.mirror.dom).ariaRole("textbox").classes.add("markdown").style("text-editor-document").style.bind(p,"text-editor-document--fullscreen").setId(`text-editor-${t}`).attributes.set("aria-multiline","true").event.subscribe("scroll",(()=>Oe.element.scrollTo({left:V.document?.element.scrollLeft??0,behavior:"instant"}))),Object.assign(V.document,{required:V.required,invalid:V.invalid,touched:V.touched}),he.ariaControls(V.document),Re(),()=>{c.value=M.default.trim(J.serialize(o.state.doc)),V.mirror=void 0,V.document=void 0,Re(),o.destroy()}}((0,D.default)().appendTo(e));G.value=void 0})).appendTo(Te),e.onRemoveManual((()=>V.mirror?.destroy()));const Ee=j.default.Generator((()=>`${V.document?.element.scrollWidth??0}px`)).observe(e,G,I.default.size,p),Oe=(0,y.default)().style("text-editor-document-scrollbar-proxy").style.bind(p,"text-editor-document-scrollbar-proxy--fullscreen").style.bind(Ee.map(e,(()=>(V.document?.element.scrollWidth??0)>(V.document?.rect.value.width??0))),"text-editor-document-scrollbar-proxy--visible").style.bindVariable("content-width",Ee).event.subscribe("scroll",(()=>V.document?.element.scrollTo({left:Oe.element.scrollLeft,behavior:"instant"}))).appendTo(Te),Me=j.default.Generator((()=>`${De.element.scrollWidth??0}px`)).observe(e,G,I.default.size);De.style.bindVariable("content-width",Me),G.use(V,(e=>{!function(e=V.document?.name.value,t){const o=t?M.default.trim(J.serialize(t)):"";if(c.value=o,V.length.asMutable?.setValue(o.length),$.value||=!!o,Ie(),!e)return;if(xe)return;if(o===V.default.state.value)return $e();N.default.items.textEditorDrafts=[...o?[{name:e,body:o,created:Date.now()}]:[],...(N.default.items.textEditorDrafts??[]).filter((t=>t.name!==e&&Date.now()-t.created<B.default.days(1)&&!0))].slice(0,4)}(void 0,e?.doc),he.rect.markDirty()}));const Se=(0,w.default)().and(D.default).style.remove("slot").style("text-editor-fullscreen-dialog").setFullscreen().setOwner(V).bind(p).appendTo(document.body);return V.length.use(V,((e=0)=>{let t;e>(V.maxLength.value??1/0)&&(t=e=>e["shared/form/invalid/too-long"]()),V.setCustomInvalidMessage(t),V.document?.setCustomInvalidMessage(t),we.event.bubble("change")})),V;function Ie(){let e;(V.length.value??0)>(V.maxLength.value??1/0)&&(e=e=>e["shared/form/invalid/too-long"]()),!V.length.value&&V.required.value&&(e=e=>e["shared/form/invalid/required"]()),V.setCustomInvalidMessage(e)}function Ce(e){return new s.InputRule(e.regex,((t,o,n,a)=>{const i=e.getAttrs instanceof Function?e.getAttrs(o):e.getAttrs,r=e.getContent instanceof Function?e.getContent(o):e.getContent??"",l=t.tr;l.replaceWith(n,a,"string"==typeof r?W.text(r):r);const u=e.type.create(i);return l.addMark(l.mapping.map(n),l.mapping.map(a),u),l.removeStoredMark(u),e.regex.lastIndex=0,l}))}function Re(){ge?.setInput(V.document),V.document?.setName(ge?.for),V.document?.setId(ge?.for),ge?.setId(ge.for.map(e,(e=>`${e}-label`))),he.ariaLabelledBy(ge),V.document?.ariaLabelledBy(ge),V.document?.attributes.toggle(V.required.value,"aria-required","true"),Ie()}function $e(e=V.document?.name.value){e&&(N.default.items.textEditorDrafts=N.default.items.textEditorDrafts?.filter((t=>t.name!==e)))}function Pe(e=""){(V.mirror?.docView).dirty=2,V.mirror?.updateState(m.EditorState.create({plugins:V.mirror.state.plugins.slice(),doc:Y.parse(e)})),c.value=e,V.length.asMutable?.setValue(e.length),Ie()}function Ae(e=V.document?.name.value){if(!e)return;if(xe)return;const t=N.default.items.textEditorDrafts?.find((t=>t.name===e));t&&Pe(t.body)}function je(e,t){if(!G.value)return!1;const o=G.value.selection;return t??=o.empty?o.$from:void 0,t?!!e.isInSet(G.value.storedMarks||t.marks()):G.value.doc.rangeHasMark(o.from,o.to,e)}function Ne(e,t,o){if(!G.value)return!1;const n=G.value.selection;if(o??=n.empty?n.$from:void 0,o)return!!o.closest(e,t);let a=!1;return G.value.doc.nodesBetween(n.from,n.to,(o=>{a||=o.matches(e,t)})),a}function qe(e){if(!G.value)return;const t=G.value.selection;if(e??=t.empty?t.$from:void 0,e){for(const t of z)if(Ne(W.nodes[t],e))return t.replaceAll("_","-");return"paragraph"}const o=new Set;if(G.value.doc.nodesBetween(t.from,t.to,((e,t)=>{if(e.type!==W.nodes.text)return;const n=G.value?.doc.resolve(t);if(n)for(const e of z)if(Ne(W.nodes[e],n))return void o.add(e.replaceAll("_","-"))})),!o.size)return qe(t.$from);if(o.size>1)return;const[n]=o;return n}function Be(e,t){if(!G.value)return!1;e="centre"===e?"center":e;const o=G.value.selection;if(t??=o.empty?o.$from:void 0,t)return(t.closest(W.nodes.text_align)?.attrs.align??"left")===e;let n=!1;return G.value.doc.nodesBetween(o.from,o.to,((t,o)=>{const a=G.value?.doc.resolve(o);n||=a?Be(e,a):"left"===e})),n}function Le(e){if(!G.value)return;const t=G.value.selection;if(e??=t.empty?t.$from:void 0,e){const t=e.closest(W.nodes.text_align)?.attrs.align??"left";return"center"===t?"centre":t}const o=new Set;if(G.value.doc.nodesBetween(t.from,t.to,((e,t)=>{if(e.type===W.nodes.text){const e=G.value?.doc.resolve(t);e&&o.add(Le(e))}})),!o.size)return Le(t.$from);if(o.size>1)return;const[n]=o;return n}})),{passThrough:function(e,t=!0){const o=Q().style("text-editor--internal").appendTo(document.body),n=e(o),a=o.content.value;if(o.remove(),!n&&t)throw new Error("Unable to convert HTML to markdown");return n?a:void 0}});t.default=Q})),define("ui/component/core/TextInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/utility/StringApplicator","utility/State"],(function(e,t,o,n,a,i){function r(e){return(t,o,n)=>void 0===o?e("",t,"").join(""):e(t,o,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.FilterFunction=r,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),function(e){e.mapped=function(t){return e(((...e)=>e.map((e=>t(e)))))},e.DEFAULT=e(((...e)=>e));const t=/[^0-9]/g;e.NUMERIC=e.mapped((e=>e.replace(t,"")));const o=/[^0-9.]|(?<=\..*)\./g;e.DECIMAL=e(((e,n,a)=>(e=e.replace(o,""),n=n.replace(e.includes(".")?t:o,""),a=a.replace(e.includes(".")||n.includes(".")?t:o,""),[e,n,a])))}(r||(t.FilterFunction=r={}));const l=o.default.Builder("input",(e=>{let t,l,u=!1;const s=(0,i.default)(""),d=e.and(n.default).style("text-input").attributes.set("type","text").attributes.set("autocomplete","off").extend((e=>({value:"",state:s,default:(0,a.default)(e,(t=>{""===e.value&&(t=(t??"").trim(),e.value=t,s.value=t,e.length.asMutable?.setValue(t.length),c())})),placeholder:(0,a.default)(e,(t=>{e.attributes.set("placeholder",t)})),ignoreInputEvent:(t=!0)=>(u=t,e),filter:o=>(t=o,e),setReadonly:()=>(e.attributes.append("readonly"),e),setValidityHandler:t=>(l=t,e),wrap:()=>(e.style("text-input--wrapped"),(0,o.default)().style("text-input","text-input-wrapper").append(e))}))).extendMagic("value",(e=>({get:()=>e.element.value||"",set:t=>{const o=e.element;o.value=t,p("change"),s.value=o.value,e.length.asMutable?.setValue(o.value.length),c()}})));return d.length.asMutable?.setValue(0),c(),d.event.subscribe(["input","change"],(e=>{p(e.type),u||(s.value=d.value.trim(),d.length.asMutable?.setValue(d.value.trim().length),c())})),d;function c(){let e;(d.length.value??0)>(d.maxLength.value??1/0)&&(e=e=>e["shared/form/invalid/too-long"]()),e??=l?.(d),d.setCustomInvalidMessage(e)}function p(e){const o=d.element.asType("input");if(!o)return;const n=t??r.DEFAULT;if("change"===e)return void(o.value=n(d.value.trim(),"","").join("").trim());let{selectionStart:a,selectionEnd:i,value:l}=o;const u=null!==a||null!==i;a??=l.length,i??=l.length;const s=l.slice(0,a).trimStart();let c=l.slice(i).trimEnd(),p=l.slice(a,i);s.length||(p=p.trimStart()),c.length||(p=p.trimEnd()),p.length||s.length||(c=c.trimStart());const[f,m,v]=n(s,p,c);o.value=f+m+v,u&&o.setSelectionRange(f.length,f.length+m.length)}}));t.default=l})),define("ui/view/about/AboutViewRoadmap",["require","exports","endpoint/changelogs/$changelog_id/EndpointChangelogs$changelogIdDelete","endpoint/changelogs/$changelog_id/EndpointChangelogs$changelogIdUpdate","endpoint/changelogs/EndpointChangelogsAdd","endpoint/changelogs/EndpointChangelogsList","model/FormInputLengths","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/ext/CanHasActionsMenu","ui/component/core/Form","ui/component/core/InfiniteScroll","ui/component/core/LabelledTable","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Small","ui/component/core/TextEditor","ui/component/core/TextInput","utility/Env","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),t.default=u.default.Builder((e=>{(0,s.default)().tweak((e=>{e.title.text.use("document/roadmap/title"),e.content.useMarkdownContent("document/roadmap")})).appendTo(e);const t=(0,f.default)().and(g.default);return(0,s.default)().type("flush").style("view-type-about-changelog-wrapper").tweak((e=>{e.title.text.use("view/about/roadmap/changelog/title"),e.content.style("view-type-about-changelog");const f=(0,k.default)(void 0),g=(0,_.default)().setMaxLength(r.default.map(e,(e=>e?.changelog?.body))).setRequired(),T=(0,b.default)().setValidityHandler((e=>{if(e.length.value)return isNaN(new Date(e.value).getTime())?e=>e["shared/form/invalid/time"]():void 0})).placeholder.use("shared/form/time/placeholder"),x=(0,b.default)().filter(((...e)=>e.map((e=>e.replace(/[^0-9]/g,""))))).placeholder.set(`v${+w.default.BUILD_NUMBER||0}`),D=(0,s.default)().tweak((e=>{e.title.text.bind(f.map(e,(e=>t=>t[e?"view/about/roadmap/changelog-editor/title/update":"view/about/roadmap/changelog-editor/title/create"]())));const o=e.and(p.default,e.title),i=(0,m.default)().appendTo(o.content);i.label((e=>e.text.use("view/about/roadmap/changelog-editor/label/body"))).content(((e,t)=>e.append(g.setLabel(t))));const r=k.default.Generator((()=>(new Date).toLocaleString(navigator.language))),l=setInterval((()=>r.refresh()),1e3);e.onRemoveManual((()=>clearInterval(l))),i.label((e=>e.text.use("view/about/roadmap/changelog-editor/label/time"))).content(((e,t)=>e.append(T.setLabel(t)).append((0,v.default)().and(h.default).and(y.default).text.bind(k.default.Map(e,[T.state,r],((e,t)=>e?new Date(e).toLocaleString(navigator.language):t)))))),i.label((e=>e.text.use("view/about/roadmap/changelog-editor/label/version"))).content(((e,t)=>e.append(x.setLabel(t))));let u=!1;o.submit.text.bind(f.map(o,(e=>t=>t[e?"view/about/roadmap/changelog-editor/action/submit/save":"view/about/roadmap/changelog-editor/action/submit/create"]()))).event.subscribe("click",(async()=>{if(x.value&&isNaN(+x.value))return;if(u)return;u=!0;const e={body:g.useMarkdown(),version:x.value?+x.value:+w.default.BUILD_NUMBER||0,time:T.value?new Date(T.value).toISOString():void 0},o=f.value?await n.default.query({params:{changelog_id:f.value.id},body:e}):await a.default.query({body:e});u=!1,toast.handleError(o)||(g.importMarkdown(""),x.value="",T.value="",t.reset())})),(0,d.default)().text.use("view/about/roadmap/changelog-editor/action/cancel").event.subscribe("click",(()=>{g.importMarkdown(""),x.value="",T.value="",f.value=void 0})).appendToWhen(f.truthy,e.footer.left)})).appendToWhen(l.default.Auth.privileged.ChangelogModify,e.content);t.setFromEndpoint(i.default.prep(),((e,n,a)=>{for(const a of e)(0,s.default)().style("view-type-about-changelog-item").tweak((e=>e.content.style("view-type-about-changelog-item-content").append((0,u.default)().style("view-type-about-changelog-item-body").setMarkdownContent(a.body)))).tweak((e=>e.footer.left.and(h.default).and(y.default).text.set(`v${a.version}`))).tweak((e=>e.footer.right.and(h.default).and(y.default).text.set(new Date(a.time).toLocaleDateString(navigator.language)))).and(c.default).setActionsMenu((e=>{l.default.Auth.privileged.ChangelogModify.value&&((0,d.default)().type("flush").setIcon("pencil").text.use("view/about/roadmap/changelog-editor/action/edit").event.subscribe("click",(()=>{f.value=a,g.importMarkdown(a.body),x.value=`${a.version}`,T.value=new Date(a.time).toISOString(),D.header.element.scrollIntoView({behavior:"smooth"})})).appendTo(e),(0,d.default)().type("flush").setIcon("trash").text.use("view/about/roadmap/changelog-editor/action/delete").event.subscribe("click",(async()=>{const e=await o.default.query({params:{changelog_id:a.id}});toast.handleError(e)||t.reset()})).appendTo(e))})).tweak((e=>{e.primaryActions.style("view-type-about-changelog-item-primary-actions").appendTo(e.content),e.header.remove()})).appendTo(n)})).appendTo(e.content)})).appendTo(e),e}))})),define("ui/component/core/RSSButton",["require","exports","ui/Component","ui/component/core/Button"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),t.default=o.default.Builder("a",((e,t)=>e.replaceElement("a").and(n.default).attributes.bind("href",t).attributes.set("target","_blank").setIcon("rss").type("flush").style("rss-button").event.subscribe("click",(e=>{e.stopPropagation()}))))})),define("ui/component/core/Breadcrumbs",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Heading","ui/component/core/Link","ui/component/core/RSSButton","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=o.default.Builder((e=>{const t=(0,o.default)().style("breadcrumbs-path","breadcrumbs-path--hidden").viewTransition("breadcrumbs-path");let u;const s=(0,l.default)(void 0);return e.style("breadcrumbs").append(t).extend((e=>({meta:void 0,info:void 0,title:void 0,description:void 0,actions:void 0,path:t,backButton:s,setPath:(...a)=>(t.removeContents().style.toggle(!a.length,"breadcrumbs-path--hidden").append(...a.flatMap((([e,t],a)=>[a&&(0,o.default)().style("breadcrumbs-path-separator"),(0,i.default)(e).and(n.default).type("flush").text.use(t)]))),e),setBackButton:(t,o)=>(s.value?.remove(),t?(s.value=(0,i.default)(t).and(n.default).type("flush").style("breadcrumbs-back-button").setIcon("arrow-left").text.use("shared/action/return").tweak(o).appendTo(e.meta),e):e),setRSSButton:t=>(t=l.default.get(t),(0,r.default)(t.mapManual((e=>e??""))).style("breadcrumbs-rss-button").style.toggle(!!u,"breadcrumbs-rss-button--with-title").appendToWhen(t.truthy,u??e.info),e),getTitleIfExists:()=>u}))).extendJIT("meta",(e=>(0,o.default)().viewTransition("breadcrumbs-meta").style("breadcrumbs-meta").prependTo(e))).extendJIT("info",(e=>(0,o.default)().style("breadcrumbs-info").prependTo(e.meta))).extendJIT("title",(e=>u=(0,a.default)().style("breadcrumbs-title").setAestheticStyle(!1).prependTo(e.info))).extendJIT("description",(e=>(0,o.default)().style("breadcrumbs-description").appendTo(e.info))).extendJIT("actions",(e=>(0,o.default)().style("breadcrumbs-actions").appendTo(e.meta)))}));t.default=u})),define("ui/view/shared/component/View",["require","exports","ui/Component","ui/component/core/Breadcrumbs","ui/component/core/Heading","ui/view/shared/ext/ViewTitle","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder(((e,t)=>{const l=(0,o.default)().style("view-content");return e.style("view",`view-type-${t}`).attributes.set("data-view",t).append(l).extend((e=>({viewId:t,hash:"",breadcrumbs:void 0,content:l,titleComponent:void 0,sidebar:void 0}))).extendJIT("hash",(e=>`${e.viewId}${e.params?`_${JSON.stringify(e.params)}`:""}`.replaceAll(/\W+/g,"-"))).extendJIT("breadcrumbs",(e=>(0,n.default)().style("view-breadcrumbs").tweak((e=>{e.path.style("view-breadcrumbs-path");const t=e.setBackButton;e.backButton.value?.style("view-breadcrumbs-back-button"),e.setBackButton=(...o)=>(t(...o),e.backButton.value?.style("view-breadcrumbs-back-button"),e),e.tweakJIT("meta",(e=>e.style("view-breadcrumbs-meta"))),e.tweakJIT("info",(e=>e.style("view-breadcrumbs-info"))),e.tweakJIT("title",(e=>e.style("view-breadcrumbs-title"))),e.tweakJIT("description",(e=>e.style("view-breadcrumbs-description")))})).prependTo(e))).extendJIT("titleComponent",(e=>{const t=(0,r.default)(void 0);return o(),e.receiveDescendantInsertEvents(),e.receiveDescendantRemoveEvents(),e.event.subscribe(["descendantInsert","descendantRemove"],o),t;function o(){t.value=_??e.breadcrumbs.getTitleIfExists()??e.getFirstDescendant(i.default)??e.getFirstDescendant(a.default)}})).extendJIT("sidebar",(e=>(0,o.default)("aside").style("view-sidebar").appendTo(e.style("view--has-sidebar"))))}));t.default=l})),define("utility/Errors",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Impossible=()=>new Error("Something impossible appears to have happened, what are you?"),e.NotFound=()=>Object.assign(new Error("Not found"),{code:404}),e.Forbidden=()=>Object.assign(new Error("Forbidden"),{code:403}),e.BadData=e=>Object.assign(new Error("Bad data was sent by the server",{cause:e}),{code:500}),e.create=e=>Object.assign(new Error(e),{code:600});const t=Symbol("REDIRECTING");e.redirection=e=>()=>(navigate.toURL(e),t)}(o||(o={})),t.default=o})),define("ui/view/shared/component/ViewDefinition",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={...e,navigate:(e,o)=>e.view.show(t,o)};return t}})),define("ui/view/AboutView",["require","exports","ui/component/core/Block","ui/component/core/Tabinator","ui/view/about/AboutViewRoadmap","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importStar(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),t.default=(0,r.default)({create({tab:e}={}){const t=(0,i.default)("about"),r=(0,n.default)().appendTo(t.content);return(0,n.Tab)().text.use("view/about/main/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/about/title"))).tweak((e=>e.content.useMarkdownContent("document/about")))))).addTo(r),(0,n.Tab)("roadmap").text.use("view/about/roadmap/tab").tweak((e=>e.content.append((0,a.default)()))).addTo(r),(0,n.Tab)("supporters").text.use("view/about/supporters/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/about-supporters/title"))).tweak((e=>e.content.useMarkdownContent("document/about-supporters")))))).addTo(r),r.bindURL(e,(e=>e?`/about/${e}`:"/about")),r.bindViewTitle(),t}})})),define("endpoint/auth/EndpointAuthSetRequiredCount",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/set-required-count","post").noResponse()})),define("endpoint/authors/EndpointAuthorsDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/delete","post").noResponse()})),define("endpoint/auth/EndpointAuthServices",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/services","get")})),define("model/DangerToken",["require","exports","utility/Env","utility/Popup","utility/Store"],(function(e,t,o,n,a){var i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),function(e){const t=new Map;function i(e){for(const e of[...t.values()])(e.expiryTime<=new Date||e.uses<=0)&&t.delete(e.type);return t.get(e)}let r;e.canRequest=function(){return!r},e.canUse=function(e){return!!i(e)};const l=(0,n.default)({width:600,height:900});e.request=async function(e,n,u){const s=i(n);if(s)return s.uses--,!0;if(r)return!1;r=!0;const d=await l.show(e,{translation:e=>e["shared/popup/danger-token/title"](u.name),url:`${o.default.API_ORIGIN}danger-token/request/${n}/${u.id}/begin`}).toastError();if(r=!1,!d)return!1;const c=a.default.items.dangerTokenMetadataTransfer;if(c){delete a.default.items.dangerTokenMetadataTransfer;const e=c.uses-1;e&&t.set(n,{type:n,uses:e,expiryTime:new Date(c.expiryTime)})}return d},e.handleAuthParams=function(e){const t=e.get("danger-token-uses"),o=e.get("danger-token-expiry");if(!t||!o)return;const n=+t,i=new Date(o);isNaN(n)||isNaN(i.getTime())||(a.default.items.dangerTokenMetadataTransfer={uses:n,expiryTime:o})}}(i||(i={})),t.default=i})),define("ui/component/core/BlockDialog",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Dialog","utility/Task"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i);const r=o.default.Builder((e=>{const t=e.and(a.default).and(n.default).viewTransition(!1).style.remove("block");t.style("dialog-block-wrapper").style.bind(t.opened.not,"dialog-block-wrapper--closed");const o=(0,n.default)().style("dialog-block").style.bind(t.opened.not,"dialog-block--closed").appendTo(t);t.extend((e=>({content:o.content}))).extendJIT("header",(()=>o.header)).extendJIT("title",(()=>o.title)).extendJIT("primaryActions",(()=>o.primaryActions)).extendJIT("description",(()=>o.description)).extendJIT("footer",(()=>o.footer));const r=t.open;return t.extend((e=>({block:o,open:()=>(r(),o.style("dialog-block--opening"),e.style("dialog-block-wrapper--opening"),i.default.yield().then((()=>{o.style.remove("dialog-block--opening"),e.style.remove("dialog-block-wrapper--opening")})),e)})))}));t.default=r})),define("ui/component/core/ConfirmDialog",["require","exports","model/DangerToken","model/Session","ui/Component","ui/component/core/BlockDialog","ui/component/core/Button","ui/component/core/Paragraph","ui/component/core/Placeholder","utility/Errors","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d){let c;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d);const p=Object.assign(a.default.Builder((async(e,t)=>{const p=e.and(i.default).style("confirm-dialog");if(!1===t?.cancelButtonTranslation&&!1===t.confirmButtonTranslation)throw s.default.create("At least one ConfirmDialog button must be enabled");const f=(0,d.default)(void 0);p.title.text.use(t?.titleTranslation??"shared/prompt/confirm");const m=t?.bodyTranslation?(0,a.default)().style("confirm-dialog-body").useMarkdownContent({body:t.bodyTranslation}).appendTo(p.content):void 0,v=!1===t?.cancelButtonTranslation?void 0:(0,r.default)().text.use(t?.cancelButtonTranslation??"shared/action/cancel").appendTo(p.footer.right),h=!1===t?.confirmButtonTranslation?void 0:(0,r.default)().type("primary").text.use(t?.confirmButtonTranslation??"shared/action/confirm").appendTo(p.footer.right);let g;if(t?.dangerToken&&!o.default.canUse(t.dangerToken)){h?.setDisabled(!0,"danger-token"),g=(0,a.default)().appendTo(p.content),(0,l.default)().and(u.default).style("confirm-dialog-danger-token-hint").text.use("shared/prompt/reauth").appendTo(g);(await c(n.default.Auth.state,t.dangerToken)).event.subscribe("DangerTokenGranted",(()=>h?.setDisabled(!1,"danger-token"))).appendTo(g)}const y=p.extend((e=>({state:f,cancelButton:v,confirmButton:h,body:m,dangerTokenAuthWrapper:g,await:t=>(f.value=void 0,e.open(),new Promise((o=>t?e.state.match(t,[!0,!1],o):e.state.matchManual([!0,!1],o)))),cancel(){f.value=!1,e.close()},confirm(){f.value=!0,e.close()}}))).onRooted((e=>{e.cancelButton?.event.subscribe("click",e.confirmButton?e.cancel:e.confirm),e.confirmButton?.event.subscribe("click",e.confirm)}));return await(t?.tweak?.(y)),y})),{prompt:async(e,t)=>(await p(t)).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e),ensureDangerToken:async(e,t)=>!!o.default.canUse(t.dangerToken)||(await p(t)).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e),setOauthServicesComponent(e){c=e}});t.default=p})),define("ui/component/auth/OAuthService",["require","exports","model/Session","ui/Component","ui/component/core/Checkbutton","ui/component/core/ConfirmDialog","utility/Objects","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),l=__importDefault(l);const u=n.default.Builder(((e,t,u)=>{const s=!!o.default.Auth.get(t.name),d=_??u?.authorisationState??o.default.Auth.authorisations.map(e,(e=>e.find((e=>e.service===t.name)))),c=l.default.Truthy(e,d),p=e.and(a.default).setChecked(s).style("oauth-service").ariaRole("button").attributes.remove("aria-checked").setIcon().use(c).style.bind(c,"oauth-service--authenticated").style.setVariable("colour",`#${t.colour.toString(16)}`).append((0,n.default)("img").style("oauth-service-icon").attributes.set("src",t.icon)).append((0,n.default)().style("oauth-service-name").text.set(t.name)).extend((e=>({service:t,stateIndicatorWrapper:void 0,stateIndicator:void 0})));p.style.bind(p.disabled,"button--disabled","oauth-service--disabled"),(0,r.mutable)(p).stateIndicatorWrapper=(0,n.default)().style("oauth-service-state-wrapper").style.bind(p.hoveredOrFocused,"oauth-service-state-wrapper--focus").appendTo(p),(0,r.mutable)(p).stateIndicator=(0,n.default)().style("oauth-service-state").style.bind(c,"oauth-service-state--authenticated").style.bind(l.default.Map(p,[p.hoveredOrFocused,p.disabled],((e,t)=>e&&!t)),"oauth-service-state--focus").appendTo(p.stateIndicatorWrapper);const f=(0,n.default)().style("oauth-service-username").style.bind(c,"oauth-service-username--has-username").ariaHidden().appendTo(p);return d.use(p,(e=>{p.ariaLabel.use((o=>o["view/account/auth/service/accessibility/"+(e?"disconnect":"connect")](t.name,e?.display_name))),f.text.set(e?.display_name??"")})),p.onRooted((()=>{p.event.subscribe("click",(async e=>{if(p.disabled.value)return;if(e.preventDefault(),await(u?.onClick?.(p)))return;const n=o.default.Auth.get(t.name);if(n){if(o.default.Auth.loggedIn.value){if(!await i.default.prompt(p,{dangerToken:"remove-auth-service",bodyTranslation:e=>e["view/account/auth/service/disconnect/confirm"](t.name,n.display_name)}))return!1}await o.default.Auth.unauth(n.id)}else await o.default.Auth.auth(p,t)}))})),p}));t.default=u})),define("ui/component/auth/OAuthServices",["require","exports","endpoint/auth/EndpointAuthServices","model/DangerToken","model/Session","ui/Component","ui/component/auth/OAuthService","ui/component/core/Block","ui/component/core/ConfirmDialog","ui/component/core/Placeholder","ui/component/core/Slot","utility/Objects","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importStar(c),p=__importDefault(p);const f=i.default.Builder((async(e,t,u)=>{const f=e.and(l.default).viewTransition("oauth-services").style("oauth-service-container").style.toggle(!!u,"oauth-service-container--reauth-list").extend((e=>({data:void 0})));u?f.type("flush"):t.use(e,(e=>{f.title.text.use(`view/account/auth/${e}/title`),f.description.text.use("partial-login"===e?void 0:`view/account/auth/${e}/description`)}));const m=(0,i.default)().style("oauth-service-list").appendTo(f.content),v=await o.default.query();return toast.handleError(v)?(console.error(v),f):((0,c.mutable)(f).data=v.data,(0,d.default)().use(a.default.has,((t,o)=>{if(!o)return(0,i.default)().and(s.default).text.use("view/account/auth/none/needs-session").appendTo(t);for(const o of c.default.values(v.data))o.disabled||u&&!a.default.Auth.isAuthed(o)||(0,r.default)(o,{async onClick(e){if(!u)return!1;if(!n.default.canRequest())return!0;return await n.default.request(e,u,o)&&e.event.bubble("DangerTokenGranted",u),!0}}).bindDisabled(p.default.Use(e,{authorisations:a.default.Auth.authorisations,author:a.default.Auth.author}).map(e,(({authorisations:e,author:t})=>!u&&!!t&&1===e.length&&e[0].service===o.name)),"singly-authed-service").tweak((e=>{u&&e.stateIndicatorWrapper.remove()})).appendTo(t)})).appendTo(m),f)}));u.default.setOauthServicesComponent(f),t.default=f})),define("ui/utility/Applicator",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=function(e,t,n){const a=n?t:void 0;let i;n??=t;const r=function e(t){return{state:(0,o.default)(a),set:e=>(i?.(),l(e),t),bind:e=>(i?.(),i=e?.use(t,l),e||l(a),t),unbind:()=>(i?.(),l(a),t),rehost:e}}(e);return r;function l(e){r.state.value!==e&&(r.state.value=e,n(e))}}})),define("ui/component/core/RangeInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/utility/Applicator","utility/State"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i);const r=o.default.Builder(((e,t,r,l=1)=>{const u=(0,o.default)("input").style("range-input-input").attributes.set("type","range"),s=u.element;s.min=`${t}`,s.max=`${r}`,s.step=`${l}`;const d=(0,i.default)(void 0),c=(0,i.default)(s.valueAsNumber);s.addEventListener("input",(()=>c.value=s.valueAsNumber));const p=(0,o.default)().style("range-input-display").text.bind(c.mapManual((e=>e.toString()))),f=(0,i.default)(0),m=e.and(n.default).style("range-input").tabIndex("auto").append(u,p).extend((e=>({input:u,display:p,state:d,liveState:c,default:(0,a.default)(e,0,(e=>f.value=e))})));return i.default.MapManual([d,f],((e,t)=>c.value=s.valueAsNumber=e??t)),u.event.subscribe("change",(()=>c.value=d.value=s.valueAsNumber)),m}));t.default=r})),define("endpoint/authors/EndpointAuthorsCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/create","post")})),define("endpoint/authors/EndpointAuthorsUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/update","post")})),define("ui/component/core/ext/GradientText",["require","exports","ui/Component","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),t.default=o.default.Extension(((e,t,o="to right")=>{let a;return e.extend((e=>({useGradient:i=>(a?.(),a=n.default.get(i).use(e,(n=>e.style.toggle(!!n?.length&&!t,"gradient-text").style.setProperty(t?`--${t}`:"background-image",n?.length?`linear-gradient(${o} in oklch, ${n.map((e=>`#${e.toString(16).padStart(6,"0")}`)).map((e=>`light-dark(\n\t\t\t\t\t\t\toklch(from ${e} min(0.5, L) C H),\n\t\t\t\t\t\t\toklch(from ${e} max(0.75, L) C H)\n\t\t\t\t\t\t)`)).map(((e,t)=>0===t?`${e} var(--gradient-offset-start, 0%)`:t===n.length-1?`${e} calc(100% - var(--gradient-offset-end, 0%))`:e)).join(", ")})`:void 0))),e)})))}))})),define("ui/component/core/ColourInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/utility/Applicator","utility/State"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i);const r=o.default.Builder("input",(e=>{const t=(0,i.default)(0);return e.replaceElement("input").and(n.default).style("colour-input").attributes.set("type","color").event.subscribe("input",(e=>{t.value=parseInt(e.host.element.value.slice(1),16)})).tweak((e=>{t.use(e,(t=>e.element.value=`#${t.toString(16).padStart(6,"0")}`))})).extend((e=>({value:t,default:(0,a.default)(e,(t=>e.value.value=t??0))})))}));t.default=r})),define("ui/component/core/GradientInput",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/ColourInput","ui/component/core/ext/Input","ui/component/core/Slot","ui/InputBus","ui/utility/Applicator","utility/State"],(function(e,t,o,n,a,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s);const d=o.default.Builder((e=>{const t=(0,s.default)([],((e,t)=>e.length===t.length&&e.every(((e,o)=>e===t[o])))),d=t.mapManual((e=>e.slice()),((e,t)=>e?.length===t.length));let c;return e.and(i.default).style("gradient-input").append((0,r.default)().use(d,((e,i)=>{const r=[];for(let n=0;n<i.length;n++){const u=i[n];(0,o.default)().style("gradient-input-stop").append((0,a.default)().tweak((o=>{r[n]=o,o.value.value=u,o.value.subscribe(e,(e=>{t.value[n]=e,t.emit()})),c===n&&(o.onRooted((()=>o.focus())),c=void 0),l.default.until(o,(e=>e.subscribe("down",(e=>{e.targetComponent===o&&(e.use("Backspace")||e.use("Delete"))&&(c="Backspace"===e.key?Math.max(0,n-1):n,t.value.splice(n,1),t.emit())}))))})).event.subscribe("mousedown",(e=>{1===e.button&&(e.preventDefault(),t.value.splice(n,1),t.emit())}))).appendTo(e)}i.length<5&&(0,n.default)().setIcon("plus").style("gradient-input-add-stop").event.subscribe("click",(()=>{c=i.length,t.value.push(0),t.emit()})).tweak((e=>{c===i.length&&(e.onRooted((()=>e.focus())),c=void 0)})).appendTo(e)}))).extend((e=>({value:t,default:(0,u.default)(e,(t=>e.value.value=t?.length?t:[]))})))}));t.default=d})),define("ui/component/core/TextInputBlock",["require","exports","ui/Component","ui/component/core/TextInput"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=o.default.Builder((e=>{const t=[];return e.style("text-input-block").extend((e=>({inputs:t,addInput:a=>{const i=(0,n.default)().style("text-input-block-input").tweak(a).tweak((e=>e.removed.matchManual(!0,(()=>{t.filterInPlace((t=>t!==e));const o=t.at(0);o?.style("text-input-block-input--first"),o?.previousSibling?.remove(),t.at(-1)?.style("text-input-block-input--last"),t.at(-1)?.parent?.style("text-input-block-input-wrapper--last")})))).appendTo((0,o.default)().style("text-input-block-input-wrapper").appendTo(e));return t.length||i.style("text-input-block-input--first"),t.at(-1)?.style.remove("text-input-block-input--last"),t.at(-1)?.parent?.style.remove("text-input-block-input-wrapper--last"),t.push(i),i.style("text-input-block-input--last"),i.parent?.style("text-input-block-input-wrapper--last"),e}})))}));t.default=a})),define("ui/component/core/LabelledTextInputBlock",["require","exports","ui/Component","ui/component/core/Label","ui/component/core/TextInputBlock"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const i=o.default.Builder((e=>{e.style("labelled-text-input-block","labelled-row").ariaRole("group");const t=(0,o.default)().style("labelled-text-input-block-labels").appendTo(e),i=(0,a.default)().style("labelled-text-input-block-inputs").appendTo(e);let r,l;return e.extend((e=>({labels:t,inputs:i,label:o=>(r=o,l??={input:o=>{const a=i.inputs.length+1,l=(0,n.AutoLabel)().style("labelled-text-input-block-label").style.setProperty("grid-row",`${a}`).appendTo(t);let u;return r(l),i.addInput((e=>u=e.style("labelled-text-input-block-input").style.setProperty("grid-row",`${a}`).tweak((e=>o(e.setLabel(l),l))))),u.parent?.style("labelled-text-input-block-input-wrapper"),r=void 0,e}})})))}));t.default=i})),define("ui/component/core/toast/ToastList",["require","exports","model/Session","ui/Component","ui/component/core/toast/Toast","utility/Async","utility/Task","utility/Time"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=n.default.Builder((e=>{const t=(0,n.default)().style("toast-title").appendTo(e);return e.style("toast").extend((e=>({title:t,content:void 0,type:Object.assign(((...t)=>{for(const o of t)e.style(`toast-type-${o}`);return e}),{remove(...t){for(const o of t)e.style.remove(`toast-type-${o}`);return e}})}))).extendJIT("content",(e=>(0,n.default)().style("toast-content").appendTo(e)))})).setName("Toast"),s=n.default.Builder((e=>{const t=e.style("toast-list").extend((e=>({info:s.bind(null,"info"),success:s.bind(null,"success"),warning:s.bind(null,"warning"),handleError(t,n="shared/toast/error-occurred"){if(t instanceof Error){const i=t;return 401!==i.code||"Invalid session token"!==i.detail&&"This endpoint requires a session"!==i.detail?(e.warning(a.TOAST_ERROR,n,t),!0):(o.default.refresh(),!0)}return!1}})));return Object.assign(window,{toast:t}),t;function s(e,o,...a){const s=u().type(e).style("toast--measuring").tweak(o.initialise,...a);return async function(e,o){const a=(0,n.default)().style("toast-wrapper").appendTo(t);o.style("toast--measuring").appendTo(a),await r.default.yield();const u=o.rect.value;o.style.remove("toast--measuring"),a.style.setProperty("height",`${u.height}px`),await i.default.sleep(e.duration),o.style("toast--hide"),a.style.removeProperties("height"),await Promise.race([new Promise((e=>o.event.subscribe("animationend",e))),i.default.sleep(l.default.seconds(1))]),a.remove()}(o,s),s}}));t.default=s})),define("ui/component/core/toast/Toast",["require","exports","ui/Component"],(function(e,t,o){function n(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.TOAST_ERROR=t.TOAST_SUCCESS=void 0,o=__importDefault(o),t.default=n,t.TOAST_SUCCESS={duration:2e3,initialise(e,t){e.title.text.use(t)}},t.TOAST_ERROR={duration:5e3,initialise(e,t,n){console.error(n),e.title.text.use(t),function(e){return void 0!==e.headers}(n)&&n.detail?e.content.append((0,o.default)().style("toast-error-type").text.set(n.message)).text.append(": ").text.append(n.detail):e.content.text.set(n.message)}}})),define("utility/Functions",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NO_OP=()=>{},e.resolve=function(e,...t){return"function"==typeof e?e(...t):e},e.throwing=function(e){return()=>{throw new Error(e)}}}(o||(o={})),t.default=o})),define("ui/component/core/Dropdown",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/ext/Input","ui/component/core/Form","ui/component/core/RadioButton","ui/component/core/TextInput","ui/utility/Applicator","ui/utility/StringApplicator","utility/Arrays","utility/Async","utility/Functions","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m){Object.defineProperty(t,"__esModule",{value:!0}),t.CheckDropdown=t.RadioDropdown=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m);const v=o.default.Builder(((e,t)=>{const v=e.and(i.default).style("dropdown"),h=(0,m.default)(void 0),g=(0,m.default)(!1),y={};let b=0;const w=(0,u.default)().placeholder.use("shared/form/dropdown/filter/placeholder").style("dropdown-popover-input"),k=(0,o.default)().style("dropdown-popover-content"),T=(0,m.default)(void 0),x=(0,n.default)().style("dropdown-button").text.bind(h.mapManual((e=>void 0===e||Array.isArray(e)&&0===e.length?e=>e["shared/form/dropdown/selection/none"]():_??t.translateSelection?.(v,e)??(t=>t["shared/form/dropdown/selection/join"](...c.default.resolve(e).map((e=>f.default.resolve(y[e]?.translation,e))).map((e=>"string"==typeof e?e:f.default.resolve(e,t,d.QuiltHelper)))))))).setPopover("click",(e=>{const t=T.value;T.value=e.style("dropdown-popover").anchor.add("aligned left","aligned top").anchor.add("aligned left","aligned bottom").anchor.add("aligned left","sticky centre").anchor.orElseHide().extend((e=>({input:w,getSelected:()=>k.getChildren(n.default).toArray()}))),T.value.appendTo(v),T.value.visible.subscribeManual((async e=>{await p.default.sleep(20),e&&w.focus()})),k.appendTo(T.value),T.value.anchor.state.useManual((e=>{if(!T.value)return;const t="bottom"===e?.preference?.yAnchor.side;T.value.style.toggle(t,"dropdown-popover--is-bottom"),t?w.appendTo(T.value):w.prependTo(T.value)})),t?.remove()})).appendTo(v),D=(0,o.default)("input").style("dropdown-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`dropdown-validity-pipe-input-${Math.random().toString(36).slice(2)}`).appendTo(v);let E,O;return v.pipeValidity(D).ariaRole("group").extend((e=>({options:y,selection:h,touched:g,default:(0,s.default)(e,(e=>h.value=e)),button:x,popover:T,add(o,n){const i=t.createButton().style("dropdown-option").tweak((e=>e.is(l.default)&&e.setIcon(void 0))).type("flush").setId(o).setName(E).text.bind(f.default.resolve(n.translation,o)).use(h.mapManual((e=>c.default.resolve(e).includes(o)))).receiveFocusedClickEvents().tweak((e=>e.as(a.default)?.event.subscribe("click",(t=>{w.focus(),t.preventDefault(),t.stopImmediatePropagation();const n=e.is(l.default);if(n&&T.value?.hide(),h.value){const e=c.default.resolve(h.value);e.includes(o)?h.value=e.filter((e=>e!==o)):h.value=n?o:[...e,o].sort(((e,t)=>y[e].index-y[t].index))}else h.value=n?o:[o];g.value=!0,M()})))).tweak(n.tweakButton,o).appendTo(k);y[o]=Object.assign(n,{button:i,index:b++}),i.style.bind(i.checked,"dropdown-option--selected");const r=m.default.Map(i,[w.state,i.checked],((e,t)=>!t&&!!e&&!i.element.textContent?.toLowerCase()?.includes(e.toLowerCase())));return i.style.bind(r,"dropdown-option--filtered-out"),i.is(l.default)&&i.bindDisabled(i.checked,"selection"),e},clear(){for(const e of Object.values(y))e.button.remove();for(const e of Object.keys(y))delete y[e];return e},select(t){return this.selection.value=t,e}}))).extend((e=>({setLabel(t){O?.(),O=T.useManual((e=>e?.ariaLabel.bind(t?.text.state))),E=t?.for;for(const e of Object.values(y))e.button.setName(E);return t?.setInput(e),e}}))),v.onRooted(M),v.required.useManual(M),v;function M(){let e;!h.value&&v.required.value&&(e=e=>e["shared/form/invalid/required"]()),v.setCustomInvalidMessage(e),v.closest(r.default)?.refreshValidity()}}));t.RadioDropdown=o.default.Builder(((e,t)=>{const o=(0,m.default)(!1);return e.and(v,{createButton:l.default,...t}).tweak((e=>e.popover.useManual((e=>e?.style.bind(o,"dropdown-popover--simple"))))).extend((e=>({setSimple:(t=!0)=>(o.value=t,e)})))})).setName("RadioDropdown"),t.CheckDropdown=o.default.Builder(((e,t)=>e.and(v,{createButton:a.default,...t}))).setName("CheckDropdown")})),define("ui/utility/License",["require","exports","utility/Objects"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),t.LICENSES_NO_LINK=t.LICENSES=void 0,o=__importDefault(o),t.LICENSES=o.default.keys({"all-rights-reserved":!0,"cc-by":!0,"cc-by-sa":!0,"cc-by-nc":!0,"cc-by-nc-sa":!0,"cc-by-nd":!0,"cc-by-nc-nd":!0,cc0:!0,custom:!0}),t.LICENSES_NO_LINK=o.default.keys({"all-rights-reserved":!0,custom:!0})})),define("ui/component/LicenseFormFragment",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/Button","ui/component/core/Dropdown","ui/component/core/LabelledTextInputBlock","ui/utility/License"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const u=(0,i.RadioDropdown)().tweak((e=>{t&&e.add("inherit",{translation:e=>e=>e["shared/form/license/inherit"]()});for(const t of l.LICENSES)e.add(t,{translation:e=>e=>e[`license/${t}`](),tweakButton(e,t){e.style("license-input-dropdown-option"),"all-rights-reserved"!==t&&"custom"!==t&&e.style("license-input-dropdown-option--has-link").append((0,n.default)("a").attributes.use("href",(e=>e[`license/${t}/link`]())).attributes.set("target","_blank").and(a.default).style("license-input-dropdown-option-link-button").type("icon").setIcon("circle-question").ariaLabel.use("shared/form/license/link-view-text").event.subscribe("click",(e=>{e.stopPropagation()})))}});e.button.style("license-input-dropdown-button").event.subscribe("click",(t=>{e.button.element.scrollIntoView({behavior:"smooth"})}))}));let s,d;return e.label((e=>e.text.use("shared/form/license/label"))).content(((e,t)=>e.append(u.setLabel(t)))),(0,r.default)().style("labelled-row--in-labelled-table").ariaLabel.use("shared/form/license/aria-label").label((e=>e.text.use("shared/form/license/link"))).input((t=>s=t.setMaxLength(o.default.map(e,(e=>e?.license?.link))))).label((e=>e.text.use("shared/form/license/name"))).input((t=>d=t.setMaxLength(o.default.map(e,(e=>e?.license?.name))))).appendToWhen(u.selection.equals("custom"),e),{dropdown:u,customLinkInput:s,customNameInput:d,getFormData:()=>!(!u.selection.value||"inherit"===u.selection.value)&&("custom"===u.selection.value?{name:d.value,link:s.value}:{name:u.selection.value,link:""})}},o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),r=__importDefault(r)})),define("ui/component/SupportersOnlyLabel",["require","exports","ui/Component","ui/component/core/Label"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),t.default=o.default.Builder("label",(e=>e.and(n.default).style("label--supporter").prepend((0,o.default)().style("label-supporter","label-supporter--in-label").text.use("shared/term/supporters"))))})),define("ui/component/core/PrefixedInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/component/core/TextInput"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder(((e,t)=>{const i=(0,a.default)().style("prefixed-input-input").appendTo(e);return e.and(n.default).style("prefixed-input").append((0,o.default)().style("prefixed-input-prefix").text.use(t)).extend((e=>({input:i,required:i.required,hint:i.hint.rehost(e),maxLength:i.maxLength,length:i.length,invalid:i.invalid,hasPopover:i.hasPopover,getPopover:()=>i.getPopover(),disableDefaultHintPopoverVisibilityHandling:()=>(i.disableDefaultHintPopoverVisibilityHandling(),e),setMaxLength:t=>(i.setMaxLength(t),e),setRequired:t=>(i.setRequired(t),e),setLabel:t=>(i.setLabel(t),e),tweakPopover:t=>(i.tweakPopover(t),e),setCustomHintPopover:t=>(i.setCustomHintPopover(t),e),pipeValidity:t=>(i.pipeValidity(t),e),setCustomInvalidMessage:t=>(i.setCustomInvalidMessage(t),e),refreshValidity:()=>(i.refreshValidity(),e),state:i.state,value:void 0,default:i.default.rehost(e),placeholder:i.placeholder.rehost(e),ignoreInputEvent:(t=!0)=>(i.ignoreInputEvent(t),e),filter:t=>(i.filter(t),e),setReadonly:()=>(i.setReadonly(),e),setValidityHandler:t=>(i.setValidityHandler(t),e),wrap:()=>i.wrap()}))).extendMagic("value",(e=>({get:()=>i.value,set(e){i.value=e}})))}));t.default=i})),define("ui/component/VanityInput",["require","exports","ui/Component","ui/component/core/PrefixedInput","ui/component/core/TextInput"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.FilterVanity=void 0,o=__importDefault(o),n=__importDefault(n);const i=o.default.Builder((e=>e.and(n.default,"shared/prefix/vanity").filter(t.FilterVanity)));function r(e){return e.replace(/[\W_-]+/g,"-")}t.default=i,t.FilterVanity=(0,a.FilterFunction)(((e,t,o)=>(e=r(e),t=r(t),o=r(o),e||o?(e.startsWith("-")&&(e=e.slice(1)),e.endsWith("-")&&t.startsWith("-")&&(t=t.slice(1)),o.endsWith("-")&&(o=o.slice(0,-1)),t.endsWith("-")&&o.startsWith("-")&&(o=o.slice(1))):t=t.replace(/^-|-$/g,""),[e,t,o])))})),define("model/Patreon",["require","exports","lang/en-nz","ui/utility/StringApplicator","utility/Arrays","utility/Functions"],(function(e,t,o,n,a,i){var r;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),i=__importDefault(i),function(e){function t(e){return t=>t["shared/term/patreon-tier"]({NAME:e.tier_name,PRICE:`$${(e.amount/100).toFixed(2)}`})}e.getMoreRestrictive=function(e,t){return e?.length?t?.length?Math.min(...e.map((e=>e.amount)))>Math.min(...t.map((e=>e.amount)))?e:t:e||[]:t||[]},e.translateTier=t,e.translateTiers=function(e,r){const l=e.map((e=>r?.find((t=>t.tier_id===e)))).filter(a.NonNullish).sort(((e,t)=>e.amount-t.amount));if(!l.length)return e=>e["shared/form/visibility-patreon-tier/selection/none"]();if(r?.length===l.length)return e=>e["shared/form/visibility-patreon-tier/selection/all"]();const u=l[0];if(r?.every((t=>t.amount<=u.amount||e.includes(t.tier_id)))){const e=t(u),a=i.default.resolve(e,o.default,n.QuiltHelper);return e=>e["shared/form/visibility-patreon-tier/selection/tier-and-up"](a)}}}(r||(r={})),t.default=r})),define("ui/component/core/RadioRow",["require","exports","ui/Component","ui/component/core/ext/Input","ui/component/core/RadioButton","ui/utility/Applicator","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder((e=>{const t=(0,r.default)(void 0),o={};let l;return e.and(n.default).style("radio-row").ariaRole("group").extend((e=>({selection:t,default:(0,i.default)(e,(e=>t.value=e)),add(n,i){const r=o[n]=(0,a.default)().style("radio-row-option").type("flush").setIcon().tweak(i,n).setId(n).setName(l).use(t.map(e,(e=>e===n))).receiveFocusedClickEvents().event.subscribe("click",(e=>{t.value=n,e.preventDefault(),e.stopImmediatePropagation()})).appendTo(e);return r.style.bind(r.checked,"radio-row-option--selected"),r.bindDisabled(r.checked,"selection"),e},select:o=>(t.value=o,e)}))).extend((e=>({setLabel(t){l=t?.for;for(const e of Object.values(o))e.setName(l);return t?.setInput(e),e}})))}));t.default=l})),define("ui/component/VisibilityOptions",["require","exports","model/Patreon","model/Session","ui/component/core/Dropdown","ui/component/core/RadioRow","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),t.default=function(e,t,l){const u=(e,t)=>e.style("visibility-options-option").text.use(`shared/form/visibility/${t.toLowerCase()}`),s=r.default.Map(e,[t,n.default.Auth.account],((e,t)=>e?.patreonEnabled?t?.patreon_campaign:void 0)),d=(0,i.default)().add("Public",u).add("Patreon",((e,t)=>e.tweak(u,t).style("visibility-options-option-patreon").style.bind(s.falsy,"radio-row-option--hidden"))).add("Private",u).default.bind(t.map(e,(e=>e?.visibility??"Private")));e.label((e=>e.text.use(l??"shared/form/visibility/label"))).content(((e,t)=>e.append(d.setLabel(t))));const c=d.selection.map(e,(e=>"Patreon"===e)),p=r.default.Use(e,{campaign:s,visibilityStateIsPatreon:c}).map(e,(({campaign:e,visibilityStateIsPatreon:t})=>e&&t?e.tiers:void 0)),f=(0,a.CheckDropdown)({translateSelection:(e,t)=>o.default.translateTiers(t,p.value??[])});return e.label((e=>e.text.use("shared/form/visibility-patreon-tier/label"))).if(p.truthy).content(((o,n)=>o.append(f.tweak((e=>{p.use(e,(t=>{e.clear();for(const o of t??[])e.add(o.tier_id,{translation:e=>e=>e["shared/term/patreon-tier"]({NAME:o.tier_name,PRICE:`$${(o.amount/100).toFixed(2)}`})})})),e.selection.subscribeManual(((t,o)=>{if(o?.length||1!==t?.length)return;const n=p.value?.find((e=>e.tier_id===t[0]));if(!n)return;const a=p.value?.filter((e=>e.amount>n.amount)).sort(((e,t)=>e.amount-t.amount));a?.length&&(e.selection.value=[...t,...a.map((e=>e.tier_id))])}))})).default.bind(t.map(e,(e=>e?.patreonTiers??[]))).setLabel(n)))),{visibility:d,patreonTiers:f}}})),define("ui/view/account/AccountViewForm",["require","exports","endpoint/authors/EndpointAuthorsCreate","endpoint/authors/EndpointAuthorsUpdate","lang/en-nz","model/FormInputLengths","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Checkbutton","ui/component/core/ext/GradientText","ui/component/core/Form","ui/component/core/GradientInput","ui/component/core/LabelledTable","ui/component/core/LabelledTextInputBlock","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/core/toast/Toast","ui/component/LicenseFormFragment","ui/component/SupportersOnlyLabel","ui/component/VanityInput","ui/component/VisibilityOptions","ui/utility/License"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),y=__importDefault(y),_=__importDefault(_),b=__importStar(b),w=__importDefault(w),t.default=l.default.Builder("form",((e,t)=>{const T=e.and(u.default),x=T.and(c.default,T.title);x.viewTransition("account-form"),x.title.text.use(`view/account/${t}/title`),x.setName(a.default[`view/account/${t}/title`]().toString()),"create"===t&&x.description.text.use("view/account/create/description"),x.submit.textWrapper.text.use(`view/account/${t}/submit`);const D=(0,f.default)().appendTo(x.content),E=(0,h.default)().setRequired().default.bind(r.default.Auth.author.map(e,(e=>e?.name))).hint.use("view/account/name/hint").setMaxLength(i.default.map(D,(e=>e?.author?.name))),O=(0,l.default)().and(d.default).text.bind(E.state).style("text-input-display");D.label((e=>e.text.use("view/account/name/label"))).content(((e,t)=>e.append(E.setLabel(t).style("text-input--wrapped--hidden").wrap().append(O))));const M=(0,p.default)().default.bind(r.default.Auth.author.map(e,(e=>e?.supporter?.username_colours)));D.label((e=>e.and(_.default).text.use("view/account/vanity-colours/label"))).content(((e,t)=>e.append(M.setLabel(t)))),O.useGradient(M.value);const S=(0,b.default)().placeholder.bind(E.state.map(e,(e=>(0,b.FilterVanity)(e)))).default.bind(r.default.Auth.author.map(e,(e=>e?.vanity))).hint.use("view/account/vanity/hint").setMaxLength(i.default.map(D,(e=>e?.author?.vanity)));D.label((e=>e.text.use("view/account/vanity/label"))).content(((e,t)=>e.append(S.setLabel(t))));const I=(0,h.default)().default.bind(r.default.Auth.author.map(e,(e=>e?.pronouns))).hint.use("view/account/pronouns/hint").setMaxLength(i.default.map(D,(e=>e?.author?.pronouns)));D.label((e=>e.text.use("view/account/pronouns/label"))).content(((e,t)=>e.append(I.setLabel(t))));const C=(0,v.default)().default.bind(r.default.Auth.account.map(e,(e=>e?.description.body))).hint.use("view/account/description/hint").setMaxLength(i.default.map(D,(e=>e?.author?.description)));let R,$;D.label((e=>e.text.use("view/account/description/label"))).content(((e,t)=>e.append(C.setLabel(t)))),(0,m.default)().style("labelled-row--in-labelled-table").ariaLabel.use("view/account/external-link/label").label((e=>e.text.use("view/account/external-link/label"))).input((t=>R=t.default.bind(r.default.Auth.author.map(e,(e=>e?.support_link))).hint.use("view/account/external-link/hint").setMaxLength(i.default.map(D,(e=>e?.author?.support_link))))).label((e=>e.text.use("view/account/external-label/label"))).input((t=>$=t.default.bind(r.default.Auth.author.map(e,(e=>e?.support_message))).hint.use("view/account/external-label/hint").setMaxLength(i.default.map(D,(e=>e?.author?.support_message))))).appendTo(D);const P=(0,p.default)().default.bind(r.default.Auth.author.map(e,(e=>e?.supporter?.card_colours)));D.label((e=>e.and(_.default).text.use("view/account/card-colours/label"))).content(((e,t)=>e.append(P.setLabel(t)))),T.useGradient(P.value);const{visibility:A}=(0,w.default)(D,r.default.Auth.account.map(D,(e=>({patreonEnabled:!1,visibility:e?.comments_privated?"Private":"Public"}))),"view/account/comments/label"),j=(0,y.default)(D);let N,q;return j.dropdown.default.bind(r.default.Auth.account.map(e,(e=>{const t=e?.license?.name;return t?k.LICENSES.includes(t)?t:"custom":"all-rights-reserved"}))),j.customLinkInput.default.bind(r.default.Auth.account.map(e,(e=>e?.license?.link))),j.customNameInput.default.bind(r.default.Auth.account.map(e,(e=>e?.license?.name))),D.label((e=>e.text.use("view/account/age/label"))).content(((e,t)=>{t.setRequired(),e.style("view-type-account-form-age-row"),N=(0,s.default)().text.use("view/account/age/option/sixteen-plus").setChecked(!!r.default.Auth.author.value).appendTo(e),q=(0,s.default)().text.use("view/account/age/option/eighteen-plus").setChecked("eighteen_plus"===r.default.Auth.account.value?.age).appendToWhen(N.checked,e),N.checked.use(e,(e=>{N.setCustomInvalidMessage(e?void 0:e=>e["view/account/age/invalid"]()),e||q.setChecked(!1)}))})),"create"===t&&D.label((e=>e.text.use("view/account/terms/label"))).content(((e,t)=>{t.setRequired();const o=(0,s.default)().text.use("view/account/terms/button").appendTo(e);o.checked.use(e,(e=>{o.setCustomInvalidMessage(e?void 0:e=>e["view/account/terms/invalid"]())}))})),x.onSubmit((async e=>{const a=N.checked.value?q.checked.value?"eighteen_plus":"sixteen_plus":void 0;if(!a)return;const i=await("create"===t?o.default:n.default).query({body:{name:E.value,vanity:S.value,description:C.useMarkdown(),pronouns:I.value,support_link:R.value,support_message:$.value,username_colours:M.value.value.slice(),card_colours:P.value.value.slice(),age:a,license:j.getFormData(),comments_privated:"Private"===A.selection.value}});toast.handleError(i,"view/account/toast/failed-to-save")||(toast.success(g.TOAST_SUCCESS,"view/account/toast/saved"),r.default.setAuthor(i.data))})),x}))})),define("endpoint/patreon/campaign/EndpointPatreonCampaignRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/patreon/campaign/remove","post")})),define("ui/view/account/AccountViewPatreonCampaign",["require","exports","endpoint/Endpoint","endpoint/patreon/campaign/EndpointPatreonCampaignRemove","model/Session","ui/Component","ui/component/auth/OAuthService","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/Slot","utility/Popup"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c);const f=(0,(p=__importDefault(p)).default)({translation:"view/account/patreon/campaign/popup/title",url:o.default.path("/auth/patreon/campaign/begin"),width:600,height:900});t.default=i.default.Builder(((e,t)=>{const o=e.and(l.default).style("view-type-account-patreon-campaign");o.title.text.use("view/account/patreon/campaign/title"),o.description.text.use("view/account/patreon/campaign/description");const p=a.default.Auth.account.map(o,(e=>e?.patreon_campaign??void 0));return(0,i.default)().style("view-type-account-patreon-campaign-oauth-row").append((0,r.default)(t,{authorisationState:p,onClick:async()=>(p.value?await async function(){if(!await s.default.prompt(e,{titleTranslation:"view/account/patreon/campaign/unlink/title",bodyTranslation:"view/account/patreon/campaign/unlink/description",confirmButtonTranslation:"view/account/patreon/campaign/unlink/confirm"}))return;await n.default.query(),await a.default.refresh()}():await m(),!0)}),(0,c.default)().use(p,((e,t)=>t&&(0,u.default)().style("view-type-account-patreon-campaign-oauth-row-relink-button").setIcon("rotate").onRooted((e=>e.event.subscribe("click",m)))))).appendTo(o.content),(0,c.default)().use(p,((e,t)=>t&&(0,i.default)().style("view-type-account-patreon-campaign-tier-list-wrapper").append((0,d.default)().setAestheticStyle(!1).style("view-type-account-patreon-campaign-tier-list-heading").text.use("view/account/patreon/campaign/tiers")).append((0,i.default)().style("view-type-account-patreon-campaign-tier-list").append(...t.tiers.sort(((e,t)=>e.amount-t.amount)).map((e=>(0,i.default)().style("view-type-account-patreon-campaign-tier").append((0,i.default)().style("view-type-account-patreon-campaign-tier-amount").text.set(`$${(e.amount/100).toFixed(2)}`)).append((0,i.default)().style("view-type-account-patreon-campaign-tier-name").text.set(e.tier_name)))))))).appendTo(o.content),o;async function m(){await f.show(e).toastError(),await a.default.refresh()}}))})),define("endpoint/supporter/EndpointSupporterStatus",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/supporter/status","get")})),define("model/PagedData",["require","exports","ui/utility/EventManipulator","utility/Objects","utility/State"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const i=Object.assign((function(e){const t=(0,a.default)(void 0),r=(0,a.default)([],!1),l={pageCount:t,event:void 0,get pages(){return r.value.filter((e=>!(e instanceof Promise)))},rawPages:r,get(t){if(r.value[t]instanceof Promise)return r.value[t];const o=r.value[t]?.value;return void 0!==o&&!1!==o||(r.value[t]=Promise.resolve(e.get(t,l)).then((e=>{if(!a.default.is(r.value[t])){let o;a.default.is(e)?(o=(0,a.default)(null,!1),o.bindManual(e)):o=(0,a.default)(e,!1),r.value[t]=o,r.emit()}return r.value[t]})),r.emit()),r.value[t]},set(e,o,n){a.default.is(r.value[e])?r.value[e].value=o:r.value[e]=(0,a.default)(o,!1),n?r.value.length=t.value=e+1:void 0!==t.value&&e>=t.value&&(t.value=void 0),r.emit(),l.event.emit("SetPage",e,o)},unset(e,t=e){for(let o=e;o<=t;o++)delete r.value[o];r.emit(),l.event.emit("UnsetPages",e,t)},delete(e){r.value.splice(e,1),r.emit(),l.event.emit("DeletePage",e)},setPageCount(e){t.value=!0===e?void 0:e},clear(){r.value=[],t.value=void 0},map(e){const t=l,o=i({get(o,n){const a=t.get(o);return a instanceof Promise?a.then((t=>e(t.value,o,o))):e(a.value,o,o)}});(0,n.mutable)(o).pageCount=t.pageCount;const a=o.clear,r=o.delete;return Object.assign(o,{pageCount:t.pageCount,setPageCount:t.setPageCount,set(e,t,o){throw new Error("Mapped PagedData is read-only")},delete(e){r(e),t.delete(e)},clear(){a(),t.clear()}})}};return(0,n.mutable)(l).event=(0,o.default)(l),l}),{fromEndpoint:function(e,t,o){const n=e,r={},l=i({async get(e){const i=await n.query(void 0,{page:e});if(404===i.code)return t?t(e):null;if(toast.handleError(i))return!1;if(l.setPageCount(i.page_count),o){const{content:e,auxiliary:t}=o(i.data);for(const[o,n]of Object.entries(t)){if(n===e)continue;const t=r[o]??=(0,a.default)([]),i=e;i[o]??=t,l[o]??=t,Object.assign(l,{aux:r}),Array.isArray(n)?t.value.push(...n):t.value.push(n),t.emit()}return e}return!Array.isArray(i.data)||i.data.length?i.data:t?t(e):null}});return l}});t.default=i})),define("model/PagedListData",["require","exports","model/PagedData","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=Object.assign((function(e,t){const i=(0,o.default)(t);return Object.assign(i,{pageSize:e,resized(t){const o=a(t,{get:l}),r=i.aux;if(r){const e=o;for(const[t,o]of Object.entries(r))e[t]=o}i.rawPages.subscribeManual((()=>{const e=o.rawPages.value;for(let t=0;t<e.length;t++){const a=e[t];if(n.default.is(a)){const u=a,s=l(t);function d(e){n.default.is(e)?u.bindManual(e):u.value=e,o.rawPages.emit()}s instanceof Promise?s.then(d):d(s);continue}const i=l(t);function r(a){const i=e[t]=(0,n.default)(null,!1);return n.default.is(a)?i.bindManual(a):i.value=a,o.rawPages.emit(),i}e[t]=i instanceof Promise?i.then(r):r(i),o.rawPages.emit()}}));return delete o.resized,o;function l(o){const a=o*t,r=(o+1)*t,l=Math.floor(a/e),s=Math.ceil(r/e),d=a%e,c=r%e||e,p=i.rawPages.value.slice();for(let e=l;e<s;e++){const t=p[e];e>=l&&e<s&&(!t||n.default.is(t)&&!1===t.value)&&(p[e]=i.get(e))}const f=p.slice(l,s);return f.some((e=>e instanceof Promise))?Promise.all(f).then((e=>u(e,d,c))):u(f,d,c)}function u(e,t,o){const a=[];for(let n=0;n<e.length;n++){const i=e[n];if(!1===i?.value)return!1;i?.value&&(0===n&&n===e.length-1?a.push(...i.value.slice(t,o)):0===n?a.push(...i.value.slice(t)):n===e.length-1?a.push(...i.value.slice(0,o)):a.push(...i.value))}return n.default.Generator((()=>a),!1).observeManual(...e)}}})}),{fromEndpoint:function(e,t,o){const i=t,r={},l=a(e,{async get(e,t){const a=await i.query(void 0,{page:e});if(404===a.code)return null;if(toast.handleError(a))return!1;if(t.setPageCount(a.page_count),o){const{content:e,auxiliary:t}=o(a.data);for(const[o,a]of Object.entries(t)){if(a===e)continue;const t=r[o]??=(0,n.default)([]),i=e;i[o]??=t,l[o]??=t,Object.assign(l,{aux:r}),Array.isArray(a)?t.value.push(...a):t.value.push(a),t.emit()}return e}return!Array.isArray(a.data)||a.data.length?a.data:null}});return l},fromArray:function(e,t){return a(e,{get(o,n){const a=o*e,i=(o+1)*e,r=t.slice(a,i);return r.length?(n.setPageCount(Math.ceil(t.length/e)),r):null}})}});t.default=a})),define("ui/component/core/ButtonRow",["require","exports","ui/Component","ui/component/core/Button"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),t.default=o.default.Builder((e=>{const t=(0,o.default)().style("button-row-content"),a=(0,n.default)().style("button-row-button");return e.style("button-row").append(t,a).extend((e=>({content:t,button:a})))}))})),define("ui/component/core/Details",["require","exports","ui/Component","ui/component/core/Button","utility/State"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder("details",(e=>{const t=(0,a.default)(!1),i=(0,o.default)("summary").and(n.default).appendTo(e),r=e.style("details").extend((e=>({state:t,summary:i})));return t.use(r,(e=>r.element.open=e)),r.event.subscribe("toggle",(e=>{t.value=e.host.element.open}))}));t.default=i})),define("ui/component/core/Paginator",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/Loading","ui/component/core/Popover","ui/component/core/Slot","ui/utility/MarkdownContent","ui/view/shared/ext/ViewTransition","utility/Async","utility/State","utility/string/Strings","utility/Style"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m);const v=o.default.Builder((e=>{const t=e.and(a.default),s=t.type.state.mapManual((e=>e.has("flush"))),v=m.default.measure("--masthead-height"),g=m.default.measure("--space-4");v.value,g.value,t.style.bind(s,"paginator--flush"),t.tweakJIT("header",(o=>{o.style("paginator-header").style.bind(s,"paginator-header--flush").style.bind(e.getStateForClosest(l.default).truthy,"paginator-header--within-popover"),t.content.style("paginator-content--has-header")}));const y=t.content.style("paginator-content").style.bind(s,"paginator-content--flush");t.footer;const _=(0,o.default)().style("paginator-after-anchor").appendTo(t),b=(0,p.default)(0),w=(0,p.default)(void 0,!1),k=w.mapManual((e=>e?.pageCount)),T=k.mapManual((e=>void 0===e)),x=k.mapManual((e=>void 0===e||e>1)),D=(0,p.default)(!1,!1);let E=Symbol();p.default.Use(e,{cursor:b,allData:w}).use(e,(async({cursor:t,allData:o})=>{if(!o)return D.value=!1;const n=E=Symbol(),a=await(o?.get(t));E===n&&D.bind(e,a)}));const O=b.mapManual((e=>e<=0)),M=p.default.Map(e,[b,k],((e,t)=>e+1>=(t??1/0)));function S(e){e.style("paginator-actions").style.bind(s,"paginator-actions--flush").style.bind(x.not,"paginator-actions--hidden"),e.left.style("paginator-actions-left"),e.right.style("paginator-actions-right"),e.middle.style("paginator-actions-middle"),(0,i.default)().setIcon("angles-left").type("icon").style("paginator-button").style.bind(O,"paginator-button--disabled").ariaLabel.use("paginator/first/label").event.subscribe("click",(()=>b.value=0)).appendTo(e.left),(0,i.default)().setIcon("angle-left").type("icon").style("paginator-button").style.bind(O,"paginator-button--disabled").ariaLabel.use("paginator/previous/label").event.subscribe("click",(()=>b.value=Math.max(b.value-1,0))).appendTo(e.left),(0,i.default)().setIcon("angle-right").type("icon").style("paginator-button").style.bind(M,"paginator-button--disabled").ariaLabel.use("paginator/next/label").event.subscribe("click",(()=>b.value=Math.min(b.value+1,void 0===k.value?1/0:k.value-1))).appendTo(e.right),(0,i.default)().setIcon("angles-right").type("icon").style("paginator-button").style.bind(M,"paginator-button--disabled").style.bind(T,"paginator-button--hidden").ariaLabel.use("paginator/last/label").event.subscribe("click",(()=>b.value=k.value?k.value-1:b.value)).appendTo(e.right)}let I,C,R,$,P,A;S(t.footer);const j=t.viewTransition("paginator").style("paginator").extend((e=>({headerActions:void 0,page:b,data:D,scrollAnchorBottom:_,set(t,o,n){I=n,W?.(),W=void 0,V?.(),V=void 0,P?.(),P=void 0,A?.(),A=void 0,b.setValueSilent(o),w.value=t,b.emit();const a=()=>b.emit();return t.event.subscribe("DeletePage",a),P=()=>t.event.unsubscribe("DeletePage",a),A=e.removed.matchManual(!0,P),e},orElse:t=>(C=t,e),setHasResults:t=>(R=t,e),setScroll:(t=!0)=>($=t,e),getPages:()=>G,onReset:(e,t)=>e?w.use(e,(()=>t())):w.useManual((()=>t()))}))).extendJIT("headerActions",(e=>(0,n.default)().tweak(S).style("paginator-actions--header").style.bind(s,"paginator-actions--header--flush").prependTo(e)));let N,q,B,L,V,W;const G=[];return(0,u.default)().use(w,((o,n)=>{const a=(0,u.default)().appendTo(o);G.splice(0,1/0);const i=(e,t)=>{const o=G[t];o?.style.remove("paginator-page--initial-load","paginator-page--bounce").style("paginator-page--hidden").style.setVariable("page-direction",0),G.splice(t,1)};n?.event.subscribe("DeletePage",i),o.closed.matchManual(!0,(()=>n?.event.unsubscribe("DeletePage",i)));const r=(e,t,o)=>{for(let e=t;e<=o;e++)G[e]?.remove(),delete G[e]};let p;function m(o,n=!1){if(!o||!1===$)return;if(e.closest(l.default))return;const a=o>0?t.element:_.element;if(a)if("function"!=typeof $)if(o>0){const e=a.getBoundingClientRect().top+window.scrollY-v.value-g.value;window.scrollTo({top:e,behavior:n?"instant":"smooth"})}else{const e=a.getBoundingClientRect().top+window.scrollY+g.value-window.innerHeight;window.scrollTo({top:e,behavior:n?"instant":"smooth"})}else $(a,o>0?"forward":"backward",{scrollRect:new DOMRect(0,window.scrollY,window.innerWidth,document.documentElement.scrollHeight),scrollAnchorTopRect:t.element.getBoundingClientRect(),scrollAnchorBottomRect:_.element.getBoundingClientRect(),previousScrollRect:L,scrollAnchorTopPreviousRect:B,scrollAnchorBottomPreviousRect:q})}n?.event.subscribe("UnsetPages",r),o.closed.matchManual(!0,(()=>n?.event.unsubscribe("UnsetPages",r))),W?.(),W=b.use(o,(async(e,i)=>{if(p??=e,e===p)return void(p=!1);L=new DOMRect(0,window.scrollY,window.innerWidth,document.documentElement.scrollHeight),B=j.element.getBoundingClientRect(),q=_.element.getBoundingClientRect(),V?.(),V=void 0;const r=!G.length,l=G[e]??=function(e){const a=`paginator-page${f.default.uid()}`,i=(0,u.default)().style("paginator-page");function r(){return i.removeContents(),(0,u.default)().style.remove("slot").style("paginator-page-content").style.bind(s,"paginator-page-content--flush").subviewTransition(a).appendTo(i)}if(!n)return;F().appendTo(r());const l=n.get(e);return Promise.resolve(l).then((l=>{l.use(o,(async o=>{if((R??h)(o,h)){async function l(){await(I?.(r(),o,e,n,j))}j.getViewTransition()?d.default.perform("subview",a,l):l()}else for(i.removeContents();!1===o;)j.event.emit("PageError",e),await new Promise((e=>{d.default.perform("subview",a,(()=>{U(e).appendTo(r())})),t.header.element.scrollIntoView()})),d.default.perform("subview",a,(()=>{F().appendTo(r())})),o=(await n.get(e)).value}))})),Object.assign(i,{content:l})}(e)?.appendTo(a),v=Math.sign(e-(i??e)),g=void 0===i?void 0:G[i];if(g?.style.remove("paginator-page--initial-load","paginator-page--bounce").style("paginator-page--hidden").style.setVariable("page-direction",v),l?.style.toggle(r,"paginator-page--initial-load").style.setVariable("page-direction",v),!n||!l)return;const y=await l.content;if(!1===y?.value||(R??h)(y?.value,h))return l.style.remove("paginator-page--hidden"),void m(v);if(void 0!==i){if(N===i)return;G[i]?.style("paginator-page--bounce"),m(-1,!0),await c.default.sleep(200),N=e,b.value=i}else{const e=n.pages.every((e=>!h(e.value)));if(0===n.pageCount.value||e||void 0===n.pageCount.value&&e)return C?.(l,j),void l.style.remove("paginator-page--hidden")}}))})).appendTo(y),j;function U(e){return(0,o.default)().style("paginator-error").append((0,o.default)().style("paginator-error-text").text.use("paginator/error")).append((0,i.default)().type("primary").style("paginator-error-retry-button").text.use("paginator/error/retry").event.subscribe("click",(()=>e())))}function F(){return(0,o.default)().style("paginator-loading").append((0,r.default)().style("paginator-loading-flag"))}}));function h(e){if(null==e||!1===e)return!1;if("object"!=typeof e)return!0;if(Array.isArray(e))return e.length>0;for(const t of Object.values(e))if(h(t))return!0;return!1}s.default.handle(((e,t)=>{if(e.getAttribute("id")?.length)return()=>{const t=(0,o.default)().replaceElement(e,!0).style("link-anchor");t.onRooted((()=>{const e=t.getStateForClosest(v).map(t,(e=>e?.getPages().find((e=>e?.element.contains(t.element)))?.style.getState(t,"paginator-page--hidden"))),o=t.element.id;t.attributes.remove("id"),t.attributes.bind(e.falsy,"id",o)}))}})),t.default=v})),define("ui/component/core/Timestamp",["require","exports","ui/Component","utility/State","utility/Time"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder(((e,t)=>{let o,i=!1;const r=(0,n.default)(new Date(t??Date.now()));return r.use(e,l),e.style("timestamp").setTooltip((e=>e.text.set(r.value.toLocaleString(navigator.language,{dateStyle:"long",timeStyle:"short"})))).extend((e=>({time:r,setTranslation:t=>(o=t,e),setSimple:(t=!0)=>(i=t,e)}))).onRooted((e=>{l();const t=setInterval(l,a.default.seconds(1));e.removed.matchManual(!0,(()=>clearInterval(t)))}));function l(){const t=a.default.relative(r.value.getTime(),{components:i?1:2,secondsExclusive:!0});e.text.set(o?e=>o(e)(t):t)}}));t.default=i})),define("endpoint/auth/patreon/patron/EndpointAuthPatreonPatronDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/patreon/patron/delete","post")})),define("ui/component/PatronAuthDialog",["require","exports","endpoint/auth/patreon/patron/EndpointAuthPatreonPatronDelete","endpoint/Endpoint","model/Session","ui/component/auth/OAuthService","ui/component/auth/OAuthServices","ui/component/core/ConfirmDialog","utility/Popup","utility/State"],(function(e,t,o,n,a,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s);const d=(0,u.default)({translation:"view/chapter/dialog/patron/popup/title",url:n.default.path("/auth/patreon/patron/begin"),width:600,height:900});var c;!function(e){e.auth=function(e){return l.default.prompt(e,{titleTranslation:"view/chapter/dialog/patron/title",bodyTranslation:"view/chapter/dialog/patron/description",confirmButtonTranslation:"view/chapter/dialog/patron/done",cancelButtonTranslation:!1,async tweak(e){const t=a.default.Auth.account.map(e,(e=>e?.patreon_patron??void 0)),n=await(0,r.default)((0,s.default)("none"));(0,i.default)(n.data.patreon,{authorisationState:t,onClick:async()=>(t.value?await async function(){await o.default.query(),await a.default.refresh()}():await async function(){await d.show(e).toastError(),await a.default.refresh()}(),!0)}).appendTo(e.content)}})}}(c||(c={})),t.default=c})),define("ui/view/account/AccountViewSupporter",["require","exports","endpoint/supporter/EndpointSupporterStatus","model/PagedListData","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/ButtonRow","ui/component/core/Details","ui/component/core/Heading","ui/component/core/Loading","ui/component/core/Paginator","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Small","ui/component/core/Timestamp","ui/component/PatronAuthDialog","utility/Popup","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b);const w=(0,_.default)({translation:"view/account/supporter/popup/start/title",width:1e3,height:900}),k=(0,_.default)({translation:"view/account/supporter/popup/manage/title",width:1e3,height:900});t.default=i.default.Builder((e=>{const t=e.and(r.default);t.title.text.use("view/account/supporter/title"),t.description.text.use("view/account/supporter/description");const _=(0,v.default)().style.remove("slot").style("view-type-account-supporter").appendTo(t.content),T=b.default.Async.fromEndpoint(_,o.default.prep());return _.use(T.state,((e,t)=>{if(!t.settled)return(0,c.default)().use(T);if(t.error)return(0,i.default)().append((0,f.default)().text.use((e=>e["view/account/supporter/status/error"](t.error.message)))).append((0,l.default)().text.use("view/account/supporter/status/action/retry").event.subscribe("click",(()=>T.refresh())));(t.value.status||t.value.months_remaining)&&((0,i.default)().append((0,i.default)().useMarkdownContent("view/account/supporter/status/supporter")).append("has_active_subscription"!==t.value.status&&t.value.end_time?(0,f.default)().and(m.default).text.use((e=>e["view/account/supporter/status/end-date"]((0,g.default)(t.value.end_time).style.remove("timestamp")))):void 0).append(t.value.total_paid?(0,f.default)().style("view-type-account-supporter-status-total").text.use((e=>e["view/account/supporter/status/total"]((t.value.total_paid/100).toFixed(2)))):void 0).appendTo(e),t.value.patreon_subscriptions.length&&(0,p.default)().type("flush").style("view-type-account-supporter-order-paginator").tweak((e=>e.title.text.use("view/account/supporter/order/list-title/patreon"))).tweak((e=>e.header.style("view-type-account-supporter-order-paginator-header").append((0,l.default)().setIcon("rotate").type("flush").event.subscribe("click",(async()=>{T.refresh()}))))).tweak((e=>e.content.style("view-type-account-supporter-order-paginator-content"))).tweak((e=>e.footer.style("view-type-account-supporter-order-paginator-footer"))).set(n.default.fromArray(25,t.value.patreon_subscriptions),0,((e,t)=>{e.style("view-type-account-supporter-order-list");const o=()=>(0,i.default)().style("view-type-account-supporter-order-list-header-label"),n=()=>o().style("view-type-account-supporter-order-list-header-amount");(0,i.default)().style("view-type-account-supporter-order-list-header").style("view-type-account-supporter-order").append(o().text.use("view/account/supporter/order/label/timestamp")).append(n().text.use("view/account/supporter/order/label/amount")).append(o()).append(o().text.use("view/account/supporter/order/label/status")).append(n().text.use("view/account/supporter/order/label/total")).appendTo(e);for(const o of t){const t="https://www.patreon.com/settings/memberships/fluff4me";(0,i.default)("a").attributes.set("href",t).attributes.set("target","_blank").style("view-type-account-supporter-order","view-type-account-supporter-order--patreon").append((0,g.default)(o.timestamp).setSimple().style("view-type-account-supporter-order-date")).append((0,i.default)().style("view-type-account-supporter-order-amount-value").text.use((e=>e["view/account/supporter/order/amount/subscription/value"](o.interval_amount?(o.interval_amount/100).toFixed(2):"?"))),(0,i.default)().style("view-type-account-supporter-order-amount-unit").text.use((e=>e["view/account/supporter/order/amount/subscription/unit"](!1)))).append((0,i.default)()).append((0,i.default)().style("view-type-account-supporter-order-status").text.use((e=>o.renewal_timestamp?e["view/account/supporter/order/renews"]((0,g.default)(o.renewal_timestamp).setSimple().style.remove("timestamp")):e["view/account/supporter/order/status"](o.status)))).append((0,i.default)().and(h.default).style("view-type-account-supporter-order-amount-value").text.use((e=>e["view/account/supporter/order/amount/total/value"]((o.amount/100).toFixed(2)))),(0,i.default)().and(h.default).style("view-type-account-supporter-order-amount-unit").text.use("view/account/supporter/order/amount/total/unit")).event.subscribe("click",(async e=>{e.preventDefault(),await k.show(e.host,{url:t}).toastError(),T.refresh()})).appendTo(e)}})).appendTo(e));const o=!!t.value.months_remaining||!!t.value.patreon_subscriptions.length||"has_active_subscription"===t.value.status,r=(0,s.default)().appendTo(e);r.summary.type("primary").text.use("view/account/supporter/action/add-plan"),r.state.value=!o,o||r.summary.style("view-type-account-supporter-add-plan-button--hidden"),o&&(0,f.default)().appendTo(r);const v=(0,i.default)().style("view-type-account-supporter-product-list").appendTo(r),_=["monthly","yearly","founder"];for(let e=0;e<_.length;e++){const t=_[e];"yearly"===t&&(0,f.default)().and(h.default).style("view-type-account-supporter-product-special-plans-hint").useMarkdownContent("view/account/supporter/product/special-plans-hint").appendTo(v);const o={monthly:"https://www.patreon.com/checkout/fluff4me?rid=25959404&slug=fluff4me",yearly:"https://www.patreon.com/checkout/fluff4me?rid=26004082&slug=fluff4me",founder:"https://www.patreon.com/checkout/fluff4me?rid=26004089&slug=fluff4me"}[t];(0,i.default)("a").and(l.default).attributes.set("href",o).attributes.set("target","_blank").style("view-type-account-supporter-product").style.setVariable("colour-rotation-index",e).event.subscribe("click",(async e=>{e.preventDefault(),await w.show(e.host,{url:o}).toastError(),T.refresh()})).append((0,d.default)().setAestheticStyle(!1).style("view-type-account-supporter-product-title").tweak((e=>e.textWrapper.remove())).append((0,i.default)().style("view-type-account-supporter-product-name").text.use(`view/account/supporter/product/${t}/name`)).append((0,i.default)().style("view-type-account-supporter-product-price").text.use(`view/account/supporter/product/${t}/default-price`))).append((0,f.default)().style("view-type-account-supporter-product-description").text.use("founder"===t?e=>e["view/account/supporter/product/founder/description"]():`view/account/supporter/product/${t}/description`)).appendTo(v)}t.value.patreon_subscriptions.length||(0,u.default)().style("view-type-account-supporter-patreon-row").tweak((e=>e.content.append((0,i.default)().text.use("view/account/supporter/already-patron-hint")))).tweak((t=>t.button.setIcon("patreon").style("view-type-account-supporter-patreon-row-button").text.bind(a.default.Auth.account.map(e,(e=>e?.patreon_patron?t=>t["view/chapter/action/unlink-patreon"](e.patreon_patron.display_name):e=>e["view/chapter/action/auth-to-patreon"]()))).event.subscribe("click",(async()=>{await y.default.auth(e),T.refresh()})))).appendTo(e)})),(0,i.default)().style("view-type-account-supporter-about").append((0,d.default)().text.use("view/account/supporter/about/title")).append((0,i.default)().useMarkdownContent("document/about-supporters")).appendTo(t.content),e}))})),define("endpoint/auth/totp/EndpointAuthTotpCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/totp/create","post")})),define("endpoint/auth/totp/EndpointAuthTotpDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/totp/delete","post").noResponse()})),define("endpoint/auth/totp/EndpointAuthTotpEnable",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/totp/enable","post").noResponse()})),define("ui/component/core/CodeInput",["require","exports","ui/Component","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=o.default.Builder(((e,t=6)=>{e.style("code-input");const a=[],i=n.default.JIT((()=>a.map((e=>e.element.value.trim())).join("")));for(let n=0;n<t;n++){const r=(0,o.default)("input").style("code-input-input","text-input").attributes.set("type","text").attributes.set("inputmode","numeric").attributes.set("maxlength","1").attributes.set("autocomplete","one-time-code").attributes.set("size","1").event.subscribe("focus",(e=>e.host.element.select())).event.subscribe("paste",(e=>{e.preventDefault();const o=e.clipboardData?.getData("text");if(o&&new RegExp(`^\\d{${t}}`).test(o)){for(let e=0;e<t;e++)a[e].element.value=o[e];i.markDirty()}})).event.subscribe("input",(e=>{const t=e.host.element;!t.value.length||t.value.match(/^\d$/)?(t.value.length&&a[n+1]?.focus(),i.markDirty()):t.value=""})).event.subscribe("keydown",(t=>{if("ArrowLeft"===t.key){t.preventDefault();const e=a[n-1];return e?.focus(),void e?.element.select()}if("ArrowRight"===t.key){t.preventDefault();const e=a[n+1];return e?.focus(),void e?.element.select()}const o=t.host.element;if("Backspace"===t.key){if(o.value.trim())return o.value="",void i.markDirty();const e=a[n-1];if(!e)return;return e.focus(),e.element.select(),e.element.value="",void i.markDirty()}if("Delete"===t.key){if(o.value.trim())return o.value="",void i.markDirty();const e=a[n+1];if(!e)return;return e.focus(),e.element.select(),e.element.value="",void i.markDirty()}if("Enter"===t.key)return t.preventDefault(),void e.cast().event.emit("Enter")})).appendTo(e);a.push(r)}return e.extend((e=>({state:i,valid:i.mapManual((e=>e.length===t)),clear(){for(const e of a)e.element.value="";i.markDirty()}})))}));t.default=a})),define("ui/view/account/AccountViewTOTP",["require","exports","endpoint/auth/totp/EndpointAuthTotpCreate","endpoint/auth/totp/EndpointAuthTotpDelete","endpoint/auth/totp/EndpointAuthTotpEnable","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/CodeInput","ui/component/core/ConfirmDialog","ui/component/core/Loading","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/TextInput","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),t.default=r.default.Builder(((e,t)=>{const h=e.and(l.default).style("view-type-account-totp");h.title.text.use("view/account/totp/title"),"disabled"===t.value?.author?.totp_state&&delete t.value.author.totp_state;const g=(0,v.default)(!1),y=v.default.Map(h,[t,g],((e,t)=>{if(!e)return;if(!e.author)return e.partial_login?.totp_required?"login":void 0;const o=e.author.totp_state;return"enabled"===o?"secured":"disabled"!==o?"none":t?"enter":"starting"}));h.content.style.bindFrom(y.mapManual((e=>e?`view-type-account-totp-content--state-${e}`:void 0)));const _=(0,r.default)().style("view-type-account-totp-content-guide").append((0,p.default)().append((0,f.default)().text.bind(y.mapManual((e=>e?t=>t[`view/account/totp/${e}/description`]():""))))).appendTo(h.content);(0,u.default)().type("primary").text.use("view/account/totp/none/action/setup").event.subscribe("click",(async()=>{if("none"!==y.value)return;const e=await o.default.query();if(toast.handleError(e))return;const t=i.default.state.value?.author;if(!t)return;const n=e.data.uri,a=new URL(n).searchParams.get("secret");a&&(t.totp_state="disabled",i.default.state.emit(),T.value=!0,w.value=a,b.value=await QRCode.toDataURL(n,{color:{dark:"#fff",light:"#0000"}}))})).appendToWhen(y.equals("none"),h.footer.right);const b=(0,v.default)(void 0),w=(0,v.default)(void 0);(0,c.default)().style("view-type-account-totp-qrcode").appendToWhen(v.default.Every(e,y.equals("starting"),b.falsy),h.content),(0,r.default)("img").attributes.bind("src",b).style("view-type-account-totp-qrcode").appendToWhen(v.default.Every(e,y.equals("starting"),b.truthy),h.content);const k=v.default.Every(e,y.equals("starting"),w.truthy),T=(0,v.default)(!0);(0,p.default)().append((0,f.default)().text.use("view/account/totp/starting/or-enter-key")).append((0,u.default)().type("inline","primary").text.bind(T.mapManual((e=>t=>t[e?"view/account/totp/starting/action/reveal-key":"view/account/totp/starting/action/hide-key"]()))).event.subscribe("click",(()=>T.value=!T.value))).appendToWhen(k,_),(0,m.default)().style("view-type-account-totp-key").attributes.bind(T,"inert").style.bind(T,"view-type-account-totp-key--disabled").placeholder.use("view/account/totp/starting/key-placeholder").setReadonly().tweak((e=>v.default.UseManual({keyHidden:T,secret:w}).useManual((({secret:t,keyHidden:o})=>e.value=o?"":t??"")))).appendToWhen(k,_),(0,u.default)().text.use("view/account/totp/starting/action/cancel").event.subscribe("click",(async()=>{if("starting"!==y.value)return;const e=await n.default.query();if(toast.handleError(e))return;const t=i.default.state.value?.author;t&&(delete t.totp_state,i.default.state.emit(),g.value=!1,b.value=void 0,w.value=void 0)})).appendToWhen(y.equals("starting"),h.footer.right),(0,u.default)().type("primary").text.use("view/account/totp/starting/action/continue").event.subscribe("click",(()=>{"starting"===y.value&&(g.value=!0)})).appendToWhen(y.equals("starting"),h.footer.right);const x=(0,s.default)().event.subscribe("Enter",(()=>D.element.click())).appendToWhen(y.equals("enter"),h.content);(0,u.default)().text.use("view/account/totp/enter/action/cancel").event.subscribe("click",(async()=>{if("enter"!==y.value)return;const e=await n.default.query();if(toast.handleError(e))return;const t=i.default.state.value?.author;t&&(delete t.totp_state,i.default.state.emit(),g.value=!1,b.value=void 0,w.value=void 0,x.clear())})).appendToWhen(y.equals("enter"),h.footer.right);const D=(0,u.default)().type("primary").text.use("view/account/totp/enter/action/enable").bindDisabled(x.valid.falsy,"invalid code").event.subscribe("click",(async()=>{if("enter"!==y.value)return;if(!x.valid.value)return;if(!await d.default.ensureDangerToken(e,{dangerToken:"totp-enable"}))return;const t=await a.default.query({body:{token:x.state.value}});if(toast.handleError(t))return;const o=i.default.state.value?.author;o&&(o.totp_state="enabled",i.default.state.emit())})).appendToWhen(y.equals("enter"),h.footer.right);return(0,u.default)().text.use("view/account/totp/secured/action/disable").event.subscribe("click",(async()=>{if("secured"!==y.value)return;if(!await d.default.ensureDangerToken(e,{dangerToken:"totp-delete"}))return;const t=await n.default.query();toast.handleError(t)||(delete i.default.state.value?.author?.totp_state,i.default.state.emit(),g.value=!1,b.value=void 0,w.value=void 0,x.clear())})).appendToWhen(y.equals("secured"),h.footer.right),h}))})),define("ui/view/AccountView",["require","exports","endpoint/auth/EndpointAuthSetRequiredCount","endpoint/authors/EndpointAuthorsDelete","model/Session","ui/component/auth/OAuthServices","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/RangeInput","ui/component/core/Slot","ui/component/core/Tabinator","ui/view/account/AccountViewForm","ui/view/account/AccountViewPatreonCampaign","ui/view/account/AccountViewSupporter","ui/view/account/AccountViewTOTP","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Errors","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importStar(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T);const x=k.default.redirection("/login");t.default=(0,w.default)({async load(){if("logged-in"!==a.default.Auth.state.value)return x();return{services:await(0,i.default)(a.default.Auth.state)}},create({tab:e}={},{services:t}){const i="account",w=(0,b.default)(i),k=a.default.Auth.state,x=navigate.isURL("/account/**");x&&a.default.Auth.author.use(w,(e=>w.breadcrumbs.setBackButton(e?.vanity?`/author/${e.vanity}`:void 0,(t=>t.subText.set(e?.name)))));const D=(0,v.default)().setMajor().appendTo(w.content);return(0,v.Tab)("profile").setIcon("circle-user").text.use("view/account/tab/profile").tweak((e=>(0,h.default)("update").subviewTransition(i).appendTo(e.content))).addTo(D),(0,v.Tab)("patreon").setIcon("patreon").text.use("view/account/tab/patreon").tweak((e=>(0,m.default)().use(k,((e,o)=>"logged-in"===o&&(0,g.default)(t.data.patreon).subviewTransition(i))).appendTo(e.content))).addTo(D),(0,v.Tab)("supporter").setIcon("heart").text.use("view/account/tab/supporter").tweak((e=>(0,y.default)().appendTo(e.content))).addTo(D),(0,v.Tab)("security").setIcon("shield-halved").text.use("view/account/tab/security").tweak((e=>{t.subviewTransition(i).appendTo(e.content);const n=a.default.state.map(t,(e=>e?.author?.authorisations?.length??1)),r=a.default.state.map(t,(e=>e?.author?.auth_services_required??1));(0,m.default)().appendTo(t.content).use(T.default.UseManual({availableCount:n,requiredCount:r}),((e,{availableCount:t,requiredCount:n})=>{if(t<=1)return;(0,s.default)().style("view-type-account-oauth-services-mfa-heading").text.use("view/account/auth/logged-in/mfa/title").appendTo(e),(0,p.default)().text.use("view/account/auth/logged-in/mfa/description").appendTo((0,c.default)().appendTo(e));const i=(0,d.default)().style("view-type-account-oauth-services-mfa-required-count-row").appendTo(e);i.label.text.use("view/account/auth/logged-in/mfa/label/required-count");const r=(0,f.default)(1,t).default.set(n).appendTo(i.content.style("view-type-account-oauth-services-mfa-required-count-row-content"));(0,l.default)().type("primary").text.use("view/account/auth/logged-in/mfa/action/save").bindDisabled(r.state.mapManual((e=>!e||e===n)),"no change").event.subscribe("click",(async()=>{const e=r.state.value??1;if(e<n&&!await u.default.ensureDangerToken(i,{dangerToken:"decrease-auth-service-count-required"}))return;const t=await o.default.query({body:{required_count:r.state.value??1}});toast.handleError(t)||(a.default.state.value?.author&&(a.default.state.value.author.auth_services_required=e,a.default.state.emit()),a.default.refresh())})).appendTo(i.content)})),(0,_.default)(a.default.state).subviewTransition(i).appendToWhen(a.default.Auth.loggedIn,e.content)})).addTo(D),(0,v.Tab)("more").setIcon("ellipsis-vertical").tweak((e=>e.icon?.style("button-icon--unpad-left"))).text.use("view/account/tab/more").tweak((e=>(0,m.default)().use(k,(e=>e.append((0,r.default)().style("view-type-account-more-row").tweak((e=>e.left.append((0,l.default)().text.use("view/account/action/logout").event.subscribe("click",(()=>a.default.reset())))))).append((0,r.default)().style("view-type-account-more-row").tweak((e=>e.left.append((0,l.default)().text.use("view/account/action/delete").event.subscribe("click",(async()=>{if(!await u.default.prompt(w,{dangerToken:"delete-account",bodyTranslation:"view/account/action/delete/confirm"}))return;const e=await n.default.query();return toast.handleError(e)?void 0:a.default.reset()})))))))).appendTo(e.content))).addTo(D),x&&D.bindURL(e,(e=>e?`/account/${e}`:"/account")),k.equals("logged-in").match(w,!1,(()=>navigate.toURL("/login"))),w}})})),define("endpoint/authors/EndpointAuthors$authorVanity",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/{author_vanity}","get")})),define("endpoint/comments/author/$author_vanity/EndpointCommentsAuthor$authorVanityChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/author/{author_vanity}/chapter","get")})),define("endpoint/comments/author/$author_vanity/EndpointCommentsAuthor$authorVanityWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/author/{author_vanity}/work","get")})),define("endpoint/works/EndpointWorks$authorVanity",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/{author_vanity}","get")})),define("endpoint/follows/author/$id/EndpointFollowsAuthor$idFollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/follow","post")})),define("endpoint/follows/author/$id/EndpointFollowsAuthor$idIgnore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/ignore","post")})),define("endpoint/follows/author/$id/EndpointFollowsAuthor$idUnfollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/unfollow","post")})),define("endpoint/follows/author/$id/EndpointFollowsAuthor$idUnignore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/unignore","post")})),define("endpoint/follows/author/$id/work-comments/EndpointFollowsAuthor$idWorkCommentsIgnore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/work-comments/ignore","post").noResponse()})),define("endpoint/follows/author/$id/work-comments/EndpointFollowsAuthor$idWorkCommentsUnignore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/work-comments/unignore","post").noResponse()})),define("endpoint/follows/EndpointFollowsAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/all","get")})),define("endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idFollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag-category/{id}/follow","post")})),define("endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idIgnore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag-category/{id}/ignore","post")})),define("endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idUnfollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag-category/{id}/unfollow","post")})),define("endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idUnignore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag-category/{id}/unignore","post")})),define("endpoint/follows/tag/$id/EndpointFollowsTag$idFollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag/{id}/follow","post")})),define("endpoint/follows/tag/$id/EndpointFollowsTag$idIgnore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag/{id}/ignore","post")})),define("endpoint/follows/tag/$id/EndpointFollowsTag$idUnfollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag/{id}/unfollow","post")})),define("endpoint/follows/tag/$id/EndpointFollowsTag$idUnignore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag/{id}/unignore","post")})),define("endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityFollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/work/{author_vanity}/{work_vanity}/follow","post")})),define("endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityIgnore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/work/{author_vanity}/{work_vanity}/ignore","post")})),define("endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityUnfollow",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/work/{author_vanity}/{work_vanity}/unfollow","post")})),define("endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityUnignore",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/work/{author_vanity}/{work_vanity}/unignore","post")})),define("ui/utility/PageListener",["require","exports","utility/State"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.visible=(0,o.default)("visible"===document.visibilityState),document.addEventListener("visibilitychange",(()=>e.visible.asMutable?.setValue("visible"===document.visibilityState)))}(n||(n={})),t.default=n})),define("model/Manifest",["require","exports","model/Session","ui/utility/PageListener","utility/State","utility/Time"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),t.default=function(e){let t,r,l,u=!1;const s=(0,a.default)(void 0,!1);let d=!1;p();const c=Object.assign(s,{isFresh:t=>!!t&&(Date.now()-(p()?.time??0)<e.valid||!n.default.visible.value),getManifest:async n=>d||!n&&c.isFresh(s.value)?s.value:!e.requiresAuthor||o.default.Auth.loggedIn.value?t??=(async()=>{try{const t=await e.get();if(t instanceof Error)throw t;r=Date.now(),s.value=t.data,f()}catch(t){if(!e.orElse)throw t;r=Date.now(),s.value=e.orElse()}return t=void 0,s.value})():void 0});return e.refresh&&setInterval((async()=>{if(c.isFresh(s.value))return;const t=`manifest:last-fetch-attempt:${e.cacheId}`,o=+localStorage.getItem(t)||0;Date.now()-o<i.default.seconds(60)||(localStorage.setItem(t,`${Date.now()}`),await c.getManifest(!0),localStorage.setItem(t,`${Date.now()}`))}),100),c;function p(){if(!e.cacheId)return;const t=localStorage.getItem(`manifest:${e.cacheId}`);if(t)try{const e=JSON.parse(t);if(!e||!("time"in e)||!("data"in e))return;const o=+e.time||0;return r===o?{time:r,data:s.value}:(d=!0,r=o,s.value=e.data,{time:o,data:s.value})}catch(e){return void console.log(e)}finally{d=!1,f()}}function f(){e.cacheId&&!u&&(l?.(),l=s.useManual((t=>{d||localStorage.setItem(`manifest:${e.cacheId}`,JSON.stringify({time:r,data:t}))})),u=!0)}}})),define("endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/{author_vanity}/{work_vanity}/delete","post").noResponse()})),define("utility/Enums",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.type=function(){return{values:(...e)=>e.distinctInPlace()}}}(o||(o={})),t.default=o})),define("model/Works",["require","exports","endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityDelete","ui/component/core/ConfirmDialog","utility/Enums"],(function(e,t,o,n,a){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.WORK_STATUS_ICONS=t.WORK_STATUSES=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.WORK_STATUSES=a.default.type().values("Complete","Ongoing","Hiatus","Cancelled"),t.WORK_STATUS_ICONS={Cancelled:"circle-xmark",Complete:"circle-check",Ongoing:"circle-play",Hiatus:"circle-pause"},function(e){e.resolve=function(e,t){return e?t.find((t=>t.author_vanity===e.author_vanity&&t.work_vanity===e.work_vanity)):void 0},e.equals=function(e,t){return!!e&&!!t&&e.author_vanity===t.author_vanity&&e.work_vanity===t.work_vanity},e.reference=function(e){return e?{author_vanity:e.author_vanity,work_vanity:e.work_vanity}:null}}(i||(i={})),t.default=Object.assign(i,{async delete(e,t){if(!e)return!0;if(!await n.default.prompt(t??null,{dangerToken:"delete-work",bodyTranslation:t=>t["work/action/delete/confirm"](e.name)}))return!1;const a=await o.default.query({params:i.reference(e)});return!toast.handleError(a)&&(navigate.isURL(`/work/${e.author_vanity}/${e.work_vanity}/**`)&&navigate.toURL(`/author/${e.author_vanity}`),!0)}})})),define("model/Follows",["require","exports","endpoint/follows/author/$id/EndpointFollowsAuthor$idFollow","endpoint/follows/author/$id/EndpointFollowsAuthor$idIgnore","endpoint/follows/author/$id/EndpointFollowsAuthor$idUnfollow","endpoint/follows/author/$id/EndpointFollowsAuthor$idUnignore","endpoint/follows/author/$id/work-comments/EndpointFollowsAuthor$idWorkCommentsIgnore","endpoint/follows/author/$id/work-comments/EndpointFollowsAuthor$idWorkCommentsUnignore","endpoint/follows/EndpointFollowsAll","endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idFollow","endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idIgnore","endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idUnfollow","endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idUnignore","endpoint/follows/tag/$id/EndpointFollowsTag$idFollow","endpoint/follows/tag/$id/EndpointFollowsTag$idIgnore","endpoint/follows/tag/$id/EndpointFollowsTag$idUnfollow","endpoint/follows/tag/$id/EndpointFollowsTag$idUnignore","endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityFollow","endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityIgnore","endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityUnfollow","endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityUnignore","model/Manifest","model/Works","utility/State","utility/Time"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x);const D=(0,w.default)({valid:x.default.minutes(5),refresh:!0,cacheId:"follows",requiresAuthor:!0,get:()=>u.default.query(),orElse:()=>({following:{work:[],author:[],tag:[],category:[]},ignoring:{work:[],author:[],tag:[],category:[]}})}),E=(0,T.default)(!1),O={changingState:E,getTotalFollowing:()=>0+(D.value?.following.author?.length??0)+(D.value?.following.work?.length??0)+(D.value?.following.tag?.length??0)+(D.value?.following["tag-category"]?.length??0),getTotalIgnoring:()=>0+(D.value?.ignoring.author?.length??0)+(D.value?.ignoring.work?.length??0)+(D.value?.ignoring.tag?.length??0)+(D.value?.ignoring["tag-category"]?.length??0),followingAuthor:e=>!!D.value?.following.author?.some((t=>t.author===e)),ignoringAuthor:e=>!!D.value?.ignoring.author?.some((t=>t.author===e)),ignoringAuthorWorkComments(e){const t=D.value?.following.author?.find((t=>t.author===e));return!!t?.ignoring_work_comments},async toggleFollowingAuthor(e){O.followingAuthor(e)?await O.unfollowAuthor(e):await O.followAuthor(e)},async followAuthor(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(O.followingAuthor(e))return;E.value=!0;const t=await o.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.ignoring.author?.filterInPlace((t=>t.author!==e)),D.value.following.author?.push({author:e,updated:(new Date).toISOString()}),D.emit())},async unfollowAuthor(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!O.followingAuthor(e))return;E.value=!0;const t=await a.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.following.author?.filterInPlace((t=>t.author!==e)),D.emit())},async toggleIgnoringAuthor(e){O.ignoringAuthor(e)?await O.unignoreAuthor(e):await O.ignoreAuthor(e)},async ignoreAuthor(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(O.ignoringAuthor(e))return;E.value=!0;const t=await n.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.following.author?.filterInPlace((t=>t.author!==e)),D.value.ignoring.author?.push({author:e,updated:(new Date).toISOString()}),D.emit())},async unignoreAuthor(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!O.ignoringAuthor(e))return;E.value=!0;const t=await i.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.ignoring.author?.filterInPlace((t=>t.author!==e)),D.emit())},async toggleIgnoringAuthorWorkComments(e){O.ignoringAuthorWorkComments(e)?await O.unignoreAuthorWorkComments(e):await O.ignoreAuthorWorkComments(e)},async ignoreAuthorWorkComments(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(O.ignoringAuthorWorkComments(e))return;E.value=!0;const t=await r.default.query({params:{id:e}});if(E.value=!1,toast.handleError(t))return;const o=D.value?.following.author?.find((t=>t.author===e));o&&(o.ignoring_work_comments=!0),D.emit()},async unignoreAuthorWorkComments(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!O.ignoringAuthorWorkComments(e))return;E.value=!0;const t=await l.default.query({params:{id:e}});if(E.value=!1,toast.handleError(t))return;const o=D.value?.following.author?.find((t=>t.author===e));o&&(o.ignoring_work_comments=void 0),D.emit()},followingWork:e=>!!D.value?.following.work?.some((t=>k.default.equals(t.work,e))),ignoringWork:e=>!!D.value?.ignoring.work?.some((t=>k.default.equals(t.work,e))),async toggleFollowingWork(e){O.followingWork(e)?await O.unfollowWork(e):await O.followWork(e)},async followWork(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(O.followingWork(e))return;E.value=!0;const t=await g.default.query({params:k.default.reference(e)});E.value=!1,toast.handleError(t)||(D.value.ignoring.work?.filterInPlace((t=>!k.default.equals(t.work,e))),D.value.following.work?.push({work:k.default.reference(e),updated:(new Date).toISOString()}),D.emit())},async unfollowWork(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!O.followingWork(e))return;E.value=!0;const t=await _.default.query({params:k.default.reference(e)});E.value=!1,toast.handleError(t)||(D.value.following.work?.filterInPlace((t=>!k.default.equals(t.work,e))),D.emit())},async toggleIgnoringWork(e){O.ignoringWork(e)?await O.unignoreWork(e):await O.ignoreWork(e)},async ignoreWork(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(O.ignoringWork(e))return;E.value=!0;const t=await y.default.query({params:k.default.reference(e)});E.value=!1,toast.handleError(t)||(D.value.following.work?.filterInPlace((t=>!k.default.equals(t.work,e))),D.value.ignoring.work?.push({work:k.default.reference(e),updated:(new Date).toISOString()}),D.emit())},async unignoreWork(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!O.ignoringWork(e))return;E.value=!0;const t=await b.default.query({params:k.default.reference(e)});E.value=!1,toast.handleError(t)||(D.value.ignoring.work?.filterInPlace((t=>!k.default.equals(t.work,e))),D.emit())},followingTag:e=>!!D.value?.following.tag?.some((t=>t.tag===e)),ignoringTag:e=>!!D.value?.ignoring.tag?.some((t=>t.tag===e)),async toggleFollowingTag(e){O.followingTag(e)?await O.unfollowTag(e):await O.followTag(e)},async followTag(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(O.followingTag(e))return;E.value=!0;const t=await f.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.ignoring.tag?.filterInPlace((t=>t.tag!==e)),D.value.following.tag?.push({tag:e,updated:(new Date).toISOString()}),D.emit())},async unfollowTag(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!O.followingTag(e))return;E.value=!0;const t=await v.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.following.tag?.filterInPlace((t=>t.tag!==e)),D.emit())},async toggleIgnoringTag(e){O.ignoringTag(e)?await O.unignoreTag(e):await O.ignoreTag(e)},async ignoreTag(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(O.ignoringTag(e))return;E.value=!0;const t=await m.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.following.tag?.filterInPlace((t=>t.tag!==e)),D.value.ignoring.tag?.push({tag:e,updated:(new Date).toISOString()}),D.emit())},async unignoreTag(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!O.ignoringTag(e))return;E.value=!0;const t=await h.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.ignoring.tag?.filterInPlace((t=>t.tag!==e)),D.emit())},followingCategory:e=>D.value?.following["tag-category"]?.some((t=>t.tag_category===e)),ignoringCategory:e=>D.value?.ignoring["tag-category"]?.some((t=>t.tag_category===e)),async toggleFollowingCategory(e){O.followingCategory(e)?await O.unfollowCategory(e):await O.followCategory(e)},async followCategory(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(O.followingCategory(e))return;E.value=!0;const t=await s.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.ignoring["tag-category"]?.filterInPlace((t=>t.tag_category!==e)),D.value.following["tag-category"]?.push({tag_category:e,updated:(new Date).toISOString()}),D.emit())},async unfollowCategory(e){if(!D.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!O.followingCategory(e))return;E.value=!0;const t=await c.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.following["tag-category"]?.filterInPlace((t=>t.tag_category!==e)),D.emit())},async toggleIgnoringCategory(e){O.ignoringCategory(e)?await O.unignoreCategory(e):await O.ignoreCategory(e)},async ignoreCategory(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(O.ignoringCategory(e))return;E.value=!0;const t=await d.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.following["tag-category"]?.filterInPlace((t=>t.tag_category!==e)),D.value.ignoring["tag-category"]?.push({tag_category:e,updated:(new Date).toISOString()}),D.emit())},async unignoreCategory(e){if(!D.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!O.ignoringCategory(e))return;E.value=!0;const t=await p.default.query({params:{id:e}});E.value=!1,toast.handleError(t)||(D.value.ignoring["tag-category"]?.filterInPlace((t=>t.tag_category!==e)),D.emit())}};t.default=Object.assign(D,O)})),define("ui/component/ActionBlock",["require","exports","model/Follows","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Dropdown","ui/component/core/Loading","ui/component/core/Paginator","ui/component/core/RadioRow","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),t.ActionBlockColumn=void 0,t.ActionProviderList=p,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d);const c=a.default.Builder((e=>{let t;const o=e.getStateForClosest(u.default);return e.style("action-block").style.bind(o.truthy,"action-block--in-paginator").extend((e=>({flush:()=>(e.style("action-block--flush"),e),attachAbove:()=>(e.style("action-block--attached-above"),e),addActions(o){t?.();const n=d.default.Owner.create();t=n.remove,e.removed.match(n,!0,n.remove);const a=p();o.getActions(n,a);const i=a.renderTo(n,e);return"boolean"==typeof i?e.style.toggle(!i,"action-block--empty"):e.style.bind(i.falsy,"action-block--empty"),e}})))}));function p(){const e=[],a={items:e,provide:(e,t)=>(t.getActions(e,a),a),add:(t,o)=>(o?e.push([t,o]):e.push([t]),a),addWhen:(t,o,n)=>(n?e.push({state:t,items:[o,n]}):e.push({state:t,items:[o]}),a),addFollowing(t,n){e.push({state:o.default.changingState,items:"loading"});const i=n.isApplicable,l=d.default.Every(t,i,n.isFollowing.falsy,n.isIgnoring.falsy,o.default.changingState.falsy);a.addWhen(l,(0,s.default)().add("follow",(e=>e.type("flush").style.remove("radio-row-option").setIcon("bookmark").text.use("shared/action/follow").tweak(n.tweakButton,"follow"))).add("ignore",(e=>e.type("flush").style.remove("radio-row-option").setIcon("eye-slash").text.use("shared/action/ignore").tweak(n.tweakButton,"ignore"))).tweak((e=>{e.selection.subscribeManual((e=>"follow"===e?n.follow():"ignore"===e?n.ignore():void 0)),l.subscribeManual((t=>{t||e.select(void 0)}))})));const u=d.default.Every(t,i,n.isFollowing,o.default.changingState.falsy);a.addWhen(u,(0,r.RadioDropdown)().tweak((e=>e.button.type("flush").setIcon("bookmark").tweak(n.tweakButton,"following"))).setSimple().add("following",{translation:e=>e=>e["shared/action/following"](),tweakButton:e=>e.tweak(n.tweakButton,"following")}).tweak(n.tweakDropdown,"following").add("unfollow",{translation:e=>e=>e["shared/action/unfollow"](),tweakButton:e=>e.setIcon("bookmark").tweak(n.tweakButton,"unfollow")}).add("ignore",{translation:e=>e=>e["shared/action/ignore"](),tweakButton:e=>e.setIcon("eye-slash").tweak(n.tweakButton,"ignore")}).tweak((e=>{e.selection.subscribeManual((e=>"unfollow"===e?n.unfollow():"ignore"===e?n.ignore():void(e&&n.onOtherOption?.(e)))),u.useManual((t=>e.select(t?"following":void 0)))})));const c=d.default.Every(t,i,n.isIgnoring,o.default.changingState.falsy);return a.addWhen(c,(0,r.RadioDropdown)().tweak((e=>e.button.type("flush").setIcon("eye-slash").tweak(n.tweakButton,"ignoring"))).setSimple().add("ignoring",{translation:e=>e=>e["shared/action/ignoring"](),tweakButton:e=>e.tweak(n.tweakButton,"ignoring")}).tweak(n.tweakDropdown,"ignoring").add("unignore",{translation:e=>e=>e["shared/action/unignore"](),tweakButton:e=>e.setIcon("eye-slash").tweak(n.tweakButton,"unignore")}).add("follow",{translation:e=>e=>e["shared/action/follow"](),tweakButton:e=>e.setIcon("bookmark").tweak(n.tweakButton,"follow")}).tweak((e=>{e.selection.subscribeManual((e=>"unignore"===e?n.unignore():"follow"===e?n.follow():void(e&&n.onOtherOption?.(e)))),c.useManual((t=>e.select(t?"ignoring":void 0)))}))),a},addModeration(e,t){const o=d.default.Every(e,t.isApplicable,n.default.Auth.isModerator.falsy),r=d.default.Every(e,t.isApplicable,n.default.Auth.isModerator);return a.addWhen(o,(0,i.default)().type("flush").setIcon("flag").text.use("shared/action/report").event.subscribe("click",t.report)),a.addWhen(r,(0,i.default)().type("flush").setIcon("shield-halved").text.use("shared/action/moderate").event.subscribe("click",t.moderate)),a},renderTo(o,n){let a=!1;const i=[];for(const o of e){const e="items"in o?o.items:o,r="loading"===e?[(0,l.default)().tweak((e=>e.enabled.value=!0)).style("action-block-loading").tweak((e=>e.flag.style("action-block-loading-flag")))]:e;(0,t.ActionBlockColumn)().append(...r).tweak("state"in o?e=>e.appendToWhen(o.state,n):e=>e.appendTo(n)),a||=!("state"in o),!a&&"state"in o&&i.push(o.state)}return a||!!i.length&&d.default.Some(o,...i)}};return a}t.default=c,t.ActionBlockColumn=a.default.Builder((e=>e.style("action-block-column")))})),define("endpoint/moderation/author/$author_vanity/EndpointModerationAuthor$authorVanityCensor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/author/{author_vanity}/censor","post").noResponse()})),define("endpoint/moderation/author/$author_vanity/EndpointModerationAuthor$authorVanityDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/author/{author_vanity}/delete","post").noResponse()})),define("endpoint/moderation/author/$author_vanity/EndpointModerationAuthor$authorVanityGrantSupporter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/author/{author_vanity}/grant-supporter","post").noResponse()})),define("endpoint/reports/author/$author_vanity/EndpointReportsAuthor$authorVanityAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reports/author/{author_vanity}/add","post").noResponse()})),define("ui/component/core/ExternalLink",["require","exports","navigation/RoutePath","ui/Component","ui/InputBus","ui/utility/MarkdownContent","utility/Env"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=n.default.Builder("a",((e,t)=>{e.and(a.HandlesMouseEvents).style("link","link-external").style.bind(e.attributes.get("href").truthy,"link-external--has");const o=(0,n.default)().appendTo(e),i=o.text.state.mapManual((e=>!!e&&e!==t&&/^https?:?\/\/?/.test(e)));return e.style.bind(i,"link-external--is-masked").extendJIT("text",(e=>o.text.rehost(e))),void 0!==t&&e.attributes.set("href",t),(0,n.default)().style("link-external-real-domain","link-external--has").text.bind(e.attributes.get("href").mapManual((e=>`[${e}]`))).appendToWhen(i,e),e}));i.default.handle(((e,t)=>{if("A"!==e.tagName)return;let a=e.getAttribute("href");return a?.startsWith(r.default.URL_ORIGIN)&&(a=a.slice(r.default.URL_ORIGIN.length-1)),a?.startsWith("#")||!a||o.RoutePath.is(a)?void 0:()=>{(0,n.default)().replaceElement(e,!0).and(l,a)}})),t.default=l})),define("ui/component/core/TextLabel",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const n=(o=__importDefault(o)).default.Builder((e=>{e.style("text-label");const t=(0,o.default)().style("text-label-label"),n=(0,o.default)().style("text-label-punctuation").text.set(": "),a=(0,o.default)().style("text-label-content");return e.append(t,n,a).extend((()=>({label:t,content:a})))}));t.default=n})),define("ui/component/FollowingBookmark",["require","exports","model/Follows","ui/Component"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const a=(n=__importDefault(n)).default.Builder(((e,t)=>{const n=o.default.map(e,(()=>t(o.default)));return e.style("following-bookmark").style.bind(n.falsy,"following-bookmark--hidden").extend((e=>({isFollowing:n})))}));t.default=a})),define("ui/component/License",["require","exports","ui/Component","ui/component/core/ExternalLink","ui/component/core/Slot","ui/utility/License","ui/utility/StringApplicator","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),l=__importDefault(l),t.default=o.default.Builder(((e,t,o)=>(e.and(a.default).style.remove("slot").style("license").use(l.default.Use(e,{quilt:r.Quilt.State,license:l.default.get(o),authorName:l.default.get(t)}),((e,{quilt:t,license:o,authorName:a})=>{let r=o?.name??"all-rights-reserved",l=o?.link;const u=r;return i.LICENSES.includes(u)&&(r=e=>e[`license/${u}`](a),i.LICENSES_NO_LINK.includes(u)||(l=t[`license/${o?.name}/link`]().toString())),(0,n.default)(l).text.set(r)})),e)))})),define("ui/component/core/InfoDialog",["require","exports","ui/Component","ui/component/core/BlockDialog","ui/component/core/Button","ui/utility/StringApplicator","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),r=__importDefault(r);const l=Object.assign(o.default.Builder(((e,t)=>{const l=e.and(n.default),u=(0,r.default)(void 0);l.title.text.use(t?.titleTranslation),t?.bodyTranslation&&(0,o.default)().setMarkdownContent({body:i.QuiltHelper.toString(t.bodyTranslation)}).appendTo(l.content);const s=(0,a.default)().type("primary").text.use(t?.continueButtonTranslation??"shared/action/continue").appendTo(l.footer.right);return l.extend((e=>({state:u,continueButton:s,await:t=>(u.value=void 0,e.open(),new Promise((o=>t?e.state.match(t,[!0,!1],o):e.state.matchManual([!0,!1],o)))),continue(){u.value=!0,e.close()}}))).onRooted((e=>{e.continueButton.event.subscribe("click",e.continue)}))})),{prompt:async(e,t)=>l(t).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e)});t.default=l})),define("ui/component/ModerationDialog",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/ConfirmDialog","ui/component/core/InfoDialog","ui/component/core/Slot","ui/component/core/Tabinator","ui/utility/StringApplicator","utility/Objects"],(function(e,t,o,n,a,i,r,l,u,s,d,c){function p(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.ModerationCensor=p,t.ModerationDefinition=function(e){return{create:e}},o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importStar(s),c=__importDefault(c),function(e){e.plaintext=function(e){return{type:"plaintext",content:e}},e.markdown=function(e){return{type:"markdown",content:e}}}(p||(t.ModerationCensor=p={}));const f=o.default.Builder(((e,t)=>{const p=e.and(l.default,{titleTranslation:e=>e["shared/prompt/moderation/title"](e[t.titleTranslation]())});p.description.text.use((e=>e["shared/prompt/moderation/subtitle"](d.QuiltHelper.arg(t.moderatedContentName)))),p.continueButton.type.remove("primary").text.use("shared/action/done");const f=(0,s.default)().appendTo(p.content),m=(t.custom??[]).filter((e=>"general"===e.type));return(t.delete||m.length)&&(0,s.Tab)().text.use("shared/prompt/moderation/tab/general").tweak((e=>e.content.style("moderation-dialog-general").append(...m.map((e=>(0,u.default)().style.remove("slot").style("moderation-dialog-general-slot").tweak(e.tweak))),t.delete&&(0,a.default)().text.use("shared/prompt/moderation/action/delete").event.subscribe("click",(async e=>{await r.default.prompt(e.host,{bodyTranslation:e=>e["shared/prompt/moderation/action/delete/body"](d.QuiltHelper.arg(t.moderatedContentName)),dangerToken:"moderate"})&&t.delete?.()}))))).addTo(f),t.censor&&(0,s.Tab)().text.use("shared/prompt/moderation/tab/censor").tweak((e=>{const l=t.censor.properties,u={},s=(0,o.default)().style("moderation-dialog-censor-list").appendTo(e.content);for(const[e,t]of c.default.entries(l))t.content&&(0,i.default)().style("moderation-dialog-censor").setIcon("xmark").append((0,o.default)().style("moderation-dialog-censor-key").text.use(`shared/prompt/moderation/censor/key/${e}`)).append((0,o.default)("blockquote").style("moderation-dialog-censor-content").tweak((e=>"plaintext"===t.type?e.text.set(t.content):e.style("moderation-dialog-censor-content--markdown").setMarkdownContent(t.content,256,!0)))).event.subscribe("SetChecked",((t,o)=>{o?u[e]=!0:delete u[e]})).appendTo(s);const p=(0,n.default)().appendTo(e.content);(0,a.default)().type("primary").text.use("shared/prompt/moderation/action/censor").event.subscribe("click",(async e=>{await r.default.prompt(e.host,{bodyTranslation:e=>e["shared/prompt/moderation/action/censor/body"](d.QuiltHelper.arg(t.moderatedContentName),Object.keys(l)),dangerToken:"moderate"})&&t.censor?.censor(u)})).appendTo(p.right)})).addTo(f),p}));t.default=Object.assign(f,{prompt:async(e,t)=>f(t).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e)})})),define("ui/component/core/Textarea",["require","exports","ui/Component","ui/component/core/ext/Input","ui/component/core/TextInput","ui/utility/StringApplicator","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder((e=>{let t,l=!1,u=!1;const s=(0,o.default)().style("text-input","text-area").attributes.set("contenteditable","plaintext-only").ariaRole("textbox").attributes.set("aria-multiline","true").event.subscribe("blur",(()=>{u&&s.event.emit("change")})).event.subscribe("keydown",(e=>{if("Enter"===e.key){e.stopPropagation();const t=window.getSelection();if(!t)return;if(!s.element.contains(t.anchorNode)||!s.element.contains(t.focusNode))return;const o=document.createTextNode("\n");t.getRangeAt(0).replaceContents(document.createTextNode("\n"),o),t.empty(),t.collapse(o),s.event.emit("input")}})),d=(0,o.default)("input").style("text-area-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`text-area-validity-pipe-input-${Math.random().toString(36).slice(2)}`),c=(0,r.default)(""),p=(0,r.default)(!1),f=e.and(n.default).style("text-area-wrapper").pipeValidity(d).append(s,d).extend((e=>({value:"",touched:p,state:c,default:(0,i.default)(e,(t=>{""===e.value&&(e.value=t??"",c.value=t??"",e.length.asMutable?.setValue(t?.length??0),p.value=!0,m())})),placeholder:(0,i.default)(e,(e=>{s.attributes.set("placeholder",e)})),ignoreInputEvent:(t=!0)=>(l=t,e),setLabel:t=>(s.setName(t?.for),s.setId(t?.for),t?.setInput(e),s.ariaLabelledBy(t),e),filter:o=>(t=o,e)}))).extendMagic("value",(e=>({get:()=>s.element.textContent||"",set:t=>{s.element.textContent=t,h("change"),c.value=t,e.length.asMutable?.setValue(t.length),m()}})));return f.length.asMutable?.setValue(0),f.onRooted((e=>{m(),s.event.subscribe(["input","change"],(t=>{h(t.type),l||(c.value=e.value.trim(),e.length.asMutable?.setValue(e.value.trim().length),p.value=!0,m())}))})),f;function m(){let e;(f.length.value??0)>(f.maxLength.value??1/0)&&(e=e=>e["shared/form/invalid/too-long"]()),!f.length.value&&f.required.value&&(e=e=>e["shared/form/invalid/required"]()),f.setCustomInvalidMessage(e)}function v(e){if(!e)return 0;let t=0;for(;e=e.previousSibling;)t+=e.textContent?.length??0;return t}function h(e){const o=s.element;if(!o)return;const n=t??a.FilterFunction.DEFAULT,i=f.value;if("change"===e)return void(o.textContent=n(i.trim(),"","").join("").trim());u=!0;let{selectionStart:r=null,selectionEnd:l=null}=function(){const e=window.getSelection();if(!e?.anchorNode&&!e?.focusNode)return null;const t=s.element.contains(e.anchorNode),o=t?e.anchorOffset+v(e.anchorNode):0;return e.isCollapsed&&t?{selectionStart:o,selectionEnd:o}:{selectionStart:o,selectionEnd:s.element.contains(e.focusNode)?e.focusOffset+v(e.focusNode):s.element.textContent?.length??0}}()??{};const d=null!==r||null!==l;r??=i.length,l??=i.length;const c=i.slice(0,r).trimStart();let p=i.slice(l).trimEnd(),m=i.slice(r,l);c.length||(m=m.trimStart()),p.length||(m=m.trimEnd()),m.length||c.length||(p=p.trimStart());const[h,g,y]=n(c,m,p);if(o.textContent=h+g+y+"\n",d){const e=o.childNodes[0];if(e){const t=window.getSelection();t?.empty();const o=document.createRange();o.setStart(e,h.length),o.setEnd(e,h.length+g.length),t?.addRange(o)}}}}));t.default=l})),define("ui/component/ReportDialog",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/ConfirmDialog","ui/component/core/Dropdown","ui/component/core/LabelledTable","ui/component/core/Textarea","ui/utility/StringApplicator","utility/Objects"],(function(e,t,o,n,a,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),t.ReportDefinition=function(e){return e},o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),r=__importDefault(r),l=__importDefault(l),s=__importDefault(s);const d=n.default.Builder((async(e,t,n)=>{const d=await e.and(a.default,{titleTranslation:e=>e["shared/prompt/report/title"](e[t.titleTranslation]()),bodyTranslation:e=>e["shared/prompt/report/body"](u.QuiltHelper.arg(n.reportedContentName))}),c=(0,r.default)().appendTo(d.content),p=(0,i.RadioDropdown)().setRequired().tweak((e=>{for(const[o,n]of s.default.entries(t.reasons))n&&e.add(o,{translation:e=>e=>e[`shared/prompt/report/reason/option/${o}`]()})}));c.label((e=>e.text.use("shared/prompt/report/reason/label"))).content(((e,t)=>e.append(p.setLabel(t))));const f=(0,l.default)().setMaxLength(o.default.map(c,(e=>e?.report?.reason_body)));return c.label((e=>e.text.use("shared/prompt/report/details/label"))).content(((e,t)=>e.append(f.setLabel(t)))),d.confirmButton?.event.subscribe("click",(()=>{n.onReport({reason:p.selection.value,reason_body:f.value})})),d}));t.default=Object.assign(d,{prompt:async(e,t,o)=>(await d(t,o)).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e)})})),define("ui/component/Author",["require","exports","endpoint/authors/EndpointAuthors$authorVanity","endpoint/moderation/author/$author_vanity/EndpointModerationAuthor$authorVanityCensor","endpoint/moderation/author/$author_vanity/EndpointModerationAuthor$authorVanityDelete","endpoint/moderation/author/$author_vanity/EndpointModerationAuthor$authorVanityGrantSupporter","endpoint/reports/author/$author_vanity/EndpointReportsAuthor$authorVanityAdd","model/Follows","model/Session","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ButtonRow","ui/component/core/ConfirmDialog","ui/component/core/ext/GradientText","ui/component/core/ExternalLink","ui/component/core/LabelledRow","ui/component/core/Loading","ui/component/core/Placeholder","ui/component/core/RangeInput","ui/component/core/RSSButton","ui/component/core/Slot","ui/component/core/TextInput","ui/component/core/TextLabel","ui/component/core/Timestamp","ui/component/FollowingBookmark","ui/component/License","ui/component/ModerationDialog","ui/component/ReportDialog","utility/Async","utility/Env","utility/Objects","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x,D,E,O,M,S,I,C,R,$){Object.defineProperty(t,"__esModule",{value:!0}),t.AuthorFooter=t.AuthorSubtitle=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importStar(T),x=__importDefault(x),D=__importDefault(D),E=__importDefault(E),O=__importDefault(O),M=__importStar(M),S=__importStar(S),I=__importDefault(I),C=__importDefault(C),$=__importDefault($);const P=(0,S.ReportDefinition)({titleTranslation:"shared/term/author",reasons:{"inappropriate-field":!0,spam:!0,harassment:!0,impersonation:!0,phishing:!0,"tos-violation":!0}}),A=(0,M.ModerationDefinition)((e=>({titleTranslation:"shared/term/author",moderatedContentName:e.name,custom:[{type:"general",tweak(t){const o=(0,f.default)().appendTo(t),n=(0,b.default)(0,15).appendTo(o.content),a=(0,T.default)().style.remove("text-input").style("range-input-display").filter(T.FilterFunction.NUMERIC).default.set("0");n.display.element.replaceWith(a.element),(0,R.mutable)(n).display=a,n.liveState.use(a,(e=>{switch(e){case 15:a.value="9999";break;case 14:a.value="36";break;case 13:a.value="24";break;default:a.value=`${e??0}`}})),o.button.text.use("shared/prompt/moderation/action/grant-supporter").bindDisabled(a.state.map(t,(e=>!+e)),"no months to give").event.subscribe("click",(async t=>{if(!await m.default.prompt(t.host,{bodyTranslation:t=>t["shared/prompt/moderation/action/grant-supporter/body"](e.name,a.value),dangerToken:"moderate"}))return;const o=await i.default.query({params:{author_vanity:e.vanity},body:{months:+a.value}});toast.handleError(o)}))}}],async delete(){const t=await a.default.query({params:{author_vanity:e.vanity},body:{}});toast.handleError(t)},censor:(0,M.ModerationCensor)({properties:{name:M.ModerationCensor.plaintext(e.name),vanity:M.ModerationCensor.plaintext(e.vanity),pronouns:M.ModerationCensor.plaintext(e.pronouns),description:M.ModerationCensor.markdown(e.description?.body),support_link:M.ModerationCensor.plaintext(e.support_link),support_message:M.ModerationCensor.plaintext(e.support_message),license:M.ModerationCensor.plaintext(e.license&&`${e.license.name}: ${e.license.link}`)},async censor(t){const o=await n.default.query({params:{author_vanity:e.vanity},body:t});toast.handleError(o)}})})));t.AuthorSubtitle=s.default.Builder(((e,t)=>(t=$.default.get(t),e.and(k.default).use(t,((e,t)=>e.append((0,s.default)().style("author-vanity").text.set(`@${t.vanity}`)).append(t.pronouns&&(0,k.default)().text.append(" · ").append((0,s.default)().style("author-pronouns").text.set(t.pronouns)))))))),t.AuthorFooter=s.default.Builder(((e,t)=>{const o=e.and(d.default),n=t.work_count?(0,x.default)().tweak((e=>e.label.text.use("work/work-count/label"))).tweak((e=>e.content.text.set(t.work_count.toLocaleString(navigator.language)))).appendTo(o.left):void 0,a=t.word_count?(0,x.default)().tweak((e=>e.label.text.use("work/word-count/label"))).tweak((e=>e.content.text.set(t.word_count.toLocaleString(navigator.language)))).appendTo(o.left):void 0,i=(0,x.default)().tweak((e=>e.label.text.use("author/time-join/label"))).tweak((e=>(0,D.default)(t.time_join).style("author-timestamp").appendTo(e.content))).appendTo(o.right);return o.extend((e=>({workCount:n,wordCount:a,timeJoin:i})))}));const j=s.default.Builder(((e,n)=>{const a=(0,$.default)(n);e.viewTransition("author").style("author");const i=e.and(c.default),d=a.map(i,(e=>e.supporter?.card_colours));i.useGradient(d),i.title.style("author-name").text.set(a.value.name).tweak((e=>e.textWrapper.style("author-name-text").and(v.default).useGradient(a.map(i.title,(e=>e.supporter?.username_colours))))).setUnderlineColours(d),i.description.append((0,t.AuthorSubtitle)(a)),(0,E.default)((e=>e.followingAuthor(a.value.vanity))).appendTo(i.header),i.footer.and(t.AuthorFooter,a.value),(0,w.default)(`${C.default.API_ORIGIN}author/${a.value.vanity}/rss.xml`).appendTo(i.footer.right);const f=(0,y.default)();f.appendToWhen(f.enabled,i.content),f.enabled.value=!1;const m=(0,s.default)().style("author-description").tweak((e=>{a.useManual((t=>{e.removeContents(),(0,k.default)().appendTo(e).tweak((e=>{const o=t.description?.body;o?e.setMarkdownContent(t.description):e.and(_.default).text.use("author/description/empty")}))}))})).appendToWhen(a.mapManual((e=>!!e.description)),i.content);(0,k.default)().use(a,((e,t)=>t.support_link&&(0,h.default)(t.support_link).style("author-support-link").text.set(t.support_message||t.support_link))).appendTo(i.content),(0,k.default)().appendTo(i.content).use(a,((e,t)=>t.license&&(0,g.default)().style("author-license").tweak((e=>e.label.text.use("author/default-license"))).tweak((e=>e.content.and(O.default,t.name,t.license)))));let b=!1;return i.extend((e=>({bio:m,async loadFull(){if(b||f.enabled.value)return;if(a.value.description)return b=!0,void a.emit();f.enabled.value=!0,await I.default.sleep(1e3);const e=await o.default.query({params:{author_vanity:a.value.vanity}});f.enabled.value=!1,e instanceof Error||(b=!0,Object.assign(a.value,e.data),a.emit())},getActions(e,t){const o=u.default.Auth.loggedInAs(e,a.value.vanity);t.addWhen(o,(0,p.default)().type("flush").setIcon("pencil").text.use("author/action/label/edit").event.subscribe("click",(()=>navigate.toURL("/account"))));const n=$.default.Every(e,u.default.Auth.loggedIn,o.falsy),i=l.default.map(e,(e=>e?.following.author?.find((e=>e.author===a.value.vanity))?.ignoring_work_comments||!1));t.addFollowing(e,{isApplicable:n,isFollowing:l.default.map(e,(()=>l.default.followingAuthor(a.value.vanity))),isIgnoring:l.default.map(e,(()=>l.default.ignoringAuthor(a.value.vanity))),follow:async()=>l.default.followAuthor(a.value.vanity),unfollow:async()=>l.default.unfollowAuthor(a.value.vanity),ignore:async()=>l.default.ignoreAuthor(a.value.vanity),unignore:async()=>l.default.unignoreAuthor(a.value.vanity),tweakButton:(e,t)=>({following:e=>e.subText.bind(i.map(e,(e=>t=>t[e?"author/action/label/following/no-recommendations":"author/action/label/following/both"]())))}[t]?.(e)),tweakDropdown:(e,t)=>"ignoring"===t?void 0:e.add("follow-change-state",{translation:e=>e=>e["shared/action/follow"](),tweakButton:e=>e.style("author-action-following").setIcon("bookmark").subText.bind(i.map(e,(e=>t=>t[e?"author/action/label/following/both":"author/action/label/following/only-works"]())))}),onOtherOption(e){"follow-change-state"===e&&l.default.toggleIgnoringAuthorWorkComments(a.value.vanity)}}),t.addModeration(e,{isApplicable:n,report:e=>S.default.prompt(e.host,P,{reportedContentName:a.value.name,async onReport(e){const t=await r.default.query({body:e,params:{author_vanity:a.value.vanity}});toast.handleError(t)}}),moderate:e=>M.default.prompt(e.host,A.create(a.value))})}})))}));t.default=j})),define("endpoint/comments/$comment_id/EndpointComments$commentIdAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/{comment_id}/add","post")})),define("endpoint/comments/$comment_id/EndpointComments$commentIdDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/{comment_id}/delete","post").noResponse()})),define("endpoint/comments/$comment_id/EndpointComments$commentIdUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/{comment_id}/update","post")})),define("endpoint/reactions/comment/$comment_id/$reaction_type/EndpointReactionsComment$commentId$reactionTypeAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reactions/comment/{comment_id}/{reaction_type}/add","post").noResponse()})),define("endpoint/reactions/comment/$comment_id/$reaction_type/EndpointReactionsComment$commentId$reactionTypeRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reactions/comment/{comment_id}/{reaction_type}/remove","post").noResponse()})),define("endpoint/reports/comment/$comment_id/EndpointReportsComment$commentIdAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reports/comment/{comment_id}/add","post").noResponse()})),define("endpoint/chapters/$author_vanity/$work_vanity/$chapter_url/EndpointChapters$authorVanity$workVanity$chapterUrlDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/{chapter_url}/delete","post").noResponse()})),define("model/Chapters",["require","exports","endpoint/chapters/$author_vanity/$work_vanity/$chapter_url/EndpointChapters$authorVanity$workVanity$chapterUrlDelete","ui/component/core/ConfirmDialog","utility/maths/Maths"],(function(e,t,o,n,a){var i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),function(e){e.resolve=function(e,t){return e?t.find((t=>t.author_vanity===e.author_vanity&&t.work_vanity===e.work_vanity&&t.chapter_url===e.chapter_url)):void 0},e.work=function(e){return e?{author_vanity:e.author_vanity,work_vanity:e.work_vanity}:void 0},e.reference=function(e){return e?{author_vanity:e.author_vanity,work_vanity:e.work_vanity,chapter_url:e.chapter_url}:void 0},e.getName=function(e){if(!e)return;const t=a.default.parseIntOrUndefined(e.chapter_url);return _||e.name||(t?e=>e["view/chapter/number/label"](t):void 0)||(e.chapter_url.includes(".")?t=>t["view/chapter/number/interlude/label"](e.chapter_url):void 0)}}(i||(i={})),t.default=Object.assign(i,{async delete(e,t){if(!e)return!0;if(!await n.default.prompt(t??null,{dangerToken:"delete-chapter",bodyTranslation:t=>t["chapter/action/delete/confirm"](e.name)}))return!1;const a=await o.default.query({params:i.reference(e)});return!toast.handleError(a)&&(navigate.isURL(`/work/${e.author_vanity}/${e.work_vanity}/chapter/${e.chapter_url}/**`)&&navigate.toURL(`/work/${e.author_vanity}/${e.work_vanity}`),!0)}})})),define("ui/component/popover/PopoverBlock",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Popover"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.default=o.default.Builder((e=>{const t=e.and(a.default).and(n.default).style("popover-block").anchor.add("aligned left","off bottom").anchor.add("aligned left","off top").anchor.add("aligned right","off bottom").anchor.add("aligned right","off top").anchor.orElseHide().viewTransition(!1);return t.header.style("popover-block-header"),t.content.style("popover-block-content"),t.tweakJIT("title",(e=>e.setAestheticLevel(3).style("popover-block-title"))),t}))})),define("ui/component/popover/AuthorPopover",["require","exports","ui/Component","ui/component/Author","ui/component/core/Popover","ui/component/popover/PopoverBlock"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),t.default=o.default.Builder(((e,t)=>e.and(a.default).setDelay(500).and(i.default).and(n.default,t).tweak((e=>e.bio.style("author-description--in-popover"))).tweak((e=>e.visible.matchManual(!0,e.loadFull)))))})),define("ui/component/AuthorLink",["require","exports","ui/Component","ui/component/core/ext/GradientText","ui/component/core/Link","ui/component/popover/AuthorPopover"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),t.default=o.default.Builder("a",((e,t)=>e.and(a.default,`/author/${t.vanity}`).style("author-link").text.set(t.name).setPopover("hover/longpress",(e=>e.and(i.default,t))).and(n.default).useGradient(t.supporter?.username_colours)))})),define("ui/component/Reaction",["require","exports","ui/Component","ui/component/core/Button","utility/State"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i={love:"heart",author_heart:"author-heart",guest_heart:"guest-heart",supporter_love:"supporter-heart"},r=o.default.Builder(((e,t,r=(0,a.default)(0),l=(0,a.default)(!1),u=(0,a.default)(!1))=>{const s=a.default.get(r),d=a.default.get(l),c=(0,n.default)().setIcon(i[t]).type("icon").style("reaction-button").style.bind(d,"reaction-button--reacted").tweak((e=>e.icon.style("reaction-button-icon").style.bind(u,"reaction-button-icon--changing-state").style.bind(d,"reaction-button-icon--reacted")));return e.style("reaction").append(c).appendWhen(s.truthy,(0,o.default)().style("reaction-count").text.bind(s.map(e,(e=>e?`${e}`:"")))).extend((e=>({reactions:s,reacted:d,icon:c})))}));t.default=r})),define("endpoint/moderation/work/$author_vanity/$work_vanity/EndpointModerationWork$authorVanity$workVanityCensor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/work/{author_vanity}/{work_vanity}/censor","post").noResponse()})),define("endpoint/moderation/work/$author_vanity/$work_vanity/EndpointModerationWork$authorVanity$workVanityLock",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/work/{author_vanity}/{work_vanity}/lock","post").noResponse()})),define("endpoint/moderation/work/$author_vanity/$work_vanity/EndpointModerationWork$authorVanity$workVanityUnlock",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/work/{author_vanity}/{work_vanity}/unlock","post").noResponse()})),define("endpoint/reports/work/$author_vanity/$work_vanity/EndpointReportsWork$authorVanity$workVanityAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reports/work/{author_vanity}/{work_vanity}/add","post").noResponse()})),define("ui/component/core/Icon",["require","exports","ui/Component","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=o.default.Builder(((e,t)=>{const o=(0,n.default)(n.default.value(t));return a(t),e.style("button-icon","button-icon--inline").style.bindFrom(o.map(e,(e=>[`button-icon-${e}`]))).extend((e=>({setIcon:t=>(a(t),e)})));function a(t){n.default.is(t)?o.bind(e,t):o.value=t}}));t.default=a})),define("ui/component/Statistics",["require","exports","ui/Component","ui/component/core/Heading","ui/component/core/TextLabel"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.StatisticsSection=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder(((e,t)=>e.style("statistics-section").append((0,n.default)().setAestheticStyle(!1).style("statistics-section-heading").text.use(t)).extend((e=>({stat(t,n,i){return void 0!==n&&(0,a.default)().style("statistics-stat").tweak((e=>e.label.style("statistics-stat-label").text.use(t))).tweak((e=>e.content.style("statistics-stat-value").append((0,o.default)().text.set("number"!=typeof n&&"bigint"!=typeof n?n:n.toLocaleString(navigator.language))))).tweak(i,n).appendTo(e),this}})))));t.StatisticsSection=i;const r=o.default.Builder((e=>(e.style("statistics"),e.extend((e=>({section(t,o){const n=i(t);return o(n),e.append(n)}}))))));t.default=r})),define("endpoint/tags/EndpointTagsManifest",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/manifest","get")})),define("model/Tags",["require","exports","endpoint/tags/EndpointTagsManifest","model/Manifest","utility/Arrays","utility/Time"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=s,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i);const r=Object.assign((0,n.default)({cacheId:"tags",valid:i.default.minutes(5),async get(){const e=await o.default.query();if(!e.data)return e;const t=e.data;for(const e of Object.values(t.categories))u(e);for(const e of Object.values(t.tags))l(e);return e}}),{resolve:s,toId:function(e,t){return"string"==typeof e?`${e}: ${t}`:`${e.category}: ${e.name}`},isId:e=>"string"==typeof e&&(!!r.value?.tags&&e in r.value.tags),addTag(e){r.value&&(r.value.tags[`${e.category}: ${e.name}`]=l(e),r.emit())},removeTags(...e){if(r.value){for(const t of e)delete r.value.tags[t],delete r.value.relationships[t];r.emit()}},recategoriseTags(e,...t){if(r.value&&t.length){for(const o of t){const t=r.value.tags[o];if(!t)continue;const n=r.toId(e,t.name);r.value.tags[n]=t,delete r.value.tags[o],r.value.relationships[n]=r.value.relationships[o],delete r.value.relationships[o]}r.emit()}},addCategory(e){r.value&&(r.value.categories[e.name]=u(e),r.emit())},removeCategory(e){r.value&&(delete r.value.categories[e],r.emit())},setAliases(e,...t){if(!r.value)return;const o=r.value.tags[e];o&&(o.aliases=t,r.emit())},addAliases(e,...t){if(!r.value)return;if(!t.length)return;const o=r.value.tags[e];o&&((o.aliases??=[]).push(...t),r.emit())},addRelationships(e,t){if(r.value&&e&&t){e=a.default.resolve(e),t=a.default.resolve(t);for(const o of e){if(r.value.tags[o])for(const e of t){r.value.tags[e]&&(r.value.relationships[o]??=[]).push(e)}}r.emit()}},hasMature:e=>!!e?.some((e=>r.value?.tags[e]?.is_mature))});function l(e){const t=e;return t.nameLowercase=t.name.toLowerCase(),t.wordsLowercase=t.nameLowercase.split(" "),t.categoryLowercase=t.category.toLowerCase(),t.categoryWordsLowercase=t.categoryLowercase.split(" "),t}function u(e){const t=e;return t.nameLowercase=t.name.toLowerCase(),t.wordsLowercase=t.nameLowercase.split(" "),t}async function s(e,t){if(!e?.length)return[];if(Array.isArray(e))return d(e);const o=t?`${e}: ${t}`:e,[n]=await d([o]);return n}async function d(e){const t=[];let o=await r.getManifest();return n(),t.length===e.length||r.isFresh()||(o=await r.getManifest(!0),n()),t;function n(){t.splice(0,1/0);for(const n of e)for(const[e,a]of Object.entries(o.tags))e.toLowerCase()!==n.toLowerCase()||t.push(a)}}t.default=r})),define("ui/component/core/ext/Draggable",["require","exports","ui/Component","utility/maths/Vector2","utility/State"],(function(e,t,o,n,a){var i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),function(e){e[e.None=0]="None",e[e.Starting=1]="Starting",e[e.Delayed=2]="Delayed",e[e.Dragging=3]="Dragging"}(i||(i={}));const r=(0,a.default)(!1),l=Object.assign(o.default.Extension(((e,t={})=>{e.style("draggable");const o=(0,a.default)(i.None),l=(0,a.default)(void 0),u=(0,a.default)(void 0),s=a.default.MapManual([l,t.stickyDistance],((e,t)=>e??t??0)),d=a.default.MapManual([u,t.delay],((e,t)=>e??t??0));let c,p;e.onRemoveManual(g),e.event.subscribe(["mousedown","touchstart"],(function(e){const n=y(e);if(!n)return;e.preventDefault(),r.value=!0,c=n,o.value=i.Starting,"touchstart"===e.type?(window.addEventListener("touchmove",m,{passive:!0}),window.addEventListener("touchend",v,{passive:!0})):(window.addEventListener("mousemove",m,{passive:!0}),window.addEventListener("mouseup",v,{passive:!0}));d&&(o.value=i.Delayed,p=window.setTimeout((()=>{if(o.value===i.Delayed){if(o.value=t.stickyDistance?.value?i.Starting:i.Dragging,!t.stickyDistance?.value){const e=t.onMoveStart?.(f,n);if(!1===e)return void v();f.style("draggable-dragging")}m(e)}}),d.value))}));const f=e.extend((e=>({state:o,dragging:o.mapManual((e=>e===i.Dragging)),setStickyDistance:t=>(l.value=t,e),setDelay:t=>(u.value=t,e),stopDragging:g})));return f;function m(e){if(o.value===i.Delayed)return;const a=y(e);if(!a)return;const r=n.default.subtract(a,c),l=s.value;if(o.value===i.Starting&&(l<5||!n.default.distanceWithin(l,r,n.default.ZERO))){const e=t.onMoveStart?.(f,a);if(!1===e)return void v();o.value=i.Dragging,f.style("draggable-dragging")}if(o.value!==i.Dragging)return;const u=t.onMove?.(f,r,a);if(!1!==u)return r;v()}function v(e){if(h(),o.value===i.Dragging&&e){const o=y(e),a=o?m(e):void 0;t.onMoveEnd?.(f,a??n.default.ZERO,o??c)}g()}function h(){window.clearTimeout(p),window.removeEventListener("touchmove",m),window.removeEventListener("mousemove",m),window.removeEventListener("touchend",v),window.removeEventListener("mouseup",v)}function g(){return h(),r.value=!1,o.value=i.None,c=void 0,f.style.remove("draggable-dragging"),f}function y(e){const t=e.touches?.[0];if(0===e.button||t)return n.default.fromClient(t??e)}})),{isDragging:r});t.default=l})),define("ui/component/Tag",["require","exports","model/Tags","ui/Component","ui/component/core/Button","ui/component/core/ext/Draggable","ui/component/core/Link","ui/component/FollowingBookmark","ui/utility/BrowserListener"],(function(e,t,o,n,a,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u);const s=/\W+/g,d=e=>e.replaceAll(s,"-").toLowerCase(),c=Object.assign(n.default.Builder("a",((e,t)=>{"A"===e.tagName&&e.and(r.default,"string"==typeof t?void 0:`/tag/${d(t.category)}/${d(t.name)}`);const s=e.and(a.default).style("tag").style.toggle("string"==typeof t,"tag-custom").style.toggle("string"!=typeof t,"tag-global"),c="string"==typeof t?void 0:(0,l.default)((e=>e.followingTag(o.default.toId(t)))).tweak((t=>t.style("tag-following-bookmark").style.bind(e.hoveredOrFocused,"tag-following-bookmark--active").style.bind(u.default.isWebkit,"tag-following-bookmark--webkit").appendTo(e.style.bind(t.isFollowing,"tag--has-following-bookmark")))),p="string"==typeof t?void 0:(0,n.default)().style("tag-category").text.set(t.category).appendTo(e),f=(0,n.default)().style("tag-name").text.set("string"==typeof t?t:t.name).appendTo(e);"object"==typeof t&&t.is_mature&&s.setIcon("circle-exclamation").tweak((e=>e.icon?.style("tag-mature-icon").prependTo(f)));const m=e.supers.useManual((()=>{e.is(i.default)&&(m(),e.style.bind(e.dragging,"tag--dragging"))}));return e.extend((e=>({tag:t,categoryWrapper:p,nameWrapper:f,followingBookmark:c,addDeleteButton:t=>(c?.style("tag-following-bookmark--has-delete-button"),(0,a.default)().style("tag-delete-button").setIcon("xmark").event.subscribe("click",t).appendTo(e),e)})))})),{Category:n.default.Builder("button",((e,t)=>e.and(c,{category:t.name,name:"...",description:{body:t.description},is_mature:!1}))).setName("TagCategory")});t.default=c})),define("ui/component/core/ext/Sortable",["require","exports","ui/Component","ui/component/core/ext/Draggable","utility/Arrays","utility/maths/Vector2","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SortableDefinition=function(e){return e},o=__importDefault(o),n=__importDefault(n),i=__importDefault(i);const l=(0,(r=__importDefault(r)).default)(!1),u=Object.assign(o.default.Extension(((e,t)=>{const u=(0,r.default)(!1),s=(0,r.default)(t.sortDelay??0),d=(0,r.default)(t.stickyDistance??0),c=(0,r.default)([]);let p,f;const m={stickyDistance:d,delay:s,onMoveStart:function(e,o){if(void 0===t.getID(e))return console.warn("Failed to begin sorting, draggable without ID"),!1;e.style("sortable-item-sorting").style.setProperty("position","fixed").style.setProperty("z-index",999999999),p=e,l.value=!0,_(e,i.default.ZERO,o),u.value=!0},onMove:_,onMoveEnd:function(e,t,o){e.insertTo(v,"after",f),y()}};for(const t of e.getChildren())t.and(n.default,m).style("sortable-item");g(),e.receiveChildrenInsertEvents(),e.event.subscribe("childrenInsert",((e,t)=>{for(const e of t)e!==f?.element&&e.component?.and(n.default,m).style("sortable-item");g()}));const v=e.extend((e=>({sorting:u,order:c,setSortDelay:o=>(s.value=o??t.sortDelay??0,e),setStickyDistance:o=>(d.value=o??t.stickyDistance??0,e),cancel:()=>(y(!1),e)})));return t.onOrderChange&&c.subscribeManual(t.onOrderChange),v;function h(){return[...e.getChildren()].map((e=>e.as(n.default))).filter(a.NonNullish)}function g(){c.value=h().map(t.getID).filter(a.NonNullish)}function y(e=!0){if(!u.value)return;u.value=!1,l.value=!1;const t=p;p=void 0,t?.style.remove("sortable-item-sorting").style.removeProperties("position","left","top"),t?.stopDragging(),f?.remove(),f=void 0,e&&g()}function _(e,t,n){const a=e.rect.value;e.style.setProperty("left",n.x-a.width/2+"px"),e.style.setProperty("top",n.y-a.height/2+"px"),function(e,t){f??=(0,o.default)().style("sortable-slot").tweak((t=>{const o=e.rect.value;t.style.setProperty("width",`${o.width}px`),t.style.setProperty("height",`${o.height}px`)}));const n=v.rect.value,a=h().filter((t=>t!==e)),r=i.default.subtract(t,n.position),l=function(e,t,o){const{left:n,top:a}=v.rect.value;let i;for(let r=0;r<o.length;r++){const l=o[r];if(l===e)continue;let{left:u,top:s,width:d,height:c}=l.rect.value;if(u-=n-d/2,s-=a,r===(o[0]===e?1:0)){if(t.y<s)return;if(t.x<u&&t.y<s+c)return}if(void 0!==i&&i!==s){if(t.y<s)return o[r-1];if(t.y>=s&&t.y<s+c&&t.x<u)return o[r-1]}if(i=s,t.x>=u&&t.x<u+d&&t.y>=s&&t.y<s+c)return l}return o.at(-1)}(e,r,a),u=new Set(f.getNextSiblings());l?f.insertTo(v,"after",l):f.prependTo(v);for(const e of f.getNextSiblings())u.add(e);for(const e of u)e.rect.markDirty()}(e,n)}})),{isSorting:l});t.default=u})),define("utility/Mouse",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return"number"==typeof e[0]?e.reverse():e}function o(...e){const[o,n]=t(e);if("click"!==o.type&&"mousedown"!==o.type&&"mouseup"!==o.type)return;const a=o;return a.button===n?a:void 0}function n(...e){const[o,n]=t(e);if("click"!==o.type&&"mousedown"!==o.type&&"mouseup"!==o.type)return!1;return o.button===n}function a(...e){const[o,a]=t(e);return!!n(o,a)&&(o.preventDefault(),!0)}e.asLeft=o.bind(null,0),e.asMiddle=o.bind(null,1),e.asRight=o.bind(null,2),e.as=o,e.isLeft=n.bind(null,0),e.isMiddle=n.bind(null,1),e.isRight=n.bind(null,2),e.is=n,e.handleLeft=a.bind(null,0),e.handleMiddle=a.bind(null,1),e.handleRight=a.bind(null,2),e.handle=a}(o||(o={})),t.default=o})),define("ui/component/TagsEditor",["require","exports","model/Tags","ui/Component","ui/component/core/Block","ui/component/core/ext/Input","ui/component/core/ext/Sortable","ui/component/core/ProgressWheel","ui/component/core/Slot","ui/component/core/TextInput","ui/component/Tag","ui/utility/AnchorManipulator","ui/utility/Applicator","ui/utility/StringApplicator","utility/AbortPromise","utility/Mouse","utility/State","utility/string/Strings","utility/Task"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y){Object.defineProperty(t,"__esModule",{value:!0}),t.filterTagSegment=w,o=__importDefault(o),n=__importDefault(n),i=__importDefault(i),r=__importStar(r),l=__importDefault(l),u=__importDefault(u),s=__importStar(s),d=__importDefault(d),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y);const _=n.default.Builder((e=>{const t=(0,h.default)({global_tags:[],custom_tags:[]}),_=(0,h.default)(!1),w=(0,h.default)(void 0),k=(0,u.default)().style("tags-editor-current").use(t,m.default.asyncFunction((async(e,a,i)=>{const l=await o.default.resolve(i.global_tags);if(e.aborted)return;l.length&&(0,n.default)().and(r.default,(0,r.SortableDefinition)({stickyDistance:10,getID:e=>T(e.as(d.default)?.tag),onOrderChange:e=>t.value.global_tags.splice(0,1/0,...e)})).style("tags-editor-current-type","tags-editor-current-global").append(...l.map((e=>(0,d.default)(e).setNavigationDisabled(!0).event.subscribe("auxclick",(e=>e.preventDefault())).event.subscribe("mouseup",(t=>v.default.handleMiddle(t)&&A(e))).addDeleteButton((()=>A(e)))))).appendTo(a),i.custom_tags.length&&(0,n.default)().and(r.default,(0,r.SortableDefinition)({stickyDistance:10,getID:e=>T(e.as(d.default)?.tag),onOrderChange:e=>t.value.custom_tags.splice(0,1/0,...e)})).style("tags-editor-current-type","tags-editor-current-custom").append(...i.custom_tags.map((e=>(0,d.default)(e).setNavigationDisabled(!0).event.subscribe("auxclick",(e=>e.preventDefault())).event.subscribe("mouseup",(t=>v.default.handleMiddle(t)&&A(e))).addDeleteButton((()=>A(e)))))).appendTo(a);const u=!!l.length||!!i.custom_tags.length;k.style.toggle(u,"tags-editor-current")})));function T(e){return e?"string"==typeof e?e:`${e.category}: ${e.name}`:""}const x=(0,n.default)().style("text-input","tags-editor-input-wrapper").event.subscribe("click",(()=>D.focus())),D=(0,s.default)().style("tags-editor-input").style.remove("text-input").placeholder.use("shared/form/tags/placeholder").filter(b).appendTo(x),E=h.default.Some(e,e.hasFocused,e.hadFocusedLast),O=(0,u.default)().style("tags-editor-suggestions").use(h.default.UseManual({tags:t,filter:D.state,focus:E}),m.default.asyncFunction((async(e,a,{tags:i,filter:r,focus:l})=>{if(!r&&!l)return;const u=await o.default.getManifest();if(e.aborted)return;let[s,c]=g.default.splitOnce(r,":");if(void 0===c&&(c=s,s=""),s=s.trim(),c=c.trim(),"custom"!==w.value){const e=s?[]:Object.values(u.categories).filter((e=>e.nameLowercase.startsWith(c))).filter((e=>Object.entries(u.tags).some((([t,o])=>o.category===e.name&&!i.global_tags.some((e=>t===e)))))).sort((e=>-Object.values(u.tags).filter((t=>t.category===e.name)).length),((e,t)=>e.name.localeCompare(t.name))).map((e=>d.default.Category(e).event.subscribe("click",(()=>D.value=`${e.name}: `))));e.length&&(0,n.default)().style("tags-editor-suggestions-type").append(...e).appendTo(a);const o=s?Object.entries(u.tags).filter((([,e])=>e.categoryLowercase.startsWith(s)&&e.nameLowercase.startsWith(c))):c?Object.entries(u.tags).filter((([,e])=>e.wordsLowercase.some((e=>e.startsWith(c))))):[];o.filterInPlace((([e])=>!i.global_tags.some((t=>t===e)))),o.length&&(0,n.default)().style("tags-editor-suggestions-type").append(...o.map((([,e])=>(0,d.default)(e).setNavigationDisabled(!0).event.subscribe("click",(o=>{i.global_tags.push(`${e.category}: ${e.name}`),t.emit(),D.value="",_.value=!0,""===o.pointerType&&D.focus()}))))).appendTo(a)}if("global"!==w.value){const e=select((()=>c?s?[(0,d.default)(`${c} ${s}`),(0,d.default)(`${s} ${c}`)]:[(0,d.default)(c)]:[]));e.length&&(0,n.default)().style("tags-editor-suggestions-type").append((0,n.default)().style("tags-editor-suggestions-type-label").text.use("shared/form/tags/suggestion/add-as-custom")).append(...e.map((e=>e.setNavigationDisabled(!0).event.subscribe("click",(o=>{i.custom_tags.push(e.tag),t.emit(),D.value="",_.value=!0,""===o.pointerType&&D.focus()}))))).appendTo(a)}a.size&&(0,n.default)().style("tags-editor-suggestions-label").text.use("shared/form/tags/suggestion/label").prependTo(a),P.rect.markDirty()}))).appendTo(x),M=(0,n.default)("input").style("tags-editor-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`tags-editor-validity-pipe-input-${Math.random().toString(36).slice(2)}`),S=(0,h.default)(void 0),I=(0,h.default)(void 0),C=(0,h.default)(void 0),R=(0,h.default)(void 0),$=(0,h.default)(void 0),P=e.and(i.default).style("tags-editor").append(k).append(x).append(M).pipeValidity(M).extend((o=>({state:t,get tags(){return t.value},default:(0,p.default)(o,(e=>t.value={global_tags:e?.global_tags?.slice()??[],custom_tags:e?.custom_tags?.slice()??[]})),touched:_,maxLengthGlobal:S,maxLengthCustom:I,lengthGlobal:t.mapManual((e=>e.global_tags.length)),lengthCustom:t.mapManual((e=>e.custom_tags.length)),setMaxLengthGlobal:t=>(h.default.is(t)?S.bind(e,t):S.value=t,o),setMaxLengthCustom:t=>(h.default.is(t)?I.bind(e,t):I.value=t,o),input:D,inputWrapper:x,setCustomTagsOnly:()=>(w.value="custom",o),setGlobalTagsOnly:()=>(w.value="global",o),mainHint:(0,f.default)(o,(e=>C.value=e)),globalHint:(0,f.default)(o,(e=>R.value=e)),customHint:(0,f.default)(o,(e=>$.value=e))})));return P.disableDefaultHintPopoverVisibilityHandling(),E.subscribeManual((e=>P.getPopover()?.toggle(e).anchor.apply())),P.setCustomHintPopover((e=>e.appendWhen(w.falsy,i.default.createHintText(C.map(e,(e=>e??(e=>e["shared/form/tags/hint/main"]()))))).appendWhen(w.equals("custom").falsy,i.default.createHintText(R.map(e,(e=>e??(e=>e["shared/form/tags/hint/global"]())))),l.default.Length(P.lengthGlobal,P.maxLengthGlobal)).appendWhen(w.equals("global").falsy,i.default.createHintText($.map(e,(e=>e??(e=>e["shared/form/tags/hint/custom"]())))),l.default.Length(P.lengthCustom,P.maxLengthCustom)).anchor.reset().anchor.from(D).anchor.add("off right",`.${a.BlockClasses.Main}`,"centre",c.AllowYOffscreen))),t.use(P,(e=>{let t;e.global_tags.length>(P.maxLengthGlobal.value??1/0)?t=e=>e["shared/form/invalid/tags/too-many-global"]():e.custom_tags.length>(P.maxLengthCustom.value??1/0)&&(t=e=>e["shared/form/invalid/tags/too-many-custom"]()),P.setCustomInvalidMessage(t)})),D.event.subscribe("keydown",(async e=>{"Enter"===e.key&&(e.preventDefault(),O.getFirstDescendant(d.default)?.element.click(),_.value=!0,await y.default.yield(),D.focus())})),P;function A(e){const o="string"==typeof e?e:`${e.category}: ${e.name}`;"string"==typeof e?t.value.custom_tags.filterInPlace((e=>e!==o)):t.value.global_tags.filterInPlace((e=>e!==o)),t.emit(),_.value=!0}})),b=(0,s.FilterFunction)(((e,t,o)=>{e=w(e),t=w(t),o=w(o),e.includes(":")?(t=t.replaceAll(":"," "),o=o.replaceAll(":"," ")):t.includes(":")&&(o=o.replaceAll(":"," "));return e.endsWith(" ")&&(t.startsWith(" ")||t.startsWith(":")||!t&&(o.startsWith(" ")||o.startsWith(":")))&&(e=e.trimEnd()),t.endsWith(" ")&&(o.startsWith(" ")||o.startsWith(":"))&&(t=t.trimEnd()),e=e.trimStart(),o=o.trimEnd(),e||(t=t.trimStart()),o||(t=t.trimEnd()),[e,t,o]}));function w(e){return e.toLowerCase().replace(/[^\w/!?&$'.,: -]/g," ").replace(/(?<=:.*?):/g," ").replace(/ {2,}/g," ").replace(" :",":")}t.default=_})),define("ui/component/Tags",["require","exports","model/Tags","ui/Component","ui/component/core/Slot","ui/component/Tag","utility/AbortPromise","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=n.default.Builder((e=>{const t=(0,l.default)(void 0);let u;return(0,a.default)().use(t.map(e,(e=>e?.global_tags)),r.default.asyncFunction((async(e,t,a)=>{const r=await o.default.resolve(a);return r?.length&&(0,n.default)().style("work-tags","work-tags-global").tweak(u?.initialiseGlobalTags,r).append(...r.map((e=>(0,i.default)(e))))}))).appendTo(e),(0,a.default)().use(t.map(e,(e=>e?.custom_tags)),((e,t)=>t?.length&&(0,n.default)().style("work-tags","work-tags-custom").tweak(u?.initialiseCustomTags,t).append(...t.map((e=>(0,i.default)(e)))))).appendTo(e),e.extend((e=>({set:(o,n)=>(l.default.is(o)?t.bind(e,o):t.value=o,u=n,e)})))}));t.default=u})),define("ui/component/Work",["require","exports","endpoint/moderation/work/$author_vanity/$work_vanity/EndpointModerationWork$authorVanity$workVanityCensor","endpoint/moderation/work/$author_vanity/$work_vanity/EndpointModerationWork$authorVanity$workVanityLock","endpoint/moderation/work/$author_vanity/$work_vanity/EndpointModerationWork$authorVanity$workVanityUnlock","endpoint/reports/work/$author_vanity/$work_vanity/EndpointReportsWork$authorVanity$workVanityAdd","model/Follows","model/FormInputLengths","model/Patreon","model/Session","model/Works","ui/Component","ui/component/AuthorLink","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ButtonRow","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/Icon","ui/component/core/Link","ui/component/core/RSSButton","ui/component/core/Slot","ui/component/core/Textarea","ui/component/core/TextLabel","ui/component/core/Timestamp","ui/component/FollowingBookmark","ui/component/License","ui/component/ModerationDialog","ui/component/ReportDialog","ui/component/Statistics","ui/component/Tags","utility/Env","utility/State","utility/Time"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,b,w,k,T,x,D,E,O,M,S,I,C,R,$,P,A){Object.defineProperty(t,"__esModule",{value:!0}),t.WorkFooter=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importStar(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),E=__importDefault(E),O=__importDefault(O),M=__importDefault(M),S=__importStar(S),I=__importStar(I),C=__importDefault(C),R=__importDefault(R),$=__importDefault($),P=__importDefault(P),A=__importDefault(A);const j=(0,I.ReportDefinition)({titleTranslation:"shared/term/work",reasons:{"inadequate-tags":!0,"inappropriate-field":!0,spam:!0,harassment:!0,plagiarism:!0,"tos-violation":!0,"work-unlock":!1}}),N=(0,S.ModerationDefinition)((e=>({titleTranslation:"shared/term/work",moderatedContentName:e.name,custom:[{type:"general",tweak(t){const o=(0,P.default)(e.lock_reason);t.use(o,((t,i)=>{const r=(0,h.default)().appendTo(t),l=(0,x.default)().text.set(i).appendTo(r.content);i?(l.attributes.set("disabled","disabled"),r.button.text.use("work/action/unlock").event.subscribe("click",(async t=>{if(!await g.default.prompt(t.host,{bodyTranslation:null,dangerToken:"moderate"}))return;const n=await a.default.query({params:d.default.reference(e)});toast.handleError(n)||(o.value=void 0)}))):r.button.text.use("work/action/lock").bindDisabled(l.state.falsy,"no lock reason").event.subscribe("click",(async t=>{if(!await g.default.prompt(t.host,{bodyTranslation:null,dangerToken:"moderate"}))return;const a=await n.default.query({params:d.default.reference(e),body:{reason:l.value}});toast.handleError(a)||(o.value=l.value)}))}))}}],censor:(0,S.ModerationCensor)({properties:{name:S.ModerationCensor.plaintext(e.name),vanity:S.ModerationCensor.plaintext(e.work_vanity),description:S.ModerationCensor.plaintext(e.description),synopsis:S.ModerationCensor.markdown(e.synopsis?.body),license:S.ModerationCensor.plaintext(e.license&&`${e.license.name}: ${e.license.link}`)},async censor(t){const n=await o.default.query({params:d.default.reference(e),body:t});toast.handleError(n)}})})));t.WorkFooter=c.default.Builder(((e,t)=>{t=P.default.get(t);const o=e.and(f.default).style("work-footer");o.left.style("work-footer-left");const n=(0,P.default)(void 0),a=(0,P.default)(void 0);(0,T.default)().appendTo(o.left).use(t,((e,t)=>{let o,i=t.status;"Ongoing"===i&&Date.now()-new Date(t.time_last_update??0).getTime()>A.default.months(3)&&(o="no-recent-updates",i="Hiatus");const r=t.status.toLowerCase();return n.value=(0,c.default)().style("button","work-status",`work-status--${r}`).append(a.value=(0,b.default)(d.WORK_STATUS_ICONS[t.status]).style("work-status-icon")).append((0,c.default)().text.use(`work/status/${o??r}`))}));const i=(0,D.default)().tweak((e=>e.label.text.use("work/chapters/label"))).tweak((e=>{t.use(e,(t=>{const o=t.chapter_count_public.toLocaleString(navigator.language);if(!t.frequency||"Complete"===t.status||"Cancelled"===t.status)return e.content.text.set(o);let n,a;switch(t.frequency.interval){case 1:a="daily",n=1;break;case 7:a="weekly",n=7;break;case 30:a="monthly",n=30;break;default:t.frequency.interval<7?(a="every-x-days",n=t.frequency.interval):t.frequency.interval<30?(a="every-x-weeks",n=t.frequency.interval/7):(a="every-x-months",n=t.frequency.interval/30)}n=Math.round(n);const i=(e,t)=>0===t?e:i(t,e%t),r=i(n,t.frequency.amount),l=t.frequency.amount/r;n/=r,"every-x-days"===a&&1===n?a="daily":"every-x-weeks"===a&&1===n?a="weekly":"every-x-months"===a&&1===n&&(a="monthly"),e.content.text.use((e=>e["work/chapters/value"](o,l.toLocaleString(navigator.language),e[`shared/term/interval/${a}`](n.toLocaleString(navigator.language)))))}))})).appendTo(o.left),r=t.map(e,(e=>e.word_count)),l=(0,D.default)().tweak((e=>e.label.text.use("work/word-count/label"))).tweak((e=>e.content.text.bind(r.map(e,(e=>e.toLocaleString(navigator.language)))))).appendToWhen(r.truthy,o.left);o.right.style("work-footer-right");const u=(0,P.default)(void 0),s=(0,P.default)(void 0);return(0,T.default)().appendTo(o.right).use(t,((e,t)=>{u.value=void 0,s.value=void 0,"Private"===t.visibility?e.append(s.value=(0,c.default)().style("timestamp","work-timestamp").text.use("work/state/private")):t.chapter_count_public?t.time_last_update&&e.append(u.value=(0,E.default)(t.time_last_update).setSimple().style("work-timestamp")):e.append(s.value=(0,c.default)().style("timestamp","work-timestamp").text.use("work/state/private-no-chapters"))})),o.extend((e=>({status:n,statusIcon:a,chapterCount:i,wordCount:l,timestampAlternative:s,timestamp:u})))}));const q=c.default.Builder(((e,o,n,a)=>{const f=P.default.get(o),h=P.default.get(n),g=P.default.Map(e,[f,h],((e,t)=>t??e.synopsis?.mentions[0])),x=f.map(e,(e=>"Patreon"===e.visibility));e.viewTransition("work").style("work").style.bind(f.map(e,(e=>"Private"===e.visibility||!e.chapter_count_public)),"work--private").style.bind(x,"work--patreon");const D=e.and(m.default),E=P.default.Map(e,[f,s.default.Auth.author],((e,t)=>e.author_vanity!==s.default.Auth.author.value?.vanity||s.default.Auth.author.value.supporter?.tier?e.card_colours:void 0));D.useGradient(E);const q=D.type.state.mapManual((e=>e.has("flush")));D.header.style("work-header").style.bind(q,"work-header--flush").style.bind(x,"work-header--patreon"),D.title.style("work-name").text.bind(f.map(e,(e=>e.name))).setResizeRange(32,Math.min(l.default.value?.work?.name??1/0,128)).setUnderlineColours(E),(0,T.default)().use(f,((e,t)=>(0,O.default)((e=>e.followingWork(t))))).appendTo(D.header),D.description.style.bind(g.truthy,"work-author-list").style.bind(P.default.Every(e,q,g.truthy),"work-author-list--flush").append((0,T.default)().use(g,((e,t)=>t&&(0,p.default)(t).style("work-author")))),D.content.style.bind(f.map(e,(e=>!!e.bookmarks)),"work-actions-and-content");const B=(0,c.default)().style("work-content").appendTo(D.content),L=(0,T.default)().style("work-actions").appendTo(D.content),V=c.default.Builder((e=>e.and(v.default).style("work-actions-action").useGradient(E))),W=(0,P.default)(void 0),G=(0,P.default)(void 0);L.use(f,((e,t)=>{if(W.value=void 0,G.value=void 0,t.bookmarks&&t.bookmarks){const o=!t.bookmarks.url_read_last&&Date.now()-new Date(t.time_publish??0).getTime()<A.default.weeks(1);W.value=(0,y.default)().setAestheticStyle(!1).style("work-bookmarks-status").style.toggle(!!o,"work-bookmarks-status--new").text.use((e=>{if(t.bookmarks){if(t.bookmarks.read_completed)return e["work/bookmarks/label/finished"]();if(t.bookmarks.url_read_last!==t.bookmarks.url_read_furthest)return e["work/bookmarks/label/progress"]((t.bookmarks?.chapters_from_last_patreon?t.chapter_count_public-t.bookmarks.chapters_from_last_patreon:1).toLocaleString(navigator.language),t.chapter_count_public.toLocaleString(navigator.language));if(t.bookmarks.chapters_from_last_patreon){const o=t.bookmarks?.chapters_from_last_patreon??1;return 1===o?e["work/bookmarks/label/new-content-single"](o):e["work/bookmarks/label/new-content"](o)}return t.bookmarks.url_read_last?e["work/bookmarks/label/caught-up"]():o?e["work/bookmarks/label/not-tried-new"]():e["work/bookmarks/label/not-tried"]()}})).prepend(o&&(0,b.default)("star").style("work-bookmarks-status-icon")).appendTo(e);const n=t.bookmarks.url_next||t.bookmarks.read_completed||!t.bookmarks.url_read_last?`/work/${t.author_vanity}/${t.work_vanity}/chapter/${!t.bookmarks.read_completed&&t.bookmarks.url_next||t.bookmarks.url_first}`:`/work/${t.author_vanity}/${t.work_vanity}`;G.value=(0,w.default)(n).and(V).ariaLabel.use((e=>e[t.bookmarks?.read_completed?"work/action/alt/reread":t.bookmarks?.url_next?"work/action/alt/continue":t.bookmarks?.url_read_last?"work/action/alt/see-all":"work/action/alt/read"](t.name))).text.use(t.bookmarks.read_completed?"work/action/label/reread":t.bookmarks.url_next?"work/action/label/continue":t.bookmarks.url_read_last?"work/action/label/see-all":"work/action/label/read").appendTo(e)}}));const U=f.map(e,(e=>"Patreon"===e.visibility&&e.patreon?.tiers[0]||void 0));(0,c.default)().style("work-patreon-visibility-header","patreon-icon-before").style.bind(q,"work-patreon-visibility-header--flush").append((0,c.default)().style("work-patreon-visibility-header-label").text.use("work/patreon/label")).append((0,c.default)().style("work-patreon-visibility-header-tier").text.bind(U.map(e,(e=>e&&u.default.translateTier(e))))).appendToWhen(U.truthy,B);const F=f.map(e,(e=>e.lock_reason));(0,c.default)().style("work-lock-reason").style.bind(q,"work-lock-reason--flush").classes.add("markdown").append((0,c.default)().style("work-lock-reason-heading").append((0,b.default)("lock")).append((0,c.default)().text.use("work/locked/label"))).append((0,c.default)().text.use("work/locked/description")).append((0,c.default)("blockquote").style("work-lock-reason-text").text.bind(F)).appendToWhen(F.truthy,B);const H=f.map(e,(e=>e.description)),Y=f.map(e,(e=>e.synopsis),((e,t)=>e?.body===t?.body&&e?.mentions.length===t?.mentions.length&&e?.mentions[0]?.vanity===t?.mentions[0]?.vanity));(0,T.default)().use(P.default.Use(e,{isFlush:q,description:H,synopsis:Y}),((e,{isFlush:t,description:o,synopsis:n})=>{const i=t;t||=a??!1;(t||n?.body&&o)&&(0,c.default)().style("work-description").style.toggle(!n?.body,"work-description--solo").style.toggle(i,"work-description--flush").style.toggle(!o,"placeholder").tweak((e=>{o?e.text.set(o):e.text.use("work/description/empty")})).appendTo(e),t||(0,c.default)().style("work-synopsis").style.toggle(!n?.body&&!o,"placeholder").append((0,T.default)().tweak((e=>{const t=n?.body?n:o;"string"==typeof t?e.text.set(t):t.body?e.setMarkdownContent(t):e.text.use("work/description/empty")}))).appendTo(e)})).appendTo(B),(0,R.default)().set(f,{initialiseGlobalTags:e=>e.style.bind(q,"work-tags--flush"),initialiseCustomTags:e=>e.style.bind(q,"work-tags--flush")}).appendTo(B);const J=P.default.Map(e,[g,f,s.default.Auth.account],((e,t,o)=>_??t.license??(e?.vanity===o?.vanity?o?.license:void 0)??void 0),((e,t)=>typeof e==typeof t&&e?.name===t?.name&&e?.link===t?.link));(0,T.default)().appendTo(B).use(P.default.Use(e,{work:f,author:g,license:J}),((e,{work:t,author:o,license:n})=>{if(t.synopsis)return(0,M.default)(o?.name,n).style("work-license")})),D.footer.and(t.WorkFooter,f),(0,k.default)(f.map(e,(e=>`${$.default.API_ORIGIN}work/${e.author_vanity}/${e.work_vanity}/rss.xml`))).appendTo(D.footer.right);const z=f.map(e,(e=>e.statistics)),K=(0,T.default)().appendTo(D.footer).use(z,((e,t)=>t&&(0,C.default)().style("work-author-statistics").section("shared/stat/section/logged-in",(e=>e.stat("work/stat/reads/label",t?.read_count).stat("work/stat/hearts/label",t?.reaction_count).stat("work/stat/comments/label",t?.comment_count))).section("shared/stat/section/logged-out",(e=>e.stat("work/stat/visits/label",t?.visits?BigInt(t.visits):void 0).stat("work/stat/chapter-visits/label",t?.chapter_visits?BigInt(t.chapter_visits):void 0)))));return D.extend((e=>({work:f,statistics:K,bookmarkActions:L,bookmarkStatus:W,bookmarkAction:G,getActions(e,t){const o=P.default.Map(e,[f,s.default.Auth.author],((e,t)=>t?.vanity===e.author_vanity));t.addWhen(o,(0,v.default)().type("flush").setIcon("plus").text.use("work/action/label/new-chapter").event.subscribe("click",(()=>navigate.toURL(`/work/${f.value.author_vanity}/${f.value.work_vanity}/chapter/new`))),(0,v.default)().type("flush").setIcon("plus").text.use("view/work-edit/update/action/bulk-chapters").event.subscribe("click",(()=>navigate.toURL(`/work/${f.value.author_vanity}/${f.value.work_vanity}/chapter/new/bulk`)))),t.addWhen(o,(0,v.default)().type("flush").setIcon("pencil").text.use("work/action/label/edit").event.subscribe("click",(()=>navigate.toURL(`/work/${f.value.author_vanity}/${f.value.work_vanity}/edit`))),(0,v.default)().type("flush").setIcon("trash").text.use("work/action/label/delete").event.subscribe("click",(()=>d.default.delete(f.value,e))));const n=P.default.Map(e,[f,s.default.Auth.author],((e,t)=>!!t&&t.vanity!==e.author_vanity));t.addFollowing(e,{isApplicable:n,isFollowing:r.default.map(e,(()=>r.default.followingWork(f.value))),isIgnoring:r.default.map(e,(()=>r.default.ignoringWork(f.value))),follow:()=>r.default.followWork(f.value),unfollow:()=>r.default.unfollowWork(f.value),ignore:()=>r.default.ignoreWork(f.value),unignore:()=>r.default.unignoreWork(f.value)}),t.addModeration(e,{isApplicable:n,report:e=>I.default.prompt(e.host,j,{reportedContentName:f.value.name,async onReport(e){const t=await i.default.query({body:e,params:d.default.reference(f.value)});toast.handleError(t)}}),moderate:e=>S.default.prompt(e.host,N.create(f.value))})}})))}));t.default=q})),define("ui/component/popover/WorkPopover",["require","exports","ui/Component","ui/component/core/Popover","ui/component/popover/PopoverBlock","ui/component/Work"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),t.default=o.default.Builder(((e,t,o)=>e.and(n.default).setDelay(500).and(a.default).and(i.default,t,o)))})),define("ui/component/WorkLink",["require","exports","ui/Component","ui/component/core/ext/GradientText","ui/component/core/Link","ui/component/popover/WorkPopover"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),t.default=o.default.Builder("a",((e,t,o)=>e.and(a.default,`/work/${t.author_vanity}/${t.work_vanity}`).style("author-link").text.set(t.name).setPopover("hover/longpress",(e=>e.and(i.default,t,o))).and(n.default).useGradient(t.card_colours)))})),define("ui/component/Comment",["require","exports","endpoint/comments/$comment_id/EndpointComments$commentIdAdd","endpoint/comments/$comment_id/EndpointComments$commentIdDelete","endpoint/comments/$comment_id/EndpointComments$commentIdUpdate","endpoint/reactions/comment/$comment_id/$reaction_type/EndpointReactionsComment$commentId$reactionTypeAdd","endpoint/reactions/comment/$comment_id/$reaction_type/EndpointReactionsComment$commentId$reactionTypeRemove","endpoint/reports/comment/$comment_id/EndpointReportsComment$commentIdAdd","lang/en-nz","model/Chapters","model/FormInputLengths","model/Session","ui/Component","ui/component/AuthorLink","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/Link","ui/component/core/Loading","ui/component/core/Slot","ui/component/core/TextEditor","ui/component/core/Timestamp","ui/component/Reaction","ui/component/ReportDialog","ui/component/WorkLink","ui/utility/StringApplicator","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,b,w,k,T,x,D,E){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importStar(T),x=__importDefault(x),E=__importDefault(E);const O=(0,T.ReportDefinition)({titleTranslation:"shared/term/comment",reasons:{inappropriate:!0,spam:!0,harassment:!0,phishing:!0,"tos-violation":!0}}),M=p.default.Builder(((e,t,S,I,C)=>{let R,$;const P=e.and(y.default).style("comment").extend((e=>({}))).extendMagic("editor",(()=>({get:()=>$}))).extendMagic("author",(()=>({get:()=>R}))),A=t.comments.map(P,(e=>e.filter((e=>e===S||e.parent_id===S.comment_id))),(()=>!1));return P.use(A,((e,j)=>{$=void 0;const N=!I?.noSiblings&&!!I?.hasParent||!(!I?.hasParent||I.hasGrandparent);P.style.toggle(N,"comment--is-thread");const q=(0,p.default)().style("comment-content").style.toggle(!!S.edit,"comment-content--has-editor").style.setProperty("z-index",""+(100-(I?.depth??0))).appendTo(e);if(S&&!I?.isRootComment){const M=(0,p.default)("header").style("comment-header").style.toggle(!!S.edit,"comment-header--editing").appendTo(q),P=t.authors.value.find((e=>e.vanity===S.author));R=P?(0,f.default)(P).style("comment-header-author").appendTo(M):(0,h.default)(void 0).style("comment-header-author").text.use("comment/deleted/author").appendTo(M);let j=!1,N=!1,B=!1;if(I?.context){const e="work"===I.context.root_object.type?"work":"work_private"===I.context.root_object.type?"work_private":`${"comment"===I.context.root_object.type?"orphaned":I.context.root_object.type}${I.context.is_reply?"/reply":"/comment"}`,t=()=>"chapter"===I.context?.root_object.type?I.context.root_object:void 0,o=()=>"work"===I.context?.root_object.type?I.context.root_object:void 0,n=t()?.chapter.author_vanity??o()?.work.author_vanity,a=t()?.chapter.work_vanity??o()?.work.work_vanity,i=t()?.chapter.chapter_url,r=n?E.default.value(I.context.authors)?.find((e=>e.vanity===n)):void 0,l=a?E.default.value(I.context.works)?.find((e=>e.author_vanity===n&&e.work_vanity===a)):void 0,u=i?E.default.value(I.context.chapters)?.find((e=>e.author_vanity===n&&e.work_vanity===a&&e.chapter_url===i)):void 0;j="work_private"===I.context.root_object.type||"chapter_private"===I.context.root_object.type,N="Patreon"===u?.visibility,B=N||j;const d=l?(0,x.default)(l,r):void 0,c=_??{work:()=>[d,r?(0,f.default)(r):""],chapter:()=>[(0,h.default)(`/work/${l?.author_vanity}/${l?.work_vanity}/chapter/${i}`).style("comment-header-context-chapter").style.toggle(N,"comment-header-context-chapter--patreon","patreon-icon-before").append((0,p.default)().text.set(s.default.getName(u))),d]}[e.split("/")[0]]?.()??[];(0,p.default)().style("comment-header-context").text.use((t=>t[`comment/context/${e}`](...D.QuiltHelper.args(c)))).appendTo(M)}const L=S.edited_time??S.created_time;if(L&&(0,w.default)(L).style("comment-header-timestamp").setSimple(!!I?.context||!!C?.simpleTimestamps).setTranslation(S.edited_time?e=>e["comment/timestamp/edited"]:void 0).appendTo(M),S.edit){const i=$=(0,b.default)().default.set(S.body?.body??"").setMaxLength(d.default.map(e,(e=>e?.comment?.body))).hint.use("comment/hint").appendTo(q);i.editor.style("comment-editor"),i.content.use(M,(e=>S.body={body:e}));const r=(0,p.default)("footer").and(m.default).style("comment-footer","comment-footer--editing").appendTo(q);S.comment_id&&(0,v.default)().style("comment-footer-action").text.use("comment/action/delete").event.subscribe("click",(async()=>{l.value=!0;const e=await n.default.query({params:{comment_id:S.comment_id}});l.value=!1,toast.handleError(e)||(t.comments.value.filterInPlace((e=>e!==S)),t.comments.emit())})).appendTo(r.right),I?.hasParent&&(0,v.default)().style("comment-footer-action").text.use("comment/action/cancel").event.subscribe("click",(()=>{S.created_time?delete S.edit:t.comments.value.filterInPlace((e=>e!==S)),t.comments.emit()})).appendTo(r.right);const l=(0,E.default)(!1);(0,v.default)().style("comment-footer-action").type("primary").text.use("comment/action/save").bindDisabled(i.invalid).event.subscribe("click",(async()=>{l.value=!0,await(async()=>{if(!S.parent_id)return;const e=S.comment_id?await a.default.query({params:{comment_id:S.comment_id},body:{body:i.useMarkdown()}}):await o.default.query({params:{comment_id:S.parent_id},body:{body:i.useMarkdown()}});if(toast.handleError(e))return;const n=e.data;for(const e of Object.keys(S))delete S[e];Object.assign(S,n),t.comments.value.some((e=>e.comment_id===S.comment_id))||t.comments.value.push(n),t.comments.emit()})(),l.value=!1})).appendToWhen(l.falsy,r.right),(0,g.default)().tweak((e=>{e.style("comment-footer-action-loading"),e.enabled.bind(e,l),e.flag.style("comment-footer-action-loading-flag")})).appendToWhen(l,r.right)}else{(0,p.default)().style("comment-body").style.toggle(!S.body?.body,"comment-body--placeholder").setMarkdownContent(S.body?.body?{body:S.body.body,mentions:t.authors.value}:u.default[`comment/${j?"private":N?"patron-only":"deleted"}/body`]().toString()).appendTo(q);const o=P;(0,y.default)().use(c.default.Auth.author,((e,a)=>{const u=(0,E.default)(!1),s=(0,p.default)("footer").style("comment-footer").appendTo(e),d=(0,p.default)().style("comment-footer-section","comment-footer-section--reactions").appendTo(s),f=(0,p.default)().style("comment-footer-section").appendTo(s),m=(0,p.default)().style("comment-footer-section").appendTo(s),h=(0,E.default)(!1),y=t.threadAuthor===c.default.Auth.author.value?.vanity,_=y?h:(0,E.default)(!1);async function b(){h.value=!0;const e=await r.default.query({params:{comment_id:S.comment_id,reaction_type:"love"}});h.value=!1,toast.handleError(e)||(delete S.reacted,t.threadAuthor===c.default.Auth.author.value?.vanity?delete S.author_hearted:(S.reactions??=0,S.reactions--,S.reactions<0&&delete S.reactions),A.emit())}if(!S.reactions&&S.reacted&&y||(0,k.default)("love",S.reactions??0,!!S.reacted,h).tweak((e=>e.icon.setDisabled(B,"not viewable").bindDisabled(c.default.Auth.loggedIn.falsy,"not logged in"))).event.subscribe("click",(async()=>{if(a){if(S.reacted)await b();else{h.value=!0;const e=await i.default.query({params:{comment_id:S.comment_id,reaction_type:"love"}});if(h.value=!1,toast.handleError(e))return;S.reacted=!0,y?S.author_hearted=!0:(S.reactions??=0,S.reactions++)}A.emit()}})).appendTo(d),S.author_hearted&&(0,k.default)("author_heart",0,!0,_).tweak((e=>e.icon.style("comment-author-heart").style.toggle(!y,"comment-author-heart--not-author"))).setTooltip((e=>e.text.use("comment/tooltip/author-heart"))).event.subscribe("click",(async()=>{y&&await b()})).appendTo(d),!a)return;const w=S.author===a.vanity;let x=!1;const D=()=>!0===x?void 0:(x=!0,(0,v.default)().style("comment-footer-action").type("flush").setIcon(S.author===a.vanity||t.threadAuthor===a.vanity?"trash":"shield-halved").text.use("comment/action/delete").event.subscribe("click",(async e=>{u.value=!0;const o=await n.default.query({params:{comment_id:S.comment_id}});u.value=!1,toast.handleError(o)||(t.comments.value.filterInPlace((e=>e!==S)),t.comments.emit())})));w&&!I?.context&&(0,v.default)().style("comment-footer-action").type("flush").setIcon("pencil").text.use("comment/action/edit").event.subscribe("click",(()=>{S.edit=!0,A.refresh()})).appendTo(f),w&&D()?.appendToWhen(u.falsy,f),!B&&S.replyable&&(0,v.default)().style("comment-footer-action").type("flush").setIcon("reply").text.use("comment/action/reply").event.subscribe("click",(()=>{t.comments.value.unshift({edit:!0,parent_id:S.comment_id,author:a.vanity}),A.refresh()})).appendTo(w?m:f),w||B||(0,v.default)().style("comment-footer-action").type("flush").setIcon("flag").text.use("comment/action/report").event.subscribe("click",(e=>T.default.prompt(e.host,O,{reportedContentName:e=>e["shared/term/comment-by"](o?.name),async onReport(e){const t=await l.default.query({body:e,params:{comment_id:S.comment_id}});toast.handleError(t)}}))).appendTo(m),(t.threadAuthor===a.vanity||c.default.Auth.isModerator.value)&&D()?.appendToWhen(u.falsy,m),(0,g.default)().tweak((e=>{e.style("comment-footer-action-loading"),e.enabled.bind(e,u),e.flag.style("comment-footer-action-loading-flag")})).appendToWhen(u,s)})).appendTo(e)}}if(S.comment_id&&j.length>1){const o=j.length>2,n=!!I?.isRootComment||I?.noSiblings&&!o||j.length>3,a=(0,p.default)().style("comment-children").style.toggle(n,"comment-children--flush").appendTo(e),i=e=>e.created_time?new Date(e.created_time).getTime():1/0;for(const e of j.sort(((e,t)=>i(t)-i(e)))){if(e===S)continue;if(C?.shouldSkipComment?.(e))continue;const o=j.length<=2||void 0;M(t,e,{noSiblings:o,hasParent:!I?.isRootComment||void 0,hasGrandparent:I?.hasParent,depth:(I?.depth??0)+1},C).appendTo(a)}}C?.onRenderComment?.(P,S)})),P}));t.default=M})),define("ui/component/CommentList",["require","exports","ui/Component","ui/component/Comment","ui/component/core/Block","ui/component/core/Paginator","ui/component/core/Slot","utility/State"],(function(e,t,o,n,a,i,r,l){var u;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextualComment=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),function(e){e.fromRaw=function(e){return{data:e.comment,metadata:{context:{root_object:e.root_object,is_reply:e.is_reply||void 0}}}}}(u||(t.ContextualComment=u={})),t.default=o.default.Builder((e=>{let t;const u=(0,i.default)().style("comment-list").tweak((e=>e.content.style("comment-list-content"))).orElse((e=>(0,a.default)().type("flush").style("comment-list-placeholder-wrapper").tweak((e=>(0,o.default)().style("placeholder").text.use("comment/list/empty").tweak(t).appendTo(e.content))).appendTo(e))).appendTo(e.and(r.default));return e.extend((e=>({paginator:u,set:o=>(t=o.placeholder,u.set(o.data,0,((e,{comments:t,authors:o,works:a,chapters:i,threadAuthor:r})=>e.append(...t.map((({data:u,metadata:s})=>(0,n.default)({threadAuthor:r??"@",comments:(0,l.default)(t.map((e=>e.data))),authors:l.default.get(o)},u,s&&{...s,context:s.context&&{...s.context,authors:o,works:a,chapters:i}}).style("comment-list-comment").appendTo(e)))))).setHasResults(((e,t)=>e&&t(e.comments))),e)})))}))})),define("ui/component/WorkFeed",["require","exports","model/PagedListData","model/Session","ui/Component","ui/component/ActionBlock","ui/component/core/Link","ui/component/core/Paginator","ui/component/core/Slot","ui/component/Work","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d);const c=a.default.Builder((e=>{const t=e.and(l.default).type("flush"),c=(0,d.default)(void 0);let p,f;const m=t.extend((e=>({state:c,setPageHandler:t=>(p=t,e),setFromEndpoint(t,n){const a=(0,d.default)([]),i=(0,o.default)(t.getPageSize?.()??25,{async get(e){const o=await t.query(void 0,{page:e});return c.value=void 0,!toast.handleError(o)&&(o.data?(c.value=o.data,a.value.push(...o.data.authors),a.value.distinctInPlace((e=>e.vanity)),a.emit(),o.data.works):null)}});return e.setFromWorks(i,a,n),e},setFromWorks:(o,a,l=0)=>(t.set(o,l,((e,t,o)=>{p?.(o);for(const o of t){const t=a.value.find((e=>e.vanity===o.author_vanity)),l=(0,r.default)(t&&`/work/${t.vanity}/${o.work_vanity}`).and(s.default,o,t,!0).viewTransition(!1).appendTo(e);(0,u.default)().appendTo(e).if(n.default.Auth.loggedInAs(e,o.author_vanity),(e=>(0,i.default)().attachAbove().addActions(l)))}})),e),setPlaceholder:t=>(f=t,e)})));return t.orElse((e=>(0,a.default)().style("placeholder").text.use("feed/empty").tweak(f).appendTo(e))),m}));t.default=c})),define("ui/view/AuthorView",["require","exports","endpoint/authors/EndpointAuthors$authorVanity","endpoint/comments/author/$author_vanity/EndpointCommentsAuthor$authorVanityChapter","endpoint/comments/author/$author_vanity/EndpointCommentsAuthor$authorVanityWork","endpoint/works/EndpointWorks$authorVanity","model/PagedData","model/PagedListData","model/Session","ui/component/ActionBlock","ui/component/Author","ui/component/CommentList","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/Tabinator","ui/component/WorkFeed","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importStar(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),t.default=(0,y.default)({async load(e){const t=await o.default.query({params:e});if(t instanceof Error)throw t;return{author:t.data}},create(e,{author:t}){const o=(0,g.default)("author"),y=u.default.Auth.loggedInAs(o,t.vanity),b=(0,d.default)(t).viewTransition("author-view-author").setContainsHeading().appendTo(o.content);(0,s.default)().viewTransition("author-view-author-actions").attachAbove().addActions(b).appendTo(o.content);const w=t.comments_privated&&u.default.Auth.author.value?.vanity!==t.vanity?void 0:(0,v.default)().appendTo(o.content),k=w&&(0,v.Tab)("works").setIcon("book").text.use("view/author/works/title").addTo(w);(0,p.default)().tweak((e=>(0,m.default)().type("primary").text.use("view/author/works/action/label/new").setIcon("plus").event.subscribe("click",(()=>navigate.toURL("/work/new"))).appendTo(e.right))).appendToWhen(y,k?.content??o.content);const T=l.default.fromEndpoint(25,i.default.prep({params:{author_vanity:e.author_vanity}}));return(0,h.default)().viewTransition("author-view-works").setFromWorks(T,(0,_.default)([t])).setPlaceholder((e=>e.removeContents().and(f.default).tweak((e=>e.content.text.use("view/author/works/content/empty"))))).appendTo(k?.content??o.content),w&&(0,v.Tab)("recommendations").setIcon("heart").text.use("view/author/recommendations/title").tweak((o=>{const n=e=>({...e.comment,author:t.vanity}),i=r.default.fromEndpoint(a.default.prep({params:{author_vanity:e.author_vanity}})).map((e=>({comments:e.comments.map((e=>({data:n(e),metadata:{context:{root_object:e.root_object,is_reply:e.is_reply||void 0}}}))),authors:e.authors,works:e.works,chapters:e.chapters})));(0,c.default)().viewTransition("author-view-recommendations").set({data:i,placeholder:e=>e.text.use("view/author/recommendations/content/empty")}).appendTo(o.content)})).addTo(w),w&&(0,v.Tab)("comments").setIcon("comment").text.use((e=>e["view/author/comments/title"](t.comments_privated))).tweak((o=>{const a=e=>({...e.comment,author:t.vanity}),i=r.default.fromEndpoint(n.default.prep({params:{author_vanity:e.author_vanity}})).map((e=>({comments:e.comments.map((e=>({data:a(e),metadata:{context:{root_object:e.root_object,is_reply:e.is_reply||void 0}}}))),authors:e.authors,works:e.works,chapters:e.chapters})));(0,c.default)().viewTransition("author-view-comments").set({data:i,placeholder:e=>e.text.use("view/author/comments/content/empty")}).appendTo(o.content)})).addTo(w),w?.bindURL(e.tab,(t=>t&&"works"!==t?`/author/${e.author_vanity}/${t}`:`/author/${e.author_vanity}`)),o}})})),define("endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanity$chapterUrl",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/{chapter_url}","get")})),define("endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanityList",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/list","get")})),define("endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/{author_vanity}/{work_vanity}/get","get")})),define("endpoint/chapters/$author_vanity/$work_vanity/$chapter_url/EndpointChapters$authorVanity$workVanity$chapterUrlUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/{chapter_url}/update","post")})),define("endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanityCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/create","post")})),define("ui/component/WorkStatusDropdown",["require","exports","model/Works","ui/Component","ui/component/core/Dropdown","utility/State"],(function(e,t,o,n,a,i){var r;Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),i=__importDefault(i),function(e){e.Radio=n.default.Builder(((e,t)=>{t=i.default.get(t);const n=e.and(a.RadioDropdown).style("work-status-dropdown");n.button.style("work-status-dropdown-button");for(const e of o.WORK_STATUSES){const t=e.toLowerCase();n.add(e,{translation:e=>e=>e[`work/status/${t}`](),tweakButton:(n,a)=>n.setIcon(o.WORK_STATUS_ICONS[e]).tweak((e=>e.icon?.style("work-status-icon"))).style("work-status-dropdown-option").style(`work-status-dropdown-option--${t}`)})}return n.selection.value=t.value,n.selection.use(n,(e=>{e??=t.value;const a=e.toLowerCase();n.button.setIcon(o.WORK_STATUS_ICONS[e]).tweak((e=>e.icon?.style("work-status-icon"))).style.remove(...o.WORK_STATUSES.map((e=>`work-status-dropdown-button--${e.toLowerCase()}`))).style(`work-status-dropdown-button--${a}`)})),n})),e.Check=n.default.Builder(((e,t)=>{t=i.default.get(t);const n=e.and(a.CheckDropdown).style("work-status-dropdown");n.button.style("work-status-dropdown-button");for(const e of o.WORK_STATUSES){const t=e.toLowerCase();n.add(e,{translation:e=>e=>e[`work/status/${t}`](),tweakButton:(n,a)=>n.setIcon(o.WORK_STATUS_ICONS[e]).tweak((e=>e.icon?.style("work-status-icon","work-status-dropdown-button-icon"))).tweak((e=>e.textWrapper.style.bind(e.checked.falsy,"work-status-dropdown-button-label--unchecked"))).style.bind(n.checked.falsy,"work-status-dropdown-button--unchecked").style("work-status-dropdown-option").style(`work-status-dropdown-option--${t}`)})}return n.selection.value=t.value,n.selection.use(n,(e=>{e??=t.value,n.button.setIcon(0===e.length?"circle":e.length>1?"circle-dot":o.WORK_STATUS_ICONS[e[0]]).tweak((e=>e.icon?.style("work-status-icon"))).style.remove(...o.WORK_STATUSES.flatMap((e=>[`work-status-dropdown-button--${e.toLowerCase()}`,...o.WORK_STATUSES.flatMap((t=>[`work-status-dropdown-button--${e.toLowerCase()}-${t.toLowerCase()}`,...o.WORK_STATUSES.flatMap((n=>[`work-status-dropdown-button--${e.toLowerCase()}-${t.toLowerCase()}-${n.toLowerCase()}`,...o.WORK_STATUSES.map((o=>`work-status-dropdown-button--${e.toLowerCase()}-${t.toLowerCase()}-${n.toLowerCase()}-${o.toLowerCase()}`))]))]))])));const a=e.join("-").toLowerCase();n.button.style(`work-status-dropdown-button--${a}`)})),n}))}(r||(r={})),t.default=r})),define("endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkCancel",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/bulk/cancel","post").noResponse()})),define("endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkFinish",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/bulk/finish","post").noResponse()})),define("endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkQueue",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/bulk/queue","post")})),define("endpoint/chapters/$author_vanity/EndpointChapters$authorVanity$workVanity",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}","get")})),define("endpoint/moderation/chapter/$author_vanity/$work_vanity/$chapter_url/EndpointModerationChapter$authorVanity$workVanity$chapterUrlCensor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/chapter/{author_vanity}/{work_vanity}/{chapter_url}/censor","post").noResponse()})),define("endpoint/reports/chapter/$author_vanity/$work_vanity/$chapter_url/EndpointReportsChapter$authorVanity$workVanity$chapterUrlAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reports/chapter/{author_vanity}/{work_vanity}/{chapter_url}/add","post").noResponse()})),define("model/Authors",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.resolve=function(e,t){return e?t.find((t=>t.vanity===e)):void 0}}(o||(o={})),t.default=o})),define("ui/component/Chapter",["require","exports","endpoint/moderation/chapter/$author_vanity/$work_vanity/$chapter_url/EndpointModerationChapter$authorVanity$workVanity$chapterUrlCensor","endpoint/reports/chapter/$author_vanity/$work_vanity/$chapter_url/EndpointReportsChapter$authorVanity$workVanity$chapterUrlAdd","model/Chapters","model/Session","ui/Component","ui/component/ActionBlock","ui/component/core/Button","ui/component/core/Link","ui/component/core/Timestamp","ui/component/ModerationDialog","ui/component/ReportDialog","utility/maths/Maths","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importStar(c),p=__importStar(p),f=__importDefault(f),m=__importDefault(m);const v=(0,p.ReportDefinition)({titleTranslation:"shared/term/author",reasons:{"inadequate-tags":!0,"inappropriate-field":!0,spam:!0,harassment:!0,plagiarism:!0,"tos-violation":!0}}),h=(0,c.ModerationDefinition)((e=>({titleTranslation:"shared/term/chapter",moderatedContentName:e.name??(t=>t["view/chapter/number/label"](e.url)),censor:(0,c.ModerationCensor)({properties:{name:c.ModerationCensor.plaintext(e.name),body:c.ModerationCensor.markdown(e.body),notes_before:c.ModerationCensor.markdown(e.notes_before),notes_after:c.ModerationCensor.markdown(e.notes_after)},async censor(t){const n=await o.default.query({params:a.default.reference(e),body:t});toast.handleError(n)}})}))),g=r.default.Builder(((e,t,o,g)=>{e=(0,s.default)(`/work/${g.vanity}/${o.work_vanity}/chapter/${t.chapter_url}`).style("chapter").style.toggle("Private"===t.visibility,"chapter--private").style.toggle("Patreon"===t.visibility,"chapter--patreon","patreon-icon-after");const y=f.default.parseIntOrUndefined(t.chapter_url),_=(0,r.default)().style("chapter-number").text.set(y?`${y.toLocaleString(navigator.language)}`:"").appendTo(e),b=(0,r.default)().style("chapter-name").style.toggle(!t.name,"chapter-name--auto").text.set(a.default.getName(t)).appendTo(e),w=(0,r.default)().style("chapter-right").appendTo(e);let k;k="Private"===t.visibility?(0,r.default)().style("timestamp","chapter-timestamp").text.use("chapter/state/private").appendTo(w):t.time_publish?(0,d.default)(t.time_publish).style("chapter-timestamp").appendTo(w):void 0;const T=(0,m.default)(!1),x=(0,m.default)(void 0);return e.style.bind(T,"chapter--edit-mode").extend((e=>({chapter:t,number:_,chapterName:b,timestamp:k,bindEditMode:t=>(m.default.is(t)?T.bind(e,m.default.get(t)):T.value=t,e),setReorderHandler:t=>(x.value=t,e),getActions(e,r){const l=i.default.Auth.loggedInAs(e,t.author_vanity),s=m.default.Every(e,l,x.truthy);r.addWhen(s,(0,u.default)().type("flush").setIcon("arrow-up-arrow-down").text.use("chapter/action/label/reorder").event.subscribe("click",(()=>x.value?.()))),r.addWhen(l,(0,u.default)().type("flush").setIcon("pencil").text.use("chapter/action/label/edit").event.subscribe("click",(()=>navigate.toURL(`/work/${g.vanity}/${o.work_vanity}/chapter/${m.default.value(t).chapter_url}/edit`))),(0,u.default)().type("flush").setIcon("trash").text.use("chapter/action/label/delete").event.subscribe("click",(()=>a.default.delete(m.default.value(t)))));const d=m.default.Every(e,l.falsy,i.default.Auth.loggedIn),f=m.default.Every(e,d,i.default.Auth.isModerator.falsy),y=m.default.Every(e,d,i.default.Auth.isModerator);r.addWhen(f,(0,u.default)().type("flush").setIcon("flag").text.use("chapter/action/label/report").event.subscribe("click",(e=>p.default.prompt(e.host,v,{reportedContentName:m.default.value(t).name??(e=>e["view/chapter/number/label"](m.default.value(t).chapter_url)),async onReport(e){const o=await n.default.query({body:e,params:a.default.reference(m.default.value(t))});toast.handleError(o)}})))),r.addWhen(y,(0,u.default)().type("flush").setIcon("shield-halved").text.use("chapter/action/label/moderate").event.subscribe("click",(e=>c.default.prompt(e.host,h.create(m.default.value(t))))))}}))).tweak((e=>{(0,r.default)().style("chapter-actions").tweak((t=>(0,l.ActionProviderList)().provide(e,e).renderTo(t,t))).appendToWhen(T,e)}))}));t.default=g})),define("ui/component/core/SlotArray",["require","exports","ui/Component","ui/component/core/Slot"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=o.default.Builder((e=>{let t;return e.and(n.default),e.extend((e=>({use(o,a){t?.();const i=[];return t=o.useEach(e,{onItem(t,o){const r=(0,n.default)().extend((()=>({index:0}))),l=t.map(r,(e=>e.index));l.use(r,(e=>r.index=e));const u=t.map(r,(e=>e.value),!1);r.use(u,((t,o)=>a(Object.assign(t,{index:l,wrapper:e,getSiblings:()=>e.getChildren(n.default)}),o)));const s=i.findIndex((e=>e.index>t.value.index)),d=i[s];e.insert("before",d,r),-1===s?i.push(r):i.splice(s,0,r),t.value.removed.match(e,!0,(()=>{r.remove(),i.filterInPlace((e=>e!==r))}))},onMove(t,o,n){const a=i.splice(t,o-t),r=t<n?n-(o-t)+1:n,l=a.map((e=>e.index)).splat(Math.max),u=i.find((e=>e.index>l));i.splice(r,0,...a);for(const t of a)e.insert("before",u,t)},onMoveAt(t,o){const n=t.map((e=>i[e]));i.sort(((e,t)=>e.index-t.index));const a=n.map((e=>e.index)).splat(Math.max),r=i.find((e=>e.index>a));for(const t of n)e.insert("before",r,t)}}),e}})))}));t.default=a})),define("utility/Documents",["require","exports","jszip","mammoth","ui/component/core/TextEditor","utility/Functions","utility/State","utility/Task"],(function(e,t,o,n,a,i,r,l){var u;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),function(e){function t(e){return e=(e=(e=e.slice(e.lastIndexOf("/")+1)).slice(e.lastIndexOf("\\")+1)).slice(0,e.lastIndexOf("."))}e.basename=t,e.importFrom=function(e,u){return r.default.Async(e,u,(async(e,r,u)=>{if(!e)return;const s=[],d=[];for(let t=0;t<e.length;t++){const o=e[t];if(r.aborted)return;u(t/e.length*.1,(o=>o["utility/documents/load/discovering"](t,e.length))),await l.default.yield(),await c("",o.name,{text:()=>o.text().then((e=>({text:e,error:void 0})),(e=>({text:void 0,error:e}))),json:()=>o.text().then((e=>JSON.parse(e))).then((e=>({data:e,error:void 0})),(e=>({data:void 0,error:e}))),raw:()=>o.arrayBuffer().then((e=>({buffer:e,error:void 0})),(e=>({buffer:void 0,error:e})))})}async function c(e,t,n,a){const i=t.slice(t.lastIndexOf(".")),r=e+"/"+(a??t);if(".zip"!==i)d.push({dir:e,path:t,file:n});else{const{buffer:e,error:a}=await n.raw();if(a)return void s.push({file:r,error:a});const i=t,l=await o.default.loadAsync(e);for(const[e,t]of Object.entries(l.files)){if(t.dir)return;await c(i,e,{text:()=>t.async("text").then((e=>({text:e,error:void 0})),(e=>({text:void 0,error:e}))),json:()=>t.async("text").then((e=>JSON.parse(e))).then((e=>({data:e,error:void 0})),(e=>({data:void 0,error:e}))),raw:()=>t.async("arraybuffer").then((e=>({buffer:e,error:void 0})),(e=>({buffer:void 0,error:e})))})}}}for(let e=0;e<d.length;e++){const{dir:t,path:o,file:n}=d[e];if(r.aborted)return;u(.1+e/d.length*.9,(t=>t["utility/documents/load/processing"](e,d.length))),await l.default.yield(),await p(t,o,n,o)}async function p(e,o,a,r){const u=o.slice(o.lastIndexOf(".")),d=e+"/"+(r??o);switch(u){case".txt":{const{text:e,error:t}=await a.text();return t?void s.push({file:d,error:t}):f(d,(t=>!!t.mirror?.pasteText(e)))}case".md":{const{text:e,error:t}=await a.text();return t?void s.push({file:d,error:t}):f(d,(t=>(t.importMarkdown(e),!0)))}case".docx":{const{buffer:r,error:u}=await a.raw();if(u)return void s.push({file:d,error:u});const{result:c,error:f}=await n.default.convertToHtml({arrayBuffer:r}).then((e=>({result:e,error:void 0})),(e=>({result:void 0,error:new Error("Unable to convert docx to html:",{cause:e})})));return f?void s.push({file:d,error:f}):(await l.default.yield(),p(e,o+`/${t(o)}.html`,{text:()=>Promise.resolve({text:c.value,error:void 0}),json:i.default.throwing("This file's text should be processed as HTML"),raw:i.default.throwing("This file's text should be processed as HTML")},o))}case".html":{const{text:e,error:t}=await a.text();return t?void s.push({file:d,error:t}):f(d,(t=>!!t.mirror?.pasteHTML(e)))}default:return void s.push({file:d,error:new Error(`Unsupported file type ${u}`)})}}function f(e,o){try{const n=a.default.passThrough(o);s.push({file:e,title:t(e),body:n})}catch(t){s.push({file:e,error:t})}}return s.sort(((e,t)=>e.file.localeCompare(t.file)))}))}}(u||(u={})),t.default=u})),define("ui/view/ChapterNewBulkView",["require","exports","endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkCancel","endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkFinish","endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkQueue","endpoint/chapters/$author_vanity/EndpointChapters$authorVanity$workVanity","endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityGet","lang/en-nz","model/Chapters","model/PagedListData","model/Patreon","model/Session","model/Works","ui/Component","ui/component/Chapter","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/ConfirmDialog","ui/component/core/Details","ui/component/core/LabelledTable","ui/component/core/Link","ui/component/core/Loading","ui/component/core/Paginator","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/SlotArray","ui/component/core/Small","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/VisibilityOptions","ui/component/Work","ui/InputBus","ui/view/chapter/ChapterEditForm","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Documents","utility/maths/Maths","utility/Objects","utility/State","utility/string/Strings","utility/Task"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,b,w,k,T,x,D,E,O,M,S,I,C,R,$,P,A,j,N,q,B,L,V,W,G,U){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),E=__importDefault(E),O=__importDefault(O),M=__importDefault(M),S=__importDefault(S),I=__importDefault(I),C=__importStar(C),R=__importDefault(R),$=__importDefault($),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N),q=__importDefault(q),B=__importDefault(B),L=__importDefault(L),V=__importDefault(V),W=__importDefault(W),G=__importDefault(G),U=__importDefault(U),t.default=(0,q.default)({requiresLogin:!0,async load(e){const t=await r.default.query({params:u.default.work(e)});if(t instanceof Error)throw t;const o=t.data.synopsis?.mentions.find((t=>t.vanity===e.author_vanity));return{work:t.data,author:o}},create(e,{work:t,author:r}){const u=(0,N.default)("chapter-bulk");delete t.synopsis,delete t.custom_tags,(0,T.default)(`/work/${r?.vanity}/${t.work_vanity}`).and(P.default,t,r).viewTransition("chapter-view-work").style("view-type-chapter-work").setContainsHeading().appendTo(u.content);const q=(e,t)=>(0,M.default)().append((()=>{const t=L.default.parseIntOrUndefined(e);if(t)return(0,f.default)().style("view-type-chapter-bulk-chapter-display-number").text.use((e=>e["view/chapter/number/label"](t)))})()).append((0,f.default)().style("view-type-chapter-bulk-chapter-display-title").text.set(t)),F=(0,f.default)().style("view-type-chapter-bulk-content").appendTo(u.content),H=(0,W.default)(void 0),Y=(0,C.default)().tabType("steps").appendTo(F),J=(0,W.default)(void 0),z=()=>M.default.using(J,((e,t)=>t&&(0,f.default)().style("view-type-chapter-bulk-position-display").append((0,f.default)().style("view-type-chapter-bulk-position-display-label").text.use(`view/chapter-create-bulk/position/label/position/${t.position}`)).append(q(t.relative_to,t.title)).appendWhen(J.truthy,(0,g.default)().tweak((e=>{K.use(e,(t=>{t?e.type.remove("primary"):e.type("primary")}))})).style("view-type-chapter-bulk-position-display-action").text.bind(K.map(e,(e=>t=>t["view/chapter-create-bulk/position/action/"+(e?"cancel-change":"change")]()))).event.subscribe("click",(e=>{K.value=!K.value,X.header.element.scrollIntoView({behavior:"instant"})}))))),K=(0,W.default)(!1),Q=(0,C.Tab)().text.use("view/chapter-create-bulk/position/tab").bindDisabled(H.truthy,"uploading or done").addTo(Y),X=(0,h.default)().type("flush").style("view-type-chapter-bulk-block","view-type-chapter-bulk-block--not-last").tweak((e=>e.title.text.use("view/chapter-create-bulk/position/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/position/description"))).tweak((o=>o.content.appendWhen(W.default.Some(o,J.falsy,K),(0,D.default)().viewTransition("work-view-chapters").style("view-type-work-chapter-list").set(s.default.fromEndpoint(25,i.default.prep({params:p.default.reference(t)})),0,((n,a)=>{n.style("chapter-list").style("view-type-work-chapter-list--moving-chapter");const i=a.at(0);i&&l("before",i).appendTo(n);for(const o of a)(0,m.default)(o,t,r??{vanity:e.author_vanity}).style("view-type-work-chapter","view-type-work-chapter--has-moving-sibling").attributes.append("inert").appendTo(n),l("after",o).appendTo(n);function l(e,t){const a={relative_to:t.chapter_url,position:e,title:t.name??(e=>e["view/chapter/number/label"](t.chapter_url))},i=J.map(n,(e=>!!e&&e.relative_to===a.relative_to&&e.position===a.position));return(0,f.default)().style("view-type-work-chapter-slot-wrapper").style("view-type-work-chapter-slot-wrapper--has-moving-chapter").append((0,g.default)().style("chapter","view-type-work-chapter-slot").style.bind(i,"view-type-work-chapter-slot--chosen").event.subscribe("click",(()=>{J.value=a,K.value=!1,o.header.element.scrollIntoView({behavior:"instant"})})))}})).orElse((e=>(0,h.default)().type("flush").tweak((e=>(0,O.default)().text.use("view/work/chapters/content/empty").appendTo(e.content))).appendTo(e)))).append(z()).append((0,v.default)().style("view-type-chapter-bulk-step-action-row").tweak((e=>e.right.append(Q.createNextButton())))))).appendToWhen(H.falsy,Q.content),Z=(0,W.default)(null),ee=(0,W.default)(void 0),te=ee.mapManual((e=>{if(!e)return;const t=new RegExp(`(?:${e.source})|`).exec("");return(t?.length??0)<=1?void 0:t})),oe=(0,W.default)(void 0),ne=B.default.importFrom(u,Z),ae=ne.state.map(u,(e=>({loading:!e.settled,imports:(e.value??[]).map((e=>({...e,enabled:!e.error})))}))),ie=e=>`light-dark(oklch(30% 100% ${(100+60*e)%360}deg), oklch(70% 100% ${(100+60*e)%360}deg))`,re=e=>{if("{auto}"===oe.value)return"";const t=e.title;if(!ee.value)return e.title;const o=ee.value.exec(t);return!o||o.length<=1&&o[0].length===t.length?e.title:(oe.value??"{filename}").replaceAll(/{filename(?::(\d+))?}/g,((e,n)=>{const a=+n;return isNaN(a)?t:o[a]??""}))},le=(0,f.default)("input").style("view-type-chapter-bulk-import-list-actions-import-input").attributes.set("type","file").attributes.append("multiple").event.subscribe("change",(e=>Z.value=e.host.element.files)).appendTo(F),ue=(0,C.Tab)().text.use("view/chapter-create-bulk/import/tab").bindDisabled(H.truthy,"uploading or done").addTo(Y);(0,h.default)().type("flush").style("view-type-chapter-bulk-block","view-type-chapter-bulk-block--not-last").tweak((e=>e.title.text.use("view/chapter-create-bulk/import/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/import/description"))).tweak((e=>e.content.style("view-type-chapter-bulk-import-list-wrapper").append((0,f.default)().style("view-type-chapter-bulk-import-list").append((0,v.default)().style("view-type-chapter-bulk-import-list-actions").tweak((e=>{(0,g.default)().setIcon("file-import").type("flush").text.bind(Z.map(e,(e=>t=>t[e?.length?"view/chapter-create-bulk/import/action/replace":"view/chapter-create-bulk/import/action/select"]()))).event.subscribe("click",(()=>le.element.click())).appendTo(e.left),(0,g.default)().setIcon("square-check").type("flush").text.use("view/chapter-create-bulk/shared/action/select-all").event.subscribe("click",(()=>{for(const e of ae.value.imports)e.error||(e.enabled=!0);ae.emit()})).appendToWhen(ae.map(e,(e=>!e.imports.every((e=>e.enabled)))),e.right),(0,g.default)().setIcon("square-minus").type("flush").text.use("view/chapter-create-bulk/shared/action/deselect-all").event.subscribe("click",(()=>{for(const e of ae.value.imports)e.error||(e.enabled=!1);ae.emit()})).appendToWhen(ae.map(e,(e=>e.imports.some((e=>e.enabled)))),e.right)}))).append(M.default.using(ae,((t,o)=>{if(o.loading)return(0,x.default)().style("view-type-chapter-bulk-import-list-loading").use(ne);const n=o.imports;if(!n.length)return(0,O.default)().style("view-type-chapter-bulk-import-list-empty-paragraph").text.use("view/chapter-create-bulk/import/empty");let a=!0;for(const o of n)(0,w.default)().style("view-type-chapter-bulk-import").style.toggle(a=!a,"view-type-chapter-bulk-import--odd").tweak((e=>{e.style.bind(e.state,"view-type-chapter-bulk-import--open"),e.summary.style.remove("button").style("view-type-chapter-bulk-import-summary").style.bind(e.state,"view-type-chapter-bulk-import-summary--open");const t=e.summary.hoveredOrHasFocused.mapManual((e=>!e&&!o.enabled)),n=(0,f.default)().style("view-type-chapter-bulk-import-summary-meta").style.bind(t,"view-type-chapter-bulk-import-summary-meta--disabled").appendTo(e.summary);o.title&&(0,f.default)().style("view-type-chapter-bulk-import-summary-title").text.bind(ee.map(n,(e=>{if(!e)return o.title;e.lastIndex=0;const t=e.exec(o.title);if(!t||!t[1]||!t[0])return o.title;if(t[1]){const e={content:[]};let n=0;for(let a=1;a<t.length;a++){const[i,r]=t.indices[a],l=o.title.slice(n,i);n=r,e.content.push({content:l,tag:"SM"},{content:(0,f.default)("strong").style.setProperty("color",ie(a)).text.set(t[a])})}const a=o.title.slice(n);return e.content.push({content:a,tag:"SM"}),t=>e}const[n,a]=t.indices[0],i=o.title.slice(0,n),r=o.title.slice(a);return e=>({content:[{content:i,tag:"SM"},{content:t[0],tag:"B"},{content:r,tag:"SM"}]})}))).appendTo(n),(0,O.default)().style("view-type-chapter-bulk-import-summary-filename").text.set(o.file).appendTo(n),o.error&&(0,f.default)().style("view-type-chapter-bulk-import-summary-error").text.set(o.error.message).appendTo(n),o.error||(0,y.default)().type("flush").style("view-type-chapter-bulk-import-summary-checkbox").tweak((e=>e.icon?.style("view-type-chapter-bulk-import-summary-checkbox-icon").style.bind(e.hoveredOrHasFocused,"view-type-chapter-bulk-import-summary-checkbox-icon--focus"))).setChecked(o.enabled).event.subscribe("change",(e=>{o.enabled=e.host.checked.value,ae.emit()})).appendTo(e.summary),o.body&&(0,f.default)().style("view-type-chapter-bulk-import-body").setMarkdownContent(o.body,512,!1).appendTo(e)})).event.subscribe("toggle",(t=>{t.host.state.value&&(t.host.element.scrollIntoView({behavior:"smooth"}),e.header.element.scrollIntoView({behavior:"smooth"}))})).appendTo(t)})))))).tweak((e=>e.footer.style("view-type-chapter-bulk-import-list-wrapper-footer").tweak((e=>{const t=Z.map(e,(e=>!!e?.length));(0,w.default)().style("view-type-chapter-bulk-import-list-wrapper-footer-config-details").tweak((e=>{e.style.bind(e.state,"view-type-chapter-bulk-import-list-wrapper-footer-config-details--open"),e.summary.style("view-type-chapter-bulk-import-list-wrapper-footer-config-button").text.use("view/chapter-create-bulk/import/action/config").tweak((t=>e.state.use(t,(e=>t.setIcon(e?"angles-up":"angles-down")))))})).append((0,h.default)().style("view-type-chapter-bulk-import-list-wrapper-footer-config").tweak((e=>e.content.and(k.default).label((e=>e.text.use("view/chapter-create-bulk/import/form/filename/label"))).content(((e,t)=>e.append((0,R.default)().setLabel(t).placeholder.set("(.*)").setValidityHandler((e=>!e.value||te.value?void 0:e=>e["view/chapter-create-bulk/import/form/filename/invalid"]())).tweak((e=>e.state.useManual((e=>ee.value=G.default.optionalParseRegex(e,"d")))))).append((0,I.default)().text.bind(te.map(e,(e=>t=>t["view/chapter-create-bulk/import/form/filename/variables"](...[...e??[""]].map(((e,t)=>t?(0,f.default)().style.setProperty("color",ie(t)).text.set(`{filename:${t}}`):(0,f.default)().style.setProperty("color","var(--colour-3)").text.set("{filename}"))).slice((e?.length??0)>1?1:0),(0,f.default)().style.setProperty("color","var(--colour-3)").text.set("{auto}")))))))).label((e=>e.text.use("view/chapter-create-bulk/import/form/name/label"))).content(((e,t)=>e.append((0,R.default)().setLabel(t).placeholder.set("{filename}").setValidityHandler((e=>{const t=e.value.trim();if(!(t.length&&("{auto}"===t||/\{filename(:\d+)?\}/.test(t))))return e=>e["view/chapter-create-bulk/import/form/name/invalid"]()})).tweak((e=>e.state.useManual((e=>oe.value=e.trim()||void 0))))).append((0,I.default)().text.bind(W.default.Generator((()=>{const e=ae.value.imports.filter((e=>!e.error&&e.enabled)),t=[];for(let o=0;o<Math.min(e.length,5);o++)t.push({content:[{content:re(e[o])||l.default["view/chapter/number/label"](o+1).toString(),tag:"B"}]});return e=>e["view/chapter-create-bulk/import/form/name/examples"](...t)})).observe(e,ae,te,oe)))))))).prependToWhen(t,e),(0,g.default)().setIcon("xmark").text.use("view/chapter-create-bulk/import/action/clear").event.subscribe("click",(()=>{le.element.value="",Z.value=null})).appendToWhen(t,e.right),(0,g.default)().type("primary").bindDisabled(ae.map(e,(e=>!e.imports.some((e=>e.enabled)))),"no enabled documents").text.use("view/chapter-create-bulk/import/action/import").event.subscribe("click",(()=>{for(const e of ae.value.imports)!e.error&&e.enabled&&se.push({open:!1,selected:!1,body:(0,W.default)({name:re(e),body:e.body,visibility:"Private"})});se.emit(),ue.showNextTab()})).appendTo(e.right)})))).appendToWhen(H.falsy,ue.content);const se=W.default.Array(),de=se.mapManual((e=>e.some((e=>e.selected)))),ce=se.mapManual((e=>e.some((e=>!e.selected))));let pe;const fe=f.default.Builder("details",((e,o,n)=>e.and(w.default).and(h.default).style("view-type-chapter-bulk-create-chapter").tweak((a=>{a.state.value=o.open,a.state.subscribeManual((e=>{e&&n.closeAllSiblings((e=>e!==a)),o.open=e})),de.use(a,(e=>{e&&(a.state.value=!1)})),a.style.bind(a.state.falsy,"view-type-chapter-bulk-create-chapter--closed"),Object.assign(a,{header:a.summary.style("block-header")}),a.summary.style("view-type-chapter-bulk-create-chapter-summary").style.bind(a.state,"view-type-chapter-bulk-create-chapter-summary--open").style.bind(a.state.falsy,"view-type-chapter-bulk-create-chapter-summary--closed").style.bind(o.body.map(a.summary,(e=>"Patreon"===e.visibility)),"view-type-chapter-bulk-create-chapter-summary--patreon").style.bind(o.body.map(a.summary,(e=>"Private"===e.visibility)),"view-type-chapter-bulk-create-chapter-summary--private").append(M.default.using(W.default.Use(a.summary,{number:n.number,body:o.body}),((e,{number:t,body:o})=>q(t.url,_||o.name||(e=>e[t.url.includes(".")?"view/chapter/number/interlude/label":"view/chapter/number/label"](t.url))).style.remove("slot").append("Patreon"===o.visibility&&o.tier_ids?.length?(0,f.default)().style("view-type-chapter-bulk-create-chapter-summary-patreon","patreon-icon-before").text.use(d.default.translateTiers(o.tier_ids,c.default.Auth.account?.value?.patreon_campaign?.tiers??[])):void 0).append("Private"!==o.visibility?void 0:(0,O.default)().style("view-type-chapter-bulk-create-chapter-summary-private").text.use("view/chapter-create-bulk/create/visibility/private"))))).event.subscribe("click",(e=>{const t=document.activeElement?.component?.closest(g.default);if(t===i)return e.preventDefault(),i.setChecked(!i.checked.value),a.element.scrollIntoView({behavior:"smooth"}),void e.host.focus();e.targetComponent?.closest(g.default)===e.host&&de.value&&(e.preventDefault(),i.setChecked(!i.checked.value))}));const i=(0,y.default)().style("view-type-chapter-bulk-create-chapter-summary-checkbox").setChecked(o.selected).attributes.bind(de,"inert").tweak((e=>e.checked.subscribeManual((e=>{o.selected=e,se.emit()})))).event.subscribe("click",(e=>e.stopPropagation())).prependTo(a.summary);a.style.bind(W.default.Every(e,de,i.checked.falsy),"view-type-chapter-bulk-create-chapter--has-selected-sibling"),a.state.matchManual(!0,(async()=>{const e=j.default.Content(o.body,t,n.number).appendTo(a);e.state.useManual((e=>{V.default.deepEquals(e,o.body.value)||(o.body.asMutable?.setValue(e),se.emit())})),e.numbered.selection.subscribe(a,(e=>{J.emit()})),await U.default.yield(),a.element.scrollIntoView()})),e.onRooted((async()=>{if(!pe)return;Date.now()-pe.time>300?pe=void 0:n.index.value===pe.index&&(pe=void 0,await U.default.yield(),a.summary.focus())}))})).extend((e=>({chapter:o,index:n.index}))))).setName("ChapterDetails"),me=(0,C.Tab)().text.use("view/chapter-create-bulk/create/tab").bindDisabled(se.length.falsy,"no chapters").bindDisabled(H.truthy,"uploading or done").addTo(Y);(0,h.default)().type("flush").style("view-type-chapter-bulk-block","view-type-chapter-bulk-block--not-last").tweak((e=>e.title.text.use("view/chapter-create-bulk/create/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/create/description"))).tweak((e=>e.content.style("view-type-chapter-bulk-create").append(z()).append((0,S.default)().use(se,((e,o)=>fe(o,{index:e.index,number:W.default.Map(e,[e.index,J],((e,o)=>{const n=o?.relative_to??t.last_chapter??"0";let a=parseInt(n)||0,i=+n-a;"before"===o?.position&&(i?i=Math.max(0,i-1):a=Math.max(0,a-1));for(let t=0;t<=e;t++){se.value[t].body.value.is_numbered??1?(a++,i=0):i++}return{chapterNumber:a,interludeNumber:i,url:`${a}${i?`.${i}`:""}`}})),closeAllSiblings(t){for(const o of e.wrapper.getDescendants(fe))t&&!t(o)||(o.chapter.open=!1,o.state.value=!1)}})))).appendWhen(se.length.truthy,(0,v.default)().style("view-type-chapter-bulk-create-selection-actions").tweak((e=>e.left.appendWhen(ce,(0,g.default)().setIcon("square-check").type("flush").text.use("view/chapter-create-bulk/shared/action/select-all").event.subscribe("click",(()=>{for(let e=0;e<se.length.value;e++){const t=se.value[e];t.selected||(t.selected=!0,se.emitItem(e))}se.emit()}))).appendWhen(de,(0,g.default)().setIcon("square-minus").type("flush").text.use("view/chapter-create-bulk/shared/action/deselect-all").event.subscribe("click",(()=>{for(let e=0;e<se.length.value;e++){const t=se.value[e];t.selected&&(t.selected=!1,se.emitItem(e))}se.emit()}))))).appendWhen(de,(0,w.default)().style("view-type-chapter-bulk-create-selection-actions-details").tweak((e=>e.summary.style("view-type-chapter-bulk-create-selection-actions-summary").type("flush").setIcon("ellipsis-vertical").text.use("view/chapter-create-bulk/create/action/actions"))).append((0,C.default)().style("view-type-chapter-bulk-create-selection-actions-details-tabinator").allowNoneVisible().tweak((e=>{function t(e){const t=n(e),o=Math.max(0,L.default.isIncrementing(t)?Math.min(...t)-1:Math.min(...t));pe={index:o,time:Date.now()},se.moveAt(t,o)}function o(e){const t=n(e),o=Math.min(se.length.value-1,L.default.isIncrementing(t)?Math.min(...t)+1:Math.max(...t)-t.length+1);pe={index:o,time:Date.now()},se.moveAt(t,o)}function n(e){const t=e?.targetComponent?.parent?.as(fe)?.chapter,o=se.value.indexOf(t);return se.value.entries().filter((([,e])=>e.selected)).map((([e])=>e)).toArray().concat(...-1===o?[]:[o]).distinctInPlace().sort(((e,t)=>e-t))}de.subscribe(e,(t=>{t||e.showNone()})),e.addTab((0,C.Tab)().text.use("view/chapter-create-bulk/create/action/tab/visibility").tweak((e=>{e.content.style("view-type-chapter-bulk-create-selection-actions-details-tabinator-tab-content");const t=(0,k.default)().appendTo(e.content),{visibility:o,patreonTiers:n}=(0,$.default)(t,(0,W.default)(void 0));se.use(o,(e=>{const t=e.filter((e=>e.selected)).map((e=>e.body.value.visibility)).distinct();o.default.set(1===t.length?t[0]:null)})),(0,v.default)().style("view-type-chapter-bulk-create-selection-actions-details-tabinator-tab-content-actions").tweak((e=>e.right.append((0,g.default)().type("primary").text.use("view/chapter-create-bulk/create/action/apply").event.subscribe("click",(()=>{if(o.selection.value){for(let e=0;e<se.length.value;e++){const t=se.value[e];t.selected&&(t.body.value.visibility=o.selection.value,t.body.value.tier_ids=n?.selection.value,se.emitItem(e))}se.emit()}}))))).appendTo(e.content)}))),e.addTab((0,C.Tab)().text.use("view/chapter-create-bulk/create/action/tab/movement").tweak((e=>{e.content.style("view-type-chapter-bulk-create-selection-actions-details-tabinator-tab-content"),(0,v.default)().tweak((e=>e.left.append((0,g.default)().type("primary").setIcon("arrow-up").text.use("view/chapter-create-bulk/create/action/move-up").event.subscribe("click",(()=>t()))))).tweak((e=>e.left.append((0,g.default)().type("primary").setIcon("arrow-down").text.use("view/chapter-create-bulk/create/action/move-down").event.subscribe("click",(()=>o()))))).appendTo(e.content)}))),e.header.append((0,g.default)().style("view-type-chapter-bulk-create-selection-actions-details-right-button").setIcon("xmark").type("flush").text.use("view/chapter-create-bulk/create/action/remove").event.subscribe("click",(async e=>{const t=se.value.filter((e=>e.selected));await b.default.prompt(e.host,{bodyTranslation:e=>e["view/chapter-create-bulk/create/action/remove/confirm"](t.map((e=>e.body.value.name||"")).slice(0,5),Math.max(0,t.length-5))})&&se.filterInPlace((e=>!e.selected))}))),A.default.until(e,(e=>e.subscribe("down",(e=>{e.use("ArrowUp","ctrl")&&t(e),e.use("ArrowDown","ctrl")&&o(e)}))))}))))).append((0,v.default)().style("view-type-chapter-bulk-step-action-row").tweak((e=>e.right.append(me.createNextButton())))))).appendToWhen(H.falsy,me.content);const ve=(0,C.Tab)().text.use("view/chapter-create-bulk/upload/tab").bindDisabled(se.length.falsy,"no chapters").addTo(Y);return(0,h.default)().type("flush").style("view-type-chapter-bulk-block").tweak((e=>e.title.text.use("view/chapter-create-bulk/upload/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/upload/description"))).tweak((e=>{const i=W.default.Async(e,H,(async(i,l,u)=>{if(!i||i.done)return;u(0,(e=>e["view/chapter-create-bulk/upload/loading/clearing"]()));const s=await o.default.query({params:p.default.reference(t)});if(toast.handleError(s))return r();for(let e=0;e<i.chapters.length;e++){if(l.aborted)return;const o=i.chapters[e];u(e/(i.chapters.length+2),(t=>t["view/chapter-create-bulk/upload/loading/queuing"](o.body.value.name||"",e,i.chapters.length)));const n=await a.default.query({params:p.default.reference(t),body:{name:o.body.value.name||"",body:o.body.value.body,visibility:o.body.value.visibility,is_numbered:o.body.value.is_numbered,notes_before:o.body.value.notes_before,notes_after:o.body.value.notes_after}});if(toast.handleError(n))return r()}if(l.aborted)return;u((i.chapters.length+1)/(i.chapters.length+2),(e=>e["view/chapter-create-bulk/upload/loading/finishing"]()));if(!await b.default.ensureDangerToken(e,{dangerToken:"chapter-create-bulk"}))return r();const d=await n.default.query({params:p.default.reference(t),body:{position:i.position&&{relative_to:i.position.relative_to,position:i.position.position},chapters:i.chapters.map((e=>({tier_ids:e.body.value.tier_ids,custom_tags:e.body.value.custom_tags,global_tags:e.body.value.global_tags})))}});if(toast.handleError(d))return r();H.value={done:!0}}));function r(){H.value=void 0,e.element.scrollIntoView()}(0,f.default)().style("view-type-chapter-bulk-import-list-wrapper").append((0,f.default)().style("view-type-chapter-bulk-import-list").appendWhen(H.map(e,(e=>!1===e?.done)),(0,x.default)().use(i).style("view-type-chapter-bulk-import-list-loading")).appendWhen(H.falsy,(0,f.default)().style("view-type-chapter-bulk-upload-box").append((0,g.default)().type("primary").text.use("view/chapter-create-bulk/upload/action/upload").event.subscribe("click",(()=>H.value={chapters:se.value,position:J.value,done:!1})))).appendWhen(H.map(e,(e=>!!e?.done)),(0,f.default)().style("view-type-chapter-bulk-upload-box").append((0,E.default)().text.use("view/chapter-create-bulk/upload/notice/complete"),(0,g.default)().type("primary").text.use((e=>e["view/chapter-create-bulk/upload/action/return"](t.name))).event.subscribe("click",(()=>navigate.toURL(`/work/${t.author_vanity}/${t.work_vanity}`)))))).appendTo(e.content)})).appendToWhen(se.length.truthy,ve.content),u}})})),define("ui/view/chapter/ChapterEditForm",["require","exports","endpoint/chapters/$author_vanity/$work_vanity/$chapter_url/EndpointChapters$authorVanity$workVanity$chapterUrlUpdate","endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanityCreate","lang/en-nz","model/FormInputLengths","model/Session","model/Works","ui/Component","ui/component/core/Block","ui/component/core/Form","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/LabelledTable","ui/component/core/Placeholder","ui/component/core/RadioRow","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/core/toast/Toast","ui/component/TagsEditor","ui/component/VisibilityOptions","ui/component/WorkStatusDropdown","utility/Functions","utility/Objects","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,b,w,k,T,x,D){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D);const E=u.default.Builder(((e,t,o,n)=>{const a=e.and(f.default),r=t.map(e,(e=>{const t=O(e);return t?t.url:"N"})),l=n?n.map(e,(e=>e.url.includes(".")?t=>t["view/chapter/number/interlude/label"](e.url):t=>t["view/chapter/number/label"](e.chapterNumber))):r.map(e,(e=>e.includes(".")?t=>t["view/chapter/number/interlude/label"](e):t=>t["view/chapter/number/label"](_||parseInt(e)||(o.chapter_count?o.chapter_count+1:0)||"N"))),u=(0,v.default)().add("numbered",(e=>e.text.use("view/chapter-edit/shared/form/type/numbered").append((0,m.default)().style("view-type-chapter-edit-type-example").text.bind(n?n.map(e,(e=>t=>t["view/chapter-edit/shared/form/type/numbered/example"](e.chapterNumber))):r.map(e,(e=>t=>t["view/chapter-edit/shared/form/type/numbered/example"](T.default.resolve((()=>e.includes(".")?parseInt(e)+1:parseInt(e)||(o.chapter_count?o.chapter_count+1:0)||"N"))))))))).add("other",(e=>e.text.use("view/chapter-edit/shared/form/type/other").append((0,m.default)().style("view-type-chapter-edit-type-example").text.use("view/chapter-edit/shared/form/type/other/example")))).default.bind(t.map(e,(e=>!1===e?.is_numbered?"other":"numbered")));a.label((e=>e.text.use("view/chapter-edit/shared/form/type/label"))).content(((e,t)=>e.append(u.setLabel(t))));const s=(0,g.default)().default.bind(t.map(e,(e=>e?.name||""))).hint.use("view/chapter-edit/shared/form/name/hint").placeholder.bind(l).setMaxLength(i.default.map(a,(e=>e?.chapter?.name)));a.label((e=>e.text.use("view/chapter-edit/shared/form/name/label"))).content(((e,t)=>e.append(s.setLabel(t))));const d=(0,b.default)().default.bind(t).setMaxLengthGlobal(i.default.map(a,(e=>e?.work_tags?.global))).setMaxLengthCustom(i.default.map(a,(e=>e?.work_tags?.custom)));a.label((e=>e.text.use("view/chapter-edit/shared/form/tags/label"))).content(((e,t)=>e.append(d.setLabel(t))));const c=(0,h.default)().default.bind(t.map(e,(e=>e?.notes_before??void 0))).hint.use("view/chapter-edit/shared/form/notes/hint").setMaxLength(i.default.map(a,(e=>e?.chapter?.notes))).setDefaultToolbarVisibility(!1);a.label((e=>e.text.use("view/chapter-edit/shared/form/notes/label"))).content(((e,t)=>e.append(c.setLabel(t))));const p=(0,h.default)().default.bind(t.map(e,(e=>e?.body??void 0))).hint.use("view/chapter-edit/shared/form/body/hint");a.label((e=>e.text.use("view/chapter-edit/shared/form/body/label"))).content(((e,t)=>e.append(p.setLabel(t))));const y=(0,h.default)().default.bind(t.map(e,(e=>e?.notes_after??void 0))).hint.use("view/chapter-edit/shared/form/notes/hint").setMaxLength(i.default.map(a,(e=>e?.chapter?.notes))).setDefaultToolbarVisibility(!1);a.label((e=>e.text.use("view/chapter-edit/shared/form/notes/label"))).content(((e,t)=>e.append(y.setLabel(t))));const{patreonTiers:k,visibility:E}=(0,w.default)(a,t.map(a,(e=>({patreonEnabled:!0,visibility:e?.visibility??"Private",...M(e)}))));e.onRooted((()=>{c.ready(),p.ready(),y.ready()}));const S=D.default.Use(e,{name:s.state.map(e,(e=>e||!1)),body:p.content,notes_before:c.content,notes_after:y.content,visibility:E.selection.coalesce("Private"),global_tags:d.state.mapManual((e=>e.global_tags)),custom_tags:d.state.mapManual((e=>e.custom_tags)),is_numbered:u.selection.equals("numbered"),tier_ids:k?.selection});return a.extend((e=>({state:S,numbered:u,hasUnsavedChanges:I})));function I(){if(!t.value)return!0;const e=S.value,o=x.default.keys(e).filter((e=>"custom_tags"!==e&&"global_tags"!==e&&"tier_ids"!==e));for(const n of o){let o=e[n],a=t.value[n];if(""===o&&(a??=""),""===a&&(o??=""),"string"==typeof o&&(o=o.trim()),"string"==typeof a&&(a=a.trim()),o!==a)return!0}const n=e.tier_ids??[],a=O(t.value)?.patreon?.tiers.map((e=>e.tier_id))??[];return n.length!==a.length||(!!n.some((e=>!a.includes(e)))||((e.custom_tags?.length??0)!==(t.value.custom_tags?.length??0)||(!!e.custom_tags?.some((e=>!t.value?.custom_tags?.includes(e)))||((e.global_tags?.length??0)!==(t.value.global_tags?.length??0)||!!e.global_tags?.some((e=>!t.value?.global_tags?.includes(e)))))))}})),O=e=>e&&"url"in e?e:void 0,M=e=>{if(!e)return;const t=e;return t.patreon?{patreonTiers:t.patreon.tiers.map((e=>e.tier_id))}:{patreonTiers:t.tier_ids}},S=Object.assign(u.default.Builder(((e,t,i)=>{const f=e.and(s.default),m=f.and(d.default,f.title);m.viewTransition("chapter-edit-form");const v=t.value?"update":"create";m.title.text.use(`view/chapter-edit/${v}/title`),t.use(m,(e=>m.setName(a.default[`view/chapter-edit/${v}/title`](O(e)?.url).toString()))),m.submit.textWrapper.text.use(`view/chapter-edit/${v}/submit`);const h=E(t,i).appendTo(m.content),g=(0,u.default)().style("view-type-chapter-edit-work-changes").appendTo(m.content);(0,c.default)().style("view-type-chapter-edit-work-changes-heading").text.use((e=>e["view/chapter-edit/shared/form/work/heading"](i.name))).appendTo(g);const _=k.default.Radio(i.status);return(0,p.default)().tweak((e=>e.label.style("view-type-chapter-edit-work-changes-status-label").text.bind(_.selection.map(e,(e=>e===i.status?e=>e["view/chapter-edit/shared/form/work/status/label/no-change"]():e=>e["view/chapter-edit/shared/form/work/status/label/change"]()))))).tweak((e=>e.content.append(_))).appendTo(g),m.onSubmit((async e=>{await b()})),m.extend((e=>({hasUnsavedChanges:h.hasUnsavedChanges,save:b})));async function b(){const e=await(()=>{switch(v){case"create":return n.default.query({params:l.default.reference(i),body:{...h.state.value,work:{status:_.selection.value}}});case"update":{const e=O(t.value);if(!e)return;const n=r.default.Auth.author.value?.vanity;return n?o.default.query({params:{...l.default.reference(i),chapter_url:e.url},body:{...h.state.value,work:{status:_.selection.value}}}):new Error("Cannot update a work when not signed in")}}})();toast.handleError(e,"view/chapter-edit/shared/toast/failed-to-save")||(toast.success(y.TOAST_SUCCESS,"view/chapter-edit/shared/toast/saved"),t.value=e?.data)}})),{Content:E});t.default=S})),define("ui/view/shared/component/PaginatedView",["require","exports","ui/Component","ui/component/core/Paginator","ui/view/shared/component/View"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder(((e,t)=>{let o;const i=[];return(0,a.default)(t).extend((e=>({setURL:r,paginator:()=>(o??=(0,n.default)().extend((e=>({setURL:r}))),o.onReset(null,(()=>{i.length=0})),o.page.subscribeManual((e=>{const t=i[e];t&&navigate.setURL(t)})),o)})));function r(e){void 0!==e&&navigate.setURL(e);const t=o?.page.value;void 0!==t&&(i[t]=e)}}));t.default=i})),define("ui/view/ChapterEditView",["require","exports","endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanity$chapterUrl","endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanityList","endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityGet","model/Chapters","model/PagedData","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Link","ui/component/Work","ui/view/chapter/ChapterEditForm","ui/view/shared/component/PaginatedView","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTitle","utility/State","utility/Type"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g);const y=Symbol("NEW_CHAPTER");t.default=(0,m.default)({requiresLogin:!0,async load(e){const t=e.chapter_url?await o.default.query({params:e}):void 0;if(t instanceof Error)throw t;const n=await a.default.query({params:i.default.work(e)});if(n instanceof Error)throw n;return n.data.author!==l.default.Auth.author.value?.vanity&&navigate.toURL(`/work/${n.data.author}/${n.data.vanity}${e.chapter_url?`/chapter/${e.chapter_url}`:""}`),{initialChapterResponse:t,work:n.data}},create(e,{initialChapterResponse:t,work:o}){const a="chapter-edit",l=(0,f.default)(a),m=o.synopsis?.mentions.find((t=>t.vanity===e.author_vanity));delete o.synopsis,delete o.custom_tags,(0,d.default)(`/work/${m?.vanity}/${o.work_vanity}`).and(c.default,o,m).viewTransition("chapter-view-work").style("view-type-chapter-work").setContainsHeading().appendTo(l.content);const _=(0,h.default)((g.default.as("number",t?.page_count)??o.chapter_count??0)+1),b=r.default.fromEndpoint(n.default.prep({params:e}),(e=>e===_.value-1?y:null));t&&b.set(t.page,t.data,!t.has_more),b.pageCount.use(l,(e=>{void 0!==e&&b.setPageCount(!0)}));const w=t?.page??_.value-1,k={},T=l.paginator().type("flush").setScroll(((e,t,o)=>{if(!o.previousScrollRect)return;const n=o.scrollRect.height,a=o.previousScrollRect.height,i=Math.max(o.scrollRect.top,o.previousScrollRect.top);window.scrollTo({top:i+(n-a),behavior:"instant"})})).set(b,w,(async(e,t,n,r,l)=>{k[n]?.remove();const d=k[n]=(0,u.default)(),c=(0,h.default)(t===y?void 0:t);c.subscribe(d,(e=>r.set(n,e??y))),c.use(d,(e=>{l.page.value===n&&(l.setURL(e?`/work/${o.author_vanity}/${o.work_vanity}/chapter/${e.url}/edit`:`/work/${o.author_vanity}/${o.work_vanity}/chapter/new`),e&&n===_.value-1&&_.value++)}));const f=(0,p.default)(c,o).tweak((e=>e.title.and(v.default))).subviewTransition(a).appendTo(e);l.page.use(d,((e,t)=>{c.value&&t===n&&e!==t&&f.hasUnsavedChanges()&&f.save()})),c.value&&(0,s.default)().setIcon("trash").text.use("view/chapter-edit/update/action/delete").event.subscribe("click",(async e=>{const t=c.value;if(!t)return;await i.default.delete(t,e.host)&&(b.delete(n),b.unset(n,_.value),_.value--,n>=_.value-2?await navigate.toURL(`/work/${t.author}/${t.work}`):l.page.emit(n-1))})).appendTo(f.footer.left)})).appendTo(l.content);return(0,s.default)().setIcon("angles-right").type("icon").style("paginator-button").event.subscribe("click",(()=>T.page.value=_.value-1)).appendTo(T.footer.right),T.data.use(l,(e=>l.breadcrumbs.setBackButton(e!==y&&e?`/work/${o.author_vanity}/${o.work_vanity}/chapter/${e.url}`:`/work/${o.author_vanity}/${o.work_vanity}`,(t=>t.subText.set(e===y?o.name:e?.name))))),l}})})),define("endpoint/history/chapter/$author_vanity/$work_vanity/chapter/$chapter_url/EndpointHistoryChapter$authorVanity$workVanityChapter$chapterUrlAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/chapter/{author_vanity}/{work_vanity}/chapter/{chapter_url}/add","post").noResponse()})),define("endpoint/reactions/chapter/$author_vanity/$work_vanity/$chapter_url/$reaction_type/EndpointReactionsChapter$authorVanity$workVanity$chapterUrl$reactionTypeAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reactions/chapter/{author_vanity}/{work_vanity}/{chapter_url}/{reaction_type}/add","post").noResponse()})),define("endpoint/reactions/chapter/$author_vanity/$work_vanity/$chapter_url/$reaction_type/EndpointReactionsChapter$authorVanity$workVanity$chapterUrl$reactionTypeRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reactions/chapter/{author_vanity}/{work_vanity}/{chapter_url}/{reaction_type}/remove","post").noResponse()})),define("model/TextBody",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.resolve=function(e,t){return null==e?void 0:{body:"string"==typeof e?e:e.body,mentions:[...("string"==typeof e?void 0:e.mentions)??[],...t??[]].distinct((e=>e.vanity))}}}(o||(o={})),t.default=o})),define("endpoint/comments/$comment_id/EndpointComments$commentIdDescendants",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/{comment_id}/descendants","get")})),define("ui/component/CommentTree",["require","exports","endpoint/comments/$comment_id/EndpointComments$commentIdDescendants","model/Session","ui/Component","ui/component/Comment","ui/component/core/Block","ui/component/core/Button","ui/component/core/Loading","ui/component/core/Slot","ui/component/core/TextEditor","utility/AbortPromise","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p);const f=a.default.Builder(((e,t,a,f,m)=>{let v;const h=e.and(r.default).type("flush").style("comment-tree").viewTransition("comments").extend((e=>({tweakCommentEditor:t=>(v=t,e)}))),g=(0,p.default)(!1);return(0,s.default)().use(n.default.Auth.author,c.default.asyncFunction((async(e,n,r)=>{const u={comment_id:t,replyable:!0},c=(0,p.default)([u]),y=(0,p.default)(r?[r]:[]);r&&c.use(h,(e=>{if(!e[0].edit)return e.unshift({edit:!0,parent_id:t,author:r.vanity}),void c.emit();m?.onCommentsUpdate?.(e)}));const _=(0,p.default)(void 0);_.value=o.default.prep({params:{comment_id:t}}).query;const b=(0,i.default)({comments:c,authors:y,threadAuthor:a},u,{isRootComment:f,noSiblings:!0},m).appendTo(n);if(await k(),e.aborted)return;const w=c.value.filter((e=>!e.edit)).length<=1;async function k(){if(!_.value)return;g.value=!0;const e=await(_.value?.());if(g.value=!1,toast.handleError(e))throw e;if(y.value.push(...e.data.authors),y.emit(),c.value.push(...e.data.comments),c.emit(),_.value=e.next,v)for(const e of b.getDescendants(d.default))e.classes.has("_text-editor-tweaked")||(v(e),e.classes.add("_text-editor-tweaked"))}w&&m?.onNoComments?.(n),(0,s.default)().if(_.truthy,(()=>(0,l.default)().event.subscribe("click",k).text.set("load more"))).else((e=>!w&&m?.onCommentsEnd?.(e))).appendTo(n)}))).appendTo(h.content),(0,u.default)().style("comment-tree-loading").tweak((e=>e.enabled.value=!0)).appendToWhen(g,h.content),h}));t.default=f})),define("endpoint/auth/totp/EndpointAuthTotpVerify",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/totp/verify","post").noResponse()})),define("ui/view/LoginView",["require","exports","endpoint/auth/totp/EndpointAuthTotpVerify","model/Session","ui/Component","ui/component/auth/OAuthServices","ui/component/core/Button","ui/component/core/CodeInput","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/view/account/AccountViewForm","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTransition","utility/Errors","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v);const h=m.default.redirection("/account");t.default=(0,p.default)({async load(){if("logged-in"===n.default.Auth.state.value)return h();const e=(0,v.default)(n.default.Auth.state.value);return{state:e,services:await(0,i.default)(e)}},create(e,{state:t,services:i}){const p="login",m=(0,c.default)(p),v=navigate.isURL("/login");(0,d.default)("create").subviewTransition(p).appendToWhen(t.equals("has-authorisations"),m.content),i.subviewTransition(p).appendTo(m.content);const h=n.default.state.map(m,(e=>!!e?.partial_login?.totp_required&&!e.partial_login.additional_auth_services_required)),g=(0,l.default)().event.subscribe("Enter",(()=>y.element.click()));(0,a.default)().style("view-type-account-totp-login-wrapper").append((0,u.default)().append((0,s.default)().text.use("view/account/totp/login/description"))).append(g).appendToWhen(h,i.content);const y=(0,r.default)().type("primary").text.use("view/account/totp/login/action/login").event.subscribe("click",(async()=>{const e=await o.default.query({body:{token:g.state.value}});toast.handleError(e)||n.default.refresh()})).appendToWhen(h,i.footer.right);return i.footer.appendToWhen(h,i),n.default.Auth.state.subscribe(m,(()=>{v?f.default.perform("subview",p,_):_()})),v&&t.match(m,"logged-in",(()=>navigate.toURL("/account"))),m;function _(e=n.default.Auth.state.value){t.value=e}}})})),define("utility/Random",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.shuffle=function(e){for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e}}(o||(o={})),t.default=o})),define("endpoint/authors/EndpointAuthorsUpdateSettings",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/update-settings","post").noResponse()})),define("utility/Settings",["require","exports","endpoint/authors/EndpointAuthorsUpdateSettings","model/Session","utility/Define","utility/Functions","utility/State","utility/Store"],(function(e,t,o,n,a,i,r,l){var u;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),function(e){const t=[],u=r.default.JIT((()=>{const e=n.default.Auth.account.value?n.default.Auth.account.value?.settings:l.default.items.settings;return e?JSON.parse(e):{}})).observe(n.default.Auth.account);function s(e){return t.push({...e,settings:Object.values(e.settings).map((e=>{const t=()=>`${e.tag?`${i.default.resolve(e.tag)}:`:""}${e.name}`,s=u.mapManual((o=>o[t()]??e.default));return e.tweakState?.(s),a.default.magic(s,"value",{get:()=>r.default.getInternalValue(s),set:e=>{const a=u.value;if(e===a[t()])return;a[t()]=e??null;const i=n.default.Auth.account.value;i?(i.settings=JSON.stringify(a),n.default.Auth.account.emit(),o.default.query({body:{settings:i.settings}}),n.default.setAuthor(i)):l.default.items.settings=JSON.stringify(a)}}),Object.assign(e,{state:s})}))}),e.settings}e.boolean=function(e){return{...e,type:"boolean"}},e.string=function(e){return{...e,type:"string"}},e.number=function(e){return{...e,type:"number"}},e.get=function(){return t},e.registerGroup=function(e,t){return s({name:e,settings:t})},e.registerHiddenGroup=function(e,t){return s({name:e,settings:t,hidden:!0})}}(u||(u={})),Object.assign(window,{Settings:u}),t.default=u})),define("ui/view/ChapterView",["require","exports","endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanity$chapterUrl","endpoint/chapters/$author_vanity/$work_vanity/EndpointChapters$authorVanity$workVanityList","endpoint/history/chapter/$author_vanity/$work_vanity/chapter/$chapter_url/EndpointHistoryChapter$authorVanity$workVanityChapter$chapterUrlAdd","endpoint/reactions/chapter/$author_vanity/$work_vanity/$chapter_url/$reaction_type/EndpointReactionsChapter$authorVanity$workVanity$chapterUrl$reactionTypeAdd","endpoint/reactions/chapter/$author_vanity/$work_vanity/$chapter_url/$reaction_type/EndpointReactionsChapter$authorVanity$workVanity$chapterUrl$reactionTypeRemove","endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityGet","model/Chapters","model/PagedData","model/Patreon","model/Session","model/TextBody","ui/Component","ui/component/ActionBlock","ui/component/AuthorLink","ui/component/Chapter","ui/component/CommentTree","ui/component/core/Button","ui/component/core/Details","ui/component/core/ext/GradientText","ui/component/core/ExternalLink","ui/component/core/Heading","ui/component/core/Icon","ui/component/core/Link","ui/component/core/Slot","ui/component/PatronAuthDialog","ui/component/Reaction","ui/component/Statistics","ui/component/Tags","ui/component/Work","ui/utility/Viewport","ui/view/LoginView","ui/view/shared/component/PaginatedView","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTitle","utility/maths/Maths","utility/Objects","utility/Random","utility/Settings","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,b,w,k,T,x,D,E,O,M,S,I,C,R,$,P,A,j,N,q,B,L,V){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),E=__importDefault(E),O=__importDefault(O),M=__importDefault(M),S=__importDefault(S),I=__importDefault(I),C=__importDefault(C),R=__importDefault(R),$=__importDefault($),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N),q=__importDefault(q),B=__importDefault(B),L=__importDefault(L),V=__importDefault(V);const W=()=>R.default.state.value,G=e=>e.observeManual(R.default.state),U=L.default.registerGroup("settings/chapter/name",{fontSize:L.default.number({tag:W,tweakState:G,name:"settings/chapter/font-size/name",description:"settings/chapter/font-size/description",default:1,min:.5,max:3,step:.1}),lineHeight:L.default.number({tag:W,tweakState:G,name:"settings/chapter/line-height/name",description:"settings/chapter/line-height/description",default:1.4,min:1,max:3,step:.1}),paragraphGap:L.default.number({tag:W,tweakState:G,name:"settings/chapter/paragraph-gap/name",description:"settings/chapter/paragraph-gap/description",default:1,min:0,max:10,step:.5}),justified:L.default.boolean({tag:W,tweakState:G,name:"settings/chapter/text-align/name",description:"settings/chapter/text-align/description",default:!1})});t.default=(0,A.default)({async load(e){const t=await l.default.query({params:u.default.work(e)});if(t instanceof Error)throw t;const n=await o.default.query({params:e});if(n instanceof Error)throw"age_restriction"===n.type&&navigate.toURL(`/work/${e.author_vanity}/${e.work_vanity}`),n;return{workData:t.data,initialChapterResponse:n}},create(e,{workData:t,initialChapterResponse:o}){const l=(0,P.default)("chapter"),A=t.synopsis?.mentions.find((e=>e.vanity===t.author_vanity));delete t.synopsis,delete t.custom_tags,l.breadcrumbs.setBackButton(`/work/${t.author_vanity}/${t.work_vanity}`,(e=>e.subText.set(t.name)));const L=(0,C.default)(t,A).tweak((e=>e.statistics.remove())).tweak((e=>e.bookmarkActions.remove())).viewTransition("chapter-view-work").style("view-type-chapter-work").setContainsHeading().appendTo(l.content);(0,b.default)().style("view-type-chapter-work-details").tweak((e=>e.summary.type("flush").bindIcon(e.state.mapManual((e=>e?"caret-down":"caret-right"))).text.bind(e.state.mapManual((e=>t=>t[e?"view/chapter/work/action/hide-details":"view/chapter/work/action/expand-details"]()))))).tweak((e=>e.append(...L.content.getChildren()))).appendTo(L.content),(0,m.default)().viewTransition("chapter-view-work-actions").attachAbove().addActions(L).appendTo(l.content);const W=(0,V.default)(o.data),G=c.default.Auth.loggedInAs(l,t.author_vanity),F=W.mapManual((e=>!e.insufficient_pledge)),H=V.default.Some(l,G.truthy,F.falsy),Y=s.default.fromEndpoint(n.default.prep({params:u.default.work(e)}));Y.set(o.page,o.data,!o.has_more),Y.setPageCount(o.page_count);const J=l.paginator().viewTransition("chapter-view-chapter").style("view-type-chapter-block").style.bindVariable("chapter-font-size-multiplier",U.fontSize.state).style.bindVariable("chapter-line-height",U.lineHeight.state).style.bindVariable("chapter-paragraph-gap-multiplier",U.paragraphGap.state).style.bindVariable("align-left-preference",U.justified.state.map(l,(e=>e?"justify":"left"))).type("flush").event.subscribe("PageError",(()=>c.default.refresh())).tweak((e=>{const t=W.mapManual((e=>e.url)),o=W.mapManual((e=>e.name)),n=t.mapManual((e=>N.default.parseIntOrUndefined(e)));e.title.and(j.default).style("view-type-chapter-block-title").text.bind(V.default.MapManual([o,t,n],((e,t,o)=>_||e||(o?e=>e["view/chapter/number/label"](o):void 0)||(t?.includes(".")?e=>e["view/chapter/number/interlude/label"](t):void 0)))),e.primaryActions.style("view-type-chapter-block-actions"),(0,E.default)().if(V.default.Every(e,o.truthy,n.mapManual((e=>void 0!==e))),(()=>(0,T.default)().setAestheticStyle(!1).style("view-type-chapter-block-number-label").style.bind(o.falsy,"view-type-chapter-block-number-label--auto-named-chapter").text.bind(n.mapManual((e=>t=>t["view/chapter/number/label"](e)))))).prependTo(e.header)})).appendTo(l.content).set(Y,o.page,((o,n,i,r,l)=>{l.setURL(`/work/${t.author_vanity}/${t.work_vanity}/chapter/${n.url}`),c.default.Auth.loggedIn.value&&a.default.query({params:{...e,chapter_url:n.url}}),n.statistics&&(0,S.default)().style("view-type-chapter-block-author-statistics").section("shared/stat/section/logged-in",(e=>e.stat("chapter/stat/reads/label",n.statistics?.read_count).stat("chapter/stat/hearts/label",n.statistics?.reaction_count).stat("chapter/stat/comments/label",n.statistics?.comment_count))).section("shared/stat/section/logged-out",(e=>e.stat("chapter/stat/visits/label",n.statistics?.visits?BigInt(n.statistics.visits):void 0))).appendTo(o),(n.notes_before||n.global_tags?.length||n.custom_tags?.length)&&(0,f.default)().style("view-type-chapter-block-notes","view-type-chapter-block-notes-before").setMarkdownContent(p.default.resolve(n.notes_before,n.mentions)).prepend(n.notes_before&&(0,f.default)().style("view-type-chapter-block-notes-label").text.use("view/chapter/notes/label")).append((n.global_tags?.length||n.custom_tags?.length)&&(0,f.default)().style("view-type-chapter-block-notes-label","view-type-chapter-block-tags-title").text.use("view/chapter/tags/label")).append((0,I.default)().set(n).style("view-type-chapter-block-tags")).appendTo(o);const u="Patreon"===n.visibility||"Patreon"==t.visibility,s=d.default.getMoreRestrictive(n.patreon?.tiers,t.patreon?.tiers);u&&(0,E.default)().if(H,(()=>(0,f.default)().style("view-type-chapter-block-patreon-header").append((0,f.default)().style("view-type-chapter-block-patreon-header-label").text.use("view/chapter/patreon/label")).append((0,T.default)().style("view-type-chapter-block-patreon-header-title").setAestheticStyle(!1).removeContents().append((0,f.default)().text.use(d.default.translateTier(s[0])),(0,E.default)().style.remove("slot").style("view-type-chapter-block-patreon-header-actions").if(G.falsy,(e=>{s&&(0,E.default)().if(c.default.Auth.loggedIn,(e=>{(0,y.default)().style("view-type-chapter-block-patreon-header-button").text.bind(c.default.Auth.account.map(e,(e=>e?.patreon_patron?t=>t["view/chapter/action/unlink-patreon"](e.patreon_patron.display_name):e=>e["view/chapter/action/auth-to-patreon"]()))).event.subscribe("click",(()=>O.default.auth(e))).appendTo(e),(0,k.default)(n.patreon?.campaign.url).and(y.default).attributes.remove("type").style("view-type-chapter-block-patreon-header-button").text.use("view/chapter/action/become-patron").appendTo(e)})).else((()=>(0,y.default)().type("primary").style("view-type-chapter-block-patreon-header-button").text.use("view/chapter/action/login").event.subscribe("click",(()=>navigate.ephemeral($.default,void 0))))).appendTo(e)})))))).appendTo(o),(0,f.default)().style("view-type-chapter-block-body").setMarkdownContent(n.body??"").appendTo(o),n.notes_after&&(0,f.default)().style("view-type-chapter-block-notes","view-type-chapter-block-notes-after").setMarkdownContent(p.default.resolve(n.notes_after,n.mentions)).prepend(n.notes_after&&(0,f.default)().style("view-type-chapter-block-notes-label").text.use("view/chapter/notes/label")).appendTo(o),(0,E.default)().if(G,(()=>u&&(0,f.default)().style("view-type-chapter-block-patreon-footer"))).appendTo(o)}));J.header.style("view-type-chapter-block-header"),J.content.style("view-type-chapter-block-content"),(0,E.default)().appendTo(J.primaryActions).use(W,((e,o)=>{const n=(0,h.default)(o,t,A??{vanity:t.author_vanity}).setOwner(e);(0,m.default)().flush().addActions(n).appendTo(e)}));const z=W.mapManual((e=>e.reactions??0)),K=W.mapManual((e=>e.guest_reactions??0)),Q=W.mapManual((e=>e.supporter_reactions?.length??0)),X=W.mapManual((e=>!!e.reacted&&!!c.default.Auth.author.value)),Z=W.mapManual((e=>!!e.reacted&&!c.default.Auth.author.value)),ee=W.mapManual((e=>!!e.supporter_reactions?.some((e=>e?.author===c.default.Auth.author.value?.vanity)))),te=(0,V.default)(!1),oe=(0,V.default)(!1),ne=(0,V.default)(!1),ae=()=>(0,E.default)().style.remove("slot").style("reaction-button-list").if(F,(e=>(0,E.default)().appendWhen(Q.map(e,(e=>!!e||!!c.default.Auth.author.value?.supporter?.tier)),(0,M.default)("supporter_love",Q,ee,oe).tweak((e=>e.icon.setDisabled(!c.default.Auth.author.value?.supporter?.tier,"not a supporter"))).and(w.default,"heart-gradient","115deg").useGradient(c.default.Auth.author.map(e,(e=>e?.supporter?.username_colours))).setTooltip((e=>{(0,f.default)().text.use("chapter/reaction/supporter-heart").appendTo(e);const t=(0,E.default)().style.remove("slot").appendTo(e);t.use(W,((e,o)=>{if(!o.supporter_reactions?.length)return;const n=B.default.shuffle(o.supporter_reactions),a=o.supporter_reactions.length<9;if(t.style("view-type-chapter-block-supporter-reaction-list").style.toggle(a,"view-type-chapter-block-supporter-reaction-list--detailed").style.toggle(!a,"view-type-chapter-block-supporter-reaction-list--compressed"),a)for(const t of n){const n=o.mentions?.find((e=>e.vanity===t?.author));n&&(0,f.default)().style("view-type-chapter-block-supporter-reaction-detailed").append((0,x.default)("supporter-heart").style("view-type-chapter-block-supporter-reaction").and(w.default,"heart-gradient","115deg").useGradient(n?.supporter?.username_colours)).append((0,v.default)(n)).appendTo(e)}else for(const t of n)(0,x.default)("supporter-heart").style("view-type-chapter-block-supporter-reaction").and(w.default,"heart-gradient","115deg").useGradient(o.mentions?.find((e=>e.vanity===t?.author))?.supporter?.username_colours).appendTo(e)}))})).event.subscribe("click",(async()=>{if(!c.default.Auth.loggedIn.value||oe.value)return;const e={...u.default.reference(W.value),type:"supporter_love"};if(ee.value){oe.value=!0;const t=await r.default.query({params:{...e,reaction_type:"supporter_love"}});if(oe.value=!1,toast.handleError(t))return;W.value.supporter_reactions?.filterInPlace((e=>e?.author!==c.default.Auth.author.value?.vanity)),W.emit()}else{oe.value=!0;const t=await i.default.query({params:{...e,reaction_type:"supporter_love"}});if(oe.value=!1,toast.handleError(t))return;(W.value.supporter_reactions??=[]).push({author:c.default.Auth.author.value.vanity,reaction_type:"heart"}),W.emit()}}))).appendWhen(z.map(e,(e=>!!e||!!c.default.Auth.author.value)),(0,M.default)("love",z,X,te).tweak((e=>e.icon.setDisabled(!c.default.Auth.author.value,"not logged in"))).setTooltip((e=>e.text.use("chapter/reaction/normal-heart"))).event.subscribe("click",(async()=>{if(!c.default.Auth.loggedIn.value||te.value)return;const e={...u.default.reference(W.value),type:"love"};if(X.value){te.value=!0;const t=await r.default.query({params:{...e,reaction_type:"love"}});if(te.value=!1,toast.handleError(t))return;delete W.value.reacted,W.value.reactions&&W.value.reactions--,W.emit()}else{te.value=!0;const t=await i.default.query({params:{...e,reaction_type:"love"}});if(te.value=!1,toast.handleError(t))return;W.value.reacted=!0,W.value.reactions??=0,W.value.reactions++,W.emit()}}))).appendWhen(K.map(e,(e=>!!e||!c.default.Auth.author.value)),(0,M.default)("guest_heart",K,Z,ne).tweak((e=>e.icon.setDisabled(!!c.default.Auth.author.value,"not a guest"))).setTooltip((e=>e.text.use("chapter/reaction/guest-heart"))).event.subscribe("click",(async()=>{if(c.default.Auth.loggedIn.value||ne.value)return;const e={...u.default.reference(W.value),type:"love"};if(Z.value){ne.value=!0;const t=await r.default.query({params:{...e,reaction_type:"love"}});if(ne.value=!1,toast.handleError(t))return;delete W.value.reacted,W.value.guest_reactions&&W.value.guest_reactions--,W.emit()}else{ne.value=!0;const t=await i.default.query({params:{...e,reaction_type:"love"}});if(ne.value=!1,toast.handleError(t))return;W.value.reacted=!0,W.value.guest_reactions??=0,W.value.guest_reactions++,W.emit()}})))));for(const e of[J.footer,J.headerActions])e.style("view-type-chapter-block-paginator-actions"),(0,D.default)(`/work/${t.author_vanity}/${t.work_vanity}`).and(y.default).type("flush").text.use("chapter/action/index").appendTo(e.middle),ae().appendToWhen(R.default.mobile.falsy,e.middle),ae().style.toggle(e===J.footer,"reaction-button-list--footer").appendToWhen(R.default.mobile.truthy,e);J.data.use(J,(e=>W.value=e));const ie=W.mapManual((e=>!e.root_comment||e.insufficient_pledge?void 0:{threadId:e.root_comment,threadAuthor:e.author}),q.default.deepEquals);return(0,E.default)().use(ie,((e,t)=>{if(t)return(0,g.default)(t.threadId,t.threadAuthor,!0)})).appendTo(l.content),l}})})),define("ui/view/ContactView",["require","exports","ui/component/core/Block","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.default=(0,a.default)({create(){const e=(0,n.default)("contact");return(0,o.default)().tweak((e=>e.title.text.use("document/contact/title"))).tweak((e=>e.content.useMarkdownContent("document/contact"))).appendTo(e.content),e}})})),define("ui/view/debug/ButtonRegistry",["require","exports","model/Session","utility/Env"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),t.BUTTON_REGISTRY=void 0,o=__importDefault(o),n=__importDefault(n),t.BUTTON_REGISTRY={createAuthor:{name:"Create Author",async execute(e,t,a,i,r,l,u,s,d){const c=await fetch(`${n.default.API_ORIGIN}author/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:e,vanity:t,age:a,description:i,pronouns:r,feedback_preference_critique:l,feedback_preference_dont_hold_back:u,feedback_preference_typos:s,license:d})}).then((e=>e.json()));console.log(c),await o.default.refresh()}},updateAuthor:{name:"Update Author",async execute(e,t,o,a,i,r,l,u,s,d){await fetch(`${n.default.API_ORIGIN}author/update`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:e,description:t,age:o,vanity:a,support_link:i,support_message:r,feedback_preference_critique:l,feedback_preference_dont_hold_back:u,feedback_preference_typos:s,license:d})})}},deleteAuthor:{name:"Delete Author",async execute(){await fetch(`${n.default.API_ORIGIN}author/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},viewAuthor:{name:"View Author",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}author/${t}/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,o)}},clearSession:{name:"Clear Session",async execute(){await fetch(`${n.default.API_ORIGIN}session/reset`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}),await o.default.refresh()}},createWork:{name:"Create Work",async execute(e,t,o,a,i,r,l,u,s,d,c,p){const f=await fetch(`${n.default.API_ORIGIN}work/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,synopsis:t,description:o,vanity:a,status:i,visibility:r,global_tags:l,custom_tags:u,feedback_preference_critique:s,feedback_preference_dont_hold_back:d,feedback_preference_typos:c,license:p})}).then((e=>e.json()));console.log(f)}},updateWork:{name:"Update Work",async execute(e,t,o,a,i,r,l,u,s,d,c){await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,description:a,vanity:i,status:r,visibility:l,feedback_preference_critique:u,feedback_preference_dont_hold_back:s,feedback_preference_typos:d,license:c})})}},deleteWork:{name:"Delete Work",async execute(e,t){await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},viewWork:{name:"View Work",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}work/${t}/${o}/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,a)}},getWorkFeedback:{name:"Get Work Feedback",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}work/${t}/${o}/feedback`,{credentials:"include"}).then((e=>e.json()));console.log(e,a)}},getAllWorksByAuthor:{name:"View All Works By Author",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}works/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(e,o)}},createChapter:{name:"Create Chapter",async execute(e,t,o,a,i,r,l,u,s,d){const c=await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/chapter/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,body:a,visibility:i,is_numbered:r,notes_before:l,notes_after:u,global_tags:s,custom_tags:d})}).then((e=>e.json()));console.log(c)}},updateChapter:{name:"Update Chapter",async execute(e,t,o,a,i,r,l,u,s,d,c){const p=await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,body:i,visibility:r,is_numbered:l,notes_before:u,notes_after:s,global_tags:d,custom_tags:c})}).then((e=>e.json()));console.log(p)}},deleteChapter:{name:"Delete Chapter",async execute(e,t,o){await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},viewChapter:{name:"View Chapter",async execute(e,t,o,a){const i=await fetch(`${n.default.API_ORIGIN}work/${t}/${o}/chapter/${a}/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,i)}},viewChapterPaginated:{name:"View Chapter Paginated",async execute(e,t,o,a){const i=await fetch(`${n.default.API_ORIGIN}work/${t}/${o}/chapters/individual?page=${a}`,{credentials:"include"}).then((e=>e.json()));console.log(e,i)}},getAllChapters:{name:"Get All Chapters",async execute(e,t,o=0){const a=await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/chapters/list?page=${o}`,{credentials:"include"}).then((e=>e.json()));console.log(a)}},follow:{name:"Follow",async execute(e,t){await fetch(`${n.default.API_ORIGIN}follow/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},followWork:{name:"Follow",async execute(e,t){await fetch(`${n.default.API_ORIGIN}follow/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unfollow:{name:"Unfollow",async execute(e,t){await fetch(`${n.default.API_ORIGIN}unfollow/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unfollowWork:{name:"Unfollow",async execute(e,t){await fetch(`${n.default.API_ORIGIN}unfollow/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},getFollow:{name:"Get Follow",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}follows/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getFollowWork:{name:"Get Follow",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}follows/work/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllFollows:{name:"Get All Follows",async execute(e,t=0){const o=await fetch(`${n.default.API_ORIGIN}following/${e}?page=${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllFollowsMerged:{name:"Get All Follows Merged",async execute(e=0){const t=await fetch(`${n.default.API_ORIGIN}following?page=${e}`,{credentials:"include"}).then((e=>e.json()));console.log(t)}},ignore:{name:"Ignore",async execute(e,t){await fetch(`${n.default.API_ORIGIN}ignore/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},ignoreWork:{name:"Ignore",async execute(e,t){await fetch(`${n.default.API_ORIGIN}ignore/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unignore:{name:"Unignore",async execute(e,t){await fetch(`${n.default.API_ORIGIN}unignore/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unignoreWork:{name:"Unignore",async execute(e,t){await fetch(`${n.default.API_ORIGIN}unignore/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},getIgnore:{name:"Get Ignore",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}ignores/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getIgnoreWork:{name:"Get Ignore",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}ignores/work/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllIgnores:{name:"Get All Ignores",async execute(e,t=0){const o=await fetch(`${n.default.API_ORIGIN}ignoring/${e}?page=${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllIgnoresMerged:{name:"Get All Ignores Merged",async execute(e=0){const t=await fetch(`${n.default.API_ORIGIN}ignoring?page=${e}`,{credentials:"include"}).then((e=>e.json()));console.log(t)}},privilegeGetAllAuthor:{name:"Get All Author Privileges",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}privilege/get/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(e,o)}},privilegeGrantAuthor:{name:"Grant Privileges to Author",async execute(e,...t){const o=await fetch(`${n.default.API_ORIGIN}privilege/grant/author/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("granted privileges",o)}},privilegeRevokeAuthor:{name:"Revoke Privileges from Author",async execute(e,...t){const o=await fetch(`${n.default.API_ORIGIN}privilege/revoke/author/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("revoked privileges",o)}},createRole:{name:"Create Role",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}role/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,below:o,description:"idk some test stuff",visibilty:t})}).then((e=>e.json()));console.log("created role",a)}},deleteRole:{name:"Delete Role",async execute(e){const t=await fetch(`${n.default.API_ORIGIN}role/delete/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log("deleted role",t)}},editRole:{name:"Edit Role",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}role/update/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:o})}).then((e=>e.json()));console.log("edited role",a)}},grantRoleToAuthor:{name:"Grant Role to Author",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}role/grant/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log("granted role",o)}},revokeRoleFromAuthor:{name:"Revoke Role from Author",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}role/revoke/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log("granted role",o)}},privilegeGrantRole:{name:"Grant Privileges to Role",async execute(e,...t){const o=await fetch(`${n.default.API_ORIGIN}privilege/grant/role/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("granted privileges to role",o)}},privilegeRevokeRole:{name:"Revoke Privileges from Role",async execute(e,...t){const o=await fetch(`${n.default.API_ORIGIN}privilege/revoke/role/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("revoked privileges from role",o)}},roleListAll:{name:"List all roles",async execute(e){const t=await fetch(`${n.default.API_ORIGIN}role/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,t)}},roleReorder:{name:"Reorder roles",async execute(...e){const t=await fetch(`${n.default.API_ORIGIN}role/reorder`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({roles:e})}).then((e=>e.json()));console.log("reordered roles",t)}},createCommentChapter:{name:"Create Comment Chapter",async execute(e,t,o,a,i){const r=await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/comment/add`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({body:a,parent_id:i})}).then((e=>e.json()));console.log(r)}},updateCommentChapter:{name:"Update Comment Chapter",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}comment/update/chapter`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:e,body:t})}).then((e=>e.json()));console.log(o)}},deleteCommentChapter:{name:"Delete Comment Chapter",async execute(e){await fetch(`${n.default.API_ORIGIN}comment/remove/chapter`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:e})})}},getComment:{name:"Get Comment",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}comment/get`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:e})}).then((e=>e.json()));console.log(t,o)}},getAllComments:{name:"Get All Comments",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/comments`,{credentials:"include"}).then((e=>e.json()));console.log(a)}},patreonGetTiers:{name:"Get Tiers",async execute(e){const t=await fetch(`${n.default.API_ORIGIN}patreon/campaign/tiers/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,t)}},patreonSetThresholds:{name:"Set Chapter Thresholds",async execute(e,t,o,a,i){const r=await fetch(`${n.default.API_ORIGIN}patreon/campaign/tiers/set/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({visibility:o,chapters:a,tier_id:i})}).then((e=>e.json()));console.log(r)}},tagCreateCategory:{name:"Tag Create Category",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}tag/create/category`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,description:t})}).then((e=>e.json()));console.log(o)}},tagCreateGlobal:{name:"Tag Create Global",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}tag/create/global`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,description:t,category:o})}).then((e=>e.json()));console.log(a)}},tagPromoteCustom:{name:"Tag Promote Custom",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}tag/promote/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:t,category:o})}).then((e=>e.json()));console.log(a)}},tagDemoteGlobal:{name:"Tag Demote Global",async execute(e){const t=await fetch(`${n.default.API_ORIGIN}tag/demote/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(t)}},tagUpdateCategory:{name:"Tag Update Category",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}tag/update/category/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:o})}).then((e=>e.json()));console.log(a)}},tagUpdateGlobal:{name:"Tag Update Global",async execute(e,t,o,a){const i=await fetch(`${n.default.API_ORIGIN}tag/update/global/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:o,category:a})}).then((e=>e.json()));console.log(i)}},tagRemoveCategory:{name:"Tag Remove Category",async execute(e){const t=await fetch(`${n.default.API_ORIGIN}tag/remove/category/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(t)}},tagRemoveGlobal:{name:"Tag Remove Global",async execute(e){const t=await fetch(`${n.default.API_ORIGIN}tag/remove/global/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(t)}},tagGetManifest:{name:"Tag Get Manifest",async execute(){const e=await fetch(`${n.default.API_ORIGIN}manifest/tags`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},manifestFormLengthGet:{name:"Form Length Manifest",async execute(){const e=await fetch(`${n.default.API_ORIGIN}manifest/form/lengths`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},notificationsGet:{name:"Get Notifications",async execute(){const e=await fetch(`${n.default.API_ORIGIN}notifications/get/all`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},notificationsGetUnread:{name:"Get Unread Notifications",async execute(){const e=await fetch(`${n.default.API_ORIGIN}notifications/get/unread`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},notificationsMark:{name:"Mark Notifications Read/Unread",async execute(e,t){await fetch(`${n.default.API_ORIGIN}notifications/mark/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({notification_ids:t})})}},seedBulk:{name:"Seed Bulk",async execute(){await fetch(`${n.default.API_ORIGIN}seed/bulk`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},feedGet:{name:"Get Feed",async execute(){const e=await fetch(`${n.default.API_ORIGIN}feed/get`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},grantSupporter:{name:"Grant supporter",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}moderation/supporter/grant/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({months:t})}).then((e=>e.json()));console.log(o)}},supporterTest:{name:"supporter test",async execute(e){console.log("button is working");const t=new URLSearchParams({amount:`${e}`}),o=await fetch(`${n.default.API_ORIGIN}supporter/checkout/single?${t.toString()}`,{method:"GET",credentials:"include"}).then((e=>e.json()));console.log(o)}},supporterStatusPatreon:{name:"supporter status patreon",async execute(){console.log("button is working");const e=await fetch(`${n.default.API_ORIGIN}supporter/status/patreon`,{method:"GET",credentials:"include"}).then((e=>e.json()));console.log(e)}},workLock:{name:"work lock",async execute(e,t,o){const a=await fetch(`${n.default.API_ORIGIN}moderation/work/${e}/${t}/lock`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:o})}).then((e=>e.json()));console.log(a)}},workUnlock:{name:"work unlock",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}moderation/work/${e}/${t}/unlock`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(o)}},workCensor:{name:"work unlock",async execute(e,t){const o=await fetch(`${n.default.API_ORIGIN}moderation/work/${e}/${t}/unlock`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(o)}}}})),define("ui/view/DebugView",["require","exports","endpoint/auth/EndpointAuthServices","model/Session","ui/Component","ui/component/core/Button","ui/utility/StringApplicator","ui/view/debug/ButtonRegistry","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Env","utility/Objects","utility/Popup"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p);const f=a.default.Builder((e=>e.style("debug-block")));t.default=(0,s.default)({async create(){const e=(0,u.default)("debug"),t=(e,...t)=>(0,i.default)().text.set(e.name).event.subscribe("click",(async()=>{try{await e.execute(...t)}catch(t){const o=t;console.warn(`Button ${e.name} failed to execute:`,o)}})),a=f().appendTo(e.content),s=await o.default.query();for(const e of c.default.values(s.data??{})){if(!e)continue;const t=(0,p.default)({translation:r.Quilt.fake(`OAuth ${e.name}`),url:e.url_begin,width:600,height:900});(0,i.default)().text.set(`OAuth ${e.name}`).event.subscribe("click",(async()=>{await t.show(a).toastError(),await n.default.refresh()})).appendTo(a),(0,i.default)().text.set(`UnOAuth ${e.name}`).event.subscribe("click",(async()=>{const t=n.default.Auth.get(e.id)?.id;void 0!==t&&await fetch(`${d.default.API_ORIGIN}auth/remove`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:t})})})).appendTo(a)}a.append(t(l.BUTTON_REGISTRY.clearSession));const m=f().appendTo(e.content);m.append(t({name:"Seed Bulk Data",async execute(){await l.BUTTON_REGISTRY.seedBulk.execute()}})),m.append(t({name:"Create Profile 1",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("prolific author","somanystories","sixteen_plus",'wow a description that mentions <mention vanity="somanystories">',"she/her pronies m8"),await l.BUTTON_REGISTRY.createWork.execute("a debut work",'pretty decent by <mention vanity="somanystories">',"short description","debut","Complete","Public"),await l.BUTTON_REGISTRY.createChapter.execute("somanystories","debut","chapter 1","woo look it's prolific author's first story!","Public"),await l.BUTTON_REGISTRY.createWork.execute("sequel to debut","wow they wrote a sequel","sequel short description","sequel","Ongoing","Public"),await l.BUTTON_REGISTRY.createChapter.execute("somanystories","sequel","the chapters","pretend there's a story here","Public"),await l.BUTTON_REGISTRY.createWork.execute("work in progress","test","short description test","wip","Ongoing","Private"),await l.BUTTON_REGISTRY.createChapter.execute("somanystories","wip","draft","it's a rough draft","Private"),await l.BUTTON_REGISTRY.viewWork.execute("work","somanystories","debut"),await l.BUTTON_REGISTRY.viewWork.execute("work","somanystories","sequel"),await l.BUTTON_REGISTRY.viewWork.execute("work","somanystories","wip"),await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("all works","somanystories")}})),m.append(t({name:"View Profile 1",async execute(){await l.BUTTON_REGISTRY.viewAuthor.execute("author with many stories","somanystories"),await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("all works","somanystories")}})),m.append(t({name:"Create Profile 2",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("single story author","justonestory","sixteen_plus",'<mention vanity="somanystories"> writes so much',"she/her",!1,void 0,!0),await l.BUTTON_REGISTRY.createWork.execute("one big work",'made by <mention vanity="justonestory">',"wow description","bigstory","Ongoing","Public",["Protagonist: Transgender","Genre: Fantasy","Genre: Romance","Setting: Urban Fantasy"],["Just A Test Work lmao","Gotta Add Some custom tags","apparently (these) are allowed?"],void 0,void 0,!1),await l.BUTTON_REGISTRY.getWorkFeedback.execute("feedback:","justonestory","bigstory"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 1","start of a long story","Public"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story interlude","middle of a long story","Public",!1,"only notes before"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 2","aaaa","Public",!0,void 0,"only notes after"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3","aaaaaaa","Public",!0,"both notes before","and notes after",[],["Capitalised Custom Tags","Capitalised Custom Tags Two","these are (also) allowed?"]),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3.1","aaaaaaaaaaaaaaaaaaa","Public",!1),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3.2","aaaaaaaaaaaaaaaaaaa","Private",!1),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3.3","aaaaaaaaaaaaaaaaaaa","Public");for(let e=4;e<50;e++)await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory",`big story ${e}`,"aaaaaaaaaaaaaaaaaaa","Public");await l.BUTTON_REGISTRY.updateChapter.execute("justonestory","bigstory",4,void 0,void 0,void 0,!1),await l.BUTTON_REGISTRY.updateAuthor.execute(void 0,void 0,"eighteen_plus")}})),m.append(t({name:"View Profile 2",async execute(){await l.BUTTON_REGISTRY.viewAuthor.execute("justonestory author","justonestory")}})),m.append(t({name:"View Profile 2's stories",async execute(){await l.BUTTON_REGISTRY.viewChapter.execute("","justonestory","bigstory",1),await l.BUTTON_REGISTRY.viewWork.execute("big story five chapters","justonestory","bigstory"),await l.BUTTON_REGISTRY.getAllChapters.execute("justonestory","bigstory",0),await l.BUTTON_REGISTRY.viewChapterPaginated.execute("0","justonestory","bigstory",0),await l.BUTTON_REGISTRY.viewChapterPaginated.execute("4 (3.1)","justonestory","bigstory",4),await l.BUTTON_REGISTRY.viewChapterPaginated.execute("6 (private)","justonestory","bigstory",6)}})),m.append(t({name:"Create licensed work",async execute(){await l.BUTTON_REGISTRY.createWork.execute("licensed work","wowowow","wawaawaw","licensed","Ongoing","Public",[],[],void 0,void 0,void 0,{name:"Test License",link:"https://fluff4.me"}),await l.BUTTON_REGISTRY.updateWork.execute("justonestory","licensed","post-update",void 0,void 0,void 0,void 0,void 0,void 0,void 0,{name:"wowowie",link:"https://www.youtube.com/"}),await l.BUTTON_REGISTRY.updateAuthor.execute(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,{name:"default license",link:"hasdfasjd"}),await l.BUTTON_REGISTRY.createWork.execute("licensed work 2","wowowow","wawaawaw","licensed2","Ongoing","Public",[],[],void 0,void 0,void 0)}})),m.append(t({name:"Grant Supporter",async execute(){await l.BUTTON_REGISTRY.grantSupporter.execute("brushly",5),await l.BUTTON_REGISTRY.grantSupporter.execute("lunafirewalk",-5),await l.BUTTON_REGISTRY.grantSupporter.execute("justonestory",9999)}}));const v=f().appendTo(e.content);v.append(t({name:"Test New Following",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("new follows","thefollower","sixteen_plus"),await l.BUTTON_REGISTRY.createWork.execute("wow a work","test pls ignore","pls ignore","wowawork","Ongoing","Public"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.follow.execute("author","thefollower"),await l.BUTTON_REGISTRY.followWork.execute("thefollower","wowawork"),await l.BUTTON_REGISTRY.getFollow.execute("author","thefollower"),await l.BUTTON_REGISTRY.getFollow.execute("author","thefollower"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(),await l.BUTTON_REGISTRY.unignoreWork.execute("thefollower","wowawork"),await l.BUTTON_REGISTRY.getFollowWork.execute("thefollower","wowawork")}})),v.append(t({name:"Create a work with loads of chapters",async execute(){await l.BUTTON_REGISTRY.createWork.execute("even longer story","aaaaaaaaa","short description aaaaa","wowbig","Ongoing","Public");for(let e=0;e<2e3;e++)await l.BUTTON_REGISTRY.createChapter.execute("justonestory","wowbig",`chapter ${e}`,`wow chapter body ${e}`,"Public")}})),v.append(t({name:"Follows testing",async execute(){await l.BUTTON_REGISTRY.getAllFollows.execute("work",0),await l.BUTTON_REGISTRY.getAllFollows.execute("work",1),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(0),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(1)}})),v.append(t({name:"Spam Create Follow Work Test",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("spam create works","manyworks","sixteen_plus");for(let e=0;e<100;e++)await l.BUTTON_REGISTRY.createWork.execute(`rapid story ${e}`,"aaaaaaaaa","rapid story aaaaa",`rapidstory${e}`,"Ongoing","Public"),await l.BUTTON_REGISTRY.follow.execute("work",`rapidstory${e}`)}})),v.append(t({name:"Test Ignore Endpoints",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("ignoring myself","ignorepls","sixteen_plus"),await l.BUTTON_REGISTRY.createWork.execute("to ignore","testing ignoring","test ignoring","worktoignore","Ongoing","Public"),await l.BUTTON_REGISTRY.ignore.execute("author","ignorepls"),await l.BUTTON_REGISTRY.ignore.execute("work","worktoignore"),await l.BUTTON_REGISTRY.getIgnore.execute("author","ignorepls"),await l.BUTTON_REGISTRY.getIgnore.execute("author","ignorepls"),await l.BUTTON_REGISTRY.getIgnore.execute("work","worktoignore"),await l.BUTTON_REGISTRY.getIgnore.execute("work","worktoignore"),await l.BUTTON_REGISTRY.getAllIgnores.execute("author"),await l.BUTTON_REGISTRY.getAllIgnores.execute("author"),await l.BUTTON_REGISTRY.getAllIgnores.execute("work"),await l.BUTTON_REGISTRY.getAllIgnoresMerged.execute(),await l.BUTTON_REGISTRY.getAllIgnoresMerged.execute()}}));const h=f().appendTo(e.content);h.append(t({name:"privileges initial test",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","WorkViewPrivate","PrivilegeViewAuthor"),await l.BUTTON_REGISTRY.privilegeGetAllAuthor.execute("privileges of somanystories","somanystories"),await l.BUTTON_REGISTRY.privilegeRevokeAuthor.execute("somanystories","WorkViewPrivate"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","RevokePrivilege"),await l.BUTTON_REGISTRY.privilegeRevokeAuthor.execute("somanystories","WorkViewPrivate"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","ThisPrivilegeDoesntExist"),await l.BUTTON_REGISTRY.privilegeGetAllAuthor.execute("privileges of somanystories","somanystories")}})),h.append(t({name:"grant privs for testing",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","PrivilegeRevoke","RoleCreate","RoleEdit","RoleDelete","RoleGrant","RoleRevoke","PrivilegeViewAuthor","RoleViewAll"),await l.BUTTON_REGISTRY.createRole.execute("TestingRevoke","Visible"),await l.BUTTON_REGISTRY.grantRoleToAuthor.execute("TestingRevoke","somanystories"),await l.BUTTON_REGISTRY.revokeRoleFromAuthor.execute("TestingRevoke","somanystories"),await l.BUTTON_REGISTRY.privilegeGrantRole.execute("TestingRevoke","ViewAllRoles"),await l.BUTTON_REGISTRY.privilegeRevokeRole.execute("TestingRevoke","ViewAllRoles"),await l.BUTTON_REGISTRY.deleteRole.execute("TestingRevoke"),await l.BUTTON_REGISTRY.createRole.execute("SecondAuthorRole","Visible"),await l.BUTTON_REGISTRY.grantRoleToAuthor.execute("SecondAuthorRole","justonestory"),await l.BUTTON_REGISTRY.privilegeGrantRole.execute("SecondAuthorRole","RoleEdit","RoleDelete","RoleCreate")}})),h.append(t({name:"second author test stuff",async execute(){await l.BUTTON_REGISTRY.createRole.execute("DontWork","Admin"),await l.BUTTON_REGISTRY.createRole.execute("DoWork","SecondAuthorRole"),await l.BUTTON_REGISTRY.editRole.execute("Admin","CantDoThis"),await l.BUTTON_REGISTRY.deleteRole.execute("SecondAuthorRole")}})),h.append(t({name:"see highest level",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","RoleViewAll","RoleGrant","RoleCreate"),await l.BUTTON_REGISTRY.createRole.execute("NotTopRole","Admin"),await l.BUTTON_REGISTRY.grantRoleToAuthor.execute("NotTopRole","somanystories"),await l.BUTTON_REGISTRY.roleListAll.execute("listing all roles"),await l.BUTTON_REGISTRY.roleListAll.execute("listing all roles")}})),h.append(t({name:"role reorder test",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","RoleViewAll","RoleGrant","RoleCreate"),await l.BUTTON_REGISTRY.createRole.execute("Role1","Visible","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role2","Visible","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role3","Hidden","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role4","Hidden","Admin"),await l.BUTTON_REGISTRY.roleReorder.execute("Role1","Role2","Role3","Role4")}}));const g=f().appendTo(e.content);g.append(t({name:"Make ten billion works",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("lots of works test","manyworks","sixteen_plus","test description"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("manyworks","TagGlobalCreate","TagGlobalDelete","TagGlobalUpdate","TagCategoryCreate","TagCategoryUpdate","TagCategoryDelete","TagPromote","TagDemote"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category One","the first test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Two","the second test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Three","the third test category"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag One","test tag 1","Category One"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Two","test tag 1","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Three","test tag 1","Category Three");for(let e=0;e<333;e++)await l.BUTTON_REGISTRY.createWork.execute(`work${e}`,`description no ${e} mentions <mention vanity="manyworks">\n"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."`,"Lorem ipsum dolor sit amet, consectetur adipiscing elit,",`testwork${e}`,"Ongoing","Public",["Category One: Tag One","Category Two: Tag Two","Category Three: Tag Three"],["custom tag one",`custom tag two ${e}`]);for(let e=0;e<333;e++)await l.BUTTON_REGISTRY.createChapter.execute("manyworks",`testwork${e}`,`chapter ${e}`,`it's a test chapter ${e}`,"Public")}})),g.append(t({name:"view ten billion works",async execute(){await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("many works","manyworks")}})),g.append(t({name:"admin list roles test (profile 1)",async execute(){await l.BUTTON_REGISTRY.createRole.execute("Role4","Hidden","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role3","Visible","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role2","Hidden","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role1","Visible","Admin"),await l.BUTTON_REGISTRY.roleListAll.execute("all roles admin")}})),g.append(t({name:"user list roles test (profile 2)",async execute(){await l.BUTTON_REGISTRY.roleListAll.execute("all roles user")}})),g.append(t({name:"Delete Author Test",async execute(){await l.BUTTON_REGISTRY.deleteAuthor.execute()}}));const y=f().appendTo(e.content);y.append(t({name:"Author 2 lots of comments",async execute(){await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","base comments 1"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","2","base comments 2"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","3","base comments 3"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","4","base comments 4"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","5","base comments 5"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1",'child comment <mention vanity="justonestory">',"6"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","child comment 2","6"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1",'child comment 3<mention vanity="justonestory">',"11"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1",'child comment 4<mention vanity="justonestory">',"12"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","base comment index 1"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","child comment 6","13"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","child comment 7","11"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","base comment index 1 again"),await l.BUTTON_REGISTRY.getAllComments.execute("justonestory","bigstory","1"),await l.BUTTON_REGISTRY.getComment.execute("1","get comment")}})),y.append(t({name:"Author 2 just get comments",async execute(){await l.BUTTON_REGISTRY.getAllComments.execute("justonestory","bigstory","1")}})),y.append(t({name:"Author 1 single comment ping",async execute(){await l.BUTTON_REGISTRY.createCommentChapter.execute("somanystories","debut","1","wow you write so many stories @somanystories how do you do it"),await l.BUTTON_REGISTRY.createCommentChapter.execute("somanystories","debut","1","@somanystories you're so @somanystories amazing"),await l.BUTTON_REGISTRY.getComment.execute("4"),await l.BUTTON_REGISTRY.getComment.execute("5"),await l.BUTTON_REGISTRY.updateCommentChapter.execute("4","okay done fawning over @somanystories now"),await l.BUTTON_REGISTRY.getComment.execute("4"),await l.BUTTON_REGISTRY.deleteCommentChapter.execute("5"),await l.BUTTON_REGISTRY.getComment.execute("5")}})),y.append(t({name:"try to delete author 1's comment",async execute(){await l.BUTTON_REGISTRY.deleteCommentChapter.execute("4"),await l.BUTTON_REGISTRY.getComment.execute("4")}}));const _=f().appendTo(e.content),b=(0,p.default)({translation:r.Quilt.fake("Campaign OAuth"),url:`${d.default.API_ORIGIN}auth/patreon/campaign/begin`,width:600,height:900});(0,i.default)().text.set("Campaign Test").event.subscribe("click",(async()=>{await b.show(_).toastError(),await n.default.refresh()})).appendTo(_),_.append(t({name:"create patreon author",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("has a campaign","patreonuser","sixteen_plus"),await l.BUTTON_REGISTRY.createWork.execute("patreon only story","test","short description test","exclusive","Ongoing","Public"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 1","hewwo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 2","hewwoo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 3","hewwooo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 4","hewwooo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 5","hewwooo","Private")}})),_.append(t({name:"get patreon tiers",async execute(){await l.BUTTON_REGISTRY.patreonGetTiers.execute("patreon tiers"),await l.BUTTON_REGISTRY.patreonGetTiers.execute("patreon tiers")}})),_.append(t({name:"set patreon chapters",async execute(){await l.BUTTON_REGISTRY.updateChapter.execute("patreonuser","exclusive",1,void 0,void 0,"Public"),await l.BUTTON_REGISTRY.patreonSetThresholds.execute("patreonuser","exclusive","Public",["2","3"]),await l.BUTTON_REGISTRY.patreonSetThresholds.execute("patreonuser","exclusive","Patreon",["4","5"],"4392761")}}));const w=(0,p.default)({translation:r.Quilt.fake("Patron OAuth"),url:`${d.default.API_ORIGIN}auth/patreon/patron/begin`,width:600,height:900});(0,i.default)().text.set("Patron Test").event.subscribe("click",(async()=>{await w.show(_).toastError(),await n.default.refresh()})).appendTo(_),_.append(t({name:"get patreon-only chapters",async execute(){await l.BUTTON_REGISTRY.viewChapter.execute("public:","patreonuser","exclusive",3),await l.BUTTON_REGISTRY.viewChapter.execute("public:","patreonuser","exclusive",3),await l.BUTTON_REGISTRY.viewChapter.execute("patreon:","patreonuser","exclusive",4),await l.BUTTON_REGISTRY.viewChapter.execute("patreon:","patreonuser","exclusive",4)}})),_.append(t({name:"update patreon-only chapters",async execute(){await l.BUTTON_REGISTRY.patreonSetThresholds.execute("patreonuser","exclusive","Public",["4"])}}));const k=f().appendTo(e.content);k.append(t({name:"Create Tag Author",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("tagging test","thetagger","sixteen_plus","test description"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("thetagger","TagGlobalCreate","TagGlobalDelete","TagGlobalUpdate","TagCategoryCreate","TagCategoryUpdate","TagCategoryDelete","TagPromote","TagDemote")}})),k.append(t({name:"Update Tag Author",async execute(){await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger"),await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger"),await l.BUTTON_REGISTRY.updateAuthor.execute("the tagger 2",'wow i\'m <mention vanity="thetagger">'),await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger"),await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger")}})),k.append(t({name:"Tag Create Test",async execute(){await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category One","the first test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Two","the second test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Three","the third test category"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag One",'test tag 1 <mention vanity="thetagger">',"Category One"),await l.BUTTON_REGISTRY.tagUpdateGlobal.execute("Category One: Tag One","Tag One Updated","test tag 1 updated","Category Two"),await l.BUTTON_REGISTRY.tagUpdateCategory.execute("Category One","Category One Updated","first test category updated"),await l.BUTTON_REGISTRY.tagRemoveCategory.execute("Category One Updated"),await l.BUTTON_REGISTRY.tagRemoveGlobal.execute("Category Two: Tag One Updated"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("tag conflict","conflicting","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("tag conflict","conflicting","Category Three"),await l.BUTTON_REGISTRY.tagUpdateGlobal.execute("Category Three: tag conflict",void 0,void 0,"Category Two")}})),k.append(t({name:"Work Tag Test",async execute(){await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Two","test tag 2","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Three","test tag 2","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Four","test tag 2","Category Two"),await l.BUTTON_REGISTRY.createWork.execute("Tag Test Work","test","desc test","testwork","Ongoing","Public",["Category Two: Tag Two","Category Two: Tag Three"],["custom tag 1","custom tag 2"]),await l.BUTTON_REGISTRY.createWork.execute("Tag Test Work Two","test2","desc test","testworktwo","Ongoing","Public",["Category Two: Tag Two","Category Two: Tag Three"],["custom tag 2","custom tag 3"]),await l.BUTTON_REGISTRY.viewWork.execute("work view 1","thetagger","testworktwo"),await l.BUTTON_REGISTRY.viewWork.execute("work view 2","thetagger","testworktwo"),await l.BUTTON_REGISTRY.updateWork.execute("thetagger","testworktwo","Test Work Two Updated"),await l.BUTTON_REGISTRY.viewWork.execute("work view 3","thetagger","testworktwo"),await l.BUTTON_REGISTRY.viewWork.execute("work view 4","thetagger","testworktwo"),await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("all works","thetagger")}})),k.append(t({name:"Chapter Tag Test",async execute(){await l.BUTTON_REGISTRY.createChapter.execute("thetagger","testworktwo","test chapter","test chapter body","Public",!0,void 0,void 0,["Category Two: Tag Two","Category Two: Tag Three"],["custom tag 2","custom tag 3","custom tag 4"]),await l.BUTTON_REGISTRY.viewChapter.execute("chapter","thetagger","testworktwo",1)}})),k.append(t({name:"Tag Promote/Demote",async execute(){await l.BUTTON_REGISTRY.tagPromoteCustom.execute("custom tag 1","test description","Category Two"),await l.BUTTON_REGISTRY.tagDemoteGlobal.execute("Category Two: Tag Three"),await l.BUTTON_REGISTRY.viewWork.execute("work view 3","thetagger","testwork"),await l.BUTTON_REGISTRY.viewWork.execute("work view 4","thetagger","testworktwo")}})),k.append(t({name:"manifest test",async execute(){await l.BUTTON_REGISTRY.tagGetManifest.execute()}})),k.append(t({name:"manifest test 2",async execute(){await l.BUTTON_REGISTRY.tagCreateGlobal.execute("extra tag","wow","Category Three"),await l.BUTTON_REGISTRY.tagGetManifest.execute()}})),k.append(t({name:"form length manifest",async execute(){await l.BUTTON_REGISTRY.manifestFormLengthGet.execute()}}));const T=f().appendTo(e.content);T.append(t({name:"Get Notifications",async execute(){await l.BUTTON_REGISTRY.notificationsGet.execute(),await l.BUTTON_REGISTRY.notificationsGetUnread.execute()}})),T.append(t({name:"Mark Notifications Read",async execute(){await l.BUTTON_REGISTRY.notificationsMark.execute("read",["ba397c1b-02e5-462c-b367-04b007d1f09a","d8830a0c-3e2c-4caa-ae4b-679a8c5cefa5"]),await l.BUTTON_REGISTRY.notificationsMark.execute("unread",["ba397c1b-02e5-462c-b367-04b007d1f09a","3b9781ea-d15d-4915-bbeb-4788ed734453"])}})),T.append(t({name:"Get Front Page Feed",async execute(){await l.BUTTON_REGISTRY.feedGet.execute()}})),T.append(t({name:"supporter test",async execute(){console.log("wow button"),await l.BUTTON_REGISTRY.supporterTest.execute(2e3)}})),T.append(t({name:"work lock",async execute(){await l.BUTTON_REGISTRY.workLock.execute("brushly","weirddrink","too stimulating"),await l.BUTTON_REGISTRY.workLock.execute("justonestory","bigstory","i dont like it")}})),T.append(t({name:"work unlock",async execute(){await l.BUTTON_REGISTRY.workUnlock.execute("brushly","weirddrink"),await l.BUTTON_REGISTRY.workUnlock.execute("justonestory","bigstory")}}));const x=f().appendTo(e.content),D=(0,p.default)({translation:r.Quilt.fake("Fluff Campaign OAuth"),url:`${d.default.API_ORIGIN}admin/auth/campaign/begin`,width:600,height:900});return(0,i.default)().text.set("Fluff Campaign Test").event.subscribe("click",(async()=>{await D.show(x).toastError(),await n.default.refresh()})).appendTo(x),x.append(t({name:"patreon status",async execute(){await l.BUTTON_REGISTRY.supporterStatusPatreon.execute()}})),e}})})),define("endpoint/comments/EndpointCommentsWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/work","get")})),define("endpoint/feed/get/EndpointFeedGetFollowed",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/feed/get/followed","get")})),define("ui/utility/DynamicDestination",["require","exports","ui/Component","ui/component/core/Slot","utility/State"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.default=function(e){const t=new Map,i=(0,o.default)().setOwner(e),r=(0,a.default)(void 0),l=(0,n.default)().setOwner(e);let u;r.subscribeManual((e=>{const o=(e?t.get(e):void 0)??i;try{if("moveBefore"in o.element)return void o.element.moveBefore(l.element,null)}catch{}o.element.insertBefore(l.element,null)}));const s={isInsertionDestination:!0,append:(...e)=>(l.append(...e),s),prepend:(...e)=>(l.prepend(...e),s),insert:(e,t,...o)=>(l.insert(e,t,...o),s),addDestination:(o,a)=>(t.set(o,(0,n.default)().setOwner(e).appendTo(a)),s),setStrategy(e){const t=a.default.Owner.create();return u?.(),u=t.remove,r.bind(t,e),s}};return s}})),define("ui/view/FeedView",["require","exports","endpoint/comments/EndpointCommentsWork","endpoint/feed/get/EndpointFeedGetFollowed","model/Follows","model/PagedData","ui/component/CommentList","ui/component/core/Button","ui/component/core/Link","ui/component/core/Tabinator","ui/component/WorkFeed","ui/utility/DynamicDestination","ui/utility/Viewport","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importStar(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),t.default=(0,m.default)({create:()=>{const e=(0,f.default)("feed");e.breadcrumbs.title.text.use("view/feed/main/title"),e.breadcrumbs.description.text.use("view/feed/main/description");const t=(0,v.default)(void 0);e.breadcrumbs.setRSSButton(t),(0,u.default)("/following").and(l.default).type("flush").style("breadcrumbs-actions-action").setIcon("bookmark").text.bind(a.default.map(e,(()=>e=>e["view/shared/info/following"](a.default.getTotalFollowing())))).appendTo(e.breadcrumbs.actions),(0,u.default)("/ignoring").and(l.default).type("flush").style("breadcrumbs-actions-action").setIcon("eye-slash").text.bind(a.default.map(e,(()=>e=>e["view/shared/info/ignoring"](a.default.getTotalIgnoring())))).appendTo(e.breadcrumbs.actions);const m=p.default.tablet,h=(0,s.default)().viewTransition("work-view-tabinator").tweak((e=>e.header.prependToWhen(m.truthy,e))).appendTo(e.content),g=(0,s.Tab)("works").text.use("view/feed/works/title").addTo(h);(0,d.default)().viewTransition("feed-view-feed").setFromEndpoint(n.default).tweak((e=>e.state.use(e,(e=>t.value=e?.rss_url)))).appendTo(g.content);const y=(0,s.Tab)("recommendations").text.use("view/feed/recommendations/title").addToWhen(m.truthy,h),_=i.default.fromEndpoint(o.default.prep(void 0,{following_only:!0})).map((e=>({comments:e.comments.map((e=>({data:e.comment,metadata:{context:{root_object:e.root_object,is_reply:e.is_reply||void 0}}}))),authors:e.authors,works:e.works,chapters:e.chapters})));return(0,r.default)().viewTransition("feed-view-comments").tweak((e=>e.paginator.style("view-type-work-comment-block"))).tweak((e=>e.paginator.header.style("view-type-work-comment-block-header"))).tweak((e=>e.paginator.title.setAestheticLevel(4).text.use("view/feed/recommendations/title"))).set({data:_,placeholder:e=>e.text.use("view/feed/recommendations/content/empty")}).appendTo((0,c.default)(e).addDestination("tab",y.content).addDestination("sidebar",e.sidebar).setStrategy(m.map(e,(e=>e?"tab":"sidebar")))),e}})})),define("endpoint/authors/resolve/EndpointAuthorsResolveFull",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/resolve/full","get")})),define("ui/view/following/FollowingAuthorsTab",["require","exports","endpoint/authors/resolve/EndpointAuthorsResolveFull","model/Follows","model/PagedListData","ui/Component","ui/component/ActionBlock","ui/component/Author","ui/component/core/Link","ui/component/core/Paginator","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","utility/AbortPromise","utility/Arrays","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),v=__importDefault(v);const h=i.default.Builder(((e,t)=>{const i=e.and(p.Tab,"authors").text.use("view/following/tab/authors").extend((e=>({}))),h=n.default.map(i,(e=>e?.[t].author??[]),((e,t)=>!!e==!!t&&e.length===t.length&&e.every((e=>t.some((t=>e.author===t.author))))));let g=0;return(0,c.default)().use(h,f.default.asyncFunction((async(e,n,i)=>{const c=(0,v.default)([]),p=(0,a.default)(25,{async get(e){const t=i.slice(25*e,25*(e+1))??[];if(!t.length)return null;const n=await o.default.query(void 0,{authors:t.map((e=>e.author)).filterInPlace(m.NonNullish)});return!toast.handleError(n)&&(c.value.push(...n.data.mentions),c.value.distinctInPlace((e=>e.vanity)),c.emit(),n.data.authors.sort(((e,o)=>t.findIndex((t=>t.author===e.vanity))-t.findIndex((e=>e.author===o.vanity)))))}});await p.get(0),(0,s.default)().type("flush").viewTransition(!1).set(p,0,((e,t)=>{for(const o of t){o.description.mentions=c.value;const t=(0,u.default)(`/author/${o.vanity}`).and(l.default,o).viewTransition(!1).appendTo(e);(0,r.default)().attachAbove().addActions(t).appendTo(e)}})).orElse((e=>(0,d.default)().text.use(`view/${t}/panel/authors/empty`).appendTo(e))).tweak((e=>e.page.asMutable?.setValue(g))).tweak((e=>e.page.use(n,(e=>g=e)))).appendTo(n)}))).appendTo(i.content),i}));t.default=h})),define("endpoint/feed/get/EndpointFeedGetAuthed",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/feed/get/authed","get")})),define("ui/view/SearchView",["require","exports","endpoint/feed/get/EndpointFeedGetAuthed","model/FormInputLengths","model/Session","model/Tags","model/Works","ui/component/core/Block","ui/component/core/Form","ui/component/core/LabelledTable","ui/component/core/Slot","ui/component/core/TextInput","ui/component/TagsEditor","ui/component/WorkFeed","ui/component/WorkStatusDropdown","ui/view/shared/component/PaginatedView","ui/view/shared/component/ViewDefinition","utility/Env","utility/Errors","utility/Objects","utility/State","utility/string/Strings"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w){Object.defineProperty(t,"__esModule",{value:!0}),t.createSearchParams=T,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importStar(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w);const k=y.default.redirection("/");function T(e){return Object.entries(e).filter((([e,t])=>null!=t&&""!==t&&(!Array.isArray(t)||t.length>0)&&("page"!==e||+t>0))).map((([e,t])=>[e,"string"==typeof t?t:JSON.stringify(t)])).collect((e=>new URLSearchParams(e.toObject()).toString()))}t.default=(0,h.default)({async load(){if("logged-in"!==a.default.Auth.state.value)return k()},create(){const e=(0,v.default)("search"),t=(0,b.default)(location.search.replaceAll("?",""));window.addEventListener("popstate",(()=>{t.value=location.search.replaceAll("?","")}));const a=(0,b.default)(void 0);return(0,d.default)().appendTo(e.content).use(t,((e,o)=>{const d=(0,l.default)().appendTo(e),f=d.and(u.default,d.title);f.title.text.use("view/search/title");const v=(0,s.default)().appendTo(f.content),h=e=>Array.isArray(e)&&e.every(i.default.isId),y=new URLSearchParams(`?${o}`).entries().toArray().toObject(),_={search:y.search,whitelist_tags:w.default.optionalParseJSON(y.whitelist_tags,h),blacklist_tags:w.default.optionalParseJSON(y.blacklist_tags,h),blacklisted_work_statuses:w.default.optionalParseJSON(y.blacklisted_work_statuses,(e=>Array.isArray(e)&&e.every((e=>"string"==typeof e&&r.WORK_STATUSES.includes(e))))),minimum_word_count:+y.minimum_word_count||void 0,maximum_word_count:+y.maximum_word_count||void 0,page:+y.page||void 0},b=(0,c.default)().setMaxLength(n.default.map(v,(e=>e?.feed_search?.search)));b.value=_.search||"",v.label((e=>e.text.use("view/search/input/text/label"))).content(((e,t)=>e.append(b.setLabel(t))));const k=(0,p.default)().setGlobalTagsOnly().globalHint.use("view/search/input/whitelist_tags/hint").setMaxLengthGlobal(n.default.map(v,(e=>e?.feed_search?.tag_whitelist)));k.state.value={global_tags:_.whitelist_tags??[],custom_tags:[]},v.label((e=>e.text.use("view/search/input/whitelist_tags/label"))).content(((e,t)=>e.append(k.setLabel(t))));const x=(0,p.default)().setGlobalTagsOnly().globalHint.use("view/search/input/blacklist_tags/hint").setMaxLengthGlobal(n.default.map(v,(e=>e?.feed_search?.tag_blacklist)));x.state.value={global_tags:_.blacklist_tags??[],custom_tags:[]},v.label((e=>e.text.use("view/search/input/blacklist_tags/label"))).content(((e,t)=>e.append(x.setLabel(t))));const D=(0,c.default)().filter(c.FilterFunction.NUMERIC);D.value=`${_.minimum_word_count??""}`,v.label((e=>e.text.use("view/search/input/minimum_word_count/label"))).content(((e,t)=>e.append(D.setLabel(t))));const E=(0,c.default)().filter(c.FilterFunction.NUMERIC);E.value=`${_.maximum_word_count??""}`,v.label((e=>e.text.use("view/search/input/maximum_word_count/label"))).content(((e,t)=>e.append(E.setLabel(t))));const O=m.default.Check(r.WORK_STATUSES.filter((e=>!_.blacklisted_work_statuses?.includes(e))));function M(e=!1){a.value={search:b.value.trim()||void 0,whitelist_tags:k.state.value.global_tags,blacklist_tags:x.state.value.global_tags,blacklisted_work_statuses:r.WORK_STATUSES.filter((e=>!O.selection.value?.includes(e))),minimum_word_count:!isNaN(+D.value)&&+D.value>99?+D.value:void 0,maximum_word_count:!isNaN(+E.value)&&+E.value>99&&+E.value>=(+D.value||0)?+E.value:void 0,page:e&&+_.page||0};const n=T(a.value);n!==o&&(o=n,t.setValueSilent(n),history.pushState(null,"",`${g.default.URL_ORIGIN}search${n?`?${n}`:""}`))}v.label((e=>e.text.use("view/search/input/statuses/label"))).content(((e,t)=>e.append(O.setLabel(t)))),f.submit.textWrapper.text.use("view/search/action/submit"),f.onSubmit((()=>M())),M(!0)})),e.paginator().and(f.default).tweak((e=>{e.headerActions,a.use(e,(t=>{e.setFromEndpoint(o.default.prep(void 0,t&&_.default.filterNullish(t)),t?.page||void 0)})),e.setPageHandler((o=>{const n=new URLSearchParams(t.value);0!==o?n.set("page",`${o}`):n.delete("page");const a=n.toString();e.setURL("/search"+(a?`?${a}`:""))}))})).appendTo(e.content),e}})})),define("ui/component/TagBlock",["require","exports","model/Follows","model/Session","model/Tags","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Popover","ui/component/core/Slot","ui/component/FollowingBookmark","ui/component/Tag","ui/view/SearchView","utility/AbortPromise","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),v=__importDefault(v),h=__importDefault(h);const g=i.default.Builder(((e,t,g)=>{const y=(0,h.default)(g);y.value||a.default.getManifest().then((e=>y.value=e));const _=a.default.toId(t),b=e.and(r.default).style("tag-block").extend((e=>({getActions(e,t){t.addFollowing(e,{isApplicable:n.default.Auth.loggedIn,isFollowing:o.default.map(e,(()=>o.default.followingTag(_))),isIgnoring:o.default.map(e,(()=>o.default.ignoringTag(_))),follow:()=>o.default.followTag(_),unfollow:()=>o.default.unfollowTag(_),ignore:()=>o.default.ignoreTag(_),unignore:()=>o.default.unignoreTag(_)})}})));b.header.style("tag-block-header"),(0,p.default)((e=>e.followingTag(_))).style("tag-block-following-bookmark").appendTo(b.header);const w=(0,i.default)().style("tag-block-info").prependTo(b.header),k=(0,f.default)(t).replaceElement(document.createElement("span")).style("tag-block-tag").tweak((e=>e.followingBookmark?.remove())).appendTo(w);k.categoryWrapper?.style("tag-block-tag-category"),k.nameWrapper.style("tag-block-tag-name"),b.content.style("tag-block-content"),(0,i.default)().style("tag-block-description").setMarkdownContent(t.description).appendTo(b.content);const T=e=>(0,f.default)(e).style("tag-block-relationship");t.aliases?.length&&(0,i.default)().style("tag-block-aliases").append((0,u.default)().style("tag-block-section-heading").setAestheticStyle(!1).text.use("tag/label/aliases")).append(...t.aliases?t.aliases.map(T):[]).appendTo(b.content);const x=e.getStateForClosest(d.default);async function D(e){const t=await a.default.resolve(e);if(!t.length)return[];const o=[];o.push(...t.slice(0,4).map(T));const n=t.slice(4);return n.length&&o.push((0,c.default)().if(x.falsy,(e=>e.append(...n.map(T))))),o}const E=a.default.toId(t),O=y.mapManual((e=>e?.relationships[E]??[]));(0,c.default)().appendTo(b.content).use(O,v.default.asyncFunction((async(e,t,o)=>o.length?(0,i.default)().style("tag-block-relationships").append((0,u.default)().style("tag-block-section-heading").setAestheticStyle(!1).text.use("tag/label/relationships-to")).append(...await D(o)):void 0)));const M=y.mapManual((e=>e?Object.entries(e.relationships).filter((([e,t])=>t.includes(E))).map((([e])=>e)):[]));return(0,c.default)().appendTo(b.content).use(M,v.default.asyncFunction((async(e,t,o)=>o.length?(0,i.default)().style("tag-block-relationships").append((0,u.default)().style("tag-block-section-heading").setAestheticStyle(!1).text.use("tag/label/relationships-from")).append(...await D(o)):void 0))),b.footer.style("tag-block-footer").append((0,s.default)(`/search?${(0,m.createSearchParams)({whitelist_tags:[_]})}`).and(l.default).style("tag-block-footer-button").text.use("tag/action/label/search")).appendToWhen(n.default.Auth.loggedIn,b),b}));t.default=g})),define("ui/view/following/FollowingTagsTab",["require","exports","model/Follows","model/Tags","ui/Component","ui/component/ActionBlock","ui/component/core/Link","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/TagBlock","utility/AbortPromise","utility/Arrays"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),d=__importDefault(d),c=__importDefault(c);const f=a.default.Builder(((e,t)=>{const a=e.and(s.Tab,"tags").text.use("view/following/tab/tags").extend((e=>({}))),f=o.default.map(a,(e=>e?.[t].tag??[]),((e,t)=>!!e==!!t&&e.length===t.length&&e.every((e=>t.some((t=>e.tag===t.tag))))));return(0,u.default)().use(f,c.default.asyncFunction((async(e,o,a)=>{const u=a.map((e=>e.tag)).filterInPlace(p.NonNullish),s=await n.default.resolve(u);if(s.sort(((e,t)=>u.indexOf(`${e.category}: ${e.name}`)-u.indexOf(`${t.category}: ${t.name}`))),!s.length)return(0,l.default)().text.use(`view/${t}/panel/tags/empty`).appendTo(o);for(const e of s){const t=(0,r.default)(`/tag/${e.category.toLowerCase()}/${e.name.toLowerCase()}`).and(d.default,e).viewTransition(!1).appendTo(o);(0,i.default)().attachAbove().addActions(t).appendTo(o)}}))).appendTo(a.content),a}));t.default=f})),define("endpoint/works/EndpointWorksResolve",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/resolve","get")})),define("ui/view/following/FollowingWorksTab",["require","exports","endpoint/works/EndpointWorksResolve","model/Follows","model/PagedListData","model/Works","ui/Component","ui/component/ActionBlock","ui/component/core/Link","ui/component/core/Paginator","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/Work","utility/AbortPromise","utility/Arrays","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h);const g=r.default.Builder(((e,t)=>{const r=e.and(p.Tab,"works").text.use("view/following/tab/works").extend((e=>({}))),g=n.default.map(r,(e=>e?.[t].work??[]),((e,t)=>!!e==!!t&&e.length===t.length&&e.every((e=>t.some((t=>e.work?.author_vanity===t.work?.author_vanity&&e.work?.work_vanity===t.work?.work_vanity))))));let y=0;return(0,c.default)().use(g,m.default.asyncFunction((async(e,n,r)=>{const c=(0,h.default)([]),p=(0,a.default)(25,{async get(e){const t=r.slice(25*e,25*(e+1))??[];if(!t.length)return null;const n=await o.default.query(void 0,{works:t.map((e=>i.default.reference(e.work))).filterInPlace(v.NonNullish)});return!toast.handleError(n)&&(c.value.push(...n.data.authors),c.value.distinctInPlace((e=>e.vanity)),c.emit(),n.data.works.sort(((e,o)=>t.findIndex((t=>t.work?.author_vanity===e.author_vanity&&t.work?.work_vanity===e.work_vanity))-t.findIndex((e=>e.work?.author_vanity===o.author_vanity&&e.work?.work_vanity===o.work_vanity)))))}});await p.get(0),(0,s.default)().type("flush").viewTransition(!1).set(p,0,((e,t)=>{for(const o of t){const t=(0,u.default)(`/work/${o.author_vanity}/${o.work_vanity}`).and(f.default,o,c.value.find((e=>e.vanity===o.author_vanity)),!0).viewTransition(!1).appendTo(e);(0,l.default)().attachAbove().addActions(t).appendTo(e)}})).orElse((e=>(0,d.default)().text.use(`view/${t}/panel/works/empty`).appendTo(e))).tweak((e=>e.page.asMutable?.setValue(y))).tweak((e=>e.page.use(n,(e=>y=e)))).appendTo(n)}))).appendTo(r.content),r}));t.default=g})),define("ui/view/FollowingView",["require","exports","ui/component/core/Tabinator","ui/view/following/FollowingAuthorsTab","ui/view/following/FollowingTagsTab","ui/view/following/FollowingWorksTab","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=(0,l.default)({create:({tab:e}={})=>{const t=(0,r.default)("following");return t.breadcrumbs.title.text.use("view/following/main/title"),t.breadcrumbs.description.text.use("view/following/main/description"),(0,o.default)().addTab((0,i.default)("following")).addTab((0,n.default)("following")).addTab((0,a.default)("following")).bindURL(e,(e=>`/following/${e??"works"}`)).appendTo(t.content),t}})})),define("endpoint/site/EndpointSiteStatus",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/site/status","get")})),define("model/SiteStatus",["require","exports","endpoint/site/EndpointSiteStatus","model/Manifest","utility/Time"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.default=(0,n.default)({valid:a.default.minutes(30),refresh:!0,cacheId:"status",get:()=>o.default.query(),orElse:()=>({fundraisers:[]})})})),define("ui/component/FundraiserBar",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=o.default.Builder(((e,t,n,a)=>{const i=e=>(0,o.default)().style("view-type-fundraiser-progress-bar-amount").text.use((t=>t[`fundraiser/amount-${a}`](e.toLocaleString(navigator.language))));return e.style("view-type-fundraiser-progress-bar").style.setVariable("fundraiser-progress",Math.min(1,t/n)).append((0,o.default)().style("view-type-fundraiser-progress-bar-background").append((0,o.default)().style("view-type-fundraiser-progress-bar-progress"))).append(i(Math.round(t/100))).append(i(Math.round(n/100)))}))})),define("ui/view/FundraiserView",["require","exports","model/SiteStatus","ui/Component","ui/component/core/Block","ui/component/core/Slot","ui/component/FundraiserBar","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),t.default=(0,u.default)({create(){const e=(0,l.default)("fundraiser");return(0,a.default)().tweak((e=>e.title.text.use("fundraiser/title"))).tweak((e=>e.content.append((0,i.default)().use(o.default,((e,t)=>{const o=t?.fundraisers[0];if(o)return(0,n.default)().style("view-type-fundraiser-progress-bar-wrapper").append((0,r.default)(o.monthly_income,1e5,"monthly")).append((0,r.default)(o.funds_raised,o.thresholds[0],"total").style("view-type-fundraiser-progress-bar--total"))}))).append((0,n.default)().useMarkdownContent("fundraiser/description")))).appendTo(e.content),e}})})),define("endpoint/history/EndpointHistoryAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/all","get")})),define("ui/view/HistoryView",["require","exports","endpoint/history/EndpointHistoryAll","model/Authors","model/PagedListData","model/Works","ui/component/Chapter","ui/component/core/Block","ui/component/core/Link","ui/component/core/Paginator","ui/component/Work","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),t.default=(0,p.default)({create:()=>{const e=(0,c.default)("history");return e.breadcrumbs.title.text.use("view/history/main/title"),e.breadcrumbs.description.text.use("view/history/main/description"),(0,s.default)().type("flush").set(a.default.fromEndpoint(25,o.default.prep(),(e=>({content:e.items,auxiliary:e}))),0,((e,t,o,a)=>{let s,c;e.style("history");for(let e=t.length-1;e>=0;e--){const o=t[e];o.chapter&&!i.default.equals(o.work,s)&&t.splice(e+1,0,{work:o.work,view_time:o.view_time}),!o.chapter&&i.default.equals(o.work,s)&&t.splice(e,1),s=o.work}for(const o of t){const t=i.default.resolve(o.work,a.works.value),s=n.default.resolve(t?.author_vanity,a.authors.value);t&&s&&(o.chapter?(0,r.default)({...o.chapter,time_last_update:o.view_time},t,s).style("history-chapter").appendTo(c??=(0,l.default)().style("history-chapter-block","chapter-list").tweak((e=>e.content.remove())).appendTo(e)):((0,u.default)(`/work/${s.vanity}/${t.work_vanity}`).and(d.default,{...t,time_last_update:o.view_time},s).style("history-work").appendTo(e),c=void 0))}})).appendTo(e.content),e}})})),define("ui/view/IgnoringView",["require","exports","ui/component/core/Tabinator","ui/view/following/FollowingAuthorsTab","ui/view/following/FollowingTagsTab","ui/view/following/FollowingWorksTab","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=(0,l.default)({create:({tab:e}={})=>{const t=(0,r.default)("ignoring");return t.breadcrumbs.title.text.use("view/ignoring/main/title"),t.breadcrumbs.description.text.use("view/ignoring/main/description"),(0,o.default)().addTab((0,i.default)("ignoring")).addTab((0,n.default)("ignoring")).addTab((0,a.default)("ignoring")).bindURL(e,(e=>`/ignoring/${e??"works"}`)).appendTo(t.content),t}})})),define("ui/view/LegalView",["require","exports","ui/component/core/Block","ui/component/core/Tabinator","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importStar(n),a=__importDefault(a),i=__importDefault(i),t.default=(0,i.default)({create({tab:e}={}){const t=(0,a.default)("legal"),i=(0,n.default)().appendTo(t.content);return(0,n.Tab)("terms").text.use("view/legal/terms-of-service/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/legal/terms-of-service/title"))).tweak((e=>e.content.useMarkdownContent("document/legal/terms-of-service/v0")))))).addTo(i),(0,n.Tab)("privacy").text.use("view/legal/privacy-policy/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/legal/privacy-policy/title"))).tweak((e=>e.content.useMarkdownContent("document/legal/privacy-policy/v0")))))).addTo(i),i.bindURL(e,(e=>e?`/legal/${e}`:"/legal")),i.bindViewTitle(),t}})})),define("endpoint/comments/moderation/all/EndpointCommentsModerationAllChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/moderation/all/chapter","get")})),define("endpoint/comments/moderation/all/EndpointCommentsModerationAllWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/moderation/all/work","get")})),define("ui/view/ManageCommentsView",["require","exports","endpoint/comments/moderation/all/EndpointCommentsModerationAllChapter","endpoint/comments/moderation/all/EndpointCommentsModerationAllWork","model/PagedData","model/Session","ui/component/CommentList","ui/component/core/Tabinator","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importStar(r),l=__importStar(l),u=__importDefault(u),s=__importDefault(s),t.default=(0,s.default)({create(e){if(!i.default.Auth.privileged.ModerationViewComments.value)return void navigate.toURL("/");const t=(0,u.default)("manage-comments"),s=(0,l.default)().appendTo(t.content),d=a.default.fromEndpoint(o.default.prep()).map((e=>({...e,comments:e.comments.map(r.ContextualComment.fromRaw)})));(0,l.Tab)("comments").text.use("view/manage-comments/tab/comments").setIcon("comment").tweak((e=>e.content.append((0,r.default)().viewTransition("author-view-comments").set({data:d})))).addTo(s);const c=a.default.fromEndpoint(n.default.prep()).map((e=>({...e,comments:e.comments.map(r.ContextualComment.fromRaw)})));return(0,l.Tab)("recommendations").text.use("view/manage-comments/tab/recommendations").setIcon("heart").tweak((e=>e.content.append((0,r.default)().viewTransition("author-view-comments").set({data:c})))).addTo(s),s.bindURL(e?.tab,(e=>e&&"comments"!==e?`/manage/comments/${e}`:"/manage/comments")),t}})})),define("endpoint/tags/EndpointTagsCustom",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/custom","get")})),define("endpoint/tags/custom/$custom_tag_name/EndpointTagsCustom$customTagNameRename",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/custom/{custom_tag_name}/rename","post")})),define("endpoint/tags/custom/EndpointTagsCustomDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/custom/delete","post").noResponse()})),define("endpoint/tags/custom/EndpointTagsCustomPromote",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/custom/promote","post")})),define("ui/view/tags/TagEditForm",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/Checkbutton","ui/component/core/Dropdown","ui/component/core/Form","ui/component/core/LabelledTable","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/TagsEditor","ui/utility/StringApplicator","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),p=__importDefault(p),t.default=n.default.Builder(((e,t,n)=>{const f=t.map(e,(e=>e?.tags[n]));let m,v,h,g,y,_,b;const w=e.and(r.default,null);return w.content.and(l.default).label((e=>e.text.use("view/manage-tags/global-tag-form/category/label"))).content(((e,o)=>e.append(m=(0,i.RadioDropdown)().setLabel(o).setRequired().tweak((e=>{t.use(e,(t=>{const o=e.selection.value;if(e.clear(),t){for(const o of Object.values(t.categories))e.add(o.nameLowercase,{translation:e=>c.Quilt.fake(o.name)});o&&o in e.options?e.selection.value=o:e.selection.value=f.value?.categoryLowercase}}))}))))).label((e=>e.text.use("view/manage-tags/global-tag-form/name/label"))).content(((e,t)=>e.append(v=(0,s.default)().setLabel(t).setRequired().setMaxLength(o.default.map(e,(e=>e?.global_tag?.name))).default.bind(f.mapManual((e=>e?.name)))))).label((e=>e.text.use("view/manage-tags/global-tag-form/description/label"))).content(((e,t)=>e.append(h=(0,u.default)().setLabel(t).setRequired().disablePersistence().setMaxLength(o.default.map(e,(e=>e?.global_tag?.description))).default.bind(f.mapManual((e=>e?.description.body)))))).label((e=>e.text.use("view/manage-tags/global-tag-form/aliases/label"))).content(((e,t)=>e.append(g=(0,d.default)().setLabel(t).setCustomTagsOnly().default.bind(f.mapManual((e=>({custom_tags:e?.aliases||[]}))))))).label((e=>e.text.use("view/manage-tags/global-tag-form/relationships-to/label"))).content(((e,o)=>e.append(y=(0,d.default)().setLabel(o).setGlobalTagsOnly().default.bind(p.default.Use(o,{tag:f,manifest:t}).map(o,(({tag:e,manifest:t})=>{if(!e||!t)return;const o=`${e.category}: ${e.name}`;return{global_tags:t.relationships[o]||[]}})))))).label((e=>e.text.use("view/manage-tags/global-tag-form/relationships-from/label"))).content(((e,o)=>e.append(_=(0,d.default)().setLabel(o).setGlobalTagsOnly().default.bind(p.default.Use(o,{tag:f,manifest:t}).map(o,(({tag:e,manifest:t})=>{if(!e||!t)return;const o=`${e.category}: ${e.name}`;return{global_tags:Object.entries(t.relationships).filter((([e,t])=>t.includes(o))).map((([e])=>e))}})))))).label((e=>e.text.use("view/manage-tags/global-tag-form/mature/label"))).content(((e,t)=>e.append(b=(0,a.default)().setLabel(t).setChecked(f.value?.is_mature??!1).text.use("view/manage-tags/global-tag-form/mature/hint")))),w.footer.style("tag-edit-form-footer"),w.extend((e=>({categoryDropdown:m,nameInput:v,descriptionEditor:h,aliasesEditor:g,relationshipsToEditor:y,relationshipsFromEditor:_,isMature:b,getFormData(){const e=m.selection.value;if(e)return{name:v.state.value,description:h.useMarkdown(),category:e,aliases:g.state.value.custom_tags,relationships_to:y.state.value.global_tags,relationships_from:_.state.value.global_tags,is_mature:b.checked.value}}})))}))})),define("ui/view/tags/ManageCustomTags",["require","exports","endpoint/tags/custom/$custom_tag_name/EndpointTagsCustom$customTagNameRename","endpoint/tags/custom/EndpointTagsCustomDelete","endpoint/tags/custom/EndpointTagsCustomPromote","model/Tags","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/Tag","ui/component/TagBlock","ui/component/TagsEditor","ui/view/tags/TagEditForm","utility/AbortPromise","utility/Arrays","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importStar(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importStar(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),t.default=r.default.Builder(((e,t,x)=>{const D=e.and(u.default);D.content.style("view-type-manage-tags-tag-block");const E=(0,h.default)().placeholder.use("view/manage-tags/shared/hint/filter").appendTo(D.content),O=e=>!E.state.value.length||e.name.includes(E.state.value),M=(0,r.default)().style("view-type-manage-tags-tag-list").appendTo(D.content),S=(0,T.default)([]);let I,C;x.use(M,(e=>{M.removeContents();for(const t of e.sort(((e,t)=>e.name.localeCompare(t.name)))){const o=S.mapManual((e=>e.includes(t.name))),n=T.default.MapManual([E.state,o],((e,o)=>!o&&!O(t)));(0,g.default)(t.name).style("view-type-manage-tags-tag").style.bind(n,"view-type-manage-tags-tag--filtered-out").style.bind(o,"tag--selected","view-type-manage-tags-tag--selected").event.subscribe("click",(o=>{const n=S.value.slice();if(S.value.includes(t.name)){if(o.shiftKey&&o.altKey&&C&&C!==t.name){const o=e.findIndex((e=>e.name===C)),a=e.indexOf(t),i=Math.min(o,a),r=Math.max(o,a);return k.default.remove(S.value,...e.slice(i,r+1).filterInPlace(O).mapInPlace((e=>e.name))),void S.emit(n)}return C=t.name,k.default.remove(S.value,t.name),void S.emit(n)}if(o.shiftKey&&I&&I!==t.name){const o=e.findIndex((e=>e.name===I)),a=e.indexOf(t),i=Math.min(o,a),r=Math.max(o,a);return k.default.add(S.value,...e.slice(i,r+1).filterInPlace(O).mapInPlace((e=>e.name))),void S.emit(n)}I=t.name,k.default.add(S.value,t.name),S.emit(n)})).appendTo(M)}})),(0,r.default)().style("view-type-manage-tags-tag-list").append((0,c.default)().setAestheticStyle(!1).style("view-type-manage-tags-section-heading").text.use("view/manage-tags/shared/label/selected-tags")).append((0,m.default)().use(S,((e,t)=>{for(const o of t)(0,g.default)(o).style("view-type-manage-tags-tag","tag--selected","view-type-manage-tags-tag--selected").event.subscribe("click",(()=>{const e=S.value.slice();k.default.remove(S.value,o),S.emit(e)})).appendTo(e)}))).appendToWhen(S.mapManual((e=>!!e.length)),D.content),(0,f.default)().text.use("view/manage-tags/shared/hint/select-tags").appendToWhen(S.mapManual((e=>!e.length)),D.footer.left);const R=(0,v.Tab)().text.use("view/manage-tags/custom-tags/action/rename"),$=(0,l.default)().style("view-type-manage-tags-custom-tag-action-rename-row").appendTo(R.content),P=(0,h.default)().placeholder.use("view/manage-tags/custom-tags/hint/rename").appendTo($.left),A=(0,s.default)().type("primary").text.use("view/manage-tags/custom-tags/action/rename").event.subscribe("click",(async()=>{const e=S.value[0],t=(0,_.filterTagSegment)(P.state.value);if(!t||t===e)return;if(!await d.default.ensureDangerToken(A,{dangerToken:"tag-modify"}))return;const n=await o.default.query({params:{custom_tag_name:e},body:{name:t}});if(toast.handleError(n))return;const a=x.value.find((t=>t.name===e));a&&(a.name=t);const i=S.value.slice();k.default.remove(S.value,e),S.emit(i),x.emit(),P.value=""})).appendTo($.right),j=(0,v.Tab)().text.use("view/manage-tags/custom-tags/action/promote"),N=(0,v.Tab)().text.use("view/manage-tags/custom-tags/action/promote/new-tag"),q=(0,b.default)(t).appendTo(N.content);S.subscribeManual(((e,t)=>{const o=e.filter((e=>!t?.includes(e))),n=t?.filter((t=>!e.includes(t)));k.default.add(q.aliasesEditor.state.value.custom_tags,...o),k.default.remove(q.aliasesEditor.state.value.custom_tags,...n??[]),q.aliasesEditor.state.emit()})),q.submit.text.use("view/manage-tags/custom-tags/action/promote").event.subscribe("click",(async()=>{const e=S.value.slice();if(!e.length)return;const o=q.getFormData();if(!o)return;if(!await d.default.prompt(q,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/custom-tags/action/delete/confirm",tweak:t=>t.content.insert("after",t.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>(0,g.default)(e).style("tag--selected")))))}))return;const n=await a.default.query({body:{into_new_tag:o,promoted_from_tags:e}});if(toast.handleError(n))return;const l=S.value.slice();x.value.filterInPlace((t=>!e.includes(t.name))),k.default.remove(S.value,...e),x.emit(),S.emit(l);const u=i.default.toId(o);t.addTag(n.data),t.addRelationships(u,o.relationships_to),t.addRelationships(o.relationships_from,u)}));const B=(0,v.Tab)().text.use("view/manage-tags/custom-tags/action/promote/existing-tag"),L=(0,_.default)().setGlobalTagsOnly().setMaxLengthGlobal(1),V=L.state.mapManual((e=>e.global_tags.at(0)));L.appendToWhen(V.falsy,B.content),(0,m.default)().appendTo(B.content).use(V,w.default.asyncFunction((async(e,t,o)=>{if(!o)return;const n=await i.default.resolve(o);if(!n)return L.state.value.global_tags=[],void L.state.emit();(0,y.default)(n).style("view-type-manage-tags-custom-tag-action-promote-existing-tag").appendTo(t)})));const W=(0,p.default)().style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases").tweak((e=>e.label.style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-label").text.use("view/manage-tags/custom-tags/label/promote/existing-tag/new-aliases"))).appendToWhen(V.truthy,B.content),G=(0,_.default)().style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-editor").setCustomTagsOnly().tweak((e=>e.inputWrapper.style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-editor-input-wrapper"))).appendTo(W.content.style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-content"));S.subscribeManual(((e,t)=>{const o=e.filter((e=>!t?.includes(e))),n=t?.filter((t=>!e.includes(t)));k.default.add(G.state.value.custom_tags,...o),k.default.remove(G.state.value.custom_tags,...n??[]),G.state.emit()}));const U=(0,l.default)().style("view-type-manage-tags-custom-tag-action-promote-row").appendToWhen(V.truthy,B.content);(0,s.default)().text.use("view/manage-tags/custom-tags/action/promote/existing-tag-change").event.subscribe("click",(()=>{L.state.value.global_tags=[],L.state.emit()})).appendTo(U.right),(0,s.default)().type("primary").text.use("view/manage-tags/custom-tags/action/promote").event.subscribe("click",(async()=>{const e=S.value.slice();if(!e.length)return;const[o]=L.state.value.global_tags;if(!o)return;if(!await d.default.prompt(L,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/custom-tags/action/delete/confirm",tweak:t=>t.content.insert("after",t.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>(0,g.default)(e).style("tag--selected")))))}))return;const n=await a.default.query({body:{into_existing_tag:{id:o,aliases:G.state.value.custom_tags},promoted_from_tags:e}});if(toast.handleError(n))return;const i=S.value.slice();x.value.filterInPlace((t=>!e.includes(t.name))),k.default.remove(S.value,...e),x.emit(),S.emit(i),t.addAliases(o,...G.state.value.custom_tags)})).appendTo(U.right);const F=(0,v.default)().allowNoneVisible().addTab(N).addTab(B).appendTo(j.content);(0,f.default)().text.use("view/manage-tags/custom-tags/hint/promote/into").prependTo(F.header);const H=(0,v.Tab)().text.use("view/manage-tags/custom-tags/action/delete"),Y=(0,l.default)().appendTo(H.content);return(0,f.default)().text.use("view/manage-tags/shared/hint/delete-tags").appendTo(Y.left),(0,s.default)().type("primary").text.use("view/manage-tags/custom-tags/action/delete").event.subscribe("click",(async()=>{const e=S.value.slice();if(!e.length)return;if(!await d.default.prompt(Y,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/custom-tags/action/delete/confirm",tweak:t=>t.content.insert("after",t.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>(0,g.default)(e).style("tag--selected")))))}))return;const t=await n.default.query({body:{tags:e}});if(toast.handleError(t))return;const o=S.value.slice();x.value.filterInPlace((t=>!e.includes(t.name))),k.default.remove(S.value,...e),x.emit(),S.emit(o)})).appendTo(Y.right),(0,v.default)().allowNoneVisible().addTabWhen(S.mapManual((e=>1===e.length)),R).addTab(j).addTab(H).appendToWhen(S.mapManual((e=>!!e.length)),D.footer.left),D}))})),define("endpoint/tags/global/$global_tag_id/EndpointTagsGlobal$globalTagIdUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/global/{global_tag_id}/update","post")})),define("endpoint/tags/global/EndpointTagsGlobalCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/global/create","post")})),define("endpoint/tags/global/EndpointTagsGlobalDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/global/delete","post").noResponse()})),define("endpoint/tags/global/EndpointTagsGlobalRecategorise",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/global/recategorise","post").noResponse()})),define("ui/view/tags/ManageGlobalTags",["require","exports","endpoint/tags/global/$global_tag_id/EndpointTagsGlobal$globalTagIdUpdate","endpoint/tags/global/EndpointTagsGlobalCreate","endpoint/tags/global/EndpointTagsGlobalDelete","endpoint/tags/global/EndpointTagsGlobalRecategorise","model/Tags","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Dropdown","ui/component/core/Form","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/Tag","ui/utility/StringApplicator","ui/view/tags/TagEditForm","utility/Arrays","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importStar(y),_=__importDefault(_),b=__importDefault(b),k=__importDefault(k),T=__importStar(T),x=__importDefault(x),t.default=l.default.Builder(((e,t)=>{const D=e.and(s.default);D.content.style("view-type-manage-tags-tag-block");const E=(0,_.default)().placeholder.use("view/manage-tags/shared/hint/filter").appendTo(D.content),O=(0,l.default)().style("view-type-manage-tags-tag-list").appendTo(D.content),M=(0,x.default)([]);let S,I;x.default.Use(e,{manifest:t,filter:E.state}).use(e,(({manifest:e,filter:t})=>{if(O.removeContents(),!e)return;let[o,n]=t.toLowerCase().split(":");void 0===n&&(n=o,o="");const a=Object.entries(e.tags).filter((([e,a])=>!t||a.name.toLowerCase().includes(n)&&a.category.toLowerCase().includes(o))),i=a.map((([e])=>e));for(const[e,t]of a)(0,b.default)(t).tweak((t=>t.style.bind(M.map(t,(t=>t.includes(e))),"tag--selected","view-type-manage-tags-tag--selected"))).event.subscribeCapture("click",(t=>{t.preventDefault(),t.stopImmediatePropagation();const o=M.value.slice();if(M.value.includes(e)){if(t.shiftKey&&t.altKey&&I&&I!==e){const t=i.indexOf(I),n=i.indexOf(e),a=Math.min(t,n),r=Math.max(t,n);return T.default.remove(M.value,...i.slice(a,r+1)),void M.emit(o)}return I=e,T.default.remove(M.value,e),void M.emit(o)}if(t.shiftKey&&S&&S!==e){const t=i.indexOf(S),n=i.indexOf(e),a=Math.min(t,n),r=Math.max(t,n);return T.default.add(M.value,...i.slice(a,r+1)),void M.emit(o)}S=e,T.default.add(M.value,e),M.emit(o)})).appendTo(O)})),(0,l.default)().style("view-type-manage-tags-tag-list").append((0,m.default)().setAestheticStyle(!1).style("view-type-manage-tags-section-heading").text.use("view/manage-tags/shared/label/selected-tags")).append((0,g.default)().use(M,((e,o)=>{const n=o.map((e=>[e,t.value?.tags[e]])).filterInPlace((e=>!!e[1]));if(n.length)for(const[t,o]of n)(0,b.default)(o).style("tag--selected","view-type-manage-tags-tag--selected").event.subscribeCapture("click",(e=>{e.preventDefault(),e.stopImmediatePropagation(),T.default.remove(M.value,t),M.emit()})).appendTo(e)}))).appendToWhen(M.mapManual((e=>!!e.length)),D.content);const C=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/create"),R=(0,k.default)(t).appendTo(C.content);R.submit.text.use("view/manage-tags/global-tags/action/create").event.subscribe("click",(async()=>{const e=R.getFormData();if(!e)return;const o=await n.default.query({body:e});if(toast.handleError(o))return;if(!t.value)return;const a=r.default.toId(o.data);r.default.addTag(o.data),r.default.addRelationships(a,e.relationships_to),r.default.addRelationships(e.relationships_from,a)}));const $=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/recategorise"),P=(0,f.default)(null).appendTo($.content);let A;(0,v.default)().tweak((e=>e.label.text.use("view/manage-tags/global-tag-form/category/label"))).tweak((e=>e.content.append(A=(0,p.RadioDropdown)().setLabel(e.label).setRequired().tweak((e=>{t.use(e,(t=>{if(e.clear(),t)for(const o of Object.values(t.categories))e.add(o.nameLowercase,{translation:e=>w.Quilt.fake(o.name)})}))}))))).appendTo(P.content),P.submit.text.use("view/manage-tags/global-tags/action/recategorise").event.subscribe("click",(async()=>{const e=M.value.slice();if(!e.length)return;const t=A.selection.value;if(!t)return;if(!await c.default.ensureDangerToken(A,{dangerToken:"tag-modify"}))return;const o=await i.default.query({body:{tags:e,category:t}});toast.handleError(o)||r.default.recategoriseTags(t,...e)}));const j=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/modify");(0,g.default)().appendTo(j.content).use(M,((e,n)=>{if(!n.length||n.length>1)return;const a=n[0],i=(0,k.default)(t,a).appendTo(e);i.submit.text.use("view/manage-tags/global-tags/action/save").event.subscribe("click",(async()=>{const e=i.getFormData();if(!e)return;if(!await c.default.ensureDangerToken(i,{dangerToken:"tag-modify"}))return;const n=await o.default.query({params:{global_tag_id:a},body:e});if(toast.handleError(n))return;if(!t.value)return;const l=r.default.toId(n.data);r.default.removeTags(a),r.default.addTag(n.data),r.default.addRelationships(l,e.relationships_to),r.default.addRelationships(e.relationships_from,l)}))}));const N=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/delete"),q=(0,u.default)().appendTo(N.content);(0,h.default)().text.use("view/manage-tags/shared/hint/delete-tags").appendTo(q.left),(0,d.default)().type("primary").text.use("view/manage-tags/global-tags/action/delete").event.subscribe("click",(async()=>{const e=M.value.slice();if(!e.length)return;if(!await c.default.prompt(q,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/global-tags/action/delete/confirm",tweak:o=>o.content.insert("after",o.body,(0,l.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>t.value?.tags[e])).filterInPlace(T.NonNullish).map((e=>(0,b.default)(e).style("tag--selected")))))}))return;const o=await a.default.query({body:{tags:e}});if(toast.handleError(o))return;r.default.removeTags(...e);const n=M.value.slice();T.default.remove(M.value,...e),M.emit(n)})).appendTo(q.right);const B=M.mapManual((e=>!e.length)),L=M.mapManual((e=>!!e.length)),V=M.mapManual((e=>1===e.length)),W=(0,y.default)().allowNoneVisible().addTabWhen(B,C).addTabWhen(V,j).addTabWhen(L,$).addTabWhen(L,N).appendTo(D.footer.left);return(0,h.default)().text.use("view/manage-tags/shared/hint/select-tags").appendToWhen(M.mapManual((e=>!e.length)),W.header),D}))})),define("endpoint/tags/category/$tag_category_name/EndpointTagsCategory$tagCategoryNameDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/category/{tag_category_name}/delete","post").noResponse()})),define("endpoint/tags/category/$tag_category_name/EndpointTagsCategory$tagCategoryNameUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/category/{tag_category_name}/update","post")})),define("endpoint/tags/category/EndpointTagsCategoryCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/category/create","post")})),define("ui/view/tags/CategoryEditForm",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/Form","ui/component/core/LabelledTable","ui/component/core/Textarea","ui/component/core/TextInput"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=n.default.Builder(((e,t,n)=>{const u=t.map(e,(e=>e?.categories[n]));let s,d;const c=e.and(a.default,null);return c.content.and(i.default).label((e=>e.text.use("view/manage-tags/global-tag-form/name/label"))).content(((e,t)=>e.append(s=(0,l.default)().setLabel(t).setRequired().setMaxLength(o.default.map(e,(e=>e?.global_tag?.name))).default.bind(u.mapManual((e=>e?.name)))))).label((e=>e.text.use("view/manage-tags/global-tag-form/description/label"))).content(((e,t)=>e.append(d=(0,r.default)().setLabel(t).setRequired().setMaxLength(o.default.map(e,(e=>e?.global_tag?.description))).default.bind(u.mapManual((e=>e?.description)))))),c.footer.style("tag-edit-form-footer"),c.extend((e=>({nameInput:s,descriptionEditor:d,getFormData:()=>({name:s.state.value,description:d.state.value})})))}))})),define("ui/view/tags/ManageTagCategories",["require","exports","endpoint/tags/category/$tag_category_name/EndpointTagsCategory$tagCategoryNameDelete","endpoint/tags/category/$tag_category_name/EndpointTagsCategory$tagCategoryNameUpdate","endpoint/tags/category/EndpointTagsCategoryCreate","model/Tags","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/Tag","ui/view/tags/CategoryEditForm","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importStar(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y);const _=r.default.Builder(((e,t)=>e.and(h.default,t.name).style("view-type-manage-tags-tag","view-type-manage-tags-category","view-type-manage-tags-category--has-description").tweak((e=>e.removeContents())).append((0,r.default)().style("tag-category","tag-category--standalone").text.set(t.name)).append((0,p.default)().style("tag-category-description").text.set(t.description))));t.default=r.default.Builder(((e,t)=>{const h=e.and(u.default);h.content.style("view-type-manage-tags-tag-block");const b=(0,v.default)().placeholder.use("view/manage-tags/shared/hint/filter").appendTo(h.content),w=(0,r.default)().style("view-type-manage-tags-tag-list").appendTo(h.content),k=(0,y.default)(void 0);y.default.Use(e,{manifest:t,filter:b.state}).use(e,(({manifest:e,filter:t})=>{if(w.removeContents(),e){t=t.toLowerCase();for(const[,o]of Object.entries(e.categories))t&&!o.name.toLowerCase().includes(t.toLowerCase())||_(o).tweak((e=>e.style.bind(k.map(e,(e=>e===o.name)),"tag--selected","view-type-manage-tags-tag--selected"))).event.subscribe("click",(()=>{k.value===o.name?k.value=void 0:k.value=o.name})).appendTo(w)}}));const T=k.mapManual((e=>!!e));(0,r.default)().style("view-type-manage-tags-tag-list").append((0,c.default)().setAestheticStyle(!1).style("view-type-manage-tags-section-heading").text.use("view/manage-tags/categories/label/selected")).append((0,f.default)().use(k,((e,o)=>{const n=t.value?.categories[o];n&&_(n).style("tag--selected","view-type-manage-tags-tag--selected").event.subscribe("click",(()=>{k.value=void 0})).appendTo(e)}))).appendToWhen(T,h.content);const x=(0,m.Tab)().text.use("view/manage-tags/categories/action/create"),D=(0,g.default)(t).appendTo(x.content);D.submit.text.use("view/manage-tags/categories/action/create").event.subscribe("click",(async e=>{const o=D.getFormData();if(!o)return;const n=await a.default.query({body:o});toast.handleError(n)||t.value&&i.default.addCategory(n.data)}));const E=(0,m.Tab)().text.use("view/manage-tags/categories/action/modify");(0,f.default)().appendTo(E.content).use(k,((e,o)=>{if(!o)return;const a=(0,g.default)(t,o).appendTo(e);a.submit.text.use("view/manage-tags/categories/action/save").event.subscribe("click",(async e=>{const r=a.getFormData();if(!r)return;if(!await d.default.ensureDangerToken(a,{dangerToken:"tag-modify"}))return;const l=await n.default.query({params:{tag_category_name:o},body:r});toast.handleError(l)||t.value&&(i.default.removeCategory(o),i.default.addCategory(l.data))}))}));const O=(0,m.Tab)().text.use("view/manage-tags/categories/action/delete"),M=(0,l.default)().appendTo(O.content),S=y.default.Map(M,[t,k],((e,t)=>!!e&&!Object.values(e.tags).some((e=>e.category===t))));(0,p.default)().text.use("view/manage-tags/categories/hint/no-delete").appendToWhen(S.falsy,M.left),(0,p.default)().text.use("view/manage-tags/categories/hint/delete").appendToWhen(S,M.left),(0,s.default)().type("primary").text.use("view/manage-tags/categories/action/delete").event.subscribe("click",(async()=>{const e=k.value;if(!e)return;const n=t.value?.categories[e];if(!n)return;if(!await d.default.prompt(M,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/categories/action/delete/confirm",tweak:e=>e.content.insert("after",e.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(_(n).style("tag--selected","view-type-manage-tags-tag--selected").insertTo(e.content,"after",e.body)))}))return;const a=await o.default.query({params:{tag_category_name:e}});toast.handleError(a)||i.default.removeCategory(e)})).appendTo(M.right);const I=(0,m.default)().allowNoneVisible().addTabWhen(T.falsy,x).addTabWhen(T,E).addTabWhen(T,O).appendTo(h.footer.left);return(0,p.default)().text.use("view/manage-tags/categories/hint/select-category").appendToWhen(T.falsy,I.header),h}))})),define("ui/view/ManageTagsView",["require","exports","endpoint/tags/EndpointTagsCustom","model/Session","model/Tags","ui/component/core/Tabinator","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","ui/view/tags/ManageCustomTags","ui/view/tags/ManageGlobalTags","ui/view/tags/ManageTagCategories","utility/Errors","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importStar(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),t.default=(0,l.default)({async load(e){if(!n.default.Auth.privileged.TagGlobalDelete.value)throw c.default.Forbidden();const t=await o.default.query();if(toast.handleError(t))throw c.default.NotFound();return a.default.getManifest(),{customTags:t.data,manifest:a.default}},create:(e,{customTags:t,manifest:o})=>{const n=(0,r.default)("manage-tags");n.breadcrumbs.title.text.use("view/manage-tags/title"),n.breadcrumbs.description.text.use("view/manage-tags/description");const a=(0,p.default)(t);return(0,i.default)().addTab((0,i.Tab)().text.use("view/manage-tags/custom-tags/title").tweak((e=>(0,u.default)(o,a).appendTo(e.content)))).addTab((0,i.Tab)().text.use("view/manage-tags/categories/title").tweak((e=>(0,d.default)(o).appendTo(e.content)))).addTab((0,i.Tab)().text.use("view/manage-tags/global-tags/title").tweak((e=>(0,s.default)(o).appendTo(e.content)))).appendTo(n.content),n}})})),define("endpoint/feed/EndpointFeedGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/feed/get","get")})),define("ui/view/NewView",["require","exports","endpoint/feed/EndpointFeedGet","endpoint/feed/get/EndpointFeedGetAuthed","model/Session","ui/component/core/Slot","ui/component/WorkFeed","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Env","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),t.default=(0,u.default)({create:()=>{const e=(0,l.default)("new");e.breadcrumbs.title.text.use("view/new/main/title"),e.breadcrumbs.description.text.use("view/new/main/description");const t=(0,d.default)(void 0),u=d.default.Map(e,[t,a.default.Auth.loggedIn],((e,t)=>_??e??(t?void 0:`${s.default.API_ORIGIN}feed/get/rss.xml`)));return e.breadcrumbs.setRSSButton(u),(0,i.default)().use(a.default.Auth.loggedIn,((e,a)=>(0,r.default)().viewTransition("new-view-feed").setFromEndpoint(a?n.default:o.default).tweak((e=>e.state.use(e,(e=>t.value=e?.rss_url)))))).appendTo(e.content),e}})})),define("endpoint/notifications/get/EndpointNotificationsGetAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/notifications/get/all","get")})),define("endpoint/notifications/get/EndpointNotificationsGetCount",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/notifications/get/count","get")})),define("endpoint/notifications/mark/EndpointNotificationsMarkRead",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/notifications/mark/read","post").noResponse()})),define("endpoint/notifications/mark/EndpointNotificationsMarkUnread",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/notifications/mark/unread","post").noResponse()})),define("model/Notifications",["require","exports","endpoint/notifications/get/EndpointNotificationsGetAll","endpoint/notifications/get/EndpointNotificationsGetCount","endpoint/notifications/mark/EndpointNotificationsMarkRead","endpoint/notifications/mark/EndpointNotificationsMarkUnread","model/PagedListData","model/Session","ui/utility/PageListener","utility/State","utility/Store","utility/Time"],(function(e,t,o,n,a,i,r,l,u,s,d,c){var p;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),function(e){l.default.setClearedWithSessionChange("notifications",(()=>{e.cache.clear(),t=[],e.authors.value=[],e.works.value=[],e.chapters.value=[],e.comments.value=[],e.hasMore.value=!1,e.unreadCount.value=0,e.lastUpdate.value=0}));let t=d.default.items.notifications?.cache??[];function p(){d.default.items.notifications&&(d.default.items.notifications={...d.default.items.notifications,lastCheck:0,lastUpdate:0})}e.cache=(0,r.default)(25,{async get(n){const a=25*n,i=25*(n+1);if(t.length<a){const a=await o.default.query(void 0,{page:n,page_size:25});if(toast.handleError(a))return!1;const i=a.data;if(!i.notifications.length)return null;t.push(...i.notifications),t.sort(...f),e.authors.value=[...d.default.items.notifications?.authors??[],...i.authors],e.works.value=[...d.default.items.notifications?.works??[],...i.works],e.chapters.value=[...d.default.items.notifications?.chapters??[],...i.chapters],e.comments.value=[...d.default.items.notifications?.comments??[],...i.comments],d.default.items.notifications={...d.default.items.notifications,cache:t,authors:e.authors.value,works:e.works.value,chapters:e.chapters.value,comments:e.comments.value}}return t.slice(a,i)}}),e.authors=(0,s.default)(d.default.items.notifications?.authors??[]),e.works=(0,s.default)(d.default.items.notifications?.works??[]),e.chapters=(0,s.default)(d.default.items.notifications?.chapters??[]),e.comments=(0,s.default)(d.default.items.notifications?.comments??[]),e.hasMore=(0,s.default)(d.default.items.notifications?.hasMore??!1),e.unreadCount=(0,s.default)(d.default.items.notifications?.unreadCount??0),e.lastUpdate=(0,s.default)(d.default.items.notifications?.lastUpdate??0),e.clear=p,e.check=function(e=!1){return e&&p(),d.default.items.notifications&&(d.default.items.notifications={...d.default.items.notifications,lastCheck:0}),v()},e.await=async function(){await v()},e.markRead=async function(o,...n){const r=o?a.default:i.default,l=await r.query({body:{notification_ids:n}});if(toast.handleError(l))return!1;let u=0;for(const e of t)n.includes(e.id)&&e.read!==o&&(e.read=o,u++);if(!u)return!0;e.unreadCount.value+=o?-u:u,d.default.items.notifications={...d.default.items.notifications,cache:t,unreadCount:e.unreadCount.value};for(const t of e.cache.pages)Array.isArray(t.value)&&t.value.some((e=>n.includes(e.id)))&&t.emit();return!0};const f=[e=>-+e.read,e=>new Date(e.created_time).getTime()];let m;async function v(){if(m)return await m;if(!l.default.Auth.author.value)return;if(!u.default.visible.value)return;let a=d.default.items.notifications;if(Date.now()-(a?.lastCheck??0)<c.default.minutes(1))return;let i;a??={},a.lastCheck=Date.now(),d.default.items.notifications=a,m=new Promise((e=>i=e));try{const i=await n.default.query();if(toast.handleError(i))return;const r=new Date(i.data.notification_time_last_modified).getTime();if(r<=(a.lastUpdate??0))return;const l=await o.default.query();if(toast.handleError(l))return;const u=i.data.unread_notification_count;a.unreadCount=e.unreadCount.value=u,a.cache=t=l.data.notifications.sort(...f),a.authors=e.authors.value=l.data.authors,a.works=e.works.value=l.data.works,a.chapters=e.chapters.value=l.data.chapters,a.comments=e.comments.value=l.data.comments,a.hasMore=e.hasMore.value=l.has_more,a.lastUpdate=e.lastUpdate.value=r,e.cache.clear()}finally{a.lastCheck=Date.now(),d.default.items.notifications=a,i(),m=void 0}}setInterval(v,c.default.seconds(1))}(p||(p={})),Object.assign(window,{Notifications:p}),t.default=p})),define("model/Comments",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.resolve=function(e,t){return e?t.find((t=>t.comment_id===e)):void 0}}(o||(o={})),t.default=o})),define("ui/component/Notification",["require","exports","model/Authors","model/Chapters","model/Comments","model/Notifications","model/TextBody","model/Works","ui/Component","ui/component/core/Button","ui/component/core/Icon","ui/component/core/Link","ui/component/core/Slot","ui/component/core/Timestamp","ui/component/popover/AuthorPopover","ui/component/WorkLink","ui/utility/StringApplicator","utility/State","utility/Type"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),g=__importDefault(g),(y=__importDefault(y)).default.assert();const _=u.default.Builder("a",((e,t)=>{const y=(0,g.default)(t.read),_=(0,g.default)(void 0);return e.and(p.default).use(h.Quilt.State,((p,h)=>{const b=h[`notification/${t.type}`];if(!b)return void console.warn(`Untranslated notification type ${t.type}`,t);const w=o.default.resolve(t.triggered_by,i.default.authors.value),k=w?(0,c.default)(`/author/${w.vanity}`).style.toggle(t.type.startsWith("report-"),"notification-reporter").text.set(w.name).setPopover("hover/longpress",(e=>e.and(m.default,w))):void 0,T=o.default.resolve(t.author,i.default.authors.value),x=T?(0,c.default)(`/author/${T.vanity}`).text.set(T.name).setPopover("hover/longpress",(e=>e.and(m.default,T))):void 0,D=l.default.resolve(t.work,i.default.works.value),E=D?(0,v.default)(D):void 0,O=n.default.resolve(t.chapter,i.default.chapters.value),M=O?(0,c.default)(`/work/${O.author_vanity}/${O.work_vanity}/chapter/${O.chapter_url}`).text.set(n.default.getName(O)):void 0,S=!!t.comment,I=(0,u.default)().style("notification").style.bind(y,"notification--read"),C=(0,g.default)(!1),R=_.value=(0,s.default)().setIcon("check").type("icon").style("notification-read-button").style.bind(y,"notification-read-button--read").style.bind(C,"notification-read-button--just-marked-unread").tweak((e=>e.icon.style("notification-read-button-icon"))).event.subscribe("click",(async e=>{e.preventDefault(),e.stopImmediatePropagation(),await P()})).appendTo(I);(0,u.default)().style("notification-label").append(t.type.startsWith("report-")&&(0,d.default)("shield-halved").style("notification-type-icon"),(0,u.default)().style("notification-label-text").useMarkdownContent({body:e=>b({TRIGGERED_BY:k,AUTHOR:x,WORK:E,CHAPTER:M,COMMENT:S})}),document.createTextNode("   "),(0,f.default)(t.created_time).style("notification-label-timestamp")).appendTo(I);const $=a.default.resolve(t.comment,i.default.comments.value);return $&&((0,u.default)().style("markdown","notification-comment-wrapper").append($.body&&(0,u.default)("blockquote").style("notification-comment").setMarkdownContent(r.default.resolve($.body,i.default.authors.value),64)).appendTo(I),O&&I.and(c.default,`/work/${O.author_vanity}/${O.work_vanity}/chapter/${O.chapter_url}`).event.subscribe("Navigate",P)),t.type.startsWith("report-")&&t.string_128&&(0,u.default)().style("notification-report-reason").append((0,u.default)().style("notification-report-reason-label").text.use("notification/report/label/reason")).append((0,u.default)().style("notification-report-reason-text").text.set(t.string_128)).appendTo(I),I;async function P(){await i.default.markRead(!y.value,t.id)&&(y.value=!y.value,y.value||(C.value=!0,R.hoveredOrFocused.match(e,!1,(()=>C.value=!1))))}})).extend((e=>({readButton:_})))}));t.default=_})),define("ui/component/NotificationList",["require","exports","model/Notifications","ui/Component","ui/component/core/Button","ui/component/core/Paginator","ui/component/Notification"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=n.default.Builder((async(e,t,n)=>{const l=e.and(i.default).viewTransition(!1).style("notification-list"),u=e.extend((e=>({paginator:l})));(0,a.default)().setIcon("check-double").type("icon").event.subscribe("click",(async()=>{const e=l.data.value;await o.default.markRead(!0,...e.map((e=>e.id)))})).appendTo(l.primaryActions),l.header.style("notification-list-header"),l.title.style("notification-list-title").text.use("masthead/user/notifications/title"),l.content.style("notification-list-content"),l.footer.style("notification-list-footer"),await o.default.await();const s=void 0===n?o.default.cache:o.default.cache.resized(n);return l.set(s,0,((e,t)=>{e.style("notification-list-page");for(const o of t)(0,r.default)(o)?.appendTo(e)})),u}));t.default=l})),define("ui/view/NotificationsView",["require","exports","ui/component/NotificationList","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.default=(0,a.default)({load:async()=>({list:await(0,o.default)()}),create(e,{list:t}){const o=(0,n.default)("notifications");return t.appendTo(o.content),o}})})),define("ui/view/TagView",["require","exports","endpoint/feed/EndpointFeedGet","endpoint/feed/get/EndpointFeedGetAuthed","model/Session","model/Tags","ui/component/ActionBlock","ui/component/Tag","ui/component/TagBlock","ui/component/WorkFeed","ui/utility/StringApplicator","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTitle","utility/Errors"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m);const v=/(-|^)(.)/g,h=e=>e.replaceAll(v,((e,t,o)=>`${t?" ":""}${o}`));t.default=(0,p.default)({async load(e){const t=e.custom_name??await i.default.resolve(h(e.category),h(e.name));if(!t)throw m.default.NotFound();return{tag:t}},create(e,{tag:t}){const i=(0,c.default)("tag"),p=(0,u.default)(t).viewTransition("tag-view-tag").tweak((e=>e.header.getFirstDescendant(l.default)?.nameWrapper.and(f.default,d.Quilt.fake(`${t.category}: ${t.name}`)))).appendTo(i.content);return(0,r.default)().viewTransition("tag-view-tag-actions").attachAbove().addActions(p).appendTo(i.content),(0,s.default)().setFromEndpoint((a.default.Auth.author.value?n.default:o.default).prep(void 0,{whitelist_tags:[`${t.category}: ${t.name}`]})).appendTo(i.content),i}})})),define("endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/{author_vanity}/{work_vanity}/update","post")})),define("endpoint/works/EndpointWorksCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/create","post")})),define("ui/view/work/WorkEditForm",["require","exports","endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityUpdate","endpoint/works/EndpointWorksCreate","lang/en-nz","model/FormInputLengths","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Form","ui/component/core/GradientInput","ui/component/core/LabelledTable","ui/component/core/Textarea","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/core/toast/Toast","ui/component/LicenseFormFragment","ui/component/SupportersOnlyLabel","ui/component/TagsEditor","ui/component/VanityInput","ui/component/VisibilityOptions","ui/component/WorkStatusDropdown","ui/utility/License"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),t.default=l.default.Builder(((e,t)=>{const l=e.and(u.default),T=l.and(s.default,l.title);T.viewTransition("work-edit-form");const x=t.value?"update":"create";T.title.text.use(`view/work-edit/${x}/title`),T.setName(a.default[`view/work-edit/${x}/title`]().toString()),T.submit.textWrapper.text.use(`view/work-edit/${x}/submit`);const D=(0,c.default)().appendTo(T.content),E=(0,m.default)().setRequired().default.bind(t.map(e,(e=>e?.name))).hint.use("view/work-edit/shared/form/name/hint").setMaxLength(i.default.map(D,(e=>e?.work?.name)));D.label((e=>e.text.use("view/work-edit/shared/form/name/label"))).content(((e,t)=>e.append(E.setLabel(t))));const O=(0,m.default)().placeholder.bind(E.state.map(e,(e=>(0,_.FilterVanity)(e)))).default.bind(t.map(e,(e=>e?.vanity))).filter(_.FilterVanity).hint.use("view/work-edit/shared/form/vanity/hint").setMaxLength(i.default.map(D,(e=>e?.work?.vanity)));D.label((e=>e.text.use("view/work-edit/shared/form/vanity/label"))).content(((e,t)=>e.append(O.setLabel(t))));const M=(0,p.default)().setRequired().default.bind(t.map(e,(e=>e?.description))).hint.use("view/work-edit/shared/form/description/hint").setMaxLength(i.default.map(D,(e=>e?.work?.description)));D.label((e=>e.text.use("view/work-edit/shared/form/description/label"))).content(((e,t)=>e.append(M.setLabel(t))));const S=(0,f.default)().default.bind(t.map(e,(e=>e?.synopsis.body))).hint.use("view/work-edit/shared/form/synopsis/hint").setMaxLength(i.default.map(D,(e=>e?.work?.synopsis)));D.label((e=>e.text.use("view/work-edit/shared/form/synopsis/label"))).content(((e,t)=>e.append(S.setLabel(t))));const I=(0,h.default)(D,!0);I.dropdown.default.bind(t.map(e,(e=>{const t=e?.license?.name;return t?k.LICENSES.includes(t)?t:"custom":"inherit"}))),I.customLinkInput.default.bind(t.map(e,(e=>e?.license?.link))),I.customNameInput.default.bind(t.map(e,(e=>e?.license?.name)));const C=(0,y.default)().default.bind(t).setMaxLengthGlobal(i.default.map(D,(e=>e?.work_tags?.global))).setMaxLengthCustom(i.default.map(D,(e=>e?.work_tags?.custom)));D.label((e=>e.text.use("view/work-edit/shared/form/tags/label"))).content(((e,t)=>e.append(C.setLabel(t))));const{visibility:R,patreonTiers:$}=(0,b.default)(D,t.map(e,(e=>({patreonEnabled:!0,visibility:e?.visibility??"Private",patreonTiers:e?.patreon?.tiers.map((e=>e.tier_id))}))));R.hint.use("view/work-edit/shared/form/visibility/hint");const P=w.default.Radio(t.map(e,(e=>e?.status??"Ongoing")));D.label((e=>e.text.use("view/work-edit/shared/form/status/label"))).content(((e,t)=>e.append(P.setLabel(t))));const A=(0,d.default)().default.bind(t.map(e,(e=>e?.card_colours)));return D.label((e=>e.and(g.default).text.use("view/work-edit/shared/form/card-colours/label"))).content(((e,t)=>e.append(A.setLabel(t)))),l.useGradient(A.value),T.onSubmit((async e=>{const a=E.value,i=await(()=>{switch(x){case"create":return n.default.query({body:{name:a,vanity:O.value,description:M.value,synopsis:S.useMarkdown(),visibility:R.selection.value??"Private",tier_ids:$.selection.value,...C.state.value,card_colours:A.value.value.slice(),status:P.selection.value}});case"update":{if(!t.value)return;const e=r.default.Auth.author.value?.vanity;return e?o.default.query({params:{author_vanity:e,work_vanity:t.value.vanity},body:{name:a,vanity:O.value,description:M.value,synopsis:S.useMarkdown(),visibility:R.selection.value??"Private",tier_ids:$.selection.value,...C.state.value,card_colours:A.value.value.slice(),license:I.getFormData(),status:P.selection.value}}):new Error("Cannot update a work when not signed in")}}})();toast.handleError(i,(e=>e["view/work-edit/shared/toast/failed-to-save"](a)))||(toast.success(v.TOAST_SUCCESS,(e=>e["view/work-edit/shared/toast/saved"](a))),t.value=i?.data)})),T}))})),define("ui/view/WorkEditView",["require","exports","endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityGet","model/Session","model/Works","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/Slot","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTransition","ui/view/work/WorkEditForm","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),t.default=(0,s.default)({requiresLogin:!0,async load(e){const t=e&&await o.default.query({params:e});if(t instanceof Error)throw t;t&&t?.data.author!==n.default.Auth.author.value?.vanity&&navigate.toURL(`/work/${t.data.author}/${t.data.vanity}`);const a=t?.data;return{work:a}},create(e,{work:t}){const o="work-edit",n=(0,u.default)(o),s=(0,p.default)(t),f=(0,p.default)(t);return s.use(n,(e=>n.breadcrumbs.setBackButton(e&&`/work/${e.author}/${e.vanity}`,(t=>e&&t.subText.set(e.name))))),(0,l.default)().use(s,(()=>(0,c.default)(f).subviewTransition(o))).appendTo(n.content),(0,l.default)().use(s,(()=>function(){const e=s.value;if(!e)return;return(0,i.default)().viewTransition("work-edit-action-row").tweak((t=>t.left.append((0,r.default)().setIcon("plus").text.use("view/work-edit/update/action/new-chapter").event.subscribe("click",(()=>navigate.toURL(`/work/${e.author}/${e.vanity}/chapter/new`)))).append((0,r.default)().setIcon("plus").text.use("view/work-edit/update/action/bulk-chapters").event.subscribe("click",(()=>navigate.toURL(`/work/${e.author}/${e.vanity}/chapter/new/bulk`)))))).tweak((t=>t.right.append((0,r.default)().setIcon("trash").text.use("view/work-edit/update/action/delete").event.subscribe("click",(async()=>a.default.delete(e,n))))))}()?.subviewTransition(o))).appendTo(n.content),f.subscribe(n,(e=>d.default.perform("subview",o,(()=>s.value=e)))),n}})})),define("endpoint/chapters/$author_vanity/$work_vanity/$chapter_url/EndpointChapters$authorVanity$workVanity$chapterUrlReorder",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/{chapter_url}/reorder","post")})),define("endpoint/history/bookmarks/$author_vanity/$work_vanity/delete/EndpointHistoryBookmarks$authorVanity$workVanityDeleteFurthestRead",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/bookmarks/{author_vanity}/{work_vanity}/delete/furthest-read","post")})),define("endpoint/history/bookmarks/$author_vanity/$work_vanity/delete/EndpointHistoryBookmarks$authorVanity$workVanityDeleteLastRead",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/bookmarks/{author_vanity}/{work_vanity}/delete/last-read","post")})),define("endpoint/history/work/$author_vanity/$work_vanity/EndpointHistoryWork$authorVanity$workVanityAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/work/{author_vanity}/{work_vanity}/add","post").noResponse()})),define("ui/view/WorkView",["require","exports","endpoint/chapters/$author_vanity/$work_vanity/$chapter_url/EndpointChapters$authorVanity$workVanity$chapterUrlReorder","endpoint/chapters/$author_vanity/EndpointChapters$authorVanity$workVanity","endpoint/history/bookmarks/$author_vanity/$work_vanity/delete/EndpointHistoryBookmarks$authorVanity$workVanityDeleteFurthestRead","endpoint/history/bookmarks/$author_vanity/$work_vanity/delete/EndpointHistoryBookmarks$authorVanity$workVanityDeleteLastRead","endpoint/history/work/$author_vanity/$work_vanity/EndpointHistoryWork$authorVanity$workVanityAdd","endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityGet","model/Chapters","model/PagedListData","model/Session","model/Tags","model/Works","ui/Component","ui/component/ActionBlock","ui/component/Chapter","ui/component/Comment","ui/component/CommentTree","ui/component/core/Block","ui/component/core/Button","ui/component/core/ext/GradientText","ui/component/core/Link","ui/component/core/Paginator","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/Work","ui/utility/DynamicDestination","ui/utility/Viewport","ui/view/LoginView","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Errors","utility/Objects","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x,D,E,O,M,S,I,C,R,$,P){function A(){return(0,f.default)().and(_.default).ariaHidden().tabIndex("programmatic").setIcon("arrow-up-arrow-down").type("icon").style("view-type-work-chapter-reordering-icon")}Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importStar(D),E=__importDefault(E),O=__importDefault(O),M=__importDefault(M),S=__importDefault(S),I=__importDefault(I),C=__importDefault(C),R=__importDefault(R),$=__importDefault($),P=__importDefault(P),t.default=(0,C.default)({async load(e){const t=await l.default.query({params:e});if(t instanceof Error)throw t;return{work:t.data}},create(e,{work:t}){const l=(0,I.default)("work"),C=(0,P.default)(t);d.default.Auth.loggedIn.value&&r.default.query({params:e});const j=C.value.synopsis.mentions.find((e=>e.vanity===C.value.author));if(!j)throw R.default.BadData("Work author not in synopsis authors");const N=(0,E.default)(C,j).viewTransition("work-view-work").setContainsHeading().appendTo(l.content);(0,m.default)().viewTransition("work-view-work-actions").attachAbove().append(N.bookmarkActions.style("view-type-work-actions")).addActions(N).appendTo(l.content),N.bookmarkStatus.use(l,(e=>e?.style("view-type-work-bookmark-status"))),N.bookmarkAction.use(l,(e=>e?.style("view-type-work-bookmark-action").style.bind(C.map(l,(e=>!!e.bookmarks?.url_read_last&&!e.bookmarks.url_next)),"view-type-work-bookmark-action--irrelevant")));const q=P.default.Map(l,[C,c.default,d.default.Auth.account],((e,t,o)=>c.default.hasMature(e.global_tags)&&(!o||"eighteen_plus"!==o.age)));(0,y.default)().tweak((e=>e.title.text.use("view/work/age-restricted/title"))).tweak((e=>e.content.append((0,T.default)().text.bind(d.default.Auth.loggedIn.map(e,(e=>t=>t[e?"view/work/age-restricted/description/logged-in":"view/work/age-restricted/description/logged-out"]())))).appendWhen(d.default.Auth.loggedIn.falsy,(0,_.default)().type("primary").setIcon("circle-user").text.use("shared/action/login-or-signup").event.subscribe("click",(()=>navigate.ephemeral(S.default,void 0)))))).appendToWhen(q,l.content);const B=M.default.tablet,L=(0,D.default)().viewTransition("work-view-tabinator").tweak((e=>e.header.prependToWhen(B.truthy,e))).appendToWhen(q.falsy,l.content),V=(0,D.Tab)("chapters").text.use("view/work/chapters/title").addTo(L),W=(0,P.default)(void 0),G=(0,P.default)(!1),U=P.default.Every(l,G,W.falsy),F=(0,P.default)(null);(0,x.default)().use([q,F],((e,r)=>r?void 0:(0,k.default)().viewTransition("work-view-chapters").style("view-type-work-chapter-list").tweak((e=>{e.title.text.use("view/work/chapters/title");const o=d.default.Auth.loggedInAs(e,t.author);(0,x.default)().appendTo(e.primaryActions).if(o,(t=>{(0,_.default)().text.use("view/work/chapters/action/label/edit").setIcon("pencil").type("primary","flush").event.subscribe("click",(()=>G.value=!0)).appendToWhen(P.default.Every(e,G.falsy,W.falsy),t),(0,_.default)().text.use("view/work/chapters/action/label/cancel-editing").setIcon("xmark").type("flush").event.subscribe("click",(()=>G.value=!1)).appendToWhen(U,t),(0,_.default)().text.use("chapter/action/label/reorder-cancel").setIcon("xmark").type("flush").event.subscribe("click",(()=>W.value=void 0)).appendToWhen(W.truthy,t)})),(0,x.default)().use(W,((e,t)=>{t&&(0,v.default)(t,C.value,j).style("view-type-work-chapter-list-chapter-moving").append(A()).appendTo(e)})).appendTo(e.header)})).set(s.default.fromEndpoint(25,n.default.prep({params:p.default.reference(C.value)})),Math.min(Math.floor((C.value.bookmarks?.url_next_page??0)/25),Math.max(0,Math.floor(((C.value.chapter_count??C.value.chapter_count_public)-1)/25))),((e,t)=>{e.style("chapter-list").style.bind(W.truthy,"view-type-work-chapter-list--moving-chapter").style.bind(U,"view-type-work-chapter-list--edit-mode");const n=t.at(0);n&&r("before",n).appendTo(e);for(const o of t){const t=W.map(e,(e=>e===o)),n=f.default.Builder(((e,t)=>e.style("view-type-work-chapter-marker").onRooted((e=>{e.event.subscribe("mousedown",(e=>1===e.button&&e.preventDefault())),e.event.subscribe("auxclick",(async e=>{if(1!==e.button)return;e.preventDefault();const o=await t.query({params:p.default.reference(C.value)});toast.handleError(o)||(C.value.bookmarks=o.data,C.emit(),F.emit())}))})))),l=C.value.bookmarks?.url_next,u=C.value.bookmarks?.url_next_furthest,s=l===u;o.chapter_url===l&&n(i.default).style(s?"view-type-work-chapter-marker--next-furthest":"view-type-work-chapter-marker--next").text.use("view/work/chapters/marker/next-chapter/next").appendTo(e),o.chapter_url===u&&l!==u&&n(a.default).style("view-type-work-chapter-marker--next-furthest").text.use("view/work/chapters/marker/next-chapter/furthest").appendTo(e),(0,v.default)(o,C.value,j).style("view-type-work-chapter").style.bind(t,"view-type-work-chapter--moving").style.bind(W.truthy,"view-type-work-chapter--has-moving-sibling").attributes.bind(W.truthy,"inert").tweak((e=>{e.number.style.bind(t,"view-type-work-chapter--moving-number"),e.chapterName.style.bind(t,"view-type-work-chapter--moving-name"),e.timestamp?.style.bind(t,"view-type-work-chapter--moving-timestamp"),(0,x.default)().if(t,(()=>A().style("view-type-work-chapter-reordering-icon--slot"))).appendTo(e)})).bindEditMode(U).setReorderHandler((()=>W.value=W.value===o?void 0:o)).appendTo(e),r("after",o).appendTo(e)}function r(e,t){return(0,f.default)().style("view-type-work-chapter-slot-wrapper").style.bind(W.truthy,"view-type-work-chapter-slot-wrapper--has-moving-chapter").append((0,_.default)().style("chapter","view-type-work-chapter-slot").event.subscribe("click",(async()=>{const n=W.value;if(!n)return;if(n.chapter_url===t.chapter_url)return void(W.value=void 0);const a=await o.default.query({params:u.default.reference(n),body:{relative_to:t.chapter_url,position:e}});W.value=void 0,toast.handleError(a)||F.emit()})))}})).orElse((e=>(0,y.default)().type("flush").tweak((e=>(0,T.default)().text.use("view/work/chapters/content/empty").appendTo(e.content))).appendTo(e))))).appendTo(V.content);const H=(0,D.Tab)("comments").text.use("view/work/comments/title").addToWhen(B.truthy,L),Y=C.mapManual((e=>e.root_comment?{threadId:e.root_comment,threadAuthor:e.author}:void 0),$.default.deepEquals);return(0,y.default)().style("view-type-work-comment-block").tweak((e=>e.header.style("view-type-work-comment-block-header"))).tweak((e=>e.title.setAestheticLevel(4).text.use("view/work/comments/title"))).tweak((e=>e.content.append((0,x.default)().use([Y,C,q],((e,t,o,n)=>{if(!t||n)return;const a=d.default.Auth.loggedInAs(e,t.threadAuthor),i={simpleTimestamps:!0,onCommentsUpdate(e){const t=e.find((e=>e.author===d.default.Auth.author.value?.vanity&&!e.edit));!o.recommendation&&t&&(o.recommendation=t,C.emit())},shouldSkipComment:e=>e.author===d.default.Auth.author.value?.vanity&&!e.edit,onRenderComment(e,n){if(e.style("view-type-work-comment").style.toggle(!!e.editor,"view-type-work-comment--has-editor").style.toggle(!n.comment_id,"view-type-work-comment--is-new-comment"),!e.editor)return;if(e.editor.setMinimal(B.falsy).hint.use(),n.comment_id)return;const r=o.recommendation,l=r||o.bookmarks?.can_recommend?a.falsy:(0,P.default)(!1),u=(0,P.default)(!r),s=P.default.Every(e,l,u),c=P.default.Every(e,l.falsy,a.falsy,u);e.author?.text.use("view/work/comments/action/add/label").style("view-type-work-comment-editor-author-hint"),e.onRooted((()=>{const n=e.parent;if(e.prependToWhen(s,n),(0,w.default)(void 0).and(b.default).useGradient(d.default.Auth.author.value?.supporter?.username_colours).style("view-type-work-comment-hint","author-link").text.use("view/work/comments/action/no-add/label").prependToWhen(c,n),r){const e=(0,P.default)([r]);e.subscribeManual((([e])=>{e||(o.recommendation=void 0,C.emit())})),(0,h.default)({threadAuthor:t.threadAuthor,comments:e,authors:(0,P.default)(r.body?.mentions??[])},r,void 0,i).prependTo(n)}}))},onNoComments(e){(0,T.default)().style("view-type-work-comment-placeholder","view-type-work-comment-placeholder--empty").style.bind(a,"view-type-work-comment-placeholder--empty--is-own-work").text.use("view/work/comments/content/empty").appendTo(e)},onCommentsEnd(e){(0,T.default)().style("view-type-work-comment-placeholder","view-type-work-comment-placeholder--end").text.use("view/work/comments/content/end").appendTo(e)}};return(0,g.default)(t.threadId,t.threadAuthor,!0,i).style("view-type-work-comment-tree")}))))).appendTo((0,O.default)(l).addDestination("tab",H.content).addDestination("sidebar",l.sidebar).setStrategy(P.default.Map(l,[B,q],((e,t)=>t?void 0:e?"tab":"sidebar")))),l}})})),define("navigation/Routes",["require","exports","navigation/Route","navigation/RoutePath","ui/view/AboutView","ui/view/AccountView","ui/view/AuthorView","ui/view/ChapterEditView","ui/view/ChapterNewBulkView","ui/view/ChapterView","ui/view/ContactView","ui/view/DebugView","ui/view/FeedView","ui/view/FollowingView","ui/view/FundraiserView","ui/view/HistoryView","ui/view/IgnoringView","ui/view/LegalView","ui/view/LoginView","ui/view/ManageCommentsView","ui/view/ManageTagsView","ui/view/NewView","ui/view/NotificationsView","ui/view/SearchView","ui/view/TagView","ui/view/WorkEditView","ui/view/WorkView"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x,D,E){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),E=__importDefault(E);const O=[(0,o.default)("/debug",c.default.navigate),(0,o.default)("/",w.default.navigate),(0,o.default)("/about",a.default.navigate),(0,o.default)("/about/$tab",a.default.navigate),(0,o.default)("/contact",d.default.navigate),(0,o.default)("/legal",g.default.navigate),(0,o.default)("/legal/$tab",g.default.navigate),(0,o.default)("/feed",p.default.navigate),(0,o.default)("/history",v.default.navigate),(0,o.default)("/search",T.default.navigate),(0,o.default)("/following",f.default.navigate),(0,o.default)("/following/$tab",f.default.navigate),(0,o.default)("/ignoring",h.default.navigate),(0,o.default)("/ignoring/$tab",h.default.navigate),(0,o.default)("/login",y.default.navigate),(0,o.default)("/account",i.default.navigate),(0,o.default)("/account/$tab",i.default.navigate),(0,o.default)("/author/$author_vanity",r.default.navigate),(0,o.default)("/author/$author_vanity/$tab",r.default.navigate),(0,o.default)("/notifications",k.default.navigate),(0,o.default)("/work/new",D.default.navigate),(0,o.default)("/work/$author_vanity/$work_vanity",E.default.navigate),(0,o.default)("/work/$author_vanity/$work_vanity/edit",D.default.navigate),(0,o.default)("/work/$author_vanity/$work_vanity/chapter/new",l.default.navigate),(0,o.default)("/work/$author_vanity/$work_vanity/chapter/new/bulk",u.default.navigate),(0,o.default)("/work/$author_vanity/$work_vanity/chapter/$chapter_url",s.default.navigate),(0,o.default)("/work/$author_vanity/$work_vanity/chapter/$chapter_url/edit",l.default.navigate),(0,o.default)("/tag/$category/$name",x.default.navigate),(0,o.default)("/manage/tags",b.default.navigate),(0,o.default)("/manage/comments",_.default.navigate),(0,o.default)("/manage/comments/$tab",_.default.navigate),(0,o.default)("/fundraiser",m.default.navigate)];n.RoutePath.setRoutes(O),t.default=O})),define("navigation/RoutePath",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.RoutePath=void 0,function(e){let t;e.setRoutes=function(e){t=e},e.is=function(e){return!!e&&t.some((t=>t.path===e||!!t.match(e)))}}(o||(t.RoutePath=o={}))})),define("ui/utility/StringApplicator",["require","exports","lang/en-nz","ui/utility/StyleManipulator","utility/DevServer","utility/Env","utility/Script","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),t.QuiltHelper=t.Quilt=t.quilt=void 0,o=__importStar(o),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const u=(0,(l=__importDefault(l)).default)(o.default);var s,d;function c(e,t,o){let n,a,i,r=!1,s=!1;const c=(0,l.default)(t),p=function e(o){return{state:c,set:e=>s?o:"function"==typeof e?(p.use(e),o):(n?.(),n=void 0,a?.(),a=void 0,i?.(),i=void 0,m(),f(e),o),use:e=>s?o:(n?.(),n=void 0,a?.(),a=void 0,i?.(),i=void 0,m(),"string"==typeof e?(a=u.useManual((t=>f(t[e]()))),o):(a=u.useManual((t=>f(e?.(t,d)))),o)),bind:e=>{if(s)return o;if(n?.(),n=void 0,a?.(),a=void 0,i?.(),i=void 0,m(),null==e)return f(t),o;if("function"==typeof e){const t=e,o=l.default.Owner.create();a=o.remove,e=u.map(o,(e=>t(e,d)))}return l.default.is(e)?(n=e?.use(o,(e=>{if(i?.(),i=void 0,"function"!=typeof e)return f(e);const t=e,o=l.default.Owner.create();i=o.remove,u.use(o,(e=>f(t(e,d))))})),o):(f(e),o)},unbind:()=>(n?.(),n=void 0,a?.(),a=void 0,i?.(),i=void 0,f(t),o),rehost:e}}(e),f=o.bind(null,p);return p;function m(){r||(r=!0,l.default.Owner.getOwnershipState(e)?.matchManual(!0,(()=>{s=!0,n?.(),n=void 0,a?.(),a=void 0,i?.(),i=void 0})))}}function p(e,t,o){const n=o??t;return c(e,o?t:void 0,((e,t)=>{"object"==typeof t&&null!==t&&(t=t.toString()),e.state.value!==t&&(e.state.asMutable?.setValue(t),n(t??void 0))}))}Object.defineProperty(window,"quilt",{get:()=>u.value}),Object.defineProperty(t,"quilt",{get:()=>u.value}),a.default.onMessage("updateLang",(async()=>{r.default.allowModuleRedefinition("lang/en-nz"),await r.default.reload(`${i.default.URL_ORIGIN}lang/en-nz/index.js`),u.value=await new Promise(((t,o)=>{e(["lang/en-nz"],t,o)})).then(__importStar).then((e=>e.default))})),function(e){e.fake=function(e){const t={content:[{content:e}],toString:()=>e};return()=>t},e.State=u}(s||(t.Quilt=s={})),function(e){let a,i,r,u,s;function d(e){return Object.keys(e).includes("toString")}function c(e){return e.content.map(m)}function p(o){return"object"==typeof o&&o&&"map"in o&&(o=o.value),"function"==typeof o&&(o=o(t.quilt,e)),"string"==typeof o&&o in t.quilt&&(o=t.quilt[o]()),o}function f(e){if((e=e.toLowerCase()).startsWith("link(")){const t=e.slice(5,-1);return(t.startsWith("/")?u(t):s(t)).element}if(e.startsWith(".")){const t=e.slice(1);if(t in n.style.value)return i().style(t).element}if(e.startsWith("icon.")){const t=`button-icon-${e.slice(5)}`;if(t in n.style.value)return i().style("button-icon",t,"button-icon--inline").element}switch(e){case"b":return document.createElement("strong");case"i":return document.createElement("em");case"u":return document.createElement("u");case"s":return document.createElement("s");case"sm":return i("small").style("small").element;case"supporters-only":return i().style("label-supporter").text.use("shared/term/supporters").element}}function m(e){if(function(e){return"string"==typeof e.content&&!e.content.includes("\n")&&!e.tag}(e))return document.createTextNode(e.content);const t=e.tag?.toLowerCase();let n=t?f(t):void 0;if(n??=document.createElement("span"),Array.isArray(e.content))n.append(...e.content.map(m));else if("object"==typeof e.content&&e.content)o.WeavingArg.isRenderable(e.content)?a(e.content)?n.append(e.content.element):e.content instanceof Node?n.append(e.content):console.warn("Unrenderable weave content:",e.content):d(e.content)?n.append(...c(e.content)):n.append(m(e.content));else{const t=`${e.content??""}`.split("\n");for(let e=0;e<t.length;e++)e>0&&n.append(r().element),n.append(document.createTextNode(t[e]))}return n}e.init=function(e){i=e.Component,u=e.Link,s=e.ExternalLink,r=i.Builder("br",(e=>e.style("break"))).setName("Break"),a=i.is},e.isWeave=d,e.renderWeave=c,e.arg=p,e.args=function(e){return e.map(p)},e.toString=function(o){if(l.default.is(o)&&(o=o.value),"function"!=typeof o){const e=o;o=()=>t.quilt[e]()}return o(t.quilt,e)?.toString()??""},e.createTagElement=f}(d||(t.QuiltHelper=d={})),function(e){function t(e){return"string"==typeof e&&(e={content:[{content:e}]}),e?d.renderWeave(e):[]}e.render=t,e.Nodes=function(e,o,n){const a=n??o;return c(e,n?o:void 0,((e,o)=>{const n="object"==typeof o&&null!==o?o.toString():o;e.state.value!==n&&(e.state.asMutable?.setValue(n),a(t(o)))}))}}(p||(p={})),t.default=p})),define("ui/utility/TextManipulator",["require","exports","ui/utility/StringApplicator"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=function(e,t=e){return function n(a){const i=a.rehost;return Object.assign(a,{prepend:n=>(t.prepend(...o.default.render(n)),e),append:n=>(t.append(...o.default.render(n)),e),rehost:e=>n(i(e))})}(o.default.Nodes(e,(e=>(t.removeContents(),t.append(...e),e))))}})),define("ui/component/core/Button",["require","exports","ui/Component","ui/InputBus","ui/utility/BrowserListener","ui/utility/FontsListener","ui/utility/TypeManipulator","utility/State","utility/Type"],(function(e,t,o,n,a,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u);const s=o.default.Builder("button",(e=>{const t=new Set,s=l.default.Generator((()=>!!t.size)),d=(0,l.default)(!1);let c;const p=(0,l.default)(null,!1),f=p.mapManual((e=>!!e?.length));let m,v;const h=new WeakMap,g=e.and(n.HandlesMouseEvents).attributes.set("type","button").style("button").style.bind(a.default.isWebkit,"button--webkit").style.bind(s,"button--disabled").style.bind(d,"button--has-subtext").attributes.bind(s,"disabled").extend((e=>({textWrapper:void 0,subTextWrapper:void 0,subText:void 0,disabled:s,type:r.default.Style(e,(e=>`button-type-${e}`)),setDisabled(o,n){const a=t.size;return o?t.add(n):t.delete(n),t.size!==a&&s.refresh(),e},bindDisabled:(t,o)=>(h.get(t)?.(),h.set(t,t.use(e,((t,n)=>{"string"==typeof t?e.setDisabled(!!t,t||n):e.setDisabled(!!t,o??"")}))),e),unbindDisabled:(t,o)=>(h.get(t)?.(),h.delete(t),e.setDisabled(!1,o??u.default.as("string",t.value)??""),e),setIcon:t=>(v?.(),v=void 0,y(t),e),bindIcon:t=>(v?.(),v=t.use(e,y),e),useGradient:t=>(c?.(),c=p.bind(e,l.default.get(t)),e)}))).style.bind(f,"button--gradient").style.bindVariable("button-gradient",p.map(e,(e=>e?.length?`${e.map((e=>`#${e.toString(16).padStart(6,"0")}`)).map((e=>`light-dark(\n\t\t\t\t\toklch(from ${e} max(var(--button-gradient-light-max), L) C H / var(--button-gradient-opacity)),\n\t\t\t\t\toklch(from ${e} min(var(--button-gradient-dark-min), L) C H / var(--button-gradient-opacity))\n\t\t\t\t)`)).join(", ")}`:void 0))).extendJIT("textWrapper",(e=>(0,o.default)().style("button-text").appendTo(e))).extendJIT("text",(e=>e.textWrapper.text.rehost(e))).extendJIT("subTextWrapper",(e=>(d.value=!0,(0,o.default)().style("button-subtext").appendTo(e)))).extendJIT("subText",(e=>e.subTextWrapper.text.rehost(e)));return g;function y(e){if(!e)return g.icon?.remove(),void delete g.icon;g.icon??=(0,o.default)().style("button-icon").style.bind(d,"button-icon--has-subtext").style.bind(i.default.loaded.not,"button-icon--no-icon").prependTo(g),g.icon.style.bind(g.type.state.map(g.icon,(e=>e.has("icon"))),"button-icon--type-icon"),m&&g.icon.style.remove(`button-icon-${m}`),m=e,m&&g.icon.style(`button-icon-${m}`)}}));t.default=s})),define("ui/component/core/Label",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Form","ui/view/shared/component/View","utility/State"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AutoLabel=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder("label",(e=>{e.style("label");const a=(0,o.default)().style("label-text").appendTo(e),i=(0,n.default)().style("label-info-button","label-info-button--hidden").type("icon").setIcon("circle-question").tweak((e=>e.icon?.style("label-info-button-icon"))).appendTo(e);let l,u;return e.extend((e=>({textWrapper:a,for:(0,r.default)(void 0),setFor:t=>(e.attributes.set("for",t),e.for.asMutable?.setValue(t),e),setRequired:(t=!0)=>(e.style.unbind(l),l=void 0,"boolean"==typeof t?a.style.toggle(t,"label-required"):a.style.bind(l=t,"label-required"),e),setInput:o=>{u?.(),u=void 0,e.is(t.AutoLabel)||e.setFor(o?.name.value),e.setRequired(o?.required);const n=r.default.Owner.create();o&&r.default.Use(n,{invalid:o.invalid,touched:o.touched}).use(n,(({invalid:t,touched:o})=>e.style.toggle(!!t&&(o??!0),"label--invalid")));const a=o?.hasPopover.use(e,(e=>{i.style.toggle(!e,"label-info-button--hidden")}));function l(){const e=o?.getPopover();(e?.lastStateChangeTime??1/0)+10>=Date.now()||o?.getPopover()?.toggle().anchor.apply()}return i.event.subscribe("click",l),u=o?()=>{n.remove(),a?.(),i.event.unsubscribe("click",l),u=void 0}:void 0,e}}))).extendJIT("text",(e=>e.textWrapper.text.rehost(e)))}));t.default=l;let u=0;t.AutoLabel=o.default.Builder("label",(e=>{const t=u++,o=e.and(l);let n,r,s;return o.receiveInsertEvents(),o.receiveAncestorInsertEvents(),o.event.subscribe(["insert","ancestorInsert"],(()=>{s?.();const e=o.closest(a.default);s=e?.name.use(o,(e=>n=e));const t=o.closest(i.default);r=t?t.hash:"_",d()})),o.text.state.use(o,(()=>d())),o.extend((e=>({})));function d(){const e=o.text.state.value?.toString().toLowerCase().replace(/\W+/g,"-");e?n?o.setFor(`${r}--${n}--${e}`):o.setFor(`${r}--${e}--${t}`):o.setFor()}}))})),define("ui/utility/AttributeManipulator",["require","exports","ui/utility/StringApplicator","utility/State"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),t.default=function(e){let t,a=!1;const i=new Map,r=new Map;return n.default.Owner.getOwnershipState(e)?.matchManual(!0,(()=>{a=!0;for(const e of Object.values(t??{}))e.unuse();t=void 0})),{has:t=>e.element.hasAttribute(t),get:t=>r.compute(t,(()=>(0,n.default)(e.element.getAttribute(t)??void 0))),append(...o){for(const n of o)t?.[n]?.unuse(),delete t?.[n],e.element.setAttribute(n,""),r.get(n)?.asMutable?.setValue("");return e},prepend(...t){const o={};for(const t of[...e.element.attributes])o[t.name]=t.value,e.element.removeAttribute(t.name);for(const n of t){const t=o[n]??"";e.element.setAttribute(n,t),r.get(n)?.asMutable?.setValue(t)}for(const t of Object.keys(o))e.element.setAttribute(t,o[t]);return e},insertBefore(t,...o){const n={};for(const t of[...e.element.attributes])n[t.name]=t.value,e.element.removeAttribute(t.name);for(const a of Object.keys(n)){if(a===t)for(const t of o){const o=n[t]??"";e.element.setAttribute(t,o),r.get(t)?.asMutable?.setValue(o)}e.element.setAttribute(a,n[a])}return e},insertAfter(t,...o){const n={};for(const t of[...e.element.attributes])n[t.name]=t.value,e.element.removeAttribute(t.name);if(!(t in n))for(const t of o){const o=n[t]??"";e.element.setAttribute(t,o),r.get(t)?.asMutable?.setValue(o)}for(const a of Object.keys(n))if(e.element.setAttribute(a,n[a]),a===t)for(const t of o){const o=n[t]??"";e.element.setAttribute(t,o),r.get(t)?.asMutable?.setValue(o)}return e},set:(o,n)=>(t?.[o]?.unuse(),delete t?.[o],void 0===n?(e.element.removeAttribute(o),r.get(o)?.asMutable?.setValue(void 0)):(e.element.setAttribute(o,n),r.get(o)?.asMutable?.setValue(n)),e),bind(...t){if("string"==typeof t[0]){let[o,a]=t;a=n.default.get(a),i.get(o)?.(),i.set(o,a.use(e,(t=>{void 0===t?(e.element.removeAttribute(o),r.get(o)?.asMutable?.setValue(void 0)):(e.element.setAttribute(o,t),r.get(o)?.asMutable?.setValue(t))})))}else{let[o,n,a,l]=t;i.get(n)?.(),i.set(n,o.use(e,(t=>{t?(a??="",e.element.setAttribute(n,a),r.get(n)?.asMutable?.setValue(a)):void 0!==l?(e.element.setAttribute(n,l),r.get(n)?.asMutable?.setValue(l)):(e.element.removeAttribute(n),r.get(n)?.asMutable?.setValue(void 0))})))}return e},compute(o,n){if(e.element.hasAttribute(o))return e;t?.[o]?.unuse(),delete t?.[o];const a=n(e);return void 0===a?(e.element.removeAttribute(o),r.get(o)?.asMutable?.setValue(void 0)):(e.element.setAttribute(o,a),r.get(o)?.asMutable?.setValue(a)),e},getUsing:e=>t?.[e]?.handler,use(n,i){if(a)return e;t??={},t[n]={handler:i,unuse:void 0};const l=o.Quilt.State.useManual((a=>{const i=t?.[n];if(!i)return;const l=i.handler,u="string"==typeof l?a[l]():l(a,o.QuiltHelper),s=u?.toString()??"";e.element.setAttribute(n,s),r.get(n)?.asMutable?.setValue(s)}));return t[n].unuse=l,e},remove(...o){for(const n of o)t?.[n]?.unuse(),delete t?.[n],e.element.removeAttribute(n),r.get(n)?.asMutable?.setValue(void 0);return e},toggle(e,t,o=""){return this[e?"set":"remove"](t,o)},copy(t){"element"in t&&(t=t.element);for(const o of t.attributes)e.element.setAttribute(o.name,o.value),r.get(o.name)?.asMutable?.setValue(o.value);return e}}}})),define("ui/utility/ClassManipulator",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{has:(...t)=>t.every((t=>e.element.classList.contains(t))),some:(...t)=>t.some((t=>e.element.classList.contains(t))),add:(...t)=>(e.element.classList.add(...t),e),remove:(...t)=>(e.element.classList.remove(...t),e),toggle(e,...t){return this[e?"add":"remove"](...t)},copy:t=>("element"in t&&(t=t.element),e.element.classList.add(...t.classList),e)}}})),define("utility/SelfScript",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)(void 0)})),define("utility/Import",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return!!window.hasModule?.(e)}e.hasModule=t,e.getModule=function(e){const o=t(e)?window.getModule?.(e):void 0;return o&&"default"in o?o.default:o}}(o||(o={})),t.default=o})),define("utility/SourceMapping",["require","exports","utility/Import","utility/State"],(function(e,t,o,n){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),function(e){const t=Error.prepareStackTrace;let a=t;e.init=function(){o.default.getModule("browser-source-map-support")?.install({environment:"browser"}),a=Error.prepareStackTrace},e.Enabled=(0,n.default)(!0),e.Enabled.useManual((e=>Error.prepareStackTrace=e?a:t))}(a||(a={})),t.default=a})),define("ui/Component",["require","exports","lang/en-nz","ui/utility/AnchorManipulator","ui/utility/AttributeManipulator","ui/utility/ClassManipulator","ui/utility/EventManipulator","ui/utility/FocusListener","ui/utility/StringApplicator","ui/utility/StyleManipulator","ui/utility/TextManipulator","ui/utility/Viewport","utility/Arrays","utility/Async","utility/Define","utility/Env","utility/Errors","utility/Objects","utility/SelfScript","utility/SourceMapping","utility/State","utility/string/Strings"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w){Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentPerf=t.ComponentInsertionDestination=void 0,n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importStar(g),y=__importDefault(y),_=__importDefault(_),b=__importDefault(b),w=__importDefault(w);Symbol("COMPONENT_BRAND");const k=new WeakMap;var T,x;m.default.magic(Element.prototype,"component",{get(){return k.get(this)},set(e){e?k.set(this,e):k.delete(this)}}),function(e){e.is=function(e){return"object"==typeof e&&!!e?.isInsertionDestination}}(T||(t.ComponentInsertionDestination=T={})),function(e){e.ReceiveRootedEvents="_receive-rooted-events",e.ReceiveAncestorInsertEvents="_receieve-ancestor-insert-events",e.ReceiveDescendantInsertEvents="_receieve-descendant-insert-events",e.ReceiveDescendantRemoveEvents="_receieve-descendant-remove-events",e.ReceiveAncestorRectDirtyEvents="_receieve-ancestor-rect-dirty-events",e.ReceiveChildrenInsertEvents="_receive-children-insert-events",e.ReceiveInsertEvents="_receive-insert-events",e.ReceiveScrollEvents="_receieve-scroll-events",e.HasRect="_has-rect",e.HasStatesToMarkDirtyOnInsertions="_has-states-to-mark-dirty-on-insertions"}(x||(x={}));const D=Symbol("RECT_STATE"),E=Symbol("CALLBACKS_ON_INSERTIONS");var O;!function(e){function t(e){return e?.[D]}let o;e.Rect=t,function(e){e.assign=function(e,t){e[D]=t}}(t=e.Rect||(e.Rect={})),function(e){e.add=function(e,t){(e[E]??=[]).push(t)},e.get=function(e){return e?.[E]??[]}}(o=e.CallbacksOnInsertions||(e.CallbacksOnInsertions={}))}(O||(t.ComponentPerf=O={}));const M=[];function S(e="span"){if(!I)throw new Error("Components cannot be built yet");let t,f,v,y,_,D,E;const C=new Map,R={};let $={supers:(0,b.default)([]),isComponent:!0,isInsertionDestination:!0,element:document.createElement(e),removed:(0,b.default)(!1),rooted:(0,b.default)(!1),nojit:R,get tagName(){return $.element.tagName},setOwner:e=>(_?.(),_=b.default.Owner.getOwnershipState(e)?.use($,(e=>e&&$.remove())),$),replaceElement:(t,o)=>{if("string"==typeof t&&t.toUpperCase()===$.element.tagName.toUpperCase())return $;"string"==typeof t&&(t=document.createElement(t));const n=$.element;return o||(S.removeContents(t),t.replaceChildren(...$.element.childNodes)),$.element.parentNode&&$.element.replaceWith(t),$.element=t,e=$.element.tagName,k.delete(n),k.set(t,$),$.attributes.copy(n),$.style.refresh(),$},is:e=>!e||(Array.isArray(e)?e:[e]).some((e=>$.supers.value.includes(e))),as:e=>!e||$.supers.value.includes(e)?$:void 0,cast:()=>$,and(e,...t){if($.is(e))return $;const o=e.from($,...t);return o instanceof Promise?o.then((t=>($=t,$.supers.value.push(e),$.supers.emit(),e.name&&$.attributes.prepend(`:${e.name.kebabcase}`),$))):($=o,$.supers.value.push(e),$.supers.emit(),e.name&&$.attributes.prepend(`:${e.name.kebabcase}`),$)},extend:e=>Object.assign($,e($)),override:(e,t)=>{const o=$[e];return $[e]=t($,o),$},extendMagic:(e,t)=>(m.default.magic($,e,t($)),$),extendJIT:(e,t)=>(m.default.magic($,e,{get:()=>{const o=t($);m.default.set($,e,o);const n=C.get(e);if(n&&!0!==n)for(const e of n)e(o,$);return C.set(e,!0),o},set:t=>{m.default.set($,e,t),R[e]=t}}),$),tweakJIT:(e,t)=>{const o=C.compute(e,(()=>new Set));return!0===o?t($[e],$):o.add(t),$},tweak:(e,...t)=>(e?.($,...t),$),get style(){return m.default.set($,"style",(0,s.default)($))},get classes(){return m.default.set($,"classes",(0,i.default)($))},get attributes(){return m.default.set($,"attributes",(0,a.default)($))},get event(){return m.default.set($,"event",(0,r.default)($))},get text(){return m.default.set($,"text",(0,d.default)($))},get anchor(){return m.default.set($,"anchor",(0,n.default)($))},get hovered(){return m.default.set($,"hovered",$.hoveredTime.mapManual((e=>!!e)))},get hoveredTime(){return m.default.set($,"hoveredTime",(0,b.default)(void 0))},get focused(){return m.default.set($,"focused",$.focusedTime.mapManual((e=>!!e)))},get focusedTime(){return m.default.set($,"focusedTime",(0,b.default)(void 0))},get hasFocused(){return m.default.set($,"hasFocused",$.hasFocusedTime.mapManual((e=>!!e)))},get hasFocusedTime(){return m.default.set($,"hasFocusedTime",(0,b.default)(void 0))},get hadFocusedLast(){return m.default.set($,"hadFocusedLast",(0,b.default)(!1))},get hoveredOrFocused(){return m.default.set($,"hoveredOrFocused",$.hoveredOrFocusedTime.mapManual((e=>!!e)))},get hoveredOrFocusedTime(){return m.default.set($,"hoveredOrFocusedTime",b.default.Generator((()=>Math.max($.hoveredTime.value??0,$.focusedTime.value??0)||void 0)).observe($,$.hoveredTime,$.focusedTime))},get hoveredOrHasFocused(){return m.default.set($,"hoveredOrHasFocused",$.hoveredOrHasFocusedTime.mapManual((e=>!!e)))},get hoveredOrHasFocusedTime(){return m.default.set($,"hoveredOrHasFocusedTime",b.default.Generator((()=>Math.max($.hoveredTime.value??0,$.hasFocusedTime.value??0)||void 0)).observe($,$.hoveredTime,$.hasFocusedTime))},get active(){return m.default.set($,"active",$.activeTime.mapManual((e=>!!e)))},get activeTime(){return m.default.set($,"activeTime",(0,b.default)(void 0))},get id(){return m.default.set($,"id",(0,b.default)(void 0))},get name(){return m.default.set($,"name",(0,b.default)(void 0))},get rect(){const e=b.default.JIT((()=>$.element.getBoundingClientRect()));O.Rect.assign($,e);const t=e.markDirty;return e.markDirty=()=>{t();for(const e of this.element.getElementsByClassName(x.HasRect))O.Rect(e.component)?.markDirty();for(const e of this.element.getElementsByClassName(x.ReceiveAncestorRectDirtyEvents))e.component?.event.emit("ancestorRectDirty");return e},this.classes.add(x.HasRect),c.default.size.subscribe($,e.markDirty),m.default.set($,"rect",e)},get fullType(){return($.tagName.startsWith(":")?"":`<${$.tagName}> `)+($.supers.value.length?":"+$.supers.value.map((e=>e.name.kebabcase)).join(" :"):"")},setId:e=>{return t?.(),t=void 0,e&&"string"!=typeof e?t=e.use($,o):o(e),$;function o(e){e?($.element.setAttribute("id",e),$.id.asMutable?.setValue(e)):($.element.removeAttribute("id"),$.id.asMutable?.setValue(void 0))}},setRandomId:()=>($.setId(w.default.uid()),$),setName:e=>{return f?.(),f=void 0,e&&"string"!=typeof e?f=e.use($,t):t(e),$;function t(e){e?(e=e.replace(/[^\w-]+/g,"-").toLowerCase(),$.element.setAttribute("name",e),$.name.asMutable?.setValue(e)):($.element.removeAttribute("name"),$.name.asMutable?.setValue(void 0))}},disableInsertion:()=>$,remove(){$.removeContents(),$.removed.asMutable?.setValue(!0),$.rooted.asMutable?.setValue(!1),$.element.component=void 0,$.element.remove(),function(e){if(!e)return;let t=e.element.parentElement;for(;t;)t.classList.contains(x.ReceiveDescendantRemoveEvents)&&t.component?.event.emit("descendantRemove"),t=t.parentElement}($),$.classes.has(x.ReceiveRootedEvents)&&$.event.emit("unroot"),_?.(),_=void 0,y?.(),y=void 0,v?.(),v=void 0,t?.(),t=void 0,f?.(),f=void 0},appendTo:e=>(e.append($.element),$.emitInsert(),$),prependTo:e=>(e.prepend($.element),$.emitInsert(),$),insertTo(e,t,o){if(T.is(e))return e.insert(t,o,$),$.emitInsert(),$;const n=o?S.element(o):null;return"before"===t?e.insertBefore($.element,n):e.insertBefore($.element,n?.nextSibling??null),$.emitInsert(),$},append(...e){const t=e.filter(p.Truthy).map(S.element);$.element.append(...t);for(const e of t)e.component?.emitInsert();return $.classes.has(x.ReceiveChildrenInsertEvents)&&$.event.emit("childrenInsert",t),$},prepend(...e){const t=e.filter(p.Truthy).map(S.element);$.element.prepend(...t);for(const e of t)e.component?.emitInsert();return $.classes.has(x.ReceiveChildrenInsertEvents)&&$.event.emit("childrenInsert",t),$},insert(e,t,...o){const n=t?S.element(t):null,a=o.filter(p.Truthy).map(S.element);if("before"===e)for(let e=a.length-1;e>=0;e--)$.element.insertBefore(a[e],n);else for(const e of a)$.element.insertBefore(e,n?.nextSibling??null);for(const e of a)e.component?.emitInsert();return $.classes.has(x.ReceiveChildrenInsertEvents)&&$.event.emit("childrenInsert",a),$},removeContents:()=>(S.removeContents($.element),$),closest:e=>S.closest(e,$),getStateForClosest(e){const t=b.default.JIT((()=>$.closest(e)));return O.CallbacksOnInsertions.add($,t.markDirty),$.classes.add(x.HasStatesToMarkDirtyOnInsertions),t},get parent(){return $.element.parentElement?.component},get previousSibling(){return $.element.previousElementSibling?.component},getPreviousSibling(e){const[t]=$.getPreviousSiblings(e);return t},get nextSibling(){return $.element.nextElementSibling?.component},getNextSibling(e){const[t]=$.getNextSiblings(e);return t},*getAncestorComponents(e){let t=$.element;for(;t;){t=t.parentElement;const o=t?.component;o?.is(e)&&(yield o)}},*getChildren(e){for(const t of $.element.children){const o=t.component;o?.is(e)&&(yield o)}},*getSiblings(e){const t=$.element.parentElement;for(const o of t?.children??[])if(o!==$.element){const t=o.component;t?.is(e)&&(yield t)}},*getPreviousSiblings(e){const t=$.element.parentElement;for(const o of t?.children??[]){if(o===$.element)break;const t=o.component;t?.is(e)&&(yield t)}},*getNextSiblings(e){let t=$.element;for(;t=t.nextElementSibling;){const o=t.component;o?.is(e)&&(yield o)}},*getDescendants(e){const t=document.createTreeWalker($.element,NodeFilter.SHOW_ELEMENT);let o;for(;o=t.nextNode();){const t=o.component;t?.is(e)&&(yield t)}},getFirstDescendant(e){const[t]=$.getDescendants(e);return t},receiveRootedEvents:()=>($.element.classList.add(x.ReceiveRootedEvents),$),receiveAncestorInsertEvents:()=>($.element.classList.add(x.ReceiveAncestorInsertEvents),$),receiveDescendantInsertEvents:()=>($.element.classList.add(x.ReceiveDescendantInsertEvents),$),receiveDescendantRemoveEvents:()=>($.element.classList.add(x.ReceiveDescendantRemoveEvents),$),receiveAncestorScrollEvents:()=>($.element.classList.add(x.ReceiveScrollEvents),$),receiveChildrenInsertEvents:()=>($.element.classList.add(x.ReceiveChildrenInsertEvents),$),receiveInsertEvents:()=>($.element.classList.add(x.ReceiveInsertEvents),$),emitInsert:()=>(function(e){if(e){const t=document.documentElement.contains(e.element);if(e.rooted.value===t)return;e.rooted.asMutable?.setValue(t),e.classes.has(x.ReceiveRootedEvents)&&e.event.emit(t?"root":"unroot");for(const o of e.element.querySelectorAll("*")){const e=o.component;e&&(e.rooted.asMutable?.setValue(t),e.classes.has(x.ReceiveRootedEvents)&&e.event.emit(t?"root":"unroot"))}}}($),function(e){if(!e)return;O.Rect(e)?.markDirty();for(const t of O.CallbacksOnInsertions.get(e))t();e.classes.has(x.ReceiveInsertEvents)&&e.event.emit("insert");const t=e.element.getElementsByClassName(x.ReceiveAncestorInsertEvents);for(const e of t)e.component?.event.emit("ancestorInsert");for(const t of e.element.getElementsByClassName(x.HasRect))O.Rect(t.component)?.markDirty();for(const t of e.element.getElementsByClassName(x.HasStatesToMarkDirtyOnInsertions))for(const e of O.CallbacksOnInsertions.get(t.component))e();let o=e.element.parentElement;for(;o;)o.classList.contains(x.ReceiveDescendantInsertEvents)&&o.component?.event.emit("descendantInsert"),o=o.parentElement}($),$),monitorScrollEvents:()=>(D??=($.element===window?document.documentElement:$.element).getElementsByClassName(x.ReceiveScrollEvents),E??=($.element===window?document.documentElement:$.element).getElementsByClassName(x.HasRect),$.event.subscribe("scroll",(()=>{for(const e of[...D])e.component?.event.emit("ancestorScroll");for(const e of[...E])O.Rect(e.component)?.markDirty()})),$),onRooted:e=>($.rooted.matchManual(!0,(()=>e($))),$),onRemove:(e,t)=>($.removed.match(e,!0,(()=>t($))),$),onRemoveManual:e=>($.removed.matchManual(!0,(()=>e($))),$),ariaRole:e=>e?$.attributes.set("role",e):$.attributes.remove("role"),get ariaLabel(){return m.default.set($,"ariaLabel",(0,u.default)($,(e=>$.attributes.set("aria-label",e))))},ariaLabelledBy:e=>{if(v?.(),v=void 0,e){const t=b.default.Generator((()=>e.id.value??e.attributes.get("for"))).observe($,e.id,e.cast()?.for);v=t.use($,(e=>$.attributes.set("aria-labelledby",e)))}return $},ariaHidden:()=>$.attributes.set("aria-hidden","true"),ariaChecked:e=>(e.use($,(e=>$.attributes.set("aria-checked",`${e}`))),$),ariaControls:e=>(y?.(),y=e?.id.use($,(e=>$.attributes.set("aria-controls",e))),$),tabIndex:e=>(void 0===e?$.element.removeAttribute("tabindex"):"programmatic"===e?$.element.setAttribute("tabindex","-1"):"auto"===e?$.element.setAttribute("tabindex","0"):$.element.setAttribute("tabindex",`${e}`),$),focus:()=>(l.default.focus($.element),$),blur:()=>(l.default.blur($.element),$)};o.WeavingArg.setRenderable($,(()=>$.element.textContent??"")),g.default.stringify.disable($);for(const e of M)e($);if(!S.is($))throw h.default.Impossible();return $.element.component=$,$}let I=!1;!function(e){let t,o,n;function a(e){return"object"==typeof e&&!!e?.isComponent}function i(t){const o=e();return(0,g.mutable)(o).element=t,o}e.getBody=()=>t??=i(document.body),e.getDocument=()=>o??=i(document.documentElement),e.getWindow=()=>n??=i(window),e.allowBuilding=function(){I=!0},e.is=a,e.element=function(e){return a(e)?e.element:e},e.wrap=i,e.SYMBOL_COMPONENT_TYPE_BRAND=Symbol("COMPONENT_TYPE_BRAND");const r=t=>e(t);function l(e){return{name:T(),from:e,setName(e){return(0,g.mutable)(this).name=p(e),this}}}e.Builder=function(e,t){let o=T();const n="string"==typeof e?e:void 0,a=t&&"string"!=typeof e?e:r;t??=e;const i=(e=a(n),...o)=>{const i=t(e,...o);return i instanceof Promise?i.then((t=>(t!==e&&c(e),t))):(i!==e&&c(e),i)},l=(...e)=>{const t=i(void 0,...e);return t instanceof Promise?t.then(d):d(t)};Object.defineProperty(t,"name",{value:o,configurable:!0}),Object.defineProperty(t,Symbol.toStringTag,{value:o,configurable:!0}),Object.defineProperty(i,"name",{value:o,configurable:!0}),Object.defineProperty(i,Symbol.toStringTag,{value:o,configurable:!0}),Object.defineProperty(l,"name",{value:o,configurable:!0}),Object.defineProperty(l,Symbol.toStringTag,{value:o,configurable:!0});const u=[],s=Object.assign(l,{from:i,setName:e=>(o=p(e),Object.defineProperty(l,"name",{value:o}),s),extend:e=>(u.push(e),s)});return s;function d(e){if(!e)return e;for(const t of u)Object.assign(e,t(e));if(o&&v.default.isDev){e[Symbol.toStringTag]??=o.toString();const t=`:${o.kebabcase}`;"SPAN"===e.element.tagName?e.replaceElement(t):e.attributes.prepend(t)}return e.supers.value.push(l),e.supers.emit(),e}async function c(e){if(!e||!b.default.OwnerMetadata.hasSubscriptions(e))return;const t=new WeakRef(e);e=void 0,await f.default.sleep(1e3),!(e=t.deref())||e.rooted.value||e.removed.value||console.error(`${String(o??"Component")} builder returned a replacement component, but the original component was used as a subscription owner and is not in the tree!`)}},e.Extension=l,e.Tag=function(){return l((e=>e))},e.extend=function(e){M.push(e)},e.get=function(e){if(e&&("object"==typeof e||"function"==typeof e))return k.get(e)};const u=/\(http.*?\w+\.[tj]s:(\d+):\d+\)|@http.*?\w+\.[tj]s:(\d+):\d+/,s=/\s*(?:const |exports\.(?!default))(\w+) = /,d=/.*\bdefine\("(?:[^"]+\/)*(\w+)", /s,c=/(?<=[a-z0-9_-])(?=[A-Z])/g;function p(e){return Object.assign(String(e),{kebabcase:e.replaceAll(c,"-").toLowerCase()})}let m,h;function T(){if(!h){if(m??=document.currentScript?.text??y.default.value,!m)return;h=m.split("\n")}_.default.Enabled.value=!1;const e=(new Error).stack??"",t=w.default.shiftLine(e,e.includes("@")?2:3);_.default.Enabled.value=!0;const o=t.match(u),n=Number(o?.[1]??o?.[2]),a=h[n-1];if(!a)return;const i=a.match(s)?.[1];if(i)return p(i);const r=m.slice(0,m.indexOf(a)),l=r.match(d)?.[1];return l?p(l):void 0}e.removeContents=function e(t){for(const o of[...t.childNodes])o.component?o.component.remove():(e(o),o.remove())},e.closest=function(e,t){let o=a(t)?t.element:t??null;for(;o;){const t=o?.component;if(t?.is(e))return t;o=o.parentElement}}}(S||(S={})),t.default=S})),define("utility/State",["require","exports","utility/Arrays","utility/Define","utility/Functions","utility/Objects"],(function(e,t,o,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),n=__importDefault(n),a=__importDefault(a),i=__importStar(i);const r=Symbol("VALUE"),l=Symbol("SUBSCRIBERS");function u(e,t){let o,s;const d=new WeakMap,c={isState:!0,setId:e=>(c.id=e,c),[r]:e,[l]:[],get value(){return c[r]},set value(e){o?.(),p(e)},setValue:e=>(o?.(),p(e),c),setValueSilent:e=>(o?.(),f(e),c),comparator:e=>!1!==t&&(c[r]===e||t?.(c[r],e)||!1),emit:e=>{void 0!==c.id&&console.log("emit",c.id);for(const t of c[l].slice())t(c[r],e);return c},bind:(e,t)=>(t.id&&console.log("bind",t.id),o?.(),o=t.use(e,p),o),bindManual:e=>(e.id&&console.log("bind",e.id),o?.(),o=e.useManual(p),o),use:(e,t)=>{let o;return c.subscribe(e,n),n(c[r],void 0),d.set(t,n),()=>c.unsubscribe(n);function n(e,n){o?.remove(),o=u.Owner.create(),t(e,n,o)}},useManual:e=>{let t;return c.subscribeManual(o),o(c[r],void 0),d.set(e,o),()=>c.unsubscribe(o);function o(o,n){t?.remove(),t=u.Owner.create(),e(o,n,t)}},subscribe:(e,t)=>{const o=u.Owner.getOwnershipState(e);if(!o||o.value)return a.default.NO_OP;function n(){o.unsubscribe(n),c.unsubscribe(t)}return u.OwnerMetadata.setHasSubscriptions(e),o.subscribeManual(n),c.subscribeManual(t),n},subscribeManual:e=>(c[l].push(e),()=>c.unsubscribe(e)),unsubscribe:e=>{const t=d.get(e);return c[l].filterInPlace((o=>o!==e&&o!==t)),c},match:(e,t,o)=>c.use(e,(function e(n){(n===t||Array.isArray(t)&&t.includes(n))&&(c.unsubscribe(e),o(n))})),matchManual:(e,t)=>c.useManual((function o(n){(n===e||Array.isArray(e)&&e.includes(n))&&(c.unsubscribe(o),t(n))})),await:(e,t)=>new Promise((o=>c.match(e,t,(()=>{o(c.value)})))),map:(e,t,o)=>u.Map(e,[c],t,o),mapManual:(e,t)=>u.MapManual([c],e,t),get nonNullish(){return n.default.set(c,"nonNullish",u.Generator((()=>void 0!==c.value&&null!==c.value)).observeManual(c))},get truthy(){return n.default.set(c,"truthy",u.Generator((()=>!!c.value)).observeManual(c))},get not(){return m()},get falsy(){return m()},equals:e=>(s??=new Map,s.compute(e,(()=>u.Generator((()=>c.value===e)).observeManual(c)))),coalesce(e){const t=u.get(e);return u.Generator((()=>{const e=c.value;return null!=e?e:t.value})).observeManual(c,t)},delay(e,t,o,n){const i=u(o?o(c.value):c.value,n);let r;return c.subscribe(e,(e=>{window.clearTimeout(r);const n=a.default.resolve(t,e);if(!n)return i.value=o?o(e):e;r=window.setTimeout((()=>{i.value=o?o(e):e}),n)})),i}};return c.asMutable=c,i.default.stringify.disable(c);function p(e){const t=c[r];f(e)&&c.emit(t)}function f(e){return(!1===t||c[r]!==e&&!t?.(c[r],e))&&(c[r]=e,!0)}function m(){const e=u.Generator((()=>!c.value)).observeManual(c);return n.default.set(c,"not",e),n.default.set(c,"falsy",e),e}}!function(e){let t;function u(e){return"object"==typeof e&&!0===e?.isState}!function(t){function o(e){const t=e;return t?.removed??t?.closed}function n(){const t=e(!1);return{removed:t,remove:()=>t.value=!0}}t.getOwnershipState=o,t.getCombined=function(...e){const t=n();for(const n of e)o(n).match(t,!0,(()=>t.remove()));return t},t.create=n,t.sub=function(t){const o=e.Owner.create();return e.Owner.getOwnershipState(t).match(o,!0,o.remove),o}}(t=e.Owner||(e.Owner={})),e.is=u,e.get=function(t){return u(t)?t:e(t)},e.value=function(e){return u(e)?e.value:e},e.getInternalValue=function(e){return u(e)?e[r]:e};const s=Symbol("HAS_SUBSCRIPTIONS");let d;function c(o,a){const i=e(void 0,a);delete i.asMutable,n.default.magic(i,"value",{get:()=>i[r]});let l,u=!0;return i.refresh=()=>s(),i.regenerate=()=>s(!0),i.refresh(),i.observe=(e,...o)=>{const n=t.getOwnershipState(e);if(!n||n.value)return i;d.setHasSubscriptions(e);for(const e of o)e?.subscribeManual(i.refresh);let a=n.subscribeManual((e=>e&&function(){a?.(),a=void 0;for(const e of o)e?.unsubscribe(i.refresh)}()));return i},i.observeManual=(...e)=>{for(const t of e)t?.subscribeManual(i.refresh);return i},i.unobserve=(...e)=>{for(const t of e)t?.unsubscribe(i.refresh);return i},i;function s(t){l?.(),l=void 0;const n=o();if(e.is(n))return l=n.useManual((e=>{if(i.comparator(e))return i;const t=i[r];i[r]=e,i.emit(t)})),i;if(i.comparator(n)&&!u&&!t)return i;u=!1;const a=i[r];return i[r]=n,i.emit(a),i}}function p(t,o,n){const a=e({settled:!1,value:void 0,lastValue:void 0,error:void 0,progress:void 0}),r=a.mapManual((e=>e.settled)),l=a.mapManual((e=>e.error)),u=a.mapManual((e=>e.value)),s=a.mapManual((e=>e.lastValue)),d=a.mapManual((e=>e.progress));let c,p;o.use(t,(async e=>{c?.abort();const t=a.value.value;a.value={settled:!1,value:void 0,lastValue:t,error:void 0,progress:void 0},c=new AbortController,p=Promise.resolve(n(e,c.signal,((e,t)=>{(0,i.mutable)(a.value).progress={progress:e,message:t},a.emit()})));const{value:o,error:r}=await p.then((e=>({value:e,error:void 0})),(e=>({error:new Error("Async state rejection:",{cause:e}),value:void 0})));c.signal.aborted||(a.value={settled:!0,value:o,lastValue:t,error:r,progress:void 0})}));const f=Object.assign(u,{settled:r,lastValue:s,error:l,state:a,progress:d});return Object.defineProperty(f,"promise",{get:()=>p}),f}!function(e){e.setHasSubscriptions=function(e){e[s]=!0},e.hasSubscriptions=function(e){return!0===e[s]}}(d=e.OwnerMetadata||(e.OwnerMetadata={})),e.Generator=c,e.JIT=function(o){const a=e(void 0);delete a.asMutable;let i,r,u,s=!1;n.default.magic(a,"value",{get:()=>{if(!s){r?.(),r=void 0,u?.remove(),u=void 0,s=!0,u=t.create();const n=o(u);e.is(n)?r=n.useManual((e=>i=e)):i=n}return i}});const d=()=>a.value;return a.emit=()=>{for(const e of a[l].slice())e(d,i);return a},a.use=(t,o)=>{let n;return a.subscribe(t,i),i(d,void 0),()=>a.unsubscribe(i);function i(t,a){n?.remove(),n=e.Owner.create(),o(t,a,n)}},a.useManual=t=>{let o;return a.subscribeManual(n),n(d,void 0),()=>a.unsubscribe(n);function n(n,a){o?.remove(),o=e.Owner.create(),t(n,a,o)}},a.markDirty=()=>{r?.(),r=void 0,u?.remove(),u=void 0;const e=i;return s=!1,i=void 0,a.emit(e),a},a.observe=(...e)=>{for(const t of e)t.subscribeManual(a.markDirty);return a},a.unobserve=(...e)=>{for(const t of e)t.unsubscribe(a.markDirty);return a},a},e.Async=p,function(t){t.fromEndpoint=function(o,n){const a=e(null);return Object.assign(t(o,a,(async(e,t)=>{const o=await n.query();if(o instanceof Error)throw o;return o?.data})),{refresh(){a.emit()}})}}(p=e.Async||(e.Async={})),e.Array=function(...t){const o=[],n=[],r=Object.assign(e(t),{length:void 0,set(e,n){t[e]=n;const a=o[e];return a.value.value=n,a.emit(),r.emit(),r},emitItem:e=>(o[e]?.emit(),r),modify(e,o){let n=t[e];return n=o(n,e,r)??n,r.set(e,n),r},clear:()=>(t.length=0,o.length=0,r.emit(),r),push(...e){const n=r.value.length;t.push(...e);for(let t=0;t<e.length;t++)o.push(l(e[t],n+t));return r.emit(),r},unshift(...e){t.unshift(...e);for(let t=0;t<e.length;t++)o.unshift(l(e[t],t));for(let t=e.length;t<o.length;t++)o[t].value.index=t;for(let t=e.length;t<o.length;t++)o[t].emit();return r.emit(),r},pop:()=>(t.pop(),o.pop(),r.emit(),r),shift(){t.shift(),o.shift();for(let e=0;e<o.length;e++)o[e].value.index=e;for(const e of o)e.emit();return r.emit(),r},splice(e,n,...a){t.splice(e,n,...a),o.splice(e,n,...a.map(((t,o)=>l(t,e+o))));for(let t=e+a.length;t<o.length;t++)o[t].value.index=t;for(let t=e+a.length;t<o.length;t++)o[t].emit();return r.emit(),r},filterInPlace(e){t.filterInPlace(e);let n=0;e:for(let e=0;e<t.length;e++)for(;n<o.length;){if(o[n].value.value===t[e]){o[e]=o[n],o[e].value.index=e,n++;continue e}o[n].value.removed.asMutable?.setValue(!0),n++}for(let e=n;e<o.length;e++)o[e].value.removed.asMutable?.setValue(!0);o.length=t.length;for(const e of o)e.emit();return r.emit(),r},move(e,a,i){if(e=Math.max(0,e),a=Math.min(a,t.length),i=Math.max(0,Math.min(i,t.length)),e>=a)return r;if(i>=e&&i<a)return r;const l=t.splice(e,a-e),u=o.splice(e,a-e),s=e<i?i-(a-e)+1:i;t.splice(s,0,...l),o.splice(s,0,...u);const d=[];for(let e=0;e<o.length;e++){o[e].value.index!==e&&(o[e].value.index=e,d.push(e))}for(const e of d)o[e]?.emit();for(const t of n)t.onMove(e,a,i);return r.emit(),r},moveAt(e,a){if(!e.length)return r;const i=t.length;e=e.map((e=>Math.max(0,Math.min(i-1,e)))).distinctInPlace().sort(((e,t)=>e-t)),a=Math.min(a,i-e.length);let l=0,u=0,s=0,d=0;const c=t.slice(),p=o.slice();let f;for(;s<i;)if(f=s>=a&&d<e.length?"moving":"static","static"===f){for(let t=l;t<i;t++)if(!e.includes(t)){l=t;break}t[s]=c[l],o[s]=p[l],l++,s++}else t[s]=c[e[u]],o[s]=p[e[u]],u++,d++,s++;const m=[];for(let e=0;e<o.length;e++){o[e].value.index!==e&&(o[e].value.index=e,m.push(e))}for(const e of m)o[e]?.emit();for(const t of n)t.onMoveAt(e,a);return r.emit(),r},useEach(t,i){const l=e.Owner.getOwnershipState(t);if(!l||l.value)return a.default.NO_OP;for(const e of o)i.onItem(e,r);return e.OwnerMetadata.setHasSubscriptions(t),l.subscribeManual(u),n.push(i),u;function u(){l.unsubscribe(u),n.filterInPlace((e=>e!==i))}}});return(0,i.mutable)(r).length=r.mapManual((e=>e.length)),r;function l(t,o){const a=e({value:t,index:o,removed:e(!1)});for(const e of n)e.onItem(a,r);return a}},e.Truthy=function(e,t){return c((()=>!!t.value)).observe(e,t)},e.NonNullish=function(e,t){return c((()=>void 0!==t.value&&null!==t.value)).observe(e,t)},e.Falsy=function(e,t){return c((()=>!!t.value)).observe(e,t)},e.Some=function(e,...t){return c((()=>t.some((e=>e.value)))).observe(e,...t)},e.Every=function(e,...t){return c((()=>t.every((e=>e.value)))).observe(e,...t)},e.Map=function(e,t,n,a){return c((()=>n(...t.map((e=>e?.value)))),a).observe(e,...t.filter(o.NonNullish))},e.MapManual=function(e,t,n){return c((()=>t(...e.map((e=>e?.value)))),n).observeManual(...e.filter(o.NonNullish))},e.Use=function(e,t){return c((()=>Object.entries(t).toObject((([e,t])=>[e,t?.value])))).observe(e,...Object.values(t).filter(o.NonNullish))},e.UseManual=function(e){return c((()=>Object.entries(e).toObject((([e,t])=>[e,t?.value])))).observeManual(...Object.values(e).filter(o.NonNullish))}}(u||(u={})),t.default=u})),define("utility/Env",["require","exports","utility/State","utility/string/Strings"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);t.default=new class{#t=!1;#o=[];state=(0,o.default)(void 0);get isDev(){return"dev"===this.ENVIRONMENT}get isNgrok(){return this.URL_ORIGIN.includes("ngrok")}async load(){const e=location.origin,t=location.pathname.startsWith("/beta/")?"/beta/":"/";Object.assign(this,_??n.default.optionalParseJSON(document.getElementById("env-json")?.textContent)??await fetch(e+t+"env.json").then((e=>e.json()))),document.documentElement.classList.add(`environment-${this.ENVIRONMENT}`),this.state.value=this,this.#t=!0;for(const e of this.#o)e();this.#o.length=0}onLoad(e,t){if("function"==typeof e)t=e,e=void 0;else if(e){const o=t;t=()=>this.ENVIRONMENT===e&&o?.()}this.#t?t?.():t&&this.#o.push(t)}}})),define("endpoint/Endpoint",["require","exports","utility/Env","utility/Objects","utility/Time"],(function(e,t,o,n,a){function i(e,t,r){let l,u="get"===t?3:1;const s={route:e,header:(e,t)=>(r??={},r[e]=t,s),headers:e=>(r={...r,...e},s),removeHeader:e=>(delete r?.[e],s),getPageSize:()=>l,setPageSize:e=>(l=e,s),setRetry:e=>(u=e,s),noResponse:()=>s.removeHeader("Accept"),query:d,prep:(o,a)=>{const u=i(e,t,r);return Object.assign(u,{query:(e,t,i)=>{e=n.default.merge(o,e),t=n.default.merge(a,t);const r=l;l=u.getPageSize();const s=d(e,t,i);return l=r,s}})}};return s;async function d(i,s,c){const p=i?.body?JSON.stringify(i.body):void 0,f=e.slice(1).replaceAll(/\{([^}]+)\}/g,((e,t)=>encodeURIComponent(String(i?.params?.[t]??"")))),m=Object.entries(s??{}).map((([e,t])=>[e,"string"==typeof t?t:JSON.stringify(t)])).collect((e=>new URLSearchParams(e)));l&&m.set("page_size",`${l}`);const v=m.size?"?"+m.toString():"";let h,g,y=!0;for(let e=0;y&&e<u;e++){h=void 0,g=void 0,y=!1;const e=AbortSignal.timeout(a.default.seconds(7));g=await fetch(`${o.default.API_ORIGIN}${f}${v}`,{method:t,headers:n.default.filterNullish({...o.default.API_ORIGIN.includes("ngrok")?{"ngrok-skip-browser-warning":"true"}:void 0,"Content-Type":p?"application/json":void 0,Accept:"application/json","App-Build-Number":o.default.BUILD_NUMBER,"App-Build-SHA":o.default.BUILD_SHA,...r}),credentials:"include",body:p,signal:c?AbortSignal.any([e,c]):e}).catch((e=>{if("AbortError"===e.name||"TimeoutError"===e.name)return y=!0,void(h=Object.assign(new Error("Request timed out"),{code:408,data:null,headers:new Headers}));if("TypeError"===e.name&&/invalid URL|Failed to construct/.test(e.message))throw e;if("TypeError"===e.name||"NetworkError"===e.name)return y=!0,void(h=Object.assign(new Error("Network connection failed"),{code:503,data:null,headers:new Headers}));if(!h)throw e}))}if(h||!g)return h;const _=g.status;200!==_&&(h=Object.assign(new Error(g.statusText),{code:_,retry:()=>d(i)}),delete h.stack);const b={headers:g.headers};if(!g.body)return Object.assign(h??{},b);const w=g.headers.get("Content-Type");if("application/json"===w){const e=await g.json().catch((e=>{const t=e instanceof Error?e:new Error("Failed to parse JSON");Object.defineProperty(t,"code",{value:_,configurable:!0,writable:!0}),Object.defineProperty(t,"retry",{value:()=>d(i),configurable:!0}),h??=t,delete h.stack}));if(h)return Object.assign(h,e,b);return e.has_more&&Object.assign(e,{next:()=>d(i,{...s,...[...m].toObject(),page:+(m.get("page")??s?.page??e.page??0)+1}),getPage:e=>d(i,{...s,page:e})}),Object.assign(e,b)}throw new Error(`Response type ${w} is not supported`)}}Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),function(e){e.path=function(e){return`${o.default.API_ORIGIN.slice(0,-1)}${e}`}}(i||(i={})),t.default=i})),define("endpoint/manifest/EndpointManifestFormLengths",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/manifest/form-lengths","get")})),define("model/FormInputLengths",["require","exports","endpoint/manifest/EndpointManifestFormLengths","model/Manifest","utility/Time"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.default=(0,n.default)({cacheId:"form-input-lengths",valid:a.default.minutes(5),get:()=>o.default.query(),orElse(){const e={};return new Proxy({},{get:(t,o,n)=>e})}})})),define("model/ToSManager",["require","exports","lang/en-nz","model/Session","ui/Component","ui/component/core/Button","utility/Settings","utility/State"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=r.default.registerHiddenGroup("footer/heading/legal",{termsOfService:r.default.number({name:"document/legal/terms-of-service/title",default:-1,min:-1,step:1}),privacyPolicy:r.default.number({name:"document/legal/privacy-policy/title",default:-1,min:-1,step:1})});var s;!function(e){function t(){return{"privacy-policy":r("privacy-policy").at(-1),"terms-of-service":r("terms-of-service").at(-1)}}function r(e){const t=`document/legal/${e}/v`;return Object.keys(o.default).map((e=>e.startsWith(t)?+e.slice(t.length):void 0)).filterInPlace((e=>!isNaN(e))).sort(((e,t)=>e-t))}e.getLatestVersionNumbers=t,e.getDocumentVersions=r,e.ensureAccepted=async function(){const e=u.termsOfService.state.value??-1,o=u.privacyPolicy.state.value??-1,r=t();(e<r["terms-of-service"]||o<r["privacy-policy"])&&(await banner.queue((t=>{t.body.append((0,a.default)().text.use(e<0?"banner/legal-notification/initial":n.default.Auth.loggedIn.value?"banner/legal-notification/update-logged-in":"banner/legal-notification/update-logged-out"),(0,i.default)().type("icon","flush").setIcon("xmark").event.subscribe("click",t.dismiss));const o=l.default.Use(t,{tos:u.termsOfService.state,privacy:u.privacyPolicy.state}).use(t,(({tos:e=-1,privacy:n=-1})=>{if(e>=r["terms-of-service"]&&n>=r["privacy-policy"])return t.dismiss(),void o()}))})),u.termsOfService.state.value=r["terms-of-service"],u.privacyPolicy.state.value=r["privacy-policy"])}}(s||(s={})),t.default=s})),define("ui/view/ErrorView",["require","exports","lang/en-nz","ui/Component","ui/component/core/Heading","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),t.default=(0,u.default)({create:e=>{const t=(0,l.default)("error");e.code>=500&&e.error&&console.error(e.error),(0,a.default)().text.use((t=>t["view/error/title"]({CODE:e.code}))).appendTo(t.content),(0,n.default)("meta").setOwner(t).attributes.set("name","robots").attributes.set("content","noindex").appendTo(document.head);const u=`view/error/description-${e.code}`;return u in o.default?(0,i.default)().and(r.default).text.use(u).appendTo(t.content):(0,i.default)().and(r.default).text.set(e.error?.message??(e=>e["view/error/description-unknown"]())).appendTo(t.content),t}})})),define("ui/view/RequireLoginView",["require","exports","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/view/LoginView","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=(0,l.default)({create:()=>{const e=(0,r.default)("require-login"),t=(0,n.default)().appendTo(e.content);t.title.text.use("view/shared/login-required/title"),t.description.text.use("view/shared/login-required/description");const l=(0,o.default)().appendTo(t);return(0,a.default)().type("primary").text.use("view/shared/login-required/action").event.subscribe("click",(()=>navigate.ephemeral(i.default,void 0))).appendTo(l.right),e}})})),define("ui/view/shared/component/ViewContainer",["require","exports","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Dialog","ui/component/core/Loading","ui/view/ErrorView","ui/view/LoginView","ui/view/RequireLoginView","ui/view/shared/ext/ViewTransition","utility/State","utility/Task"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p);let f=0;t.default=()=>{let e;const t=(0,c.default)(void 0),m=(0,c.default)(!0);let v;const h=(0,n.default)().style("view-container").style.bind(m.falsy,"view-container--no-wrapper").tabIndex("programmatic").ariaRole("main").ariaLabel.use("view/container/alt").extend((n=>({state:t,wrapped:m,show:async(a,i)=>{const h=++f;let _,b;v?.remove(),v=c.default.Owner.create(),m.value=!1!==a.wrapper;const w=a.requiresLogin&&!o.default.Auth.loggedIn.value;if(w||a.load){let t;const n=d.default.perform("view",(async()=>{if(D(),!w)return;const n=function(){if(o.default.Auth.author.value)return;const t=g(u.default,void 0),n=t.then((async t=>{if(!t)return!1;const n=new Promise((t=>e=t));return await Promise.race([o.default.Auth.await(t),n]),e=void 0,o.default.Auth.loggedIn.value}));return{loginViewShown:t,authed:n}}();t=n?.authed,await(n?.loginViewShown)}));if(await n.updateCallbackDone,await t,w&&!o.default.Auth.loggedIn.value){let e;const t=new Promise((t=>e=t));d.default.perform("view",(async()=>{y();const t=await E(s.default);t&&o.default.Auth.loggedIn.subscribe(t,(t=>t&&e()))})),await t}}let k,T;if(a.load&&(n.style("view-container--loading"),k=(0,r.default)().setOwner(v).style("view-container-loading").prependTo(n)),await p.default.yield(),window.scrollTo({top:0,behavior:"smooth"}),a.load)try{const e=c.default.Async(v,(0,c.default)(i),a.load);k?.use(e),b=await e.promise}catch(e){T=e}if(k?.remove(),v?.remove(),v=void 0,n.style.remove("view-container--loading"),f===h&&"symbol"!=typeof b){if(n.state||h>1){const e=d.default.perform("view",x);await e.updateCallbackDone}else await x();return _}async function x(){D(),await E()}function D(){n.state?.value?.remove(),y()}async function E(e=a){const o=await(T?Promise.reject(T):Promise.resolve(e.create(i,b))).then((t=>(_=e===a?t:void 0,t))).catch((e=>l.default.create({code:(e.code<200?void 0:e.code)??600,error:e},{})));return o&&(o.prependTo(n),t.value=o,e===a&&(o.params=i)),o}},ephemeralDialog:(0,i.default)().style("view-container-ephemeral").tweak((e=>e.style.bind(e.opened,"view-container-ephemeral--open"))).setOwner(n).setNotModal().append((0,a.default)().setIcon("xmark").style("view-container-ephemeral-close").event.subscribe("click",(()=>{if(!e)return n.hideEphemeral();e()}))).appendTo(document.body),showEphemeral:async(e,t)=>await g(e,t),hideEphemeral:async()=>{const e=document.startViewTransition(y);await e.updateCallbackDone}})));return h;async function g(e,t){let o,n;if(h.ephemeral?.remove(),h.ephemeral=void 0,h.ephemeralOwner?.remove(),h.ephemeralOwner=c.default.Owner.create(),e.load){const i=c.default.Async(h.ephemeralOwner,(0,c.default)(t),e.load),u=(0,r.default)().setOwner(h.ephemeralOwner).style("view-container-loading","view-container-ephemeral-loading");if(await p.default.yield(),!h.ephemeralDialog.opened.value){const d=document.startViewTransition(s);await d.updateCallbackDone}function s(){u.prependTo(h.ephemeralDialog),u.use(i),h.ephemeralDialog.open(),h.attributes.append("inert")}n=await(i?.promise),u.remove(),await a()}else if(h.ephemeralDialog.opened.value)await a();else{const f=document.startViewTransition(a);await f.updateCallbackDone}return o;async function a(){const a=await Promise.resolve(e.create(t,n)).then((e=>o=e)).catch((e=>l.default.create({code:e.code??600,error:e},{})));a&&(a.prependTo(h.ephemeralDialog),h.ephemeral=a,h.ephemeralDialog.open(),h.attributes.append("inert"),h.ephemeralDialog.opened.subscribe(a,(e=>{e||y()})))}}function y(){h.ephemeralDialog.close(),h.ephemeral?.remove(),h.ephemeral=void 0,h.ephemeralOwner?.remove(),h.ephemeralOwner=void 0,h.attributes.remove("inert")}}})),define("navigation/Navigate",["require","exports","navigation/Routes","ui/utility/EventManipulator","ui/view/ErrorView","utility/Env","utility/State"],(function(e,t,o,n,a,i,r){function l(){const e=(0,r.default)(location.href);let t;const l={state:e,event:void 0,isURL:e=>{const t=e.replace(/(?<=\/)\*(?!\*)/g,"[^/]*").replace(/\/\*\*/g,".*");return new RegExp(`^${t}$`).test(location.pathname)},fromURL:async(n=!1)=>{if(location.href===t?.href&&!n)return;if(!u)throw new Error("Cannot navigate yet, no app instance");const i=t;let r;t=new URL(location.href),e.value=location.href;let s=!1;if(location.pathname!==i?.pathname||n){const e=location.pathname;let t=!1;for(const n of o.default){const o=n.match(e);if(o){r=n.path,await n.handler(u,Object.keys(o).length?o:void 0),t=!0;break}}t||(s=!0,await u.view.show(a.default,{code:404}))}if(location.hash&&!s){const e=location.hash.slice(1),t=document.getElementById(e);if(!t)return console.error(`No element by ID: "${e}"`),void(location.hash="");t.scrollIntoView(),t.focus()}l.event.emit("Navigate",r)},toURL:async e=>(l.setURL(e,!1),l.fromURL()),setURL:(e,o=!0)=>{const n=new URL(e,i.default.URL_ORIGIN);n.pathname===location.pathname&&n.search===location.search&&n.hash===location.hash||(history.pushState({},"",`${i.default.URL_ORIGIN}${n.pathname.slice(1)}${n.search}${n.hash}`),o&&(t=new URL(location.href)))},toRawURL:e=>{if(e.startsWith("http"))return location.href=e,!0;if(e.startsWith("/"))return l.toURL(e),!0;if(e.startsWith("#")){const t=e.slice(1);return document.getElementById(t)?(location.hash=e,!0):(console.error(`No element by ID: "${t}"`),!1)}return console.error(`Unsupported raw URL to navigate to: "${e}"`),!1},ephemeral:(...e)=>{if(!u)throw new Error("Cannot show ephemeral view yet, no app instance");return u.view.showEphemeral(...e)}};return Object.assign(l,{event:(0,n.default)(l)}),window.addEventListener("popstate",(()=>l.fromURL())),Object.assign(window,{navigate:l}),l}let u;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),function(e){e.setApp=function(e){u=e}}(l||(l={})),t.default=l})),define("navigation/popup/PopupRoute",["require","exports"],(function(e,t){function o(e,t){return{route:e,handler:t}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.is=function(e){return"route"in e&&"handler"in e},e.match=function(e,t){return"string"==typeof e?e===t?[t]:void 0:t.match(e)??void 0},e.collect=function(...t){return t.reduce(((t,o)=>e.is(o)?(t.push(o),t):[...t,...o]),[])}}(o||(o={})),t.default=o})),define("navigation/popup/PopupAuthRoutes",["require","exports","model/DangerToken","navigation/popup/PopupRoute","utility/Store"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.default=n.default.collect((0,n.default)(/\/auth\/(.*)\/error/,(()=>{const e=new URLSearchParams(location.search);a.default.items.popupError={code:+(e.get("code")??"500"),message:e.get("message")??"Internal Server Error"},window.close()})),(0,n.default)(/\/auth\/(.*)\/ok/,(()=>{const e=new URLSearchParams(location.search);o.default.handleAuthParams(e),window.close()})))})),define("navigation/popup/PopupRoutes",["require","exports","navigation/popup/PopupAuthRoutes","navigation/popup/PopupRoute"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),t.default=n.default.collect(o.default)})),define("ui/component/AppBanner",["require","exports","ui/Component","utility/Async","utility/State"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.AppBannerQueue=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),t.AppBannerQueue=o.default.Builder((e=>{Object.assign(window,{banner:e});const t=(0,a.default)(!1),o=[];return e.style("app-banner-container").extend((e=>({state:t,queue:e=>{let a;const i=new Promise((e=>a=e));return o.push([e,a]),t.value||n(),i}})));function n(){const a=o.shift();if(!a)return void(t.value=!1);const[r,l]=a;t.value=!0;i().tweak(r).appendTo(e).dismissed.match(e,!0,(()=>{l(),n()}))}}));const i=o.default.Builder((e=>{const t=(0,a.default)(!1);e.onRemoveManual((()=>t.value=!0));const i=(0,o.default)().style("app-banner-body");return e.style("app-banner").style.bind(t,"app-banner--dismissed").append(i).extend((e=>({dismissed:t,body:i,dismiss:()=>{t.value=!0,n.default.sleep(500).then(e.remove)}})))}));t.default=i})),define("ui/component/PrimaryNav",["require","exports","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Slot","ui/utility/StringApplicator","utility/Env","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),s=__importDefault(s),d=__importDefault(d),t.default=n.default.Builder((e=>{e.style("primary-nav");const t=(0,n.default)().style("primary-nav-top").appendTo(e),c=(0,n.default)().style("primary-nav-bottom").appendTo(e);function p(e,o){return(0,n.default)().style("primary-nav-group").append((0,i.default)().style("primary-nav-group-heading").style.remove("heading").text.use(o)).extend((e=>({add:u(e),addWhen:(t,o,n,a)=>e.using(t,((e,t)=>t&&e.add(o,n,a))),using:(t,o)=>((0,l.default)().use(t,((e,t)=>o(Object.assign(e,{add:u(e)}),t))).appendTo(e),e)}))).tweak((o=>null!==e&&o.appendTo("top"===e?t:c)));function u(e){return(t,o,n)=>((0,r.default)(t).and(a.default).style("primary-nav-link").type("flush").text.use(o).override("setIcon",((e,t)=>e=>t(e).tweak((e=>e.icon?.style("primary-nav-link-icon"))))).tweak((e=>e.style.bind(e.disabled,"button--disabled","primary-nav-link--disabled"))).tweak((e=>e.textWrapper.style("primary-nav-link-text"))).tweak(n).appendTo(e),e)}}p("top","sidebar/section/browse").add("/","sidebar/link/new",(e=>e.setIcon("calendar-plus"))).using(o.default.Auth.author,((e,t)=>e.add("/feed","sidebar/link/feed",(e=>e.setIcon("heart").setDisabled(!t,"no author"))).add("/history","sidebar/link/history",(e=>e.setIcon("clock-rotate-left").setDisabled(!t,"no author"))).add("/search","sidebar/link/search",(e=>e.setIcon("magnifying-glass").setDisabled(!t,"no author"))))),(0,l.default)().use(o.default.Auth.account,((e,t)=>t&&p("top","sidebar/section/create").tweak((e=>{for(const o of t.works??[])e.add(`/work/${o.author_vanity}/${o.work_vanity}`,u.Quilt.fake(o.name),(e=>e.setIcon("book")))})).add("/work/new","sidebar/link/create-work",(e=>e.setIcon("plus"))))).appendTo(t);const f=o.default.Auth.privileged,m=d.default.Some(e,f.TagGlobalDelete,f.ModerationViewComments);return(0,l.default)().if(m,(()=>p("top","sidebar/section/manage").addWhen(f.TagGlobalDelete,"/manage/tags","sidebar/link/tags",(e=>e.setIcon("tag"))).addWhen(f.ModerationViewComments,"/manage/comments","sidebar/link/comments",(e=>e.setIcon("comment"))))).appendTo(t),p("bottom","sidebar/section/profile").using(o.default.Auth.author,((e,t)=>{t?e.add(`/author/${t.vanity}`,u.Quilt.fake(t.name),(e=>e.setIcon("circle-user").ariaLabel.use((e=>e["sidebar/link/profile"](t.name))))).add("/account","sidebar/link/settings",(e=>e.setIcon("id-card"))):e.add("/account","sidebar/link/login",(e=>e.setIcon("circle-user")))})),"dev"===s.default.ENVIRONMENT&&p("bottom","sidebar/section/dev").add("/debug","sidebar/link/debug",(e=>e.setIcon("bug"))),e}))})),define("endpoint/EndpointSearch",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/search","get")})),define("ui/component/Search",["require","exports","endpoint/EndpointSearch","model/Session","model/Tags","ui/Component","ui/component/Author","ui/component/AuthorLink","ui/component/core/Button","ui/component/core/ext/GradientText","ui/component/core/Heading","ui/component/core/Icon","ui/component/core/Link","ui/component/core/Loading","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Small","ui/component/core/TextInput","ui/component/popover/PopoverBlock","ui/component/Work","ui/utility/Viewport","utility/AbortPromise","utility/Async","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),t.default=i.default.Builder((e=>{const t=(0,y.default)().style("search-input").placeholder.use("masthead/placeholder/search"),D=(0,x.default)(void 0),E=(0,x.default)(!1),O=(0,_.default)().style("search-popover").setOwner(e).anchor.from(e).anchor.reset().anchor.add("sticky centre","off bottom").anchor.orElseHide().tweak((e=>{e.header.style("search-popover-header");const o=(0,i.default)().style("search-popover-state-wrapper").appendTo(e);(0,u.default)().style("search-popover-retry-button").text.bind(w.default.mobile.map(e,(e=>t=>t[e?"search/action/again/short":"search/action/again"]()))).event.subscribe("click",(()=>I())).appendToWhen(E.falsy,o),(0,f.default)().style("search-popover-loading").tweak((e=>e.enabled.bind(e,E))).tweak((e=>e.flag.style("search-popover-loading-flag"))).appendToWhen(E,o);const c=(0,i.default)().style("search-popover-sections-wrapper").appendTo(e),y=i.default.Builder((e=>{e.style("search-popover-section");const t=(0,d.default)().setAestheticStyle(!1).style("search-popover-section-title").appendTo(e),o=(0,h.default)().style("search-popover-section-content").appendTo(e);return e.extend((e=>({title:t,titleText:t.text.rehost(e),content:o,handle:t=>(o.use(D,t),e)})))})),_=i.default.Builder("a",((e,t)=>e.and(u.default).and(p.default,t).type("flush").style("search-popover-result").extend((e=>({title:void 0,titleText:void 0,subtitle:void 0,subtitleText:void 0,description:void 0,descriptionText:void 0,details:void 0}))).extendJIT("title",(e=>(0,d.default)().setAestheticStyle(!1).style("search-popover-result-title").prependTo(e))).extendJIT("titleText",(e=>e.title.text.rehost(e))).extendJIT("subtitle",(t=>(0,i.default)().style("search-popover-result-subtitle").insertTo(e,"after",t.title))).extendJIT("subtitleText",(e=>e.subtitle.text.rehost(e))).extendJIT("description",(t=>(0,m.default)().and(v.default).style("search-popover-result-description").appendTo(e))).extendJIT("descriptionText",(e=>e.description.text.rehost(e))).extendJIT("details",(t=>(0,i.default)().style("search-popover-result-details").appendTo(e))))),T=i.default.Builder((e=>e.and(m.default).and(g.default).and(v.default).style("search-popover-no-results").text.use("search/none")));y().titleText.use("search/section/works/title").tweak((e=>(0,p.default)(t.state.map(e,(e=>`/search?search=${encodeURIComponent(e)}`))).and(u.default).style("search-popover-advanced-link").text.use("search/action/advanced").appendToWhen(n.default.Auth.loggedIn,e.title))).handle(((e,t)=>{if(!t?.works.length)return T();for(const o of t?.works??[]){const n=t.authorData.find((e=>e.vanity===o.author_vanity));_(`/work/${o.author_vanity}/${o.work_vanity}`).titleText.set(o.name).tweak((e=>n&&e.subtitle.append((0,l.default)(n)))).descriptionText.set(o.description).tweak((e=>e.description.style("search-popover-result-description--work"))).tweak((e=>e.details.and(b.WorkFooter,o).tweak((t=>{t.left.style("search-popover-result-details-left"),t.right.style("search-popover-result-details-right"),t.status.use(t,(e=>e.style("search-popover-result-work-status"))),t.statusIcon.use(t,(e=>e.style("search-popover-result-work-status-icon"))),t.chapterCount.style("search-popover-result-work-chapter-count"),t.wordCount?.style("search-popover-result-work-word-count"),t.timestamp.use(t,(e=>e?.style("search-popover-result-work-timestamp"))),x.default.Map(t,[t.timestamp,t.timestampAlternative],((e,t)=>e??t)).use(t,(t=>t?.appendTo(e.subtitle)))})))).appendTo(e)}})).appendTo(c),y().titleText.use("search/section/authors/title").handle(((e,t)=>{const o=t?.authors.map((e=>t.authorData.find((t=>t.vanity===e)))).filter((e=>void 0!==e));if(!o?.length)return T();for(const t of o)_(`/author/${t.vanity}`).titleText.set(t.name).tweak((e=>e.title.textWrapper.and(s.default).useGradient(t.supporter?.username_colours))).tweak((e=>e.subtitle.append((0,r.AuthorSubtitle)(t)))).tweak((e=>e.details.and(r.AuthorFooter,t).tweak((e=>{e.left.style("search-popover-result-details-left"),e.right.style("search-popover-result-details-right"),e.workCount?.style("search-popover-result-author-work-count"),e.wordCount?.style("search-popover-result-author-word-count"),e.timeJoin.remove()})))).appendTo(e)})).appendTo(c),y().style("search-popover-section--tags").titleText.use("search/section/tags/title").handle(k.default.asyncFunction((async(e,o)=>{const n=await a.default.getManifest();if(e.aborted)return;const i=t.value.toLowerCase(),r=Object.keys(n.tags).filter((e=>e.toLowerCase().includes(i))).map((e=>n.tags[e]));if(!r.length)return T();for(const e of r)_(`/tag/${e.categoryLowercase}/${e.nameLowercase}`).titleText.set(`${e.category}: ${e.name}`).tweak((t=>t.description.style("search-popover-result-description--tag").setMarkdownContent(e.description))).appendTo(o)}))).appendTo(c)})).appendTo(document.body);let M,S;return navigate.state.subscribe(e,(()=>{t.value="",O.hide()})),t.event.subscribe("keydown",(e=>{"Enter"===e.key&&O.focus()})),t.state.subscribeManual((e=>{e.length<3||function(){if(!M)return void I();const e=Math.max(0,M+1e3-Date.now());if(!e)return void I();clearTimeout(S),S=window.setTimeout(I,e)}()})),x.default.UseManual({focused:t.hasFocused,longEnough:t.state.mapManual((e=>e.length>2))}).useManual((async({focused:e,longEnough:t})=>{e&&t?(O.show(),O.anchor.apply(),await T.default.sleep(50),O.anchor.apply(),C()):t||O.hide()})),e.style("search").append((0,c.default)("magnifying-glass").style("search-icon")).append(t).onRooted((()=>{w.default.size.use(O,C)}));async function I(){M=Date.now(),E.value=!0,D.value=t.value.length<3?void 0:await o.default.query(void 0,{text:t.value}).then((e=>e.data??void 0)).catch((()=>{})),E.value=!1}function C(){O.style.setProperty("width",`${e.element.clientWidth}px`)}}))})),define("ui/component/SettingsDialog",["require","exports","ui/Component","ui/component/core/BlockDialog","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/Heading","ui/component/core/LabelledTable","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/RangeInput","ui/component/core/TextInput","utility/maths/Vector2","utility/Settings"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f);const m=o.default.Builder((e=>{const t=e.and(n.default);t.title.text.use("settings/title"),t.description.text.use("settings/description"),(0,u.default)().and(s.default).style("settings-dialog-hint").text.use("settings/hint/account").appendTo(t.content);for(const v of f.default.get()){if(v.hidden)continue;const h=(0,o.default)().style("settings-dialog-group").appendTo(t.content);(0,r.default)().style("settings-dialog-group-heading").text.use(v.name).appendTo(h);const g=(0,l.default)().style("settings-dialog-group-content").appendTo(h);for(const y of v.settings){function _(){switch(y.type){case"boolean":return(0,i.default)().style("settings-dialog-setting-button").setChecked(y.state.value??y.default).text.use(y.description).event.subscribe("SetChecked",((e,t)=>y.state.value=t)).tweak((e=>{y.state.subscribe(e,(t=>e.setChecked(t??y.default)))}));case"number":return y.max?(0,d.default)(y.min??0,y.max,y.step).default.set(y.default).tweak((e=>{e.state.value=y.state.value??y.default,e.state.useManual((e=>y.state.value=e)),y.state.subscribe(e,(t=>e.state.value=t))})):(0,c.default)().filter(((...e)=>e.map((e=>e.replace(/[^0-9]/g,"")))));case"string":return(0,c.default)()}}g.label((e=>e.text.use(y.name))).content(((e,t,o)=>{o.style("settings-dialog-setting"),e.style("settings-dialog-setting-content"),_().setLabel(t).appendTo(e),(0,a.default)().setIcon("rotate-reverse").event.subscribe("click",(()=>y.state.value=void 0)).appendTo(e)}))}}return(0,a.default)().type("primary").text.use("shared/action/done").event.subscribe("click",(()=>t.close())).appendTo(t.footer.right),t.opened.useManual((e=>{e?document.addEventListener("mousedown",m):document.removeEventListener("mousedown",m)})),t.extend((e=>({})));function m(e){t.rect.value.intersects(p.default.fromClient(e))||t.close()}}));t.default=m})),define("ui/component/Sidebar",["require","exports","ui/Component","utility/State","utility/Store"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder("nav",(e=>{e.style("sidebar").ariaLabel.use("masthead/primary-nav/alt");const t=n.default.Generator((()=>!!a.default.items.sidebar));return o(),e.extend((e=>({state:t,toggle:()=>(a.default.items.sidebar=!a.default.items.sidebar,t.refresh(),o(),e)})));function o(){e.style.toggle(!!a.default.items.sidebar,"sidebar--visible")}}));t.default=i})),define("ui/component/Masthead",["require","exports","model/Notifications","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Dialog","ui/component/core/Flag","ui/component/core/Link","ui/component/core/Slot","ui/component/NotificationList","ui/component/PrimaryNav","ui/component/Search","ui/component/SettingsDialog","ui/component/Sidebar","ui/utility/Viewport","ui/view/LoginView","utility/AbortPromise","utility/Env","utility/State"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_){Object.defineProperty(t,"__esModule",{value:!0}),t.MastheadFlush=t.HomeLink=void 0,o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importDefault(_);const b="_masthead",w=a.default.Builder("header",((e,l)=>{e.style("masthead").classes.add(b).style.bind(l.wrapped.falsy,"masthead--view-no-wrapper");const y=(0,m.default)().style.bind(l.wrapped.falsy,"sidebar--view-no-wrapper"),w=(0,c.default)();(0,i.default)().style("masthead-skip-nav").text.use("masthead/skip-navigation").event.subscribe("click",l.focus).appendTo(e);const k=(0,_.default)(void 0),T=(0,a.default)().append((0,a.default)().and(i.default).setIcon("bars").type("icon").style("masthead-left-hamburger","masthead-left-hamburger-sidebar").ariaHidden().event.subscribe("click",y.toggle)).append((0,i.default)().setIcon("bars").type("icon").style("masthead-left-hamburger","masthead-left-hamburger-popover").ariaLabel.use("masthead/primary-nav/alt").clearPopover().setPopover("hover/click",(e=>k.value=e.style("primary-nav-popover").anchor.add("aligned left","off bottom").anchor.add("aligned left","off top").ariaRole("navigation")))).style("masthead-left").appendTo(e);let x;y.style.bind(e.hasFocused,"sidebar--visible-due-to-keyboard-navigation");const D=(0,a.default)(),E=(e=!!y.element.clientWidth)=>w.style.toggle(e,"primary-nav--sidebar").appendTo(e?y:k.value??D);return v.default.size.use(e,(()=>{window.clearTimeout(x),x=window.setTimeout(E,1)})),k.subscribeManual((()=>E())),(0,t.HomeLink)().style("masthead-home-wrapper").appendTo(T),(0,p.default)().style("masthead-search").appendTo(e),(0,s.default)().style.remove("slot").style("masthead-user").if(n.default.Auth.loggedIn,(e=>e.append((0,i.default)().setIcon("bell").type("icon").style("masthead-user-notifications").clearPopover().ariaLabel.use("masthead/user/notifications/alt").append((0,s.default)().use(o.default.unreadCount,((e,t)=>t?(0,a.default)().style("masthead-user-notifications-badge").text.set(`${t}`):void 0))).setPopover("hover/click",(e=>e.style("masthead-user-notifications-popover").anchor.add("aligned right","off bottom").anchor.add("aligned left",`.${b}`,"off top").append((0,s.default)().use(o.default.cache,g.default.asyncFunction((async(e,t,o)=>{const n=await(0,d.default)(!0,5);if(!e.aborted){n.paginator.type("flush").style("masthead-user-notifications-list"),n.paginator.header.style("masthead-user-notifications-list-header"),n.paginator.title.style("masthead-user-notifications-list-title"),n.paginator.content.style("masthead-user-notifications-list-content"),n.paginator.footer.style("masthead-user-notifications-list-footer");for(const e of n.paginator.primaryActions.getChildren())e.is(i.default)&&e.style("masthead-user-notifications-list-action");(0,u.default)("/notifications").and(i.default).type("flush").text.use("masthead/user/notifications/link/label").appendTo(n.paginator.footer.middle),n.appendTo(t)}}))))))).append((0,i.default)().setIcon("circle-user").type("icon").clearPopover().ariaLabel.use("masthead/user/profile/alt").setPopover("hover/click",(e=>e.anchor.add("aligned right","off bottom").anchor.add("aligned right","off top").ariaRole("navigation").append((0,s.default)().style("action-group").style.remove("slot").use(n.default.Auth.author,((e,t)=>{t&&((0,u.default)(`/author/${t.vanity}`).and(i.default).type("flush").style("masthead-popover-link-button").tweak((e=>e.textWrapper.style("masthead-popover-link-button-text"))).setIcon("circle-user").text.set(t.name).ariaLabel.use((e=>e["masthead/user/profile/popover/profile"](t.name))).appendTo(e),(0,u.default)("/account").and(i.default).type("flush").style("masthead-popover-link-button").setIcon("id-card").text.use("masthead/user/profile/popover/account").appendTo(e),(0,i.default)().type("flush").style("masthead-popover-link-button").setIcon("arrow-right-from-bracket").text.use("view/account/action/logout").event.subscribe("click",(()=>n.default.reset())).appendTo(e))})))))).append((0,i.default)().setIcon("gear").type("icon").clearPopover().ariaLabel.use("masthead/user/settings/alt").event.subscribe("click",(()=>(0,f.default)().tweak(r.default.await)))))).else((()=>(0,i.default)().style("masthead-user-action-login").type("primary").setIcon("circle-user").text.use("masthead/action/login").event.subscribe("click",(()=>navigate.ephemeral(h.default,void 0))))).appendTo(e),e.extend((e=>({sidebar:y,flush:(0,t.MastheadFlush)().style.bind(l.wrapped.falsy,"masthead--view-no-wrapper")})))}));t.default=w,t.HomeLink=a.default.Builder("a",(e=>{const t=(0,l.default)().style("masthead-home-logo"),o=e.and(u.default,"/").ariaLabel.use("home/label").style("masthead-home-link").clearPopover(),n=(0,a.default)().and(i.default).style("masthead-home","heading").append(t).append((0,a.default)("img").style("masthead-home-logo-wordmark").ariaHidden().attributes.set("src",`${y.default.URL_ORIGIN}image/logo-wordmark.svg`)).append((0,a.default)().style("masthead-home-logo-beta").text.use("masthead/label/beta")).appendTo(o);return t.style.bind(o.hoveredOrFocused,"flag--focused"),t.style.bind(o.active,"flag--active"),o.hoveredOrFocused.subscribeManual((e=>t.wave("home link focus",e))),o.extend((e=>({button:n})))})),t.MastheadFlush=a.default.Builder("header",(e=>e.style("masthead-flush").append((0,t.HomeLink)())))})),define("ui/component/AppFooter",["require","exports","ui/Component","ui/component/core/ExternalLink","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Small","ui/component/Masthead","utility/Env"],(function(e,t,o,n,a,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),d=__importDefault(d),t.default=o.default.Builder((e=>{const t=()=>(0,o.default)().style("app-footer-column"),c=()=>(0,o.default)().style("app-footer-column-section"),p=()=>(0,a.default)().setAestheticStyle(!1).style("app-footer-column-heading"),f=e=>(0,i.default)(e).style("app-footer-column-link"),m=e=>(0,n.default)(e).style("app-footer-column-link");return t().style("app-footer-column-site").append(c().append((0,s.HomeLink)().style("app-footer-wordmark").tweak((e=>e.button.style("app-footer-wordmark-button")))).append((0,r.default)().and(l.default).text.use("fluff4me/tagline"))).append(c().append((0,l.default)().and(u.default).text.use((e=>e["footer/other/copyright"]({YEAR:(new Date).getFullYear()}))))).append((0,n.default)(void 0).style("app-version").attributes.bind("href",d.default.state.mapManual((e=>e?.BUILD_SHA?`https://github.com/fluff4me/fluff4.me/commit/${e.BUILD_SHA}`:void 0))).text.bind(d.default.state.mapManual((e=>e?e.BUILD_SHA?`v${e.BUILD_NUMBER} (${e.BUILD_SHA?.slice(0,7)})`:"dev":"")))).appendTo(e),t().append(p().text.use("footer/heading/site")).append(c().append(f("/about").text.use("footer/link/about")).append(f("/about/roadmap").text.use("footer/link/roadmap")).append(f("/about/supporters").text.use("footer/link/supporters"))).appendTo(e),t().append(p().text.use("footer/heading/support")).append(c().append(f("/contact").text.use("footer/link/contact")).append(m("https://discord.gg/KrXfDtn").text.use("footer/link/bug-reports")).append(m("https://discord.gg/KrXfDtn").text.use("footer/link/feature-requests")).append(f("/contact").text.use("footer/link/responsible-disclosure"))).appendTo(e),t().append(p().text.use("footer/heading/legal")).append(c().append(f("/legal/terms").text.use("footer/link/terms-of-service")).append(f("/legal/privacy").text.use("footer/link/privacy-policy"))).appendTo(e),e.style("app-footer")}))})),define("ui/component/core/HashLink",["require","exports","ui/Component","ui/utility/MarkdownContent"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=o.default.Builder((e=>e.style("link","link-hash")));n.default.handle(((e,t)=>{if("A"!==e.tagName)return;const n=e.getAttribute("href");return n?.startsWith("#")?()=>{(0,o.default)().replaceElement(e,!0).and(a)}:void 0})),t.default=a})),define("ui/component/core/Tooltip",["require","exports","ui/Component","ui/component/core/Popover"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const a=Object.assign(o.default.Builder((e=>e.and(n.default).setDelay(300).setMousePadding(0).style("tooltip").anchor.add("aligned left","off bottom").anchor.add("aligned left","off top").anchor.add("aligned right","off bottom").anchor.add("aligned right","off top"))),{initExtension(){o.default.extend((e=>{e.extend((e=>({setTooltip:t=>e.setPopover("hover/longpress",((e,o)=>t(e.and(a),o)))})))}))}});t.default=a})),define("ui/component/Mention",["require","exports","ui/Component","ui/component/core/ext/GradientText","ui/component/core/Link","ui/component/popover/AuthorPopover","ui/utility/MarkdownContent","utility/string/MarkdownItHTML"],(function(e,t,o,n,a,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),t.registerMarkdownMentionHandler=function(){l.default.defaultOptions.voidElements.push("mention"),l.default.defaultOptions.allowedTags.push("mention"),l.default.defaultOptions.perTagAllowedAttributes.mention=["vanity"],r.default.handle(((e,t)=>{if("MENTION"===e.tagName)return()=>{const o=e.getAttribute("vanity"),n=t.mentions?.find((e=>e.vanity===o)),a=u(n);e.replaceWith(a.element)}}))},o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=o.default.Builder("a",((e,t)=>e.and(a.default,t&&`/author/${t.vanity}`).append((0,o.default)().style("mention-punctuation").text.set("@")).append((0,o.default)().style("mention-author-name").text.set(t?.name??(e=>e["shared/mention/unresolved"]()))).setPopover("hover/longpress",(e=>t&&e.and(i.default,t))).style("mention").and(n.default).useGradient(t?.supporter?.username_colours)));t.default=u})),define("ui/component/popover/TagPopover",["require","exports","ui/Component","ui/component/core/Popover","ui/component/popover/PopoverBlock","ui/component/Tag","ui/component/TagBlock"],(function(e,t,o,n,a,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder(((e,t)=>e.and(n.default).setDelay(500).and(a.default).tweak((e=>e.visible.matchManual(!0,(()=>{e.and(r.default,t)}))))));t.default=Object.assign(l,{register(){i.default.extend((e=>{if("object"==typeof e.tag){const t=e.tag;e.clearPopover().setPopover("hover/longpress",(e=>e.and(l,t)))}return{}}))}})})),define("ui/utility/ActiveListener",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t=[];e.allActive=function(){return t},e.active=function(){return t.at(-1)},e.allActiveComponents=function*(){for(const e of t){const t=e.component;t&&(yield t)}},e.activeComponent=function(){return t.at(-1)?.component},e.listen=function(){function e(){const e=document.querySelectorAll(":active");if(e[e.length-1]===t[t.length-1])return;const o=[...e];for(const e of t)e.component&&!o.includes(e)&&e.component.activeTime.asMutable?.setValue(void 0);for(const e of o)e.component&&!t.includes(e)&&e.component.activeTime.asMutable?.setValue(Date.now());t=o}document.addEventListener("mousedown",e),document.addEventListener("mouseup",e)}}(o||(o={})),t.default=o,Object.assign(window,{ActiveListener:o})})),define("ui/utility/SiteStatusListener",["require","exports","model/SiteStatus","ui/Component","ui/component/core/Button","ui/component/core/Link","ui/component/core/Slot","ui/component/FundraiserBar","ui/utility/PageListener","utility/Env","utility/State","utility/Store","utility/Time"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p){var f;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),function(e){const t=(0,d.default)(!c.default.items.status?.dismissed);function f(){const e=c.default.items.status??{dismissed:!1,lastActive:Date.now()};e.dismissed&&Date.now()-e.lastActive>p.default.hours(2)&&(e.dismissed=!1,t.value=!0),e.lastActive=Date.now(),c.default.items.status=e}e.listen=function(){f(),u.default.visible.subscribeManual(f),navigate.state.subscribeManual(f),t.useManual((async e=>{e&&(s.default.isDev||(await o.default.getManifest(),await banner.queue((e=>{e.body.style("view-type-fundraiser-banner"),(0,r.default)().appendTo(e.body).use(o.default,((t,o)=>{const a=o?.fundraisers[0];a&&((0,i.default)("/fundraiser").text.use("fundraiser/title").event.subscribe("Navigate",(()=>{e.dismiss()})).appendTo(t),(0,n.default)().style("view-type-fundraiser-progress-bar-wrapper").append((0,l.default)(a.monthly_income,1e5,"monthly")).append((0,l.default)(a.funds_raised,a.thresholds[0],"total").style("view-type-fundraiser-progress-bar--total")).appendTo(t))})),(0,a.default)().style("view-type-fundraiser-banner-dismiss-button").type("icon","flush").setIcon("xmark").event.subscribe("click",e.dismiss).appendTo(e.body),e.dismissed.matchManual(!0,(()=>{c.default.items.status={dismissed:!0,lastActive:Date.now()},t.value=!1}))}))))}))}}(f||(f={})),t.default=f})),define("App",["require","exports","lang/en-nz","model/FormInputLengths","model/Notifications","model/Session","model/ToSManager","navigation/Navigate","navigation/popup/PopupRoute","navigation/popup/PopupRoutes","style","ui/Component","ui/component/AppBanner","ui/component/AppFooter","ui/component/core/ExternalLink","ui/component/core/HashLink","ui/component/core/Link","ui/component/core/toast/ToastList","ui/component/core/Tooltip","ui/component/Masthead","ui/component/Mention","ui/component/popover/TagPopover","ui/InputBus","ui/utility/ActiveListener","ui/utility/FocusListener","ui/utility/FontsListener","ui/utility/HoverListener","ui/utility/MarkdownContent","ui/utility/Mouse","ui/utility/SiteStatusListener","ui/utility/StringApplicator","ui/utility/Viewport","ui/view/shared/component/ViewContainer","utility/DevServer","utility/Env","utility/State","utility/string/Strings"],(function(e,t,o,n,a,i,r,l,u,s,d,c,p,f,m,v,h,g,y,_,b,w,k,T,x,D,E,O,M,S,I,C,R,$,P,A,j){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),m=__importDefault(m),v=__importDefault(v),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),_=__importStar(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),E=__importDefault(E),O=__importDefault(O),M=__importDefault(M),S=__importDefault(S),C=__importDefault(C),R=__importDefault(R),$=__importDefault($),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),location.href.includes("localhost")&&P.default.isNgrok&&(location.href=P.default.URL_ORIGIN+location.pathname.slice(1)),I.QuiltHelper.init({Component:c.default,Link:h.default,ExternalLink:m.default}),v.default,O.default.registerMarkdownHandlers(),(0,b.registerMarkdownMentionHandler)(),w.default.register(),y.default.initExtension(),t.default=async function(){for(const{route:e,handler:t}of s.default){const o=u.default.match(e,location.pathname);o&&t(o)}await(screen?.orientation?.lock?.("portrait-primary").catch((()=>{}))),k.default.subscribe("down",(e=>{if(e.use("F6"))for(const e of document.querySelectorAll("link[rel=stylesheet]")){const t=e.getAttribute("href"),o=`${t.slice(0,Math.max(0,t.indexOf("?"))||1/0)}?${Math.random().toString().slice(2)}`;e.setAttribute("href",o)}e.use("F4")&&document.documentElement.classList.add("persist-tooltips")})),k.default.subscribe("up",(e=>{e.use("F4")&&document.documentElement.classList.remove("persist-tooltips")})),c.default.allowBuilding(),n.default.getManifest(),i.default.init();const e=(0,l.default)();E.default.listen(),T.default.listen(),x.default.listen(),M.default.listen(),C.default.listen(),D.default.listen(),$.default.connect(),document.title=o.default["fluff4me/title"]().toString(),document.body.classList.add(...d.default.body);const t=(0,R.default)(),m=(0,_.default)(t);A.default.UseManual({viewTitle:t.state.mapManual((e=>e?.titleComponent)).mapManual((e=>e?A.default.MapManual([e.attributes.get("data-view-title"),e.text.state],((e,t)=>e??t)):void 0)),returnTo:t.state.mapManual((e=>e?.breadcrumbs.backButton)).mapManual((e=>e?.subText.state)),notificationCount:a.default.unreadCount}).mapManual((({viewTitle:e,returnTo:t,notificationCount:n})=>{document.title=o.default["fluff4me/title"]({NOTIFICATIONS:n,PAGE:e,PAGE2:j.default.areSameWords(e??void 0,t??void 0)?void 0:t}).toString()})),(0,f.default)().style.bind(m.sidebar.state.falsy,"app-footer--no-sidebar").style.bind(t.wrapped.falsy,"app-footer--view-no-wrapper").appendTo(t);const v=(0,c.default)().style("app-content").append(t);c.default.getBody().monitorScrollEvents(),c.default.getDocument().monitorScrollEvents(),c.default.getWindow().monitorScrollEvents();const h=(0,p.AppBannerQueue)().style.bind(t.wrapped.falsy,"app-banner-container--view-no-wrapper"),y=(0,_.HomeLink)().style("app-no-wrapper-home-link").tweak((e=>e.button.style("app-no-wrapper-home-link-button"))),b=(0,c.default)().style("app").style.bind(h.state,"app--has-banner").style.bind(t.wrapped.falsy,"app--view-no-wrapper").appendWhen(t.wrapped.falsy,y).append(m.flush,m,h,m.sidebar,v).append((0,g.default)()).extend((o=>({navigate:e,view:t}))).tweak(l.default.setApp).appendTo(document.body);return Object.assign(window,{app:b}),P.default.isNgrok&&(0,c.default)().style("app-qrcode").tweak((async e=>{const t=await QRCode.toDataURL(P.default.URL_ORIGIN,{color:{dark:"#fff",light:"#0000"}});e.style.setProperty("background-image",`url(${t})`)})).appendTo(document.body),r.default.ensureAccepted(),S.default.listen(),await b.navigate.fromURL(),b}})),define("Constants",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.APP_NAME=void 0,t.APP_NAME="fluff4.me / Queer Webnovels"})),define("utility/DOMRect",["require","exports","utility/Define","utility/maths/Vector2"],(function(e,t,o,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){o.default.magic(DOMRect.prototype,"centreX",{get(){return this.left+this.width/2}}),o.default.magic(DOMRect.prototype,"centreY",{get(){return this.top+this.height/2}}),o.default.magic(DOMRect.prototype,"centre",{get(){return(0,n.default)(this.left+this.width/2,this.top+this.height/2)}}),o.default.magic(DOMRect.prototype,"position",{get(){return(0,n.default)(this.left,this.top)}}),(0,o.default)(DOMRect.prototype,"expand",(function(e){return new DOMRect(this.x-e,this.y-e,this.width+2*e,this.height+2*e)})),(0,o.default)(DOMRect.prototype,"contract",(function(e){return new DOMRect(Math.min(this.x+e,this.centreX),Math.min(this.y-e,this.centreY),Math.max(0,this.width-2*e),Math.max(0,this.height-2*e))})),(0,o.default)(DOMRect.prototype,"intersects",(function(e){return"width"in e?this.left>=e.right&&this.right<=e.left&&this.top>=e.bottom&&this.bottom<=e.top:this.left<=e.x&&this.right>=e.x&&this.top<=e.y&&this.bottom>=e.y}))},o=__importDefault(o),n=__importDefault(n)})),define("utility/Elements",["require","exports","utility/Define"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.applyPrototypes=function(){o.default.set(Element.prototype,"asType",(function(e){return this.tagName.toLowerCase()===e?this:void 0})),Element.prototype.computedStyleMap||o.default.set(Element.prototype,"computedStyleMap",(function(){const e=getComputedStyle(this);return{get(t){const o=e.getPropertyValue(t);return o?{toString:()=>o}:void 0}}}))}}(n||(n={})),t.default=n})),define("utility/Maps",["require","exports","utility/Define"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.applyPrototypes=function(){(0,o.default)(Map.prototype,"compute",(function(e,t){if(this.has(e))return this.get(e);const o=t(e);return this.set(e,o),o}))}}(n||(n={})),t.default=n})),define("utility/Ranges",["require","exports","utility/Define"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.applyPrototypes=function(){(0,o.default)(Range.prototype,"replaceContents",(function(...e){this.deleteContents();let t=this.endContainer;const o=[];for(const n of e.reverse()){const e=t.nextSibling;t=n,this.insertNode(n);const a=n.nextSibling;a&&a!==e&&o.push(a)}for(const e of o)e.remove()}))}}(n||(n={})),t.default=n})),define("index",["require","exports","utility/Arrays","utility/DOMRect","utility/Elements","utility/Env","utility/Maps","utility/Ranges","utility/SelfScript","utility/SourceMapping"],(function(e,t,o,n,a,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),Object.assign(window,{_:void 0,select:e=>e()}),s.default.init();const d={types:new Set,finished:Promise.resolve(void 0),ready:Promise.resolve(void 0),updateCallbackDone:Promise.resolve(void 0),skipTransition:()=>{}};document.startViewTransition??=e=>(e?.(),d),(0,n.default)(),o.default.applyPrototypes(),r.default.applyPrototypes(),a.default.applyPrototypes(),l.default.applyPrototypes(),(async()=>{await i.default.load(),i.default.isDev&&(u.default.value=await fetch(`${i.default.URL_ORIGIN}index.js`).then((e=>e.text())));const t=await new Promise(((t,o)=>{e(["App"],t,o)})).then(__importStar);await t.default()})()})),define("endpoint/EndpointEmbed",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/embed","get").noResponse()})),define("endpoint/EndpointOembed",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/oembed","get").noResponse()})),define("endpoint/auth/$service/EndpointAuth$serviceBegin",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/{service}/begin","get").noResponse()})),define("endpoint/auth/$service/EndpointAuth$serviceCallback",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/{service}/callback","get").noResponse()})),define("endpoint/auth/patreon/campaign/EndpointAuthPatreonCampaignBegin",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/patreon/campaign/begin","get").noResponse()})),define("endpoint/auth/patreon/campaign/EndpointAuthPatreonCampaignCallback",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/patreon/campaign/callback","get").noResponse()})),define("endpoint/auth/patreon/patron/EndpointAuthPatreonPatronBegin",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/patreon/patron/begin","get").noResponse()})),define("endpoint/auth/patreon/patron/EndpointAuthPatreonPatronCallback",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/auth/patreon/patron/callback","get").noResponse()})),define("endpoint/authors/EndpointAuthorsResolve",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/resolve","get")})),define("endpoint/authors/$author_vanity/EndpointAuthors$authorVanityRss.xml",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/authors/{author_vanity}/rss.xml","get").noResponse()})),define("endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkHas",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/bulk/has","post")})),define("endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkSetvisibility",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/bulk/setvisibility","post").noResponse()})),define("endpoint/chapters/$author_vanity/$work_vanity/bulk/EndpointChapters$authorVanity$workVanityBulkUnname",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/chapters/{author_vanity}/{work_vanity}/bulk/unname","post").noResponse()})),define("endpoint/comments/moderation/EndpointCommentsModerationAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/moderation/all","get")})),define("endpoint/comments/moderation/author/EndpointCommentsModerationAuthor$authorVanity",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/moderation/author/{author_vanity}","get")})),define("endpoint/comments/work/$author_vanity/EndpointCommentsWork$authorVanity$workVanity",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/work/{author_vanity}/{work_vanity}","get")})),define("endpoint/comments/work/$author_vanity/$work_vanity/EndpointCommentsWork$authorVanity$workVanityAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/comments/work/{author_vanity}/{work_vanity}/add","post")})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceChapterClearNameBulk",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/chapter-clear-name-bulk","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceChapterCreateBulk",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/chapter-create-bulk","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceDecreaseAuthServiceCountRequired",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/decrease-auth-service-count-required","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceDeleteAccount",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/delete-account","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceDeleteChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/delete-chapter","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceDeleteWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/delete-work","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceModerate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/moderate","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceRemoveAuthService",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/remove-auth-service","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceTagModify",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/tag-modify","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceTotpDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/totp-delete","get").noResponse()})),define("endpoint/danger-tokens/request/$service/EndpointDangerTokensRequest$serviceTotpEnable",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/danger-tokens/request/{service}/totp-enable","get").noResponse()})),define("endpoint/feed/EndpointFeedRegen",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/feed/regen","post").noResponse()})),define("endpoint/feed/$feed_id/authed/EndpointFeed$feedIdAuthedRss.xml",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/feed/{feed_id}/authed/rss.xml","get").noResponse()})),define("endpoint/feed/$feed_id/followed/EndpointFeed$feedIdFollowedRss.xml",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/feed/{feed_id}/followed/rss.xml","get").noResponse()})),define("endpoint/feed/get/EndpointFeedGetRss.xml",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/feed/get/rss.xml","get").noResponse()})),define("endpoint/follows/$type/EndpointFollows$typeFollows",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/{type}/follows","get")})),define("endpoint/follows/$type/EndpointFollows$typeIgnores",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/{type}/ignores","get")})),define("endpoint/follows/author/$id/EndpointFollowsAuthor$idFollowing",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/following","get")})),define("endpoint/follows/author/$id/EndpointFollowsAuthor$idIgnoring",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/author/{id}/ignoring","get")})),define("endpoint/follows/tag/$id/EndpointFollowsTag$idFollowing",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag/{id}/following","get")})),define("endpoint/follows/tag/$id/EndpointFollowsTag$idIgnoring",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag/{id}/ignoring","get")})),define("endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idFollowing",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag-category/{id}/following","get")})),define("endpoint/follows/tag-category/$id/EndpointFollowsTagCategory$idIgnoring",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/tag-category/{id}/ignoring","get")})),define("endpoint/follows/work/$author_vanity/EndpointFollowsWork$authorVanity$workVanity",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/work/{author_vanity}/{work_vanity}","get")})),define("endpoint/follows/work/$author_vanity/$work_vanity/EndpointFollowsWork$authorVanity$workVanityIgnoring",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/follows/work/{author_vanity}/{work_vanity}/ignoring","get")})),define("endpoint/history/bookmarks/$author_vanity/$work_vanity/delete/EndpointHistoryBookmarks$authorVanity$workVanityDeleteAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/bookmarks/{author_vanity}/{work_vanity}/delete/all","post")})),define("endpoint/history/chapter/$author_vanity/$work_vanity/chapter/$chapter_url/EndpointHistoryChapter$authorVanity$workVanityChapter$chapterUrlDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/chapter/{author_vanity}/{work_vanity}/chapter/{chapter_url}/delete","post").noResponse()})),define("endpoint/history/work/$author_vanity/$work_vanity/EndpointHistoryWork$authorVanity$workVanityDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/history/work/{author_vanity}/{work_vanity}/delete","post").noResponse()})),define("endpoint/moderation/author/$author_vanity/comments/EndpointModerationAuthor$authorVanityCommentsRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/author/{author_vanity}/comments/remove","post").noResponse()})),define("endpoint/moderation/author/$author_vanity/privileges/$privilege_name/EndpointModerationAuthor$authorVanityPrivileges$privilegeNameRevoke",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/moderation/author/{author_vanity}/privileges/{privilege_name}/revoke","post").noResponse()})),define("endpoint/notifications/EndpointNotificationsManifest",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/notifications/manifest","get")})),define("endpoint/notifications/get/EndpointNotificationsGetUnread",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/notifications/get/unread","get")})),define("endpoint/patreon/campaign/tiers/EndpointPatreonCampaignTiersGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/patreon/campaign/tiers/get","get")})),define("endpoint/privileges/author/$author_vanity/EndpointPrivilegesAuthor$authorVanityGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/privileges/author/{author_vanity}/get","get")})),define("endpoint/privileges/author/$author_vanity/EndpointPrivilegesAuthor$authorVanityGrant",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/privileges/author/{author_vanity}/grant","post").noResponse()})),define("endpoint/privileges/author/$author_vanity/EndpointPrivilegesAuthor$authorVanityRevoke",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/privileges/author/{author_vanity}/revoke","post").noResponse()})),define("endpoint/privileges/role/$role_name/EndpointPrivilegesRole$roleNameGrant",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/privileges/role/{role_name}/grant","post").noResponse()})),define("endpoint/privileges/role/$role_name/EndpointPrivilegesRole$roleNameRevoke",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/privileges/role/{role_name}/revoke","post").noResponse()})),define("endpoint/reactions/EndpointReactionsManifest",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reactions/manifest","get")})),define("endpoint/reactions/chapter/$author_vanity/$work_vanity/$chapter_url/supporter/EndpointReactionsChapter$authorVanity$workVanity$chapterUrlSupporterAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reactions/chapter/{author_vanity}/{work_vanity}/{chapter_url}/supporter/add","post").noResponse()})),define("endpoint/reactions/chapter/$author_vanity/$work_vanity/$chapter_url/supporter/EndpointReactionsChapter$authorVanity$workVanity$chapterUrlSupporterRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/reactions/chapter/{author_vanity}/{work_vanity}/{chapter_url}/supporter/remove","post").noResponse()})),define("endpoint/roles/EndpointRolesAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/roles/all","get")})),define("endpoint/roles/EndpointRolesCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/roles/create","post").noResponse()})),define("endpoint/roles/EndpointRolesReorder",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/roles/reorder","post").noResponse()})),define("endpoint/roles/$role_name/EndpointRoles$roleNameDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/roles/{role_name}/delete","post").noResponse()})),define("endpoint/roles/$role_name/EndpointRoles$roleNameUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/roles/{role_name}/update","post")})),define("endpoint/roles/author/$author_vanity/$role_name/EndpointRolesAuthor$authorVanity$roleNameGrant",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/roles/author/{author_vanity}/{role_name}/grant","post").noResponse()})),define("endpoint/roles/author/$author_vanity/$role_name/EndpointRolesAuthor$authorVanity$roleNameRevoke",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/roles/author/{author_vanity}/{role_name}/revoke","post").noResponse()})),define("endpoint/shelves/EndpointShelves$shelfId",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/{shelf_id}","get")})),define("endpoint/shelves/EndpointShelvesAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/all","get")})),define("endpoint/shelves/EndpointShelvesCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/create","post").noResponse()})),define("endpoint/shelves/EndpointShelvesPreview",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/preview","get")})),define("endpoint/shelves/$shelf_id/EndpointShelves$shelfIdDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/{shelf_id}/delete","post").noResponse()})),define("endpoint/shelves/$shelf_id/EndpointShelves$shelfIdFeed",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/{shelf_id}/feed","get")})),define("endpoint/shelves/$shelf_id/EndpointShelves$shelfIdRegen",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/{shelf_id}/regen","post")})),define("endpoint/shelves/$shelf_id/EndpointShelves$shelfIdReorder",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/{shelf_id}/reorder","post")})),define("endpoint/shelves/$shelf_id/EndpointShelves$shelfIdRss.xml",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/{shelf_id}/rss.xml","get").noResponse()})),define("endpoint/shelves/$shelf_id/EndpointShelves$shelfIdUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/shelves/{shelf_id}/update","post").noResponse()})),define("endpoint/tags/global/$global_tag_id/EndpointTagsGlobal$globalTagIdDemote",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/tags/global/{global_tag_id}/demote","post")})),define("endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityFeedback",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/{author_vanity}/{work_vanity}/feedback","get")})),define("endpoint/works/$author_vanity/$work_vanity/EndpointWorks$authorVanity$workVanityRss.xml",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/v2/works/{author_vanity}/{work_vanity}/rss.xml","get").noResponse()})),define("ui/component/CurrencyInput",["require","exports","ui/Component","ui/component/core/PrefixedInput","ui/component/core/TextInput"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.FilterCurrency=void 0,o=__importDefault(o),n=__importDefault(n);const i=o.default.Builder((e=>e.and(n.default,"shared/prefix/currency").filter(t.FilterCurrency)));t.default=i,t.FilterCurrency=(0,a.FilterFunction)(((e,t,o)=>{if([e,t,o]=a.FilterFunction.DECIMAL(e,t,o),!e&&!t&&!o)return[e,t,o];let n=e.indexOf(".")+1;e=n?e.slice(0,n+2):e,n||(n=t.indexOf(".")+1,n&&(n+=e.length)),t=n?t.slice(0,n+2-e.length):t,n||(n=o.indexOf(".")+1,n&&(n+=e.length+t.length));const i=n+2-e.length-t.length;return[e,t,o=n?o.slice(0,i).padEnd(i,"0"):`${o}.00`]}))})),define("ui/component/core/ActionHeading",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Heading"],(function(e,t,o,n,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a);const i=o.default.Builder((e=>{const t=e.and(n.default).viewTransition("action-heading").style("action-heading"),o=t.left.and(a.default).style("action-heading-heading");return t.extend((e=>({heading:o})))}));t.default=i})),define("ui/view/TestView",["require","exports","markdown-it","ui/Component","ui/component/core/Block","ui/component/core/TextEditor","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Env","utility/string/MarkdownItHTML"],(function(e,t,o,n,a,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),t.default=(0,l.default)({create:()=>{const e=(0,r.default)("home"),t=(0,a.default)().appendTo(e.content);if(t.title.text.set("Test the text editor"),t.description.text.set("fluff4.me is still a work-in-progress. In the meantime, feel free to play with this!"),(0,i.default)().appendTo(t.content),u.default.isDev){(0,n.default)("br").appendTo(t.content);const e=(0,n.default)("div");(0,n.default)("div").attributes.set("contenteditable","plaintext-only").style.setProperty("white-space","pre-wrap").style.setProperty("font","inherit").style.setProperty("background","#222").style.setProperty("width","100%").style.setProperty("height","400px").style.setProperty("padding","0.5em").style.setProperty("box-sizing","border-box").event.subscribe("input",(t=>{const n=t.host.element.textContent??"",a=new o.default("commonmark",{html:!0,breaks:!0});s.default.use(a,s.default.Options().disallowTags("img","figure","figcaption","map","area")),console.log(a.parse(n,{})),e.element.innerHTML=a.render(n)})).appendTo(t.content),e.style.setProperty("font","inherit").style.setProperty("background","#222").style.setProperty("width","100%").style.setProperty("padding","0.5em").style.setProperty("margin-top","1em").style.setProperty("box-sizing","border-box").appendTo(t.content)}return e}})})),define("utility/Debug",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Debug=void 0,function(e){e.placeholder=!1}(o||(t.Debug=o={})),Object.assign(window,{Debug:o})})),define("utility/Tuples",["require","exports","utility/Arrays"],(function(e,t,o){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){function t(...e){return e}e.make=t;const n=Object.fromEntries(o.default.range(6).map((e=>t(e,(t=>void 0!==t[e]&&null!==t[e])))));e.filterNullish=function(e){return n[e]};const a=Object.fromEntries(o.default.range(6).map((e=>t(e,(t=>t[e])))));e.filterFalsy=function(e){return a[e]},e.getter=function(e){return t=>t[e]},e.filter=function(e,t){return(o,n)=>t(o[e],n)}}(n||(n={})),t.default=n}));