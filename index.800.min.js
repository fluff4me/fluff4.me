"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},__createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,a){void 0===a&&(a=o);var n=Object.getOwnPropertyDescriptor(t,o);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,a,n)}:function(e,t,o,a){void 0===a&&(a=o),e[a]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(){var e=function(t){return e=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},e(t)};return function(t){if(t&&t.__esModule)return t;var o={};if(null!=t)for(var a=e(t),n=0;n<a.length;n++)"default"!==a[n]&&__createBinding(o,t,a[n]);return __setModuleDefault(o,t),o}}();define("utility/Type",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.as=function(e,t){return typeof t===e?t:void 0},e.not=function(e,t){return typeof t===e?void 0:t},e.assert=function(){}}(o||(o={})),t.default=o})),define("utility/EventManager",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0,o=__importDefault(o);class a{static global=a.make();static make(){return new a({})}static emit(e,t,o){return o instanceof Event&&(t=o),"string"==typeof t&&(t=new Event(t,{cancelable:!0})),"function"==typeof o?o?.(t):o&&t!==o&&Object.assign(t,o),e?.dispatchEvent(t),t}host;_target;get target(){return this._target instanceof WeakRef?this._target.deref():this._target}constructor(e,t=new EventTarget){this.host=new WeakRef(e),this._target=t}subscribe(e,t){Array.isArray(e)||(e=[e]);for(const o of e)this.target?.addEventListener(o,t);return this.host.deref()}subscriptions={};subscribeOnce(e,t){if(Array.isArray(e)||(e=[e]),this.target){const o=this.target,a=this.subscriptions;function n(i){t.call(this,i);for(const i of e)a[i]?.delete(t),o?.removeEventListener(i,n)}for(const i of e)a[i]??=new WeakMap,a[i].set(t,n),this.target?.addEventListener(i,n)}return this.host.deref()}unsubscribe(e,t){Array.isArray(e)||(e=[e]);for(const o of e){this.target?.removeEventListener(o,t);const e=this.subscriptions[o]?.get(t);e&&(this.target?.removeEventListener(o,e),this.subscriptions[o].delete(t))}return this.host.deref()}async waitFor(e){return new Promise((t=>this.subscribeOnce(e,t)))}until(e,t){"object"!=typeof e&&(e=this.waitFor(e));const a={subscribe:(t,n)=>{this.subscribe(t,n);const i=()=>this.unsubscribe(t,n);return e instanceof Promise?e.then(i):o.default.Owner.getOwnershipState(e)?.matchManual(!0,i),a},subscribeOnce:(t,n)=>{this.subscribeOnce(t,n);return e instanceof Promise?e.then((()=>this.unsubscribe(t,n))):o.default.Owner.getOwnershipState(e)?.matchManual(!0,(()=>this.unsubscribe(t,n))),a}};return t?.(a),this.host.deref()}emit(e,t){return e=a.emit(this.target,e,t),this.host.deref()}}t.EventManager=a})),define("ui/InputBus",["require","exports","ui/Component","utility/EventManager"],(function(e,t,o,a){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.HandlesMouseEvents=t.HandlesKeyboardEvents=void 0,o=__importDefault(o),function(e){e.ReceiveFocusedClickEvents="_receieve-focused-click-events"}(n||(n={})),o.default.extend((e=>{e.extend((e=>({receiveFocusedClickEvents:()=>e.classes.add(n.ReceiveFocusedClickEvents)})))})),t.HandlesKeyboardEvents=o.default.Tag().setName("HandlesKeyboardEvents"),t.HandlesMouseEvents=o.default.Tag().setName("HandlesMouseEvents");const i={0:"MouseLeft",1:"MouseMiddle",2:"MouseRight",3:"Mouse3",4:"Mouse4",5:"Mouse5",undefined:"Mouse?"};let r=0;const l={},u=Object.assign(a.EventManager.make(),{getPressStart:e=>l[e],getPressDuration:e=>void 0===l[e]?void 0:Date.now()-l[e],isDown:e=>!!l[e],isUp:e=>!l[e]});function s(e){const a=e.target,s=a?.closest("input[type=text], textarea, [contenteditable]")??null;let d=!!s;if(!(d||"keydown"!==e.type||"Enter"!==e.key&&" "!==e.key||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||!a?.classList.contains(n.ReceiveFocusedClickEvents))){const t=a?.component?.event.emit("click");if(!0===t?.stoppedPropagation?e.stopPropagation():"immediate"===t?.stoppedPropagation&&e.stopImmediatePropagation(),t?.defaultPrevented)return void e.preventDefault()}const c=e.key??i[e.button],p="mousedown"===e.type?"keydown":"mouseup"===e.type?"keyup":e.type;"keydown"===p&&(l[c]=Date.now());let f=!1;const m={key:c,ctrl:e.ctrlKey,shift:e.shiftKey,alt:e.altKey,used:d,input:s,targetElement:a,targetComponent:a?.component??null,use:(e,...t)=>{if(m.used)return!1;const o=m.matches(e,...t);return o&&(m.used=!0),o},useOverInput:(e,...t)=>{if(m.used&&!d)return!1;const o=m.matches(e,...t);return o&&(m.used=!0,d=!1),o},matches:(e,...t)=>c===e&&!!t.every((e=>m[e])),cancelInput:()=>f=!0,hovering:e=>{const t=[...document.querySelectorAll(":hover")];return e?t[t.length-1]?.closest(e)??void 0:t[t.length-1]}};if("keyup"===p&&(m.usedAnotherKeyDuring=r>(l[c]??0),delete l[c]),u.emit("keydown"===p?"down":"up",m),(m.used&&!d||d&&f)&&(e.preventDefault(),r=Date.now()),d&&"keydown"===e.type&&"Enter"===c&&!m.shift&&!m.alt){const n=a?.closest("form");!n||"input"!==a?.tagName.toLowerCase()&&!a?.closest("[contenteditable]")||m.ctrl?n?.requestSubmit():o.default.closest(t.HandlesKeyboardEvents,a)||e.preventDefault()}}document.addEventListener("keydown",s,{capture:!0}),document.addEventListener("keyup",s,{capture:!0}),document.addEventListener("mousedown",s),document.addEventListener("mouseup",s),document.addEventListener("click",s),Object.defineProperty(MouseEvent.prototype,"used",{get(){return this._used??!1}}),Object.defineProperty(MouseEvent.prototype,"use",{value:function(e,...t){if(this._used)return!1;const o=this.matches(e,...t);return o&&(this._used=!0,r=Date.now()),o}}),Object.defineProperty(MouseEvent.prototype,"matches",{value:function(e,...t){return i[this.button]===e&&!!t.every((e=>this[`${e}Key`]))}}),t.default=u})),define("ui/utility/BrowserListener",["require","exports","utility/State"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.isWebkit=(0,o.default)(/AppleWebKit/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent))}(a||(a={})),t.default=a})),define("ui/utility/FontsListener",["require","exports","utility/State"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.loaded=(0,o.default)(!1),e.listen=async function(){await document.fonts.ready,e.loaded.asMutable?.setValue(!0)}}(a||(a={})),t.default=a})),define("utility/Define",["require","exports"],(function(e,t){function o(e,t,o){try{Object.defineProperty(e,t,{configurable:!0,writable:!0,value:o})}catch{}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.all=function(t,o,a){for(const n of t)e(n,o,a)},e.magic=function(e,t,o){try{Object.defineProperty(e,t,{configurable:!0,...o})}catch{}},e.set=function(e,t,o){try{Object.defineProperty(e,t,{configurable:!0,writable:!0,value:o})}catch{}return o}}(o||(o={})),t.default=o})),define("utility/Arrays",["require","exports","utility/Define"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.NonNullish=function(e){return null!=e},t.Truthy=function(e){return!!e},o=__importDefault(o),function(e){e.EMPTY=[],e.resolve=function(e){return Array.isArray(e)?e:void 0===e?[]:[e]},e.includes=function(e,t){return Array.isArray(e)?e.includes(t):e===t},e.slice=function(e){return Array.isArray(e)?e.slice():void 0===e?[]:[e]},e.remove=function(e,...t){if(!e)return!1;let o=!1;for(const a of t){const t=e.indexOf(a);-1!==t&&(e.splice(t,1),o=!0)}return o},e.removeAll=function(e,...t){if(!e)return!1;let o=!1,a=0;for(let n=0;n<e.length;n++)t.includes(e[n])?o=!0:(a!==n&&(e[a]=e[n]),a++);return e.length=a,o},e.removeWhere=function(e,t){if(!e)return!1;let o=!1,a=0;for(let n=0;n<e.length;n++)t(e[n],n,e)?o=!0:(a!==n&&(e[a]=e[n]),a++);return e.length=a,o},e.add=function(e,...t){if(!e)return!1;let o=!1;for(const a of t)e.includes(a)||(o=!0,e.push(a));return o},e.tuple=function(...e){return e},e.range=function(e,t,o){if(0===o)throw new Error("Invalid step for range");const a=[];void 0===t&&(t=e,e=0),o=t<e?-1:1;for(let n=e;o>0?n<t:n>t;n+=o)a.push(n);return a},e.mergeSorted=function(...e){return e.reduce(((e,t)=>function(e,t){const o=[];let a=0,n=0;for(;a<e.length||n<t.length;){const i=a<e.length?e[a]:void 0,r=n<t.length?t[n]:void 0;if(i===r){o.push(i),a++,n++;continue}if(void 0===i&&void 0!==r){o.push(r),n++;continue}if(void 0===r&&void 0!==i){o.push(i),a++;continue}-1===t.indexOf(i,n)?(o.push(i),a++):(o.push(r),n++)}return o}(e,t)),[])},e.applyPrototypes=function(){(0,o.default)(Array.prototype,"findLast",(function(e){if(this.length>0)for(let t=this.length-1;t>=0;t--)if(e(this[t],t,this))return this[t]})),(0,o.default)(Array.prototype,"findLastIndex",(function(e){if(this.length>0)for(let t=this.length-1;t>=0;t--)if(e(this[t],t,this))return t;return-1}));const t=Array.prototype.sort;(0,o.default)(Array.prototype,"sort",(function(...e){return this.length<=1?this:e.length?t.call(this,((t,o)=>{for(const a of e)if(1===a.length){const e=a,n=e(o)-e(t);if(n)return n}else{const e=a(t,o);if(e)return e}return 0})):t.call(this)})),(0,o.default)(Array.prototype,"collect",(function(e,...t){return e?.(this,...t)})),(0,o.default)(Array.prototype,"splat",(function(e,...t){return e?.(...this,...t)})),(0,o.default)(Array.prototype,"toObject",(function(e){return Object.fromEntries(e?this.map(e):this)})),(0,o.default)(Array.prototype,"toMap",(function(e){return new Map(e?this.map(e):this)})),(0,o.default)(Array.prototype,"distinct",(function(e){const t=[],o=e?[]:t;for(const a of this){const n=e?e(a):a;o.includes(n)||(e&&o.push(n),t.push(a))}return t})),(0,o.default)(Array.prototype,"distinctInPlace",(function(e){const t=[];let o=0;for(const a of this){const n=e?e(a):a;t.includes(n)||(t.push(n),this[o++]=a)}return this.length=o,this})),(0,o.default)(Array.prototype,"findMap",(function(e,t){for(let o=0;o<this.length;o++)if(e(this[o],o,this))return t(this[o],o,this)})),(0,o.default)(Array.prototype,"groupBy",(function(e){const t={};for(let o=0;o<this.length;o++)(t[String(e(this[o],o,this))]??=[]).push(this[o]);return Object.entries(t)})),(0,o.default)(Array.prototype,"filterInPlace",(function(t){return e.removeWhere(this,((e,o,a)=>!t(e,o,a))),this})),(0,o.default)(Array.prototype,"mapInPlace",(function(e){return this.splice(0,1/0,...this.map(e))}))}}(a||(a={})),t.default=a})),define("utility/DevServer",["require","exports","utility/Env"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const a={};let n;const i={connect(){if(n)return;if("dev"!==o.default.ENVIRONMENT)return;const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}`;n=new WebSocket(e),n.addEventListener("message",(e=>{try{const t=JSON.parse(e.data),{type:o,data:n}="object"==typeof t&&null!==t?t:{},i=a[o];if(!i?.length)return void console.warn("No handler for devserver message type:",o);for(const e of i)e(o,n)}catch{console.warn("Unsupported devserver message:",e.data)}}))},onMessage(e,t){a[e]??=[],a[e].push(t)},close(){n?.close(),n=void 0}};t.default=i})),define("utility/Script",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.allowModuleRedefinition=function(...e){for(const t of e)window.allowRedefine(t)},e.reload=async function(e){document.querySelector(`script[src^="${e}"]`)?.remove();const t=document.createElement("script");return t.src=`${e}?${Date.now()}`,new Promise(((e,o)=>{t.onload=()=>e(),t.onerror=o,document.head.appendChild(t)}))}}(o||(o={})),t.default=o})),define("utility/Async",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){async function t(e,t){return t?!!t.aborted||new Promise((o=>{let a;const n=()=>{window.clearTimeout(a),o(!0)};a=window.setTimeout((()=>{t.removeEventListener("abort",n),o(!1)}),e),t.addEventListener("abort",n,{once:!0})})):new Promise((t=>{window.setTimeout((()=>t(void 0)),e)}))}function o(...e){let o,i;return"function"==typeof e[0]?([i,...e]=e,function(e,...t){const o=n.get(e);if(o?.nextQueued)return o.promise;const a=new WeakRef(e);e=void 0;const i=()=>{try{const e=a.deref();if(!e)return;const o=e(...t),i=Promise.resolve(o);return n.set(e,{promise:i,nextQueued:!1}),e=void 0,i.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:i,reason:e}))})),i}catch(e){return void window.dispatchEvent(new ErrorEvent("error",{error:e}))}};return o?(o.nextQueued=!0,o.promise.catch(i).then(i)):i()}(i,...e)):([o,i,...e]=e,function(e,o,...n){let i=a.get(o);if(i&&Date.now()-i.last<e){const a=new WeakRef(o);o=void 0;const r=new AbortController;return i.queued=t(Date.now()-i.last+e,r.signal).then((e=>e?i?.queued:(delete i.queued,delete i.abortController,i.last=Date.now(),a.deref()?.(...n)))),i.abortController?.abort(),i.abortController=r,i.queued}i||a.set(o,i={last:0});return i.last=Date.now(),o(...n)}(o,i,...e))}e.sleep=t,e.debounce=o;const a=new WeakMap;const n=new WeakMap;function i(...e){let t,a,n=0,i=!1;"function"==typeof e[0]?[t,...e]=e:"function"==typeof e[1]?[n,t,...e]=e:"function"==typeof e[2]?"object"==typeof e[1]?[n,a,t,...e]=e:[n,i,t,...e]=e:[n,i,a,t,...e]=e,!0===i&&(i=n);const r=[];let l;const u={cancelled:!1,completed:!1,cancel:()=>{if(!u.cancelled&&!u.completed){a?.removeEventListener("abort",u.cancel),u.cancelled=!0,window.clearTimeout(l);for(const t of r)try{const o=t(...e),a=Promise.resolve(o);a.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:a,reason:e}))}))}catch(e){window.dispatchEvent(new ErrorEvent("error",{error:e}))}r.length=0,e.length=0}},onCancel:t=>{if(u.completed)return u;if(u.cancelled)try{const o=t(...e),a=Promise.resolve(o);a.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:a,reason:e}))}))}catch(e){window.dispatchEvent(new ErrorEvent("error",{error:e}))}else r.push(t);return u}};return a?.addEventListener("abort",u.cancel,{once:!0}),l=window.setTimeout((()=>{if(!u.cancelled){a?.removeEventListener("abort",u.cancel),u.completed=!0,r.length=0;try{const a=i?o(i,t,...e):t(...e),n=Promise.resolve(a);n.catch((e=>{window.dispatchEvent(new PromiseRejectionEvent("unhandledrejection",{promise:n,reason:e}))}))}catch(e){window.dispatchEvent(new ErrorEvent("error",{error:e}))}}}),n),u}e.schedule=i,e.timeout=function(e,t=new AbortController,o=`Timed out after ${e} ms`){return i(e,(()=>t.abort(o))),t.signal}}(o||(o={})),t.default=o})),define("utility/string/Strings",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return e.toLowerCase().replace(/\W+/g," ")}function o(e,t,o=1/0){let a=0,n=-1;for(;a<o;){const o=e.indexOf(t,n+1);if(-1===o)return a;a++,n=o}return a}function a(e){const t=[e];return t.push(e+"d",e+"ed"),e.endsWith("d")&&t.push(...a(e.slice(0,-1))),e.endsWith("ed")&&t.push(...a(e.slice(0,-2))),e.endsWith("ing")?(t.push(e.slice(0,-3)),e[e.length-4]===e[e.length-5]&&t.push(e.slice(0,-4))):(t.push(e+"ing",e+e[e.length-1]+"ing"),e.endsWith("y")&&t.push(e.slice(0,-1)+"ing")),e.endsWith("ion")?(t.push(...a(e.slice(0,-3))),e[e.length-4]===e[e.length-5]&&t.push(e.slice(0,-4))):t.push(e+"ion"),e.endsWith("er")?t.push(e.slice(0,-1),e.slice(0,-2)):(t.push(e+"r",e+"er"),e.endsWith("y")&&t.push(e.slice(0,-1)+"ier")),e.endsWith("ier")&&t.push(e.slice(0,-3)+"y"),t.push(e+"s",e+"es"),e.endsWith("s")?t.push(e.slice(0,-1)):e.endsWith("y")&&t.push(e.slice(0,-1)+"ies"),t}e.uid=function(){return`_${Date.now().toString(36)}${Math.random().toString(36).slice(2)}`},e.optionalParseJSON=function(e,t){if(e)try{const o=JSON.parse(e);if(t&&!t(o))return;return o}catch{return}},e.optionalParseRegex=function(e,t){if(e)try{return new RegExp(e,t)}catch{return}},e.simplify=t,e.areSameWords=function(e,o){return void 0!==e&&void 0!==o&&t(e)===t(o)},e.includesAt=function(e,t,o){if(o<0&&(o=e.length+o),o+t.length>e.length)return!1;for(let a=0;a<t.length;a++)if(e[a+o]!==t[a])return!1;return!0},e.splitOnce=function(e,t){const o=e.indexOf(t);return-1===o?[e]:[e.slice(0,o),e.slice(o+t.length)]},e.sliceTo=function(e,t,o){const a=e.indexOf(t,o);return-1===a?e:e.slice(0,a)},e.sliceAfter=function(e,t,o){const a=e.indexOf(t,o);return-1===a?e:e.slice(a+t.length)},e.trimTextMatchingFromStart=function(e,t,o){if(e.length<t.length)return e;const a=e.indexOf(t,o);return 0!==a?e:e.slice(a+t.length)},e.trimTextMatchingFromEnd=function(e,t,o){if(e.length<t.length)return e;const a=e.lastIndexOf(t,o);return a!==e.length-t.length?e:e.slice(0,a)},e.extractFromQuotes=function(e){let t=(e??"").trim();return'"'===t[0]&&(t=t.slice(1)),'"'===t[t.length-1]&&(t=t.slice(0,-1)),t.trim()},e.extractFromSquareBrackets=function(e){let t=e??"";return"["===t[0]&&(t=t.slice(1).trimStart()),"]"===t[t.length-1]&&(t=t.slice(0,-1).trimEnd()),t},e.mergeRegularExpressions=function(e,...t){let o="";for(const e of t)o+="|"+e.source;return new RegExp(o.slice(1),e)},e.count=o,e.includesOnce=function(e,t){return 1===o(e,t,2)},e.getVariations=a,e.shiftLine=function(e,t=1){for(let o=0;o<t;o++){const t=e.indexOf("\n");if(-1===t)return e;e=e.slice(t+1)}return e};const n=/'/g,i=/\W+/g;function r(e){return e.toLowerCase().replace(n,"").split(i).filter(Boolean)}e.getWords=r,e.fuzzyMatches=function(e,t,o){o??={},o.missingWordsThreshold??=.4,o.maxMissingWordsForFuzzy=4;const n=r(e).map(a),i=r(t).map(a);let l=0,u=0,s=0,d=0;e:for(;;){const e=n[s],t=i[d];if(!e&&!t)break;if(!e||!t){s++,d++,u++;continue}let a=0;for(let e=s;e<n.length&&a<=o.maxMissingWordsForFuzzy;e++){if(n[e].some((e=>t.includes(e)))){s=e+1,d++,l++,u+=a;continue e}a++}a=0;for(let t=d;t<i.length&&a<=o.maxMissingWordsForFuzzy;t++){if(i[t].some((t=>e.includes(t)))){s++,d=t+1,l++,u+=a;continue e}a++}u++,s++,d++}return l/(l+u)>=o.missingWordsThreshold};const l=/(?<=\W+)/g;e.toTitleCase=function(e){return e.split(l).map((e=>e[0].toUpperCase()+e.slice(1))).join("")},e.indent=function(e,t="\t"){return e.split("\n").map((e=>t+e)).join("\n")}}(o||(o={})),t.default=o})),define("utility/Time",["require","exports","utility/string/Strings"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){function t(e){return 1e3*e}function a(e){return 1e3*e*60}function n(e){return 1e3*e*60*60}function i(e){return 1e3*e*60*60*24}function r(e){return 1e3*e*60*60*24*7}function l(e){return Math.floor(1e3*e*60*60*24*(365.2422/12))}function u(e){return Math.floor(1e3*e*60*60*24*365.2422)}e.floor=function(e){return Math.floor(Date.now()/e)*e},e.frame=t(1)/144,e.ms=function(e){return e},e.seconds=t,e.minutes=a,e.hours=n,e.days=i,e.weeks=r,e.months=l,e.years=u,e.decades=function(e){return Math.floor(1e3*e*60*60*24*365.2422*10)},e.centuries=function(e){return Math.floor(1e3*e*60*60*24*365.2422*10*10)},e.millenia=function(e){return Math.floor(1e3*e*60*60*24*365.2422*10*10*10)},e.relative=function(e,s={}){let d=e-Date.now();const c=navigator.language||"en-NZ";if(!c.startsWith("en"))return function(e,o,s){const d=new Intl.RelativeTimeFormat(o,s);let c=e;return c=Math.trunc(e/u(1)),c?d.format(c,"year"):(c=Math.trunc(e/l(1)),c?d.format(c,"month"):(c=Math.trunc(e/r(1)),c?d.format(c,"week"):(c=Math.trunc(e/i(1)),c?d.format(c,"day"):(c=Math.trunc(e/n(1)),c?d.format(c,"hour"):(c=Math.trunc(e/a(1)),c?d.format(c,"minute"):(c=Math.trunc(e/t(1)),d.format(c,"second")))))))}(d,c,s);if(Math.abs(d)<t(1))return"now";const p=d<0;p&&(d=Math.abs(d));let f=s.components??1/0,m=d,h=p||!1===s.label?"":"in ";return m=Math.floor(d/u(1)),d-=m*u(1),m&&f-- >0&&(h+=`${m} year${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/l(1)),d-=m*l(1),m&&f-- >0&&(h+=`${m} month${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/r(1)),d-=m*r(1),m&&f-- >0&&(h+=`${m} week${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/i(1)),d-=m*i(1),m&&f-- >0&&(h+=`${m} day${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/n(1)),d-=m*n(1),m&&f-- >0&&(h+=`${m} hour${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/a(1)),d-=m*a(1),m&&f-- >0&&(h+=`${m} minute${1===m?"":"s"}${f>0?", ":""}`),m=Math.floor(d/t(1)),!(m&&f-- >0)||s.secondsExclusive&&h.includes(",")||(h+=`${m} second${1===m?"":"s"}`),h=o.default.trimTextMatchingFromEnd(h,", "),`${h}${p&&!1!==s.label?" ago":""}`},e.absolute=function(e,t={dateStyle:"full",timeStyle:"medium"}){const o=navigator.language||"en-NZ";return new Intl.DateTimeFormat(o,t).format(e)}}(a||(a={})),Object.assign(window,{Time:a}),t.default=a})),define("utility/Task",["require","exports","utility/Async","utility/Time"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const n=(a=__importDefault(a)).default.seconds(1)/144;class i{interval;static async yield(e=!1){if("undefined"!=typeof scheduler&&"function"==typeof scheduler.yield)return scheduler.yield();e||await o.default.sleep(1)}static post(e,t){return"undefined"==typeof scheduler||"function"!=typeof scheduler.postTask?e():scheduler.postTask(e,{priority:t})}lastYieldEnd=Date.now();constructor(e=n){this.interval=e}reset(){this.lastYieldEnd=Date.now()}async yield(e=!1){Date.now()-this.lastYieldEnd>this.interval&&(await i.yield(e),this.lastYieldEnd=Date.now())}}t.default=i})),define("utility/Style",["require","exports","utility/State","utility/Task"],(function(e,t,o,a){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),function(e){e.properties=o.default.JIT((()=>window.getComputedStyle(document.documentElement)));const t={};e.measure=function(n){return t[n]?t[n]:e.properties.mapManual((e=>{const i=e.getPropertyValue(n),r=document.createElement("div");r.style.width=i,r.style.pointerEvents="none",r.style.opacity="0",r.style.position="fixed",document.body.appendChild(r);const l=t[n]=(0,o.default)(0);return a.default.yield().then((()=>{l.value=r.clientWidth,r.remove()})),t[n]}))},e.reload=async function(e){const t=document.querySelector(`link[rel=stylesheet][href^="${e}"]`),o=document.createElement("link");return o.rel="stylesheet",o.href=`${e}?${Date.now()}`,new Promise(((e,t)=>{o.onload=()=>e(),o.onerror=t,document.head.appendChild(o)})).finally((()=>t?.remove()))}}(n||(n={})),t.default=n})),define("ui/utility/StyleManipulator",["require","exports","style","utility/Arrays","utility/DevServer","utility/Env","utility/Script","utility/State","utility/Style"],(function(e,t,o,a,n,i,r,l,u){function s(){for(const e of[...document.documentElement.attributes])e.name.startsWith("chiridata:")&&document.documentElement.removeAttribute(e.name);for(const e in t.style.value){const o=t.style.value[e];o.length&&document.documentElement.setAttribute(`chiridata:${e}`,JSON.stringify(o))}}Object.defineProperty(t,"__esModule",{value:!0}),t.style=void 0,o=__importDefault(o),a=__importStar(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),t.style=(0,l.default)(o.default),n.default.onMessage("updateStyle",(async()=>{r.default.allowModuleRedefinition("style"),u.default.reload(`${i.default.URL_ORIGIN}style/index.css`),await r.default.reload(`${i.default.URL_ORIGIN}style/index.js`),t.style.value=await new Promise(((t,o)=>{e(["style"],t,o)})).then(__importStar).then((e=>e.default))})),i.default.onLoad("dev",(()=>{Object.assign(window,{writeChiridata:s})})),t.default=function(e){const o=new Set,n=[],r=new WeakMap,u={},s=l.default.JIT((()=>o)),d=[];i.default.isDev&&t.style.subscribe(e,(()=>p()));const c=Object.assign(((...t)=>{for(const e of t)o.add(e);return p(),e}),{get:()=>[...o].sort(),has:e=>o.has(e),getState:(e,t)=>s.map(e,(e=>e.has(t))),remove(...t){for(const e of t)o.delete(e);return p(),e},toggle(t,...a){if(t)for(const e of a)o.add(e);else for(const e of a)o.delete(e);return p(),e},bind(t,...a){if(!l.default.is(t))return c.toggle(t,...a);c.unbind(t);const n=t.use(e,(e=>{if(e)for(const e of a)o.add(e);else for(const e of a)o.delete(e);p()}));return r.set(t,[n,a]),e},bindFrom(t){c.unbind(t);const a=[],n=t.use(e,((e,t)=>{Array.isArray(e)||(e=e?[e]:[]),Array.isArray(t)||(t=t?[t]:[]);for(const e of t??[])o.delete(e);for(const t of e)o.add(t);a.splice(0,1/0,...e),p()}));return r.set(t,[n,a]),e},unbind(t){const o=t&&r.get(t);if(!o)return e;const[a,n]=o;return a?.(),r.delete(t),c.remove(...n),e},combine:(t,o)=>(d.push({combined:t,requirements:o}),e),uncombine:t=>(d.filterInPlace((e=>e.combined!==t)),c.remove(t),e),refresh:()=>p(),hasProperty:t=>""!==e.element.style.getPropertyValue(t),setProperty:(t,o)=>(u[t]?.(),f(t,o),e),setProperties(t){for(let[e,o]of Object.entries(t))u[e]?.(),e=e.replaceAll(/[a-z][A-Z]/g,(e=>`${e[0]}-${e[1].toLowerCase()}`)).toLowerCase(),f(e,o);return e},toggleProperty:(e,t,o)=>(e??=!c.hasProperty(t),!0===e?c.setProperty(t,e?o:void 0):c.removeProperties(t)),setVariable:(e,t)=>c.setProperty(`--${e}`,t),bindProperty:(t,o)=>(u[t]?.(),l.default.is(o)?u[t]=o.use(e,(e=>f(t,e))):(f(t,o),u[t]=void 0),e),bindVariable:(e,t)=>c.bindProperty(`--${e}`,t),removeProperties(...t){for(const o of t)e.element.style.removeProperty(o);return e},removeVariables(...t){for(const o of t)e.element.style.removeProperty(`--${o}`);return e}});return c;function p(){const i=[...o];for(const e of d){e.requirements.every((e=>o.has(e)))?(o.add(e.combined),i.push(e.combined)):(o.delete(e.combined),a.default.remove(i,e.combined))}e.attributes.has("component")||e.attributes.insertBefore("class","component"),e.attributes.set("component",i.join(" "));const r=i.flatMap((e=>t.style.value[e])).filter(a.NonNullish),l=n.filter((e=>!r.includes(e)));return l&&e.element.classList.remove(...l),e.element.classList.add(...r),n.push(...r),s.markDirty(),e}function f(t,o){null==o?e.element.style.removeProperty(t):e.element.style.setProperty(t,`${o}`)}}})),define("navigation/Route",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const o=(e.startsWith("/")?e.slice(1):e).split("/"),a=[];let n="^";for(const e of o)n+="/+","$"===e[0]?"$"!==e[1]?(a.push(e.slice(1)),n+="([^/]+)"):(a.push(e.slice(2)),n+="(.*)"):n+=e;n+="$";const i=new RegExp(n),r=e;return{path:e,..."function"==typeof t?{handler:t}:t,match:e=>{const t=e.match(i);if(!t)return;const o={};for(let e=0;e<a.length;e++){const n=a[e],i=t[e+1];if(void 0===i)return void console.warn(`${r} matched, but $${n} was unset`);o[n]=i}return o}}}})),define("ui/component/core/ActionRow",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const a=(o=__importDefault(o)).default.Builder((e=>{e.style("action-row");let t=!1;return e.extend((e=>({left:void 0,middle:void 0,right:void 0}))).extendJIT("left",(e=>(0,o.default)().style("action-row-left").prependTo(e))).extendJIT("middle",(e=>{const a=(0,o.default)().style("action-row-middle");return t?a.insertTo(e,"before",e.right):a.appendTo(e)})).extendJIT("right",(e=>(t=!0,(0,o.default)().style("action-row-right").appendTo(e))))}));t.default=a})),define("ui/component/core/ext/ComponentInsertionTransaction",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=function(e,t){let a=e?.removed.useManual((e=>e&&u()));const n=(0,o.default)(!1);let i=!1;const r={isInsertionDestination:!0,closed:n,get size(){return e?.element.children.length??0},append:(...t)=>(n.value||e?.append(...t),r),prepend:(...t)=>(n.value||e?.prepend(...t),r),insert:(t,o,...a)=>(n.value||e?.insert(t,o,...a),r),abort(){n.value||l()},close(){n.value||(i||t?.(r),l())}};return r;function l(){n.value=!0,a?.(),a=void 0,e=void 0}function u(){a?.(),a=void 0,i=!0,r.close()}}})),define("ui/component/core/Dialog",["require","exports","ui/Component","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=new Set;function i(e){const t=!!n.size;n.add(e),t||o.default.getDocument().style("has-dialog")}function r(e){n.delete(e),n.size||o.default.getDocument().style.remove("has-dialog")}const l=Object.assign(o.default.Builder((()=>{const e=(0,a.default)(!1),t=(0,a.default)(!1),n=(0,a.default)(!1);let l,u=!0;return(0,o.default)("dialog").style("dialog").style.bind(e,"dialog--open").extend((o=>({opened:e,willClose:n,willOpen:t,setNotModal:(e=!0)=>(u=!e,o.style.toggle(e,"dialog--not-modal"),o),setFullscreen:(e=!0)=>o.style.toggle(e,"dialog--fullscreen"),open:()=>(t.value=!0,o.willOpen.value?(l?.(),i(o),o.element[u?"showModal":"show"](),e.value=!0,t.value=!1,o):o),close:()=>(n.value=!0,o.willClose.value?(l?.(),r(o),o.element.close(),e.value=!1,n.value=!1,o):o),toggle:(t=!o.opened.value)=>{const a=t?"willOpen":"willClose";return o[a].asMutable?.setValue(!0),o[a].value?(l?.(),t?(i(o),o.element[u?"showModal":"show"]()):(r(o),o.element.close()),e.value=t??!e.value,o[a].asMutable?.setValue(!1),o):o},bind:t=>(l?.(),l=t.use(o,(t=>{const a=t?"willOpen":"willClose";o[a].asMutable?.setValue(!0),t?(i(o),o.element[u?"showModal":"show"]()):(r(o),o.element.close()),e.value=t,o[a].asMutable?.setValue(!1)})),o),unbind:()=>(l?.(),o)})))})),{await(e){let t=!1;return e.rooted.value||(t=!0,e.appendTo(document.body)),new Promise((o=>{e.open(),e.event.subscribe("close",(a=>{a.host.event.subscribe("transitionend",(()=>{t&&e.remove(),o()}))})),navigate.event.until(e,(t=>t.subscribe("Navigate",(()=>e.close()))))}))}});t.default=l})),define("ui/utility/FocusListener",["require","exports","utility/State"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.hasFocus=(0,o.default)(!1),e.focused=(0,o.default)(void 0),e.focusedLast=(0,o.default)(void 0),e.focusedComponent=function(){return e.focused.value?.component},e.focus=function(e){!function(e){if(document.querySelector(":focus-visible")===e)return;if(a>100)return;a++,e.focus(),window.clearTimeout(t),window.setTimeout((()=>a=0))}(e)};let t,a=0;function n(){r()}function i(e){null===e.relatedTarget&&r()}function r(){document.activeElement&&document.activeElement!==document.body&&location.hash&&document.activeElement.id!==location.hash.slice(1)&&history.pushState(void 0,""," ");const t=document.querySelector(":focus-visible")??void 0;if(t===e.focused.value)return;const o=e.focusedLast.value?.component;if(o){o.hadFocusedLast.asMutable?.setValue(!1);for(const e of o.getAncestorComponents())e.hadFocusedLast.asMutable?.setValue(!1)}const a=e.focused.value?.component,n=t?.component,i=a?[...a.getAncestorComponents()]:void 0,r=n?[...n.getAncestorComponents()]:void 0,l=e.focused.value?.contains(t??null);if(e.focusedLast.value=e.focused.value,e.focused.value=t,e.hasFocus.value=!!t,a&&(l||(n||a.hadFocusedLast.asMutable?.setValue(!0),a.hasFocusedTime.asMutable?.setValue(void 0)),a.focusedTime.asMutable?.setValue(void 0)),n&&(n.focusedTime.asMutable?.setValue(Date.now()),n.hasFocusedTime.asMutable?.setValue(Date.now())),i)for(const e of i)r?.includes(e)||e&&(n||e.hadFocusedLast.asMutable?.setValue(!0),e.hasFocusedTime.asMutable?.setValue(void 0));if(r)for(const e of r)e&&e.hasFocusedTime.asMutable?.setValue(Date.now())}e.blur=function(e){!function(e){if(document.querySelector(":focus-visible")!==e)return;e.blur()}(e)},e.listen=function(){document.addEventListener("focusin",n),document.addEventListener("focusout",i)}}(a||(a={})),t.default=a,Object.assign(window,{FocusListener:a})})),define("utility/maths/Vector2",["require","exports"],(function(e,t){function o(e=0,t){return void 0===t&&(t=e),{x:e,y:t}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ZERO={x:0,y:0},e.ONE={x:1,y:1},e.mutable=function(e=0,t){return void 0===t&&(t=e),{x:e,y:t}},e.fromClient=function(e){return{x:e.clientX,y:e.clientY}},e.equals=function(e,t){return e.x===t.x&&e.y===t.y},e.distance=function(e,t){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)},e.distanceWithin=function(e,t,o){return(o.x-t.x)**2+(o.y-t.y)**2<e**2},e.add=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},e.addInPlace=function(e,t){return e.x+=t.x,e.y+=t.y,e},e.subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},e.subtractInPlace=function(e,t){return e.x-=t.x,e.y-=t.y,e},e.multiply=function(e,t){return{x:e.x*t,y:e.y*t}},e.multiplyInPlace=function(e,t){return e.x*=t,e.y*=t,e},e.divide=function(e,t){return{x:e.x/t,y:e.y/t}},e.divideInPlace=function(e,t){return e.x/=t,e.y/=t,e},e.modTruncate=function(e,t){return{x:e.x%t,y:e.y%t}},e.modTruncateInPlace=function(e,t){return e.x%=t,e.y%=t,e},e.modFloor=function(e,t){return{x:(e.x%t+t)%t,y:(e.y%t+t)%t}},e.modFloorInPlace=function(e,t){return e.x=(e.x%t+t)%t,e.y=(e.y%t+t)%t,e},e.dot=function(e,t){return e.x*t.x+e.y*t.y},e.magnitude=function(e){return Math.sqrt(e.x**2+e.y**2)},e.normalise=function(t){const o=e.magnitude(t);return e.divide(t,o)},e.normaliseInPlace=function(t){const o=e.magnitude(t);return e.divideInPlace(t,o)},e.angle=function(t,o){const a=e.dot(t,o),n=e.magnitude(t)*e.magnitude(o),i=Math.max(-1,Math.min(1,a/n));return Math.acos(i)},e.rotate=function(e,t){const o=Math.cos(t),a=Math.sin(t);return{x:e.x*o-e.y*a,y:e.x*a+e.y*o}},e.rotateInPlace=function(e,t){const o=Math.cos(t),a=Math.sin(t),n=e.x;return e.x=n*o-e.y*a,e.y=n*a+e.y*o,e},e.lerp=function(e,t,o){return{x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}},e.clamp=function(e,t,o){return{x:Math.min(Math.max(e.x,t.x),o.x),y:Math.min(Math.max(e.y,t.y),o.y)}},e.clampInPlace=function(e,t,o){return e.x=Math.min(Math.max(e.x,t.x),o.x),e.y=Math.min(Math.max(e.y,t.y),o.y),e}}(o||(o={})),t.default=o})),define("ui/utility/Mouse",["require","exports","utility/State"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){const t={x:0,y:0};e.state=(0,o.default)(t);const a=new Set;e.onMove=function(e){a.add(e)},e.offMove=function(e){a.delete(e)},e.listen=function(){document.addEventListener("mousemove",(o=>{if(t.x!==o.clientX||t.y!==o.clientY){t.x=o.clientX,t.y=o.clientY,e.state.emit();for(const e of a)e(t)}}))}}(a||(a={})),t.default=a})),define("ui/utility/HoverListener",["require","exports","ui/utility/Mouse"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){let t=[];e.allHovered=function(){return t},e.hovered=function(){return t.at(-1)},e.allHoveredComponents=function*(){for(const e of t){const t=e.component;t&&(yield t)}},e.hoveredComponent=function(){return t.at(-1)?.component},e.listen=function(){o.default.onMove((()=>{const e=[...document.querySelectorAll(":hover")],o=e[e.length-1];if(0!==o.clientWidth&&0!==o.clientHeight||e.filterInPlace((e=>"none"!==e.computedStyleMap().get("display")?.toString())),o===t[t.length-1])return;const a=e,n=t.filter((e=>!a.includes(e)));for(const e of n)e.component&&e.component.hoveredTime.asMutable?.setValue(void 0);const i=a.filter((e=>!t.includes(e)));for(const e of i)e.component&&e.component.hoveredTime.asMutable?.setValue(Date.now());t=a}))}}(a||(a={})),t.default=a,Object.assign(window,{HoverListener:a})})),define("ui/utility/TypeManipulator",["require","exports","utility/Arrays","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=Object.assign((function(e,t,o){const n=(0,a.default)(new Set);return Object.assign(i,{state:n,remove:r,toggle:(e,...t)=>e?i(...t):r(...t)});function i(...o){const a=n.value.size,i=o.filter((e=>!n.value.has(e)));for(const e of i)n.value.add(e);return t(i),n.value.size!==a&&n.emit(),e}function r(...t){const a=n.value.size,i=t.filter((e=>n.value.has(e)));for(const e of i)n.value.delete(e);return o(i),n.value.size!==a&&n.emit(),e}}),{Style:function(e,t){const i=Array.isArray(t)?t:[[e,t]],r=[];let l;return n(e,(e=>{r.push(...e),r.distinctInPlace(),l?.();const t=a.default.Owner.create();l=t.remove;for(const[n,l]of i)if(a.default.is(n))n.use(t,(e=>{for(const t of o.default.resolve(e))for(const e of r)t.style(l(e))}));else for(const t of e)for(const e of o.default.resolve(n))e.style(l(t))}),(e=>{r.filterInPlace((t=>!e.includes(t)));for(const t of e)for(let[e,n]of i){a.default.is(e)&&(e=e.value);for(const a of o.default.resolve(e))a.style.remove(n(t))}}))}});t.default=n})),define("ui/utility/Viewport",["require","exports","utility/State","utility/Style"],(function(e,t,o,a){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),function(e){e.size=o.default.JIT((()=>({w:window.innerWidth,h:window.innerHeight}))),e.mobile=o.default.JIT((t=>{const o=a.default.measure("--content-width"),n=e.size.value.w<o.value;return o.subscribe(t,e.mobile.markDirty),e.size.subscribe(t,e.mobile.markDirty),n})),e.tablet=o.default.JIT((t=>{const o=a.default.measure("--tablet-width"),n=e.size.value.w<o.value;return o.subscribe(t,e.tablet.markDirty),e.size.subscribe(t,e.tablet.markDirty),n})),e.laptop=o.default.JIT((t=>{const o=a.default.measure("--laptop-width"),n=e.size.value.w<o.value;return o.subscribe(t,e.laptop.markDirty),e.size.subscribe(t,e.laptop.markDirty),n})),e.state=o.default.JIT((t=>{const o=e.mobile.value?"mobile":e.tablet.value?"tablet":e.laptop.value?"laptop":"desktop";return e.mobile.subscribe(t,e.state.markDirty),e.tablet.subscribe(t,e.state.markDirty),e.laptop.subscribe(t,e.state.markDirty),o})),e.listen=function(){window.addEventListener("resize",e.size.markDirty)}}(n||(n={})),Object.assign(window,{Viewport:n}),t.default=n})),define("utility/Objects",["require","exports","utility/string/Strings"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),t.mutable=function(e){return e},o=__importDefault(o),function(e){function t(e,t){return Object.fromEntries(Object.entries(e).filter(t))}function a(e,t,o){const a=()=>{const a=o();return delete e[t],e[t]=a,a instanceof Promise&&a.then((o=>e[t]=o)),a};a.compute=o,Object.defineProperty(e,t,{configurable:!0,get:a})}function n(e,t){return r(e,t)}e.EMPTY={},e.keys=function(e){return Object.keys(e)},e.values=function(e){return Object.values(e)},e.entries=function(e){return Object.entries(e)},e.inherit=function(e,t){return Object.setPrototypeOf(e,t.prototype),e},e.filterNullish=function(e){return t(e,(e=>null!==e[1]&&void 0!==e[1]))},e.filter=t,e.map=function(e,t){return Object.fromEntries(Object.entries(e).map(t))},e.mapAsync=async function(e,t){return Object.fromEntries(await Promise.all(Object.entries(e).map(t)))},e.followPath=function(e,t){for(const o of t)e=e?.[o];return e},e.applyJIT=a,e.copyJIT=function(e,t,o){const n=Object.getOwnPropertyDescriptor(t,o);if(!n)return;if("value"in n)return void(e[o]=t[o]);const i=n.get?.compute;i&&a(e,o,i)},e.assign=function(e,...t){for(const o of t)for(const t of Object.keys(o)){const a=Object.getOwnPropertyDescriptor(e,t);a&&!a.writable||(e[t]=o[t])}return e},e.merge=function e(t,o){if("object"!=typeof t||"object"!=typeof o||null===t||null===o||Array.isArray(t)||Array.isArray(o))return void 0===o?t:o;const a={};for(const n of new Set([...Object.keys(t),...Object.keys(o)]))a[n]=e(t[n],o[n]);return a},e.stringify=n;const i=Symbol("STRINGIFY_DISABLED");function r(e,t,a=[]){if(void 0===e)throw new Error("Cannot stringify undefined");if(null===e||"object"!=typeof e)return JSON.stringify(e);if(a.includes(e))return"[Circular]";if(a.push(e),Array.isArray(e)){const n=e.map((e=>"object"==typeof e&&e&&(e[i]||e instanceof Node)?"[Omitted]":"function"==typeof e?"[Function]":"symbol"==typeof e?e.description??"[Symbol]":r(e,t,a)));return t?`[\n${o.default.indent(n.join(",\n"),t)}\n]`:`[${n.join(",")}]`}const n=function(e){if(Object.getPrototypeOf(e)===Object.prototype)return Object.entries(e);const t={};let o=e;for(;o&&o!==Object.prototype;){for(const a of Object.getOwnPropertyNames(o))try{t[a]??=e[a]}catch{}o=Object.getPrototypeOf(o)}return Object.entries(t)}(e).filter((([,e])=>void 0!==e&&"function"!=typeof e&&"symbol"!=typeof e&&!("object"==typeof e&&e&&(e[i]||e instanceof Node)))).sort((([e],[t])=>e.localeCompare(t)));return t?`{\n${o.default.indent(n.map((([e,o])=>`${JSON.stringify(e)}: ${r(o,t,a)}`)).join(",\n"))}\n}`:`{${n.map((([e,o])=>`${JSON.stringify(e)}:${r(o,t,a)}`)).join(",")}}`}function l(e,t,o){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("object"!=typeof e)return!1;if(!e||!t)return!1;if(o.includes(e)||o.includes(t))return!1;o.push(e,t);const a=Array.isArray(e);if(a!==Array.isArray(t))return!1;if(a){const a=t;if(e.length!==a.length)return!1;for(let t=0;t<e.length;t++)if(!l(e[t],a[t],o))return!1;return!0}const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const a of n){if(!i.includes(a))return!1;if(!l(e[a],t[a],o))return!1}return!0}!function(e){function t(e){return Object.defineProperty(e,i,{value:!0}),e}e.disable=t,t(window),t(document)}(n=e.stringify||(e.stringify={})),e.deepEquals=function(e,t){return l(e,t,[])},e.strip=function(e,...t){if(void 0!==e)for(const o of t)delete e[o];return e}}(a||(a={})),t.default=a})),define("ui/component/core/Popover",["require","exports","ui/Component","ui/component/core/Dialog","ui/InputBus","ui/utility/FocusListener","ui/utility/HoverListener","ui/utility/Mouse","ui/utility/TypeManipulator","ui/utility/Viewport","utility/maths/Vector2","utility/Objects","utility/State","utility/Task"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importStar(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),p=__importDefault(p),f=__importDefault(f);var m;!function(e){let t;function a(){return t??=(0,o.default)().tabIndex("auto").ariaHidden().style.setProperty("display","none").prependTo(document.body)}e.show=function(){a().style.setProperty("display","inline")},e.hide=function(){a().style.setProperty("display","none")}}(m||(m={})),o.default.extend((e=>{e.extend((e=>({hasPopoverSet:()=>!!e.popover,clearPopover:()=>e.attributes.set("data-clear-popover","true"),setPopover:(t,i)=>{e.popover&&e.popover.remove(),e.style("has-popover");let u=!1;const c=h().anchor.from(e).tweak((e=>e.prepend((0,o.default)().style("popover-close-surface").event.subscribe("click",(()=>e.hide()))))).setOwner(e).setCloseDueToMouseInputFilter((t=>{const o=r.default.hovered()??null;return!e.element.contains(o)})).event.subscribe("toggle",(t=>{c.element.matches(":popover-open")||(u=!1,e.clickState=!1,l.default.offMove(D))})).tweak(i,e);let p,g;e.getStateForClosest(a.default).use(c,(e=>{c.appendTo(e()??document.body)}));let v=!1;function y(){v=!1,g=void 0,clearTimeout(p)}e.event.until(c,(t=>t.subscribe("touchstart",(t=>{if(g=d.default.fromClient(t.touches[0]),t.touches.length>1)return y();const o=[t.targetComponent,...t.targetComponent?.getAncestorComponents()??[]].find((e=>e?.hasPopoverSet()));o===e&&(p=window.setTimeout((()=>{v=!0,D(null,null,"longpress")}),800))})).subscribePassive("touchmove",(e=>{if(!g)return;if(e.touches.length>1)return y();const t=d.default.fromClient(e.touches[0]);return d.default.distanceWithin(20,g,t)?void 0:y()})).subscribe("touchend",(e=>{v&&e.preventDefault(),y()})).subscribe("contextmenu",(e=>{g||(e.preventDefault(),D(null,null,"longpress"))})))),c.visible.match(e,!0,(async()=>{c.hasContent()&&(c.show(),await f.default.yield(),c.anchor.apply())})),c.style.bind(c.anchor.state.mapManual((e=>"bottom"===e?.preference?.yAnchor.side)),"popover--anchored-top");const b=e.hoveredOrFocused.delay(c,(e=>e?c.getDelay():0));"hover/click"!==t&&"hover/longpress"!==t&&"longpress"!==t||e.popover||b.subscribe(e,D);const _=e.ariaLabel.state.value,w=c.ariaLabel.state.map(c,(e=>_||e)),k=c.attributes.getUsing("role")??c.attributes.get("role");function T(){e.clickState=!1,c.hide()}return e.ariaLabel.bind(w.mapManual((e=>(t,{arg:o})=>t["popover/button"](o(e),o(k))))),c.ariaLabel.bind(w.mapManual((e=>(t,{arg:o})=>t.popover(o(e))))),navigate.event.subscribe("Navigate",T),c.removed.matchManual(!0,(()=>navigate.event.unsubscribe("Navigate",T))),e.clickState=!1,e.popover||(e.event.subscribe("click",(async o=>{if("hover/longpress"===t||"longpress"===t)return;const a=o.target.component?.closest(n.HandlesMouseEvents);a&&a?.element!==e.element&&e.element.contains(a.element)||(e.clickState=!e.clickState,o.stopPropagation(),o.preventDefault(),e.clickState?await x():c.hide())})),e.receiveInsertEvents(),e.receiveAncestorInsertEvents(),e.event.subscribe(["insert","ancestorInsert"],(function(){if(!e.popover)return;const t=e.popover.popoverParent.value;e.popover.popoverParent.asMutable?.setValue(e.closest(h)),t&&t!==e.popover.popoverParent.value&&t.popoverChildren.asMutable?.setValue(t.popoverChildren.value.filter((t=>t!==e.popover)));e.popover.popoverParent.value&&e.popover.popoverParent.value!==t&&e.popover.popoverParent.value.popoverChildren.asMutable?.setValue([...e.popover.popoverParent.value.popoverChildren.value,e.popover])}))),c.popoverHasFocus.subscribe(e,((t,o)=>{t||(e.clickState=!1,e.popover?.hide(),"no-focus"!==o&&e.focus())})),e.extend((e=>({popover:c,popoverDescendants:[],tweakPopover:t=>(t(e.popover,e),e),showPopover:()=>(x(),e),togglePopover:()=>(c.visible.value?c.hide():x(),e)})));async function x(){e.popover?.show(),e.popover?.focus(),e.popover?.style.removeProperties("left","top"),await f.default.yield(),e.popover?.anchor.apply()}async function D(o,a,i){if(!e.popover)return;const d=b.value&&!("ontouchstart"in window||navigator.maxTouchPoints>0)&&!("longpress"===t&&s.default.tablet.value)||"longpress"===i||u&&("hover/longpress"===t||"longpress"===t)&&s.default.tablet.value||u&&(e.popover.isMouseWithin(!0)&&!function(){if(!e.popover)return!1;const t=r.default.hovered()??null;if(e.element.contains(t)||e.popover.element.contains(t))return!1;const o=t?.closest("[data-clear-popover]");if(!o)return!1;if(o.contains(e.element))return!1;const a=o.component?.closest(h);return!e.popover.containsPopoverDescendant(a)}()||n.default.isDown("F4"))||!!e.clickState;u!==d&&(b.value&&!u&&l.default.onMove(D),d||l.default.offMove(D),d||m.hide(),u=d,e.popover.toggle(d),d&&(m.show(),await f.default.yield(),e.popover.anchor.apply()))}}})))}));const h=o.default.Builder((e=>{let t,a,d=0;const f=(0,p.default)(!1);let m,h=!0,g=!1;const v=[],y=e.style("popover").tabIndex("programmatic").attributes.set("popover","manual").extend((e=>({lastStateChangeTime:0,visible:f,type:u.default.Style(e,(e=>`popover--type-${e}`)),popoverChildren:(0,p.default)([]),popoverParent:(0,p.default)(void 0),popoverHasFocus:i.default.focused.map(e,(e=>e?f.value&&w(e)?"focused":void 0:"no-focus")),setCloseOnInput:(t=!0)=>(h=t,e),setCloseDueToMouseInputFilter:t=>(m=t,e),setMousePadding:o=>(t=o,e),setDelay:t=>(d=t,e),getDelay:()=>d,setNormalStacking:()=>(s.default.tablet.use(e,(t=>{const o=t();e.style.toggle(!o,"popover--normal-stacking"),e.attributes.toggle(o,"popover","manual"),g=!o,b(f.value)})),e),onShow:t=>(v.push(t),e),isMouseWithin:(o=!1)=>{if(e.rect.value.expand(t??100).intersects(l.default.state.value))return!0;if(o)for(const t of e.popoverChildren.value)if(t.isMouseWithin(!0))return!0;return!1},containsPopoverDescendant:w,show:()=>(a?.(),b(!0),e.visible.asMutable?.setValue(!0),e),hide:()=>(a?.(),b(!1),e.visible.asMutable?.setValue(!1),e),toggle:t=>(a?.(),b(t),e.visible.asMutable?.setValue(t??!e.visible.value),e),bind:t=>(a?.(),a=t.use(e,(t=>{b(t),e.visible.asMutable?.setValue(t)})),e),unbind:()=>(a?.(),e)})));return y.event.subscribe("toggle",(e=>{y.visible.asMutable?.setValue("open"===e.newState)})),y.onRooted((()=>{n.default.subscribe("down",_),y.removed.matchManual(!0,(()=>n.default.unsubscribe("down",_)))})),y;function b(e){if(e)for(const e of v)if(!1===e(y))return;y.hasContent()||(e=!1),g&&!s.default.tablet.value?y.style.toggle(!e,"popover--normal-stacking--hidden"):y.rooted.value&&y.style.remove("popover--normal-stacking--hidden").attributes.set("popover","manual").element.togglePopover(e),(0,c.mutable)(y).lastStateChangeTime=Date.now()}function _(e){y.visible.value&&h&&e.key.startsWith("Mouse")&&!y.containsPopoverDescendant(r.default.hovered())&&(m&&!m(e)||(y.rooted.value&&y.attributes.set("popover","manual").element.togglePopover(!1),y.visible.asMutable?.setValue(!1),(0,c.mutable)(y).lastStateChangeTime=Date.now()))}function w(e){if(!e)return!1;const t=o.default.is(e)?e.element:e;if(y.element.contains(t))return!0;for(const t of y.popoverChildren.value){if(t===e)return!0;if(t.containsPopoverDescendant(e))return!0}return!1}}));t.default=h})),define("utility/AbortPromise",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});class o extends Promise{#e;constructor(e){const t=new AbortController;super(((o,a)=>e(o,a,t.signal))),this.#e=t,this.abort=this.abort.bind(this)}abort(){this.#e?.signal.aborted||this.#e?.abort()}}!function(e){e.asyncFunction=function(t){return(...o)=>new e(((e,a,n)=>{t(n,...o).then(e,a)}))}}(o||(o={})),t.default=o})),define("ui/component/core/Slot",["require","exports","ui/Component","ui/component/core/ext/ComponentInsertionTransaction","utility/AbortPromise","utility/State"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importStar(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),o.default.extend((e=>{e.extend((e=>({hasContent(){const t=document.createTreeWalker(e.element,NodeFilter.SHOW_TEXT);for(;t.nextNode();)if(t.currentNode.textContent?.trim())return!0;for(const t of e.getDescendants())if(!t.is(r))return!0;return!1},appendWhen(t,...a){let n=(0,o.default)().append(...a);return r().appendTo(e).preserveContents().if(t,(e=>{e.append(...a),n?.remove(),n=void 0})),e},prependWhen(t,...a){let n=(0,o.default)().append(...a);return r().prependTo(e).preserveContents().if(t,(e=>{e.append(...a),n?.remove(),n=void 0})),e},insertWhen(t,a,n,...i){let l=(0,o.default)().append(...i);return r().insertTo(e,a,n).preserveContents().if(t,(e=>{e.append(...i),l?.remove(),l=void 0})),e},appendToWhen(t,a){let n;return e.parent&&(n=(0,o.default)(),e.appendTo(n)),r().appendTo(a).preserveContents().if(t,(t=>{t.append(e),n?.remove(),n=void 0})),e},prependToWhen(t,a){let n;return e.parent&&(n=(0,o.default)(),e.appendTo(n)),r().prependTo(a).preserveContents().if(t,(t=>{t.append(e),n?.remove(),n=void 0})),e},insertToWhen(t,a,n,i){let l;return e.parent&&(l=(0,o.default)(),e.appendTo(l)),r().insertTo(a,n,i).preserveContents().if(t,(t=>{t.append(e),l?.remove(),l=void 0})),e}})))}));const r=Object.assign(o.default.Builder((e=>{let t,r,l,u;e.style("slot");const s=(0,i.default)({elseIfs:[]});let d,c,p=!1,f=!1;const m=(0,i.default)(!1);return e.style.bind(m,"slot--hidden").extend((e=>({preserveContents(){if(s.value.elseIfs.length||s.value.else)throw new Error("Cannot preserve contents when using elses");return p=!0,e},use:(n,s)=>{if(p)throw new Error('Cannot "use" when preserving contents');t?.(),t=void 0,l?.(),l=void 0,u?.(),u=void 0,c?.(),c=void 0,d?.(),d=void 0;const m=Array.isArray(n);if(m){const e=i.default.Owner.create();c=e.remove,n=i.default.Map(e,n,((...e)=>e))}else n=i.default.get(n);return t=n.use(e,(t=>{l?.(),l=void 0,r?.(),r=void 0,u?.(),u=void 0;const n=(0,o.default)(),i=(0,a.default)(n,(()=>{e.removeContents(),e.append(...n.element.children),f=!0}));Object.assign(i,{closed:n.removed}),u=i.abort,g(i,m?s(i,...t):s(i,t))})),e},if:(o,a)=>(t?.(),t=void 0,l?.(),l=void 0,u?.(),u=void 0,c?.(),c=void 0,d?.(),d=void 0,o.use(e,(t=>{if(l?.(),l=void 0,r?.(),r=void 0,u?.(),u=void 0,c?.(),c=void 0,d?.(),d=void 0,t)m.value=!1,p&&f||h(a);else{if(p)return void(m.value=!0);let t;const o=s.useManual((o=>{t=i.default.MapManual(o.elseIfs.map((({state:e})=>e)),((...e)=>e.indexOf(!0))).useManual((t=>{const a=-1===t?o.else:o.elseIfs[t].initialiser;a?h(a):e.removeContents()}))}));d=()=>{t?.(),o()}}})),e),elseIf(t,o){if(p)throw new Error("Cannot use else when preserving contents");return s.value.elseIfs.push({state:t,initialiser:o}),s.emit(),e},else(t){if(p)throw new Error("Cannot use else when preserving contents");return s.value.else=t,s.emit(),e}}))).tweak((e=>e.removed.matchManual(!0,(()=>r?.()))));function h(t){const n=(0,o.default)(),i=(0,a.default)(n,(()=>{e.removeContents(),e.append(...n.element.children),f=!0}));Object.assign(i,{closed:n.removed}),u=i.abort,g(i,t(i))}function g(e,t){if(!(t instanceof n.default))return v(e,t||void 0);l=t.abort,t.then((t=>v(e,t||void 0))).catch((e=>console.error("Slot initialiser promise rejection:",e)))}function v(t,a){if(a||=void 0,a===e&&(a=void 0),t.close(),u=void 0,o.default.is(a))return a.appendTo(e),f=!0,void(r=void 0);r=o.ComponentInsertionDestination.is(a)?void 0:a}})),{using:(e,t)=>r().use(i.default.get(e),t)});t.default=r})),define("ui/component/core/ext/CanHasActionsMenu",["require","exports","lang/en-nz","ui/Component","ui/component/core/Button","ui/component/core/Popover","ui/component/core/Slot","ui/utility/Viewport","utility/Objects","utility/State"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),s=__importDefault(s);const d=a.default.Builder((e=>{if(!e.is(i.default))throw new Error("ActionsMenu must be a Popover");const t=new Set,o={};return e.extend((e=>({actionsWrappers:o,anchorTweakers:t,appendAction:a((t=>t.appendTo(e))),prependAction:a((t=>t.prependTo(e))),insertAction:a(((t,a,n)=>t.insertTo(e,a,o[n]))),subscribeReanchor:o=>(t.add(o),e),unsubscribeReanchor:o=>(t.delete(o),e)})));function a(t){return function(...a){const[n]=a,[i,l]=a.slice(-2),u=a.slice(1,-2),s=(0,r.default)().tweak(t,...u);return o[n]=s,"function"==typeof i?(s.tweak(i),e):(s.use(i,l),e)}}})),c=a.default.Extension(((e,t)=>{let c;const p=(0,s.default)(!1);function f(){const e=o.default["shared/actions/empy"]().toString();p.value=!!c?.element.textContent?.replace(e,"").trim()}let m,h,g=!1;const v=e=>{c?(e(c),f()):(h??=[]).push(e)};return e.extend((e=>({actionsMenu:void 0,setActionsMenu:o=>(g=!0,m&&y(e),e.clearPopover().setPopover("longpress",((n,s)=>{n.onShow((t=>!e.closest(i.default))),c=(0,u.mutable)(e).actionsMenu=n.and(d).style("actions-menu-popover").style.bind(p.falsy,"actions-menu-popover--empy").prepend((0,a.default)().style("actions-menu-popover-close-surface").event.subscribe("click",(()=>n.hide()))).appendWhen(p.falsy,(0,a.default)().style("actions-menu-popover-empy-text").text.use("shared/actions/empy")).append((0,r.default)().style.remove("slot").style("actions-menu-popover-arrow")).tweak(t,s).tweak(o,s);for(const e of h??[])e(c);f(),l.default.tablet.use(c,(e=>{const t=e();c.anchor.reset(),t?c.type.remove("flush").anchor.add("aligned right","off bottom").anchor.add("aligned right","off top").anchor.orElseHide():c.type("flush").anchor.add("off right","centre").anchor.orElseHide();const{anchorTweakers:o}=c;for(const e of o)e(c,t)}))})),e),setActionsMenuButton:t=>(m=t??!0,g&&y(e),e),tweakActions:t=>(v((o=>o.tweak(t,e))),e),tweakActionsAnchor:t=>(v((e=>e.subscribeReanchor(t))),e),untweakActionsAnchor:t=>(v((e=>e.unsubscribeReanchor(t))),e)})));function y(e){const t=(0,n.default)().setIcon("ellipsis-vertical").type("icon").event.subscribe("click",(t=>{t.preventDefault(),t.stopImmediatePropagation(),l.default.tablet.value?e.togglePopover():e.showPopover()}));"function"==typeof m?m(t):t.appendTo(e)}}));t.default=c})),define("utility/string/MarkdownItHTML",["require","exports","entities"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const a=Object.assign(((e,t)=>{const o={block:void 0,inline:void 0,i:0,l:0,e:0,src:"",silent:!1,options:{...a.defaultOptions,...t}};e.block.ruler.at("html_block",((e,t,n,i)=>{o.block=e,o.src=o.block.src,o.l=t,o.i=o.block.bMarks[o.l]+o.block.tShift[o.l],o.e=o.src.length,o.silent=i;const r=o.block.blkIndent,l=a.consumeBlock(o);return o.block.blkIndent=r,o.block=void 0,l}),{alt:["paragraph"]}),e.inline.ruler.at("html_inline",((e,t)=>{o.inline=e,o.e=e.posMax,o.i=e.pos,o.src=e.src,o.silent=t;const n=a.consumeInline(o);return o.inline=void 0,n})),e.renderer.rules.html_inline=(e,t)=>e[t].content||e[t].raw}),{regexCSSProperty:/^[-a-zA-Z_][a-zA-Z0-9_-]*$/,defaultOptions:{voidElements:["area","base","br","col","embed","hr","img","input","link","meta","source","track","wbr"],allowedTags:["hgroup","h1","h2","h3","h4","h5","h6","div","p","br","wbr","hr","details","summary","label","ol","ul","li","table","tr","th","td","caption","thead","tbody","tfoot","span","i","b","u","s","strike","sup","sub","em","mark","small","strong","q","cite","blockquote","a","abbr","dfn","dd","dt","dl","code","samp","kbd","img","figure","figcaption","area","map"],allTagsAllowedAttributes:["title","name","id","style","aria-label","aria-labelledby","aria-describedby","aria-hidden"],allTagsAllowedAttributeValues:{},perTagAllowedAttributes:{a:["href"],img:["src","alt","usemap","width","height"],area:["shape","coords"],details:["open"],ol:["type","start","reversed"],li:["value"],th:["colspan","rowspan","headers","scope","abbr"],td:["colspan","rowspan","headers"],q:["cite"]},perTagAllowedAttributeValues:{a:{href:/^https?:/},img:{src:/^https?:/},area:{href:/^https?:/},q:{cite:/^https?:/},blockquote:{cite:/^https?:/}},allTagsAllowedStyleProperties:["color","text-align","font-family","font-style","font-weight","text-decoration","text-transform","line-height","letter-spacing","word-spacing","vertical-align","background-color","opacity","margin","padding","width","height","vertical-align","box-shadow","border-width","border-style","border-color","border-radius","text-indent","display","position"],allTagsAllowedStylePropertyValues:{position:["relative","absolute","sticky"]},perTagAllowedStyleProperties:{},perTagAllowedStylePropertyValues:{}},Options(e){const t=Object.assign({...structuredClone(a.defaultOptions),...e},{disallowTags(...e){const o=e.map((e=>e.toLowerCase()));return t.allowedTags=t.allowedTags.filter((e=>!o.includes(e))),t},allowTags:(...e)=>(t.allowedTags=[...new Set([...t.allowedTags,...e.map((e=>e.toLowerCase()))])],t),disallowAttributes(...e){const o=e.map((e=>e.toLowerCase()));t.allTagsAllowedAttributes=t.allTagsAllowedAttributes.filter((e=>!o.includes(e)));for(const[e,a]of Object.entries(t.perTagAllowedAttributes))t.perTagAllowedAttributes[e]=a.filter((e=>!o.includes(e)));return t},allowAttributes:(...e)=>(t.allTagsAllowedAttributes=[...new Set([...t.allTagsAllowedAttributes,...e.map((e=>e.toLowerCase()))])],t)});return t},use:(e,t)=>e.use(a,t),consumeBlock(e){if(!e.block)return!1;if(a.consumeInlineWhitespace(e),e.silent)return a.consumeTerminator(e);if(!a.consumeTagsLine(e))return!1;e.l++,e.block.line=e.l;const t=a.consumeInlineWhitespace(e)||0;return t>=e.block.blkIndent+4?e.block.blkIndent=t-4:e.block.blkIndent=t,!0},consumeInline(e){if(!e.inline||"<"!==e.src[e.i])return!1;return!!a.consumeTag(e)&&(e.inline.pos=e.i,!0)},consumeTerminator(e){const t=(new Error).stack?.split("\n")?.at(4)?.includes("Array.lheading"),o=a.consumeInlineWhitespace(e)||0;return!!a.consumeTagsLine(e)&&(!t&&e.block&&(e.block.blkIndent=o),!0)},consumeTagsLine(e){let t=!1;const o=[];let n;for(;n=a.consumeTag(e);)"object"==typeof n&&o.push(n),t=!0,a.consumeInlineWhitespace(e);if(t){if(!(e.i<e.src.length)||a.consumeNewline(e))return{tokens:o};o.length&&e.block?.tokens.splice(0,1/0,...e.block.tokens.filter((e=>!o.includes(e))))}},consumeNewline:e=>!e.inline&&("\n"===e.src[e.i]?(e.i++,!0):"\r"===e.src[e.i]&&(e.i++,"\n"===e.src[e.i]&&e.i++,!0)),consumeWhitespace(e){if(e.inline)return!!a.consumeInlineWhitespace(e);const t=e.i;if(e.i>=e.e)return!1;for(e.i;e.i<e.e&&a.isWhitespace(e);e.i++)a.consumeNewline(e)&&(e.l++,e.i--);return e.i>t},consumeInlineWhitespace(e){if(e.i>=e.e)return;let t=0;for(e.i;e.i<e.e;e.i++)if(" "===e.src[e.i])t++;else{if("\t"!==e.src[e.i])break;t+=4}return t||void 0},consumeTag(e){if("<"===e.src[e.i])return e.i++,a.consumeOpenTag(e)??a.consumeCloseTag(e)},consumeOpenTag(e){const t=e.i,n=a.consumeTagName(e);if(!n)return;const i=n.toLowerCase(),r=e.options;if(!r.allowedTags.includes(i))return void(e.i=t);const l=[];let u;for(;a.consumeWhitespace(e);){const t=a.consumeAttribute(e);if(!t)break;let[n,s]=t;if(n=n.toLowerCase(),!r.allTagsAllowedAttributes.includes(n)&&!r.perTagAllowedAttributes[i]?.includes(n))continue;if(s=o.default.decodeHTML5Strict(s),"style"!==n){const e=r.perTagAllowedAttributeValues[i]?.[n]??r.allTagsAllowedAttributeValues[n];if(void 0!==e&&!a.matchesAllowedValues(s,e))continue;l.push(t);continue}u=a.parseStyleAttributeValue(s);let d="";for(let[e,t]of u){if(e=e.toLowerCase(),!r.allTagsAllowedStyleProperties.includes(e)&&!r.perTagAllowedStyleProperties[i]?.includes(e))continue;const o="!important",n=t.slice(-o.length).toLowerCase()===o;n&&(t=t.slice(0,-o.length).trim());const l=r.perTagAllowedStylePropertyValues[i]?.[e]??r.allTagsAllowedStylePropertyValues[e];(void 0===l||a.matchesAllowedValues(t,l))&&(d+=`${e}:${t}${n?o:""};`)}d.length&&l.push(["style",d.slice(0,-1)])}if("/"===e.src[e.i]&&e.i++,">"!==e.src[e.i])return void(e.i=t);e.i++;const s=e.options.voidElements.includes(i)?0:1;if(e.silent)return!0;let d=`html_${e.block?"block":"inline"}${s?"_open":""}`;"br"===i&&(d="softbreak");const c=(e.block??e.inline).push(d,i,s);Object.assign(c,{style:u,raw:e.src.slice(t-1,e.i)});for(const e of l)c.attrPush(e);return c},consumeCloseTag(e){const t=e.i;if("/"!==e.src[e.i])return;e.i++;const o=a.consumeTagName(e);if(!o)return;if(">"!==e.src[e.i])return void(e.i=t);e.i++;const n=o.toLowerCase();if(!e.options.allowedTags.includes(n))return void(e.i=t);if(e.silent||e.options.voidElements.includes(n))return!0;const i=`html_${e.block?"block":"inline"}_close`,r=(e.block??e.inline).push(i,n,-1);return Object.assign(r,{raw:e.src.slice(t-1,e.i)}),e.inline&&!e.inline.delimiters&&(e.inline.delimiters=[]),r},consumeTagName(e){const t=e.i;if(!(e.i>=e.e)&&a.isAlpha(e)){for(e.i++;e.i<e.e&&a.isAlphaNumeric(e);e.i++);return e.src.slice(t,e.i)}},consumeAttribute(e){const t=e.i,o=a.consumeAttributeName(e);if(!o)return;const n=e.i;if(a.consumeWhitespace(e),"="!==e.src[e.i])return e.i=n,[o,""];e.i++,a.consumeWhitespace(e);const i=a.consumeAttributeValue(e);if(i)return[o,i];e.i=t},consumeAttributeName(e){const t=e.i;if(!(e.i>=e.e)){for(e.i;e.i<e.e;e.i++){const t=e.src.charCodeAt(e.i);if(32===t||34===t||39===t||62===t||47===t||61===t||a.isNonCharacter(e,t)||a.isControl(e,t))break}return e.i>t?e.src.slice(t,e.i):void 0}},consumeAttributeValue:e=>a.consumeUnquotedAttributeValue(e)||a.consumeQuotedAttributeValue(e)||void 0,consumeUnquotedAttributeValue(e){let t="";for(;e.i<e.e;){const o=e.src.charCodeAt(e.i);if(34===o||39===o||61===o||60===o||62===o||96===o||a.isWhitespace(e,o))break;if(38!==o){t+=e.src[e.i],e.i++;continue}const n=a.consumeCharacterReference(e);n?t+=n:(t+="&amp;",e.i++)}return t||void 0},consumeQuotedAttributeValue(e){const t=e.i,o=e.src[e.i];if("'"!==o&&'"'!==o)return;e.i++;let n="";for(;e.i<e.e;){const i=e.src.charCodeAt(e.i);if(e.src[e.i]===o)return e.i++,n;if(38!==i){const o=e.i;if(a.consumeNewline(e)){e.l++,n+=e.src.slice(o,e.i);continue}if(e.inline&&a.isWhitespace(e)&&" "!==e.src[e.i]&&"\t"!==e.src[e.i])return void(e.i=t);n+=e.src[e.i],e.i++;continue}const r=a.consumeCharacterReference(e);r?n+=r:(n+="&amp;",e.i++)}e.i=t},consumeCharacterReference(e){const t=e.i;if("&"!==e.src[e.i])return;e.i++;if(a.consumeNumericCharacterReference(e)||a.consumeNamedCharacterReference(e))return e.src.slice(t,e.i);e.i=t},consumeNamedCharacterReference(e){const t=e.i;for(e.i;e.i<e.e&&a.isAlpha(e);e.i++);return e.i!==t&&";"===e.src[e.i]&&(e.i++,!0)},consumeNumericCharacterReference(e){if("#"!==e.src[e.i])return!1;e.i++;const t="x"===e.src[e.i]||"X"===e.src[e.i];t&&e.i++;const o=e.i;for(e.i;e.i<e.e&&(t?a.isHexadecimal(e):a.isNumeric(e));e.i++);if(e.i===o||";"!==e.src[e.i])return!1;const n=parseInt(e.src.slice(o,e.i),t?16:10);return!(13===n||a.isNonCharacter(e,n)||a.isControl(e,n)&&!a.isWhitespace(e,n))&&(e.i++,!0)},parseStyleAttributeValue:e=>{if(null==e)return;const t=new Map;let o="",n="",i=!1,r=!1,l=!1,u=!1,s="",d=0;for(let c=0;c<e.length;c++){const p=e[c];if(u){if("*"!==p&&"/"!==e[c+1])continue;u=!1,c++}else if("\\"!==p)if(r)n+=p,r=!1;else if(u||"/"!==p||"*"!==e[c+1]){if(l){if(p===s){l=!1,n+=p;continue}}else if('"'===p||"'"===p){l=!0,s=p,n+=p;continue}"("!==p||l?")"!==p||l?":"!==p||l||0!==d?";"!==p||l||0!==d?i?n+=p:o+=p:(o&&n&&(o=o.trim(),a.regexCSSProperty.test(o)?t.set(o,n.trim()):console.warn(`Invalid CSS property "${o}"`),o="",n=""),i=!1):i=!0:(d--,n+=p):(d++,n+=p)}else u=!0,c++;else r=!0}return o&&n&&(o=o.trim(),a.regexCSSProperty.test(o)?t.set(o,n.trim()):console.warn(`Invalid CSS property "${o}"`)),t},isAlpha:(e,t=e.src.charCodeAt(e.i))=>t>=65&&t<=90||t>=97&&t<=122,isNumeric:(e,t=e.src.charCodeAt(e.i))=>t>=48&&t<=57,isHexadecimal:(e,t=e.src.charCodeAt(e.i))=>t>=65&&t<=70||t>=97&&t<=102||a.isNumeric(e,t),isAlphaNumeric:(e,t=e.src.charCodeAt(e.i))=>a.isAlpha(e,t)||a.isNumeric(e,t),isNonCharacter:(e,t=e.src.charCodeAt(e.i))=>t>=64976&&t<=65007||65534===t||65535===t||131070===t||131071===t||196606===t||196607===t||262142===t||262143===t||327678===t||327679===t||393214===t||393215===t||458750===t||458751===t||524286===t||524287===t||589822===t||589823===t||655358===t||655359===t||720894===t||720895===t||786430===t||786431===t||851966===t||851967===t||917502===t||917503===t||983038===t||983039===t||1048574===t||1048575===t||1114110===t||1114111===t,isControl:(e,t=e.src.charCodeAt(e.i))=>t>=0&&t<=31||t>=127&&t<=159,isWhitespace:(e,t=e.src.charCodeAt(e.i))=>9===t||10===t||12===t||13===t||32===t,matchesAllowedValues:(e,t)=>Array.isArray(t)?t.some((t=>a.matchesAllowedValues(e,t))):"string"==typeof t?e===t:"function"==typeof t?t(e):t.test(e)}),n=a;t.default=n})),define("utility/string/Markdown",["require","exports","markdown-it","utility/string/MarkdownItHTML"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new o.default("commonmark",{html:!0,breaks:!0});return a.default.use(e,a.default.Options().disallowTags("img","figure","figcaption","map","area")),e.inline.ruler.enable("strikethrough"),e.inline.ruler2.enable("strikethrough"),e.inline.ruler.before("emphasis","underline",(function(e,t){const o=e.pos,a=e.src.charCodeAt(o);if(t||95!==a)return!1;const n=e.scanDelims(e.pos,!0);let i=n.length;if(i<2)return!1;const r=String.fromCharCode(a);let l;i%2&&(l=e.push("text","",0),l.content=r,i--);for(let t=0;t<i;t+=2)l=e.push("text","",0),l.content=r+r,e.delimiters.push({marker:a,length:0,token:e.tokens.length-1,end:-1,open:n.can_open,close:n.can_close});return e.pos+=n.length,!0})),e.inline.ruler2.before("emphasis","underline",(function(e){const t=e.tokens_meta,o=e.tokens_meta.length;a(e,e.delimiters);for(let n=0;n<o;n++){const o=t[n]?.delimiters;o&&a(e,o)}for(const t of e.delimiters)95===t.marker&&(t.marker=-999999);return!0;function a(e,t){let o;const a=[],n=t.length;for(let i=0;i<n;i++){const n=t[i];if(95!==n.marker)continue;if(-1===n.end)continue;const r=t[n.end];o=e.tokens[n.token],o.type="u_open",o.tag="u",o.nesting=1,o.markup="__",o.content="",o=e.tokens[r.token],o.type="u_close",o.tag="u",o.nesting=-1,o.markup="__",o.content="","text"===e.tokens[r.token-1].type&&"_"===e.tokens[r.token-1].content&&a.push(r.token-1)}for(;a.length;){const t=a.pop()??0;let n=t+1;for(;n<e.tokens.length&&"u_close"===e.tokens[n].type;)n++;n--,t!==n&&(o=e.tokens[n],e.tokens[n]=e.tokens[t],e.tokens[t]=o)}}})),e},o=__importDefault(o),a=__importDefault(a)})),define("ui/utility/MarkdownContent",["require","exports","lang/en-nz","ui/Component","ui/utility/StringApplicator","utility/string/Markdown","utility/string/MarkdownItHTML"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=[],u=Object.entries({SPAN:["DIV","P","UL","OL","LI"],STRONG:["H1","H2","H3","H4","H5","H6"],EM:["BLOCKQUOTE"],CODE:["PRE"]}).flatMap((([e,t])=>t.map((t=>[t,e])))).toObject(),s=new Set(["IMG","HR","BR","TABLE"]),d=/(?<=<mention[^>]*>)/g;var c;a.default.extend((e=>{let t;function r(t,o,n){if(!t)return void(e.element.innerHTML="");"string"==typeof t&&(t={body:t}),e.classes.add("markdown");const r=(0,i.default)().render(t.body);e.element.innerHTML=r.replace(d,"</mention>"),o&&function(e,t,o){let a=0,n=!1;const i=[],r=[];let l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);for(;l.nextNode();){const e=l.currentNode,d=e.tagName;if(s.has(d)){i.push(e);continue}if(a>=t){i.push(e),n=!0;continue}if(e.nodeType===Node.TEXT_NODE){const o=e.textContent?.length??0;a+=o;const i=Math.max(0,a-t);i&&(n=!0,e.textContent=e.textContent?.slice(0,o-i)??null,a=t)}u[d]&&o&&r.push(e)}for(let e=i.length-1;e>=0;e--)i[e].parentNode?.removeChild(i[e]);if(o)for(let e=r.length-1;e>=0;e--){const t=r[e],o=u[t.tagName],a=document.createElement(o);a.replaceChildren(...t.childNodes),t.replaceWith(a)}const d=[];if(l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT),o)for(;l.nextNode();){const e=l.currentNode;"SPAN"!==e.tagName&&(e.parentElement?.closest(e.tagName)&&d.push(e))}for(let e=d.length-1;e>=0;e--)d[e].replaceWith(...d[e].childNodes);if(n){const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let o=null;for(;t.nextNode();)o=t.currentNode;o?o.nodeValue+="…":e.append("…")}}(e.element,o,n??!!o);const c=[],p=document.createTreeWalker(e.element,NodeFilter.SHOW_ELEMENT);for(;p.nextNode();)for(const e of l){const o=e(p.currentNode,t);o&&c.push(o)}for(const e of c)e();2===e.element.lastElementChild?.tagName.length&&"H"===e.element.lastElementChild.tagName[0]&&(0,a.default)("p").appendTo(e)}e.extend((e=>({setMarkdownContent:(o,a,n)=>(t?.(),t=void 0,r(o,a,n),e),useMarkdownContent:(a,i,l)=>(t?.(),t=void 0,t=n.Quilt.State.use(e,(e=>{const t=(n.QuiltHelper,"string"==typeof a?e[a]():"string"==typeof a?.body?e[a.body]():a?.body(e,n.QuiltHelper))?.content.map((function e(t){if(!t.tag)return Array.isArray(t.content)?t.content.map(e).join(""):"object"==typeof t.content&&t.content&&!o.WeavingArg.isRenderable(t.content)?n.QuiltHelper.isWeave(t.content)?t.content.content.map(e).join(""):e(t):"string"==typeof t.content||"number"==typeof t.content?String(t.content):"";return`<weave tag="${t.tag}">${e({content:t.content})}</weave>`})).join("");r(t&&"string"!=typeof a?{body:t,mentions:a?.mentions}:t,i,l)})),e)})))})),function(e){e.handle=function(e){l.push(e)},e.trim=function(e){return e.trim().replace(/^(?:\s|<br>)+/,"").replace(/(?:\s|<br>)+$/,"")},e.registerMarkdownHandlers=function(){r.default.defaultOptions.allowedTags.push("weave"),r.default.defaultOptions.perTagAllowedAttributes.weave=["tag"],e.handle(((e,t)=>{if("WEAVE"===e.tagName)return()=>{const t=e.getAttribute("tag");let o=t?n.QuiltHelper.createTagElement(t):void 0;o??=document.createElement("span"),e.childNodes.length&&o.replaceChildren(...e.childNodes),e.replaceWith(o)}}))}}(c||(c={})),t.default=c})),define("utility/maths/Maths",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isIncrementing=function(e){for(let t=1;t<e.length;t++)if(e[t]!==e[t-1]+1)return!1;return!0},e.sum=function(...e){let t=0;for(const o of e)t+=o;return t},e.average=function(...e){let t=0;for(const o of e)t+=o;return t/e.length},e.bits=function(e){const o=new t;for(let t=52;t>=0;t--){const a=1<<t;e&a&&o.add(a)}return o};class t extends Set{everyIn(e){const t=e??0;for(const e of this)if(!(t&e))return!1;return!0}someIn(e){const t=e??0;for(const e of this)if(t&e)return!0;return!1}every(e){for(const t of this)if(!e(t))return!1;return!0}some(e){for(const t of this)if(e(t))return!0;return!1}}e.BitsSet=t,e.bitsn=function(e){const t=new o;for(let o=52n;o>=0n;o--){const a=1n<<o;e&a&&t.add(a)}return t};class o extends Set{everyIn(e){const t=e??0n;for(const e of this)if(!(t&e))return!1;return!0}someIn(e){const t=e??0n;for(const e of this)if(t&e)return!0;return!1}every(e){for(const t of this)if(!e(t))return!1;return!0}some(e){for(const t of this)if(e(t))return!0;return!1}}e.BitsSetN=o,e.lerp=function(e,t,o){return(1-o)*e+o*t},e.unlerp=function(e,t,o){const a=e>t;if(a){const o=t;t=e,e=o}const n=o<=e?0:o>=t?1:(o-e)/(t-e);return a?1-n:n},e.parseIntOrUndefined=function(e){const t=parseFloat(e);return isNaN(t)||!Number.isInteger(t)?void 0:t},e.clamp1=function(e){return e<0?0:e>1?1:e}}(o||(o={})),t.default=o})),define("ui/component/core/Heading",["require","exports","ui/Component","ui/utility/MarkdownContent","ui/utility/TextManipulator","utility/Define","utility/maths/Maths","utility/State"],(function(e,t,o,a,n,i,r,l){var u;Object.defineProperty(t,"__esModule",{value:!0}),t.HeadingClasses=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),function(e){e._ContainsHeading="_contains-heading"}(u||(t.HeadingClasses=u={})),o.default.extend((e=>e.extend((e=>({containsHeading:()=>e.classes.has(u._ContainsHeading),setContainsHeading:()=>(e.classes.add(u._ContainsHeading),e)})))));const s=o.default.Builder("h1",(e=>{e.style("heading");const t=(0,o.default)().style("heading-text").appendTo(e);i.default.set(e,"text",(0,n.default)(e,t));let a,u,s=!0;const c=(0,l.default)(void 0);let m;l.default.Map(e,[e.text.state,c],((...e)=>e)).use(e,(([o,a])=>{if(e.setId(o?.toString().toLowerCase().replace(/\W+/g,"-")),!a)return;const n=o?.length??0,i=1-r.default.clamp1(r.default.unlerp(a.minLength,a.maxLength,n));t.style.setProperty("--font-size-multiplier",`${i}`)})),e.tabIndex("programmatic"),e.receiveInsertEvents(),e.receiveAncestorInsertEvents(),e.event.subscribe(["insert","ancestorInsert"],v),e.rooted.subscribeManual(v);const h=(0,l.default)(null,!1),g=(e,t)=>{const o=e?.at(t);if("number"!=typeof o)return;const a=`#${o.toString(16).padStart(6,"0")}`;return`light-dark(\n\t\t\toklch(from ${a} max(var(--heading-colour-light-min), min(var(--heading-colour-light-max), L)) C H),\n\t\t\toklch(from ${a} max(var(--heading-colour-dark-min), min(var(--heading-colour-dark-max), L)) C H)\n\t\t)`};return e.style.bindVariable("heading-colour-1",h.map(e,(e=>g(e,0)))),e.style.bindVariable("heading-colour-2",h.map(e,(e=>g(e,-1)))),e.extend((o=>({textWrapper:t,setAestheticLevel(t){const n=u??"heading",i=p(e.element);return!1!==n&&f(i)&&e.style.remove(`${n}-${i}`),!1!==n&&a&&e.style.remove(`${n}-${a}`),a=t,!1!==n&&f(a)&&e.style(`${n}-${a}`),o},setAestheticStyle(t){const n=a??p(e.element);return!1!==u&&f(n)&&e.style.remove(`${u??"heading"}`,`${u??"heading"}-${n}`),u=t,!1!==t&&f(n)&&e.style(`${t??"heading"}`,`${t??"heading"}-${n}`),o},updateLevel:()=>(v(),o),setResizeRange:(e,t)=>(l.default.is(t)?c.bind(o,t.map(o,(function(t){return void 0===e||void 0===t?void 0:{minLength:e,maxLength:t}}))):c.value=void 0===e||void 0===t?void 0:{minLength:e,maxLength:t},o),clearResizeRange:()=>(c.value=void 0,o),setUnderlineColours:e=>(m?.(),m=h.bind(o,l.default.get(e)),o)})));function v(){const t=function(e){let t=e,o=!1;for(;t;){if(t.nodeType===Node.ELEMENT_NODE&&"NAV"===t.tagName)return 2;const e=d(t);if(e){const t=p(e);return o||1===t?void 0===t||t>6?t:t+1:t}t=t.parentNode??void 0,o||=!0}return 1}(e.element),o=p(e.element),n=t===o;if(n&&!s)return;const i=u??"heading";s=!1,!1!==i&&f(o)&&e.style.remove(`${i}-${o}`);const r=f(t);!1!==i&&!a&&r&&e.style(`${i}-${t}`),!1!==i&&a&&e.style(`${i}-${a}`),n||(e.event.unsubscribe(["insert","ancestorInsert"],v),e.replaceElement(r?`h${t}`:"span"),e.attributes.toggle(!r,"role","heading"),e.attributes.toggle(!r&&"number"==typeof t,"aria-level",`${t}`),e.event.subscribe(["insert","ancestorInsert"],v))}}));function d(e){let t=e;for(;t;){if(t=t.previousSibling??void 0,t?.nodeType!==Node.ELEMENT_NODE)continue;const e=t;if(c(e))return e;if("heading"===e.getAttribute("role"))return e;if("HGROUP"===e.tagName){const[t]=e.querySelectorAll("h1, h2, h3, h4, h5, h6, [role='heading']");if(t)return t}if(e.component?.containsHeading()){const[t]=e.querySelectorAll("h1, h2, h3, h4, h5, h6, [role='heading']");if(t)return t}}}function c(e){if(!e||"object"!=typeof e||!("tagName"in e))return!1;const t=e;return"H"===t.tagName[0]&&2===t.tagName.length&&!isNaN(+t.tagName[1])}function p(e){return+e.tagName.slice(1)||+e.getAttribute("aria-level")||void 0}function f(e){return"number"==typeof e&&e>=1&&e<=6}a.default.handle((e=>{if(c(e))return()=>{const t=p(e),a=s().setAestheticStyle("markdown-heading");o.default.removeContents(a.element),a.element.replaceChildren(...e.childNodes),e.replaceWith(a.element),a.emitInsert(),f(t)&&a.setAestheticLevel(t)}})),t.default=s})),define("ui/utility/EventManipulator",["require","exports","utility/Arrays","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=Symbol("REGISTERED_FUNCTION");function i(e){if(!(e&&e instanceof Node))return;let t=e;do{const e=t.component;if(e)return e}while(t=t.parentNode)}t.default=function(e){const t=function(e){return"object"==typeof e&&null!==e&&"isComponent"in e}(e)?e:{element:document.createElement("span")},r={emit(e,...o){const a={result:[],params:o};let n=!1,i=!1;const r=Object.assign(new CustomEvent(e,{detail:a}),{preventDefault(){Event.prototype.preventDefault.call(this),i||=!0},stopPropagation(){n||=!0},stopImmediatePropagation(){n="immediate"}});return t.element.dispatchEvent(r),Object.assign(a.result,{defaultPrevented:r.defaultPrevented||i,stoppedPropagation:n})},bubble(e,...o){const a={result:[],params:o};let n=!1,i=!1;const r=Object.assign(new CustomEvent(e,{detail:a,bubbles:!0}),{preventDefault(){Event.prototype.preventDefault.call(this),i||=!0},stopPropagation(){n||=!0},stopImmediatePropagation(){n="immediate"}});return t.element.dispatchEvent(r),Object.assign(a.result,{defaultPrevented:r.defaultPrevented||i,stoppedPropagation:n})},subscribe:(e,t)=>l(t,e),subscribePassive:(e,t)=>l(t,e,{passive:!0}),subscribeCapture:(e,t)=>l(t,e,{capture:!0}),unsubscribe(a,i){const r=i[n];if(!r)return e;delete i[n];for(const e of o.default.resolve(a))t.element.removeEventListener(e,r);return e},until:(t,o)=>(o({subscribe(e,o){return r.subscribe(e,o),a.default.Owner.getOwnershipState(t).matchManual(!0,(()=>r.unsubscribe(e,o))),this},subscribeCapture(e,o){return r.subscribeCapture(e,o),a.default.Owner.getOwnershipState(t).matchManual(!0,(()=>r.unsubscribe(e,o))),this},subscribePassive(e,o){return r.subscribePassive(e,o),a.default.Owner.getOwnershipState(t).matchManual(!0,(()=>r.unsubscribe(e,o))),this}}),e)};return r;function l(a,r,l){if(a[n])return console.error(`Can't register handler for event(s) ${o.default.resolve(r).join(", ")}, already used for other events`,a),e;const u=t=>{const o=t instanceof CustomEvent?t:void 0,n=o?.detail,r=a(Object.assign(t,{host:e,targetComponent:i(t.target)}),...n?.params??[]);n?.result.push(r)};Object.assign(a,{[n]:u});for(const e of o.default.resolve(r))t.element.addEventListener(e,u,l);return e}}})),define("ui/component/core/Link",["require","exports","navigation/RoutePath","ui/Component","ui/InputBus","ui/utility/MarkdownContent","utility/Env","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=a.default.Builder("a",((e,t)=>{t=l.default.get(t),e.and(n.HandlesMouseEvents).style("link");const o=(0,l.default)(!0),a=e.extend((e=>({canNavigate:o,setNavigationDisabled:(t=!0)=>(o.value=!t,e)})));return t.use(a,(e=>{a.attributes.set("href",e&&`${r.default.URL_ORIGIN}${e.slice(1)}`)})),a.event.subscribe("click",(e=>{t.value&&(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||0!==e.button||(e.preventDefault(),o.value&&(e.stopImmediatePropagation(),navigate.toURL(t.value),a.event.emit("Navigate"))))})),a}));i.default.handle(((e,t)=>{if("A"!==e.tagName)return;let a=e.getAttribute("href");return a?.startsWith(r.default.URL_ORIGIN)&&(a=a.slice(r.default.URL_ORIGIN.length-1)),o.RoutePath.is(a)?()=>{const t=u(a).text.set(e.textContent??"");e.replaceWith(t.element)}:void 0})),t.default=u})),define("ui/component/core/Paragraph",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const a=(o=__importDefault(o)).default.Builder((e=>e.style("paragraph")));t.default=a})),define("ui/component/core/Block",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/ext/CanHasActionsMenu","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Paragraph","ui/utility/TypeManipulator","utility/State"],(function(e,t,o,a,n,i,r,l,u,s){var d;Object.defineProperty(t,"__esModule",{value:!0}),t.BlockClasses=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),function(e){e.Main="_block",e.Header="_block-header"}(d||(t.BlockClasses=d={}));const c=o.default.Builder((e=>{let t,c,p;const f=(0,s.default)(null,!1),m=f.mapManual((e=>!!e?.length)),h=e.supers.mapManual((()=>e.is(r.default))),g=e.classes.add(d.Main).viewTransition("block").style("block").style.bind(h,"block--link").extend((a=>({title:void 0,header:void 0,description:void 0,primaryActions:void 0,content:(0,o.default)().style("block-content").appendTo(e),footer:void 0,type:(0,u.default)(a,(e=>{for(const o of e)a.style(`block--type-${o}`),t?.style(`block--type-${o}-header`),c?.style(`block--type-${o}-footer`)}),(e=>{for(const o of e)a.style.remove(`block--type-${o}`),t?.style.remove(`block--type-${o}-header`),c?.style.remove(`block--type-${o}-footer`)})),useGradient:e=>(p?.(),p=f.bind(a,s.default.get(e)),a)}))).tweak((e=>{const t=e.type.state.map(e,(e=>e.has("flush")));e.style.bindFrom(s.default.MapManual([h,e.type.state],((e,t)=>[...t].map((t=>`block${e?"--link":""}--type-${t}`))))),(0,o.default)().style("block-gradient").style.bind(t,"block-gradient--flush").style.bindVariable("block-gradient",f.map(e,(e=>e?.length?`${e.map((e=>`#${e.toString(16).padStart(6,"0")}`)).map((e=>`light-dark(\n\t\t\t\t\t\t\toklch(from ${e} max(var(--block-gradient-light-max), L) C H),\n\t\t\t\t\t\t\toklch(from ${e} min(var(--block-gradient-dark-min), L) C H)\n\t\t\t\t\t\t)`)).join(", ")}`:void 0))).prependToWhen(m,e)})).extendJIT("header",(e=>t=(0,o.default)("hgroup").style("block-header").style.bindFrom(e.type.state.mapManual((e=>[...e].map((e=>`block--type-${e}-header`))))).classes.add(d.Header).prependTo(e).and(n.default,(e=>e.subscribeReanchor(((e,t)=>{t||e.anchor.reset().anchor.add("off right","centre").anchor.add("off right","centre").anchor.orElseHide()})))).setActionsMenuButton((t=>t.style("block-actions-menu-button").appendTo(e.primaryActions))))).extendJIT("title",(e=>(0,i.default)().style("block-title").prependTo(e.header))).extendJIT("primaryActions",(e=>(0,o.default)().style("block-actions-primary").appendTo(e.header))).extendJIT("description",(e=>(0,l.default)().style("block-description").appendTo(e.header))).extendJIT("footer",(e=>c=(0,a.default)().style("block-footer").style.bindFrom(e.type.state.mapManual((e=>[...e].map((e=>`block--type-${e}-footer`))))).appendTo(e)));return g.and(n.default,(e=>e.subscribeReanchor(((e,t)=>{t||e.anchor.reset().anchor.add("off right","centre",`>> .${d.Header}`).anchor.add("off right","centre",`.${d.Main}`).anchor.orElseHide()})))).setActionsMenuButton((e=>e.style("block-actions-menu-button").appendTo(g.primaryActions)))}));t.default=c})),define("ui/view/shared/ext/ViewTitle",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=o.default.Tag()})),define("ui/component/core/Tabinator",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/utility/TypeManipulator","ui/view/shared/ext/ViewTitle","utility/Objects","utility/State"],(function(e,t,o,a,n,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),t.Tab=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),u=__importDefault(u),t.Tab=o.default.Builder(((e,t)=>{const a=(0,o.default)().style("tabinator-panel").ariaRole("tabpanel").setRandomId(),i=e.and(n.default).type("flush").style("tabinator-tab").ariaRole("tab").setRandomId().ariaControls(a).extend((e=>({content:a,tabinator:void 0,tabId:t,tweakContent:(t,...o)=>(a.tweak(t,e,...o),e),addTo:t=>(t.addTab(e),e),addToWhen:(t,o)=>(o.addTabWhen(t,e),e),createNextButton:()=>(0,n.default)().text.use("shared/action/next").event.subscribe("click",r),showNextTab:r})));return a.ariaLabelledBy(i).setOwner(i),i;function r(){const e=i.tabinator?.tabs.value.indexOf(i)??-1;if(-1===e)return;const t=i.tabinator.tabs.value[e+1];t&&i.tabinator.showTab(t)}})).setName("Tab");const s=o.default.Builder((e=>{const t=(0,u.default)(void 0);let n=!0;const s=(0,u.default)([]),d=()=>s.value.find((e=>!e.style.has("tabinator-tab--hidden"))),c=e.and(a.default).type("flush").style("tabinator").ariaRole("tablist").extend((e=>({tabType:i.default.Style(e,[[e,e=>`tabinator--type-${e}`],[e.header,e=>`tabinator--type-${e}-tab-list`],[s,e=>`tabinator--type-${e}-tab`]]),tab:t,tabs:s,allowNoneVisible:()=>(n=!1,e),showTab(o){if("string"==typeof o){const t=s.value.find((e=>e.tabId===o));if(!t)return e;o=t}return s.value.includes(o)&&!o.style.has("tabinator-tab--hidden")&&(t.value=o),e},showNone(){if(n)throw new Error("Cannot show none when `allowNoneVisible` is not set");return t.value=void 0,e},addTab(o){if(s.value.includes(o))return e;const a=t.map(o,(e=>e===o));return o.setOwner(e).attributes.bind(a,"aria-selected","true","false").style.bind(a,"tabinator-tab--active").event.subscribe("click",(()=>{t.value!==o||n?t.value=o:t.value=void 0})).appendTo(e.header),o.content.style("tabinator-panel--hidden").appendTo(e.content),(0,l.mutable)(o).tabinator=e,s.value.push(o),s.emit(),void 0===e.tab.value&&n&&(t.value=o),e},addTabWhen:(o,a)=>(e.addTab(a),a.style.bind(o.falsy,"tabinator-tab--hidden"),o.falsy.subscribe(a,(e=>{e&&t.value===a&&(t.value=n?d():void 0)})),e),removeTab:o=>s.value.includes(o)?((0,l.mutable)(o).tabinator=void 0,o.setOwner(void 0),o.remove(),s.value.filterInPlace((e=>e!==o)),s.emit(),t.value===o&&(t.value=n?d():void 0),e):e,bindURL:(t,o)=>(t&&e.showTab(t),e.tab.useManual((e=>navigate.setURL(o(e?.tabId,e)))),e),bindViewTitle(){return(0,o.default)().and(r.default).style("tabinator-view-title").tweak((e=>this.tab.use(e,(t=>e.text.bind(t?.text.state))))).appendTo(e.header),e}})));return c.header.style("tabinator-tab-list").style.bind(t.mapManual((e=>!e)),"tabinator-tab-list--no-tab-shown"),c.content.style("tabinator-content"),t.useManual(((e,t)=>{const o=s.value.indexOf(e)+1,a=s.value.indexOf(t)+1||o,n=Math.sign(o-a);t?.content.style("tabinator-panel--hidden").style.setVariable("page-direction",n),e?.content.style.remove("tabinator-panel--hidden").style.setVariable("page-direction",n)})),c}));t.default=s})),define("endpoint/changelog/EndpointChangelogAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/changelog/add","post")})),define("endpoint/changelog/EndpointChangelogDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/changelog/{id}/delete","post")})),define("endpoint/changelog/EndpointChangelogGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/changelog/get","get")})),define("endpoint/changelog/EndpointChangelogUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/changelog/{id}/update","post")})),define("endpoint/auth/EndpointAuthDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/delete","post").noResponse()})),define("endpoint/session/EndpointSessionGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/session","get")})),define("endpoint/session/EndpointSessionReset",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/session/reset","post").noResponse()})),define("utility/Store",["require","exports","utility/State"],(function(e,t,o){let a,n,i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);class r{static get items(){return a??=new Proxy({},{has:(e,t)=>r.has(t),get:(e,t)=>r.get(t),set:(e,t,o)=>r.set(t,o),deleteProperty:(e,t)=>r.delete(t)})}static get state(){const e=i??={};return n??=new Proxy({},{has:(e,t)=>r.has(t),get:(t,a)=>e[a]??=(0,o.default)(r.get(a))})}static get full(){const e={};for(const[t,o]of Object.entries(localStorage))e[t]=JSON.parse(o);return e}static has(e){return null!==localStorage.getItem(e)}static get(e){const t=localStorage.getItem(e);try{return null===t?null:JSON.parse(t)}catch{return localStorage.removeItem(e),null}}static set(e,t){void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t));const o=i?.[e];return o&&(o.value=t),!0}static delete(e){localStorage.removeItem(e);const t=i?.[e];return t&&(t.value=void 0),!0}}t.default=r,Object.assign(window,{Store:r})})),define("utility/Popup",["require","exports","ui/utility/StringApplicator","utility/State","utility/Store"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),n=__importDefault(n);t.default=function(e){return{...e,show(t,i){const r=i?.url??e.url;if(!r){console.error("Popup URL is not defined");return Object.assign(Promise.resolve(),{toastError:()=>Promise.resolve(!1)})}const l=i?.translation??e.translation,u=i?.width??e.width??600,s=i?.height??e.height??800,d=(window.innerWidth-u)/2+window.screenLeft,c=(window.innerHeight-s)/2+window.screenTop;let p=!1;const f=Object.assign(new Promise(((e,i)=>{delete n.default.items.popupError;const f="width="+u+",height="+s+",top="+c+",left="+d,m="string"==typeof l?o.quilt[l]():l?.(o.quilt,o.QuiltHelper),h=window.open(r,m?.toString(),f),g=a.default.Owner.getOwnershipState(t).matchManual(!0,(()=>h?.close())),v=setInterval((()=>{if(h?.closed){g(),clearInterval(v);const t=n.default.items.popupError;if(t){const e=Object.assign(new Error(t.message??"Internal Server Error"),{code:t.code});if(!p)return i(e);toast.handleError(e)}e(p?!t:void 0)}}),100)})),{toastError:()=>(p=!0,f)});return f}}}})),define("model/Session",["require","exports","endpoint/auth/EndpointAuthDelete","endpoint/session/EndpointSessionGet","endpoint/session/EndpointSessionReset","utility/Objects","utility/Popup","utility/State","utility/Store"],(function(e,t,o,a,n,i,r,l,u){var s;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),function(e){const t=(0,l.default)(void 0);e.state=t,e.has=t.mapManual((e=>!!e));const s=[];async function d(){const e=await a.default.query(),o=e.headers.get("State-Token");o&&(u.default.items.stateToken=o);const n=e?.data??void 0;if(u.default.items.session?.created!==n?.created)for(const e of s)"function"==typeof e?e():u.default.delete(e);u.default.items.session=n,t.value=n}let c;e.setClearedWithSessionChange=function(...e){s.push(...e)},e.init=function(){t.value=u.default.items.session,d()},e.refresh=d,e.reset=async function(e=!1){await n.default.query(),delete u.default.items.session,t.value=void 0,e||await d()},e.setAuthor=function(e){const o=u.default.items.session;if(!o)return void d();const a={...o,author:{...e,authorisations:void 0},authorisations:e.authorisations??o.authorisations};u.default.items.session=a,t.value=a},e.getStateToken=function(){return u.default.items.stateToken},function(t){t.state=e.state.mapManual((e=>e?.author?"logged-in":e?.partial_login?"partial-login":u.default.items.session?.authorisations?.length?"has-authorisations":"none")),t.loggedIn=t.state.mapManual((e=>"logged-in"===e)),t.authorisations=e.state.mapManual((e=>e?.author?.authorisations??e?.authorisations??[]),!1),t.account=e.state.mapManual((e=>e?.author),!1),t.author=t.account.mapManual((e=>e?i.default.strip({...e},"roles","settings","description","license","authorisations","patreon_campaign","patreon_patron","works","settings","roles","totp_state","auth_services_required","age"):void 0),i.default.deepEquals),t.partialLogin=e.state.mapManual((e=>e?.partial_login)),t.get=function(t){return _??e.Auth.account.value?.authorisations?.find((e=>e.service===t))??e.Auth.authorisations.value.find((e=>e.service===t))},t.loggedInAs=function(e,o){return o=l.default.get(o),l.default.Map(e,[t.author,o],((e,t)=>e?.vanity===t))},t.isAuthed=function(t){return e.Auth.account.value?.authorisations?.some((e=>e.service===t.name))||e.Auth.authorisations.value.some((e=>e.service===t.name))};const a={};t.privileged=new Proxy({},{get(t,o){const n=o;return a[n]??=e.Auth.account.mapManual((e=>e?.roles?.some((e=>e.privileges?.includes(n)))??!1))}});const n=Object.values({ModerationCensor:t.privileged.ModerationCensor,ModerationDelete:t.privileged.ModerationDelete,ModerationGrantSupporter:t.privileged.ModerationGrantSupporter,ModerationLock:t.privileged.ModerationLock,ModerationViewReport:t.privileged.ModerationViewReport,ModerationViewPatronOnly:t.privileged.ModerationViewPatronOnly});t.isModerator=l.default.Generator((()=>n.some((e=>e.value)))).observeManual(...n),t.unauth=async function(t){const a="string"==typeof t?t:t.id,n=await o.default.query({body:{id:a}});if(toast.handleError(n))return;const i=u.default.items.session,r=i?.author?.authorisations??i?.authorisations;r&&(r.filterInPlace((e=>e.id!==a)),!r.length&&i?.partial_login&&(i.authorisations=null,delete i?.partial_login),u.default.items.session=i,e.state.asMutable?.setValue(i))};const s=(0,r.default)({width:600,height:900});t.auth=async function(t,o){await s.show(t,{translation:e=>e["view/account/auth/popup/title"](o.name),url:o.url_begin}).toastError(),await e.refresh()},t.await=async function(e){return"logged-in"===t.state.value||new Promise((o=>{t.state.subscribe(e,(function e(a){if("logged-in"!==a)return;o(),t.state.unsubscribe(e)}))}))}}(c=e.Auth||(e.Auth={}))}(s||(s={})),Object.assign(window,{Session:s}),t.default=s})),define("ui/component/core/Flag",["require","exports","ui/Component","utility/Arrays"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=o.default.Builder((e=>{const t=a.default.range(5).map((e=>(0,o.default)().style("flag-stripe",`flag-stripe-${i[e]}`,`flag-stripe-${e+1}`)));let n=1/0;const r=new Set;function l(e,o){o?function(e){if(!r.size){n=1/0;for(const e of t)e.style.remove("flag-stripe--animate-end-0","flag-stripe--animate-end-1"),e.style("flag-stripe--animate")}r.add(e)}(e):function(e){r.delete(e)}(e)}e.hoveredOrFocused.subscribe(e,(e=>l("focus",e)));for(const e of t){const o=e===t[0];let a=0;e.event.subscribe("animationstart",(()=>a=0)),e.event.subscribe("animationiteration",(()=>{a++,o&&!r.size&&(n=a),a>=n&&(e.style.remove("flag-stripe--animate"),e.style("flag-stripe--animate-end-"+a%2))}))}return e.style("flag").append(...t).extend((e=>({wave:(t,o)=>(l(t,o),e)})))}));t.default=n;const i=["blue","pink","white","pink","blue"]})),define("ui/component/core/Placeholder",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const a=(o=__importDefault(o)).default.Builder((e=>e.style("placeholder").extend((e=>({})))));t.default=a})),define("ui/component/core/Loading",["require","exports","ui/Component","ui/component/core/Flag","ui/component/core/Placeholder","utility/State"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i);const r=o.default.Builder((e=>{const t=(0,i.default)(!0),r=(0,i.default)(void 0),l=(0,a.default)().style("loading-flag").style.bind(t.falsy,"loading-flag--hidden").wave("loading",!0);let u,s;return e.style("loading").append(l).appendWhen(r.truthy,(0,o.default)().style("loading-progress").append((0,o.default)().style("loading-progress-bar").tweak((e=>e.style.bindVariable("progress",r.map(e,(e=>e?.progress??0))))),(0,n.default)().style("loading-progress-message").tweak((e=>e.text.bind(r.map(e,(e=>e?.message??""))))))).extend((e=>({enabled:t,flag:l,use:o=>(u?.(),u=t.bind(e,o.settled.falsy),s?.(),s=r.bind(e,o.progress),e)})))}));t.default=r})),define("ui/component/core/Form",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/Loading","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=o.default.Builder(((e,t)=>{const u=e.replaceElement("form").style("form").ariaRole("form").ariaLabelledBy(t??void 0);u.receiveDescendantInsertEvents(),u.event.subscribe("submit",(e=>e.preventDefault()));const s=l.default.Generator((()=>u.element.checkValidity()));u.event.subscribe(["input","change","descendantInsert"],(()=>s.refresh()));const d=(u.is(n.default)?u.content:(0,o.default)()).style("form-content"),c=(u.is(n.default)?u.footer:(0,a.default)()).style("form-footer");let p;const f=(0,l.default)(!1);let m;return u.append(d,c).extend((()=>({content:d,footer:c,submit:void 0,refreshValidity(){return s.refresh(),this},onSubmit(e){return m=e,this}}))).extendJIT("submit",(()=>(0,i.default)().type("primary").attributes.set("type","submit").bindDisabled(s.not,"invalid").appendToWhen(f.falsy,p??=(0,o.default)().event.subscribe("click",(()=>{u.element.checkValidity()||u.element.reportValidity()})).appendWhen(f,(0,r.default)().tweak((e=>{e.style("form-submit-loading"),e.enabled.bind(e,f),e.flag.style("form-submit-loading-flag")}))).appendTo(c.right)).tweak((e=>e.style.bind(l.default.Every(u,p.hovered,e.disabled),"button--disabled--hover").style.bind(l.default.Every(u,p.active,e.disabled),"button--disabled--active"))))).event.subscribe("submit",(async e=>{e.preventDefault(),f.value=!0,await(m?.(e)),f.value=!1}))}));t.default=u})),define("ui/component/core/InfiniteScroll",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Loading","ui/component/core/Slot","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder((e=>{const t=e.style("infinite-scroll"),l=(0,r.default)(!1),u=(0,r.default)(!1);let s,d,c=0;return t.extend((e=>({ended:l,set:t=>(s=t,e.reset(),e),setFromEndpoint:(t,o)=>(e.set((async(e,a)=>{const n=await t.query(void 0,{page:c},a);if(a.aborted)return!1;if(n instanceof Error)throw n;const i=o(n.data,e,a);return"object"==typeof i?i.then((e=>(c++,e??n.has_more))):(c++,i??n.has_more)})),e),reset:()=>(e.removeContents(),d?.abort(),d=void 0,l.value=!1,c=0,p(),e)})));async function p(){if(!s||u.value||l.value)return;u.value=!0;const e=(0,i.default)().appendTo(t);let r,c=!0;for(;e.removeContents(),d=new AbortController,r=d.signal,c=s(e,r),"boolean"!=typeof c;){const t=(0,n.default)().style("infinite-scroll-loading").appendTo(e);try{if(c=await c,r.aborted)return;t.remove();break}catch(o){toast.handleError(o),t.remove();const n=(0,a.default)().text.use("shared/action/retry").appendTo(e);if(await new Promise((e=>n.event.subscribe("click",(()=>e())))),d.signal.aborted)return;continue}}if(l.value=!c,u.value=!1,l.value)return;const f=(0,o.default)().style.setProperties({height:"1px",width:"100%",marginTop:"-1px"}).appendTo(e),m=new IntersectionObserver((([e])=>{e.isIntersecting&&(m.disconnect(),f.remove(),r.aborted||p())}),{root:null,rootMargin:"200px 0px",threshold:.01});m.observe(f.element),f.onRemoveManual((()=>m.disconnect()))}}));t.default=l})),define("ui/component/core/LabelledRow",["require","exports","ui/Component","ui/component/core/Label"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0});const n=(o=__importDefault(o)).default.Builder((e=>{e.style("labelled-row");let t=(0,a.AutoLabel)().style("labelled-row-label").appendTo(e),n=(0,o.default)().style("labelled-row-content").appendTo(e);return e.extend((e=>({label:t,content:n}))).extendMagic("label",(e=>({get:()=>t,set:e=>{t!==e&&(o.default.removeContents(t.element),t.element.replaceWith(e.element),t=e)}}))).extendMagic("content",(e=>({get:()=>n,set:e=>{n!==e&&(o.default.removeContents(n.element),n.element.replaceWith(e.element),n=e)}})))}));t.default=n})),define("ui/component/core/LabelledTable",["require","exports","ui/Component","ui/component/core/LabelledRow","ui/component/core/Slot"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder((e=>{let t,o;return e.style("labelled-table"),e.extend((e=>({label:i=>{let r;return t=i,o??={if:e=>(r=e,o),content:o=>{const i=t;t=void 0;const l=r;if(r=void 0,l){const t=(0,n.default)().appendTo(e);l.match(e,!0,(()=>{u().appendToWhen(l,t)}))}else u().appendTo(e);return e;function u(){const e=(0,a.default)().style("labelled-row--in-labelled-table");return e.label=i(e.label,e),e.content=o(e.content,e.label,e)??e.content,e}}}}})))}));t.default=i})),define("ui/component/core/Small",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const a=(o=__importDefault(o)).default.Builder("small",(e=>e.style("small").extend((e=>({})))));t.default=a})),define("ui/Announcer",["require","exports","ui/Component"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){let t,a;function n(e,t,a){const n=[];a((e=>{n.push((0,o.default)("p").attributes.set("data-id",t).text.use(e))}));const i=function(e,t){return[...e.element.querySelectorAll(`[data-id="${t}"]`)]}(e,t);if(i.length){const e=i.map((e=>e.textContent)).join("\n");if(n.map((e=>e.element.textContent)).join("\n")===e)return;for(const e of i)e.remove()}for(const t of n)t.appendTo(e)}e.interrupt=function(e,a){n(t??=(0,o.default)().attributes.set("aria-live","assertive").style.setProperty("opacity","0").style.setProperty("user-select","none").style.setProperty("pointer-events","none").style.setProperty("position","fixed").appendTo(document.body),e,a)},e.announce=function(e,t){n(a??=(0,o.default)().attributes.set("aria-live","polite").style.setProperty("opacity","0").style.setProperty("user-select","none").style.setProperty("pointer-events","none").style.setProperty("position","fixed").appendTo(document.body),e,t)}}(a||(a={})),t.default=a})),define("ui/component/core/ProgressWheel",["require","exports","ui/Component","ui/component/core/Slot","utility/State"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder((e=>e.style("progress-wheel").extend((e=>({set(t){e.removeContents(),(0,o.default)().style("progress-wheel-icon").tweak(t.initialiseIcon).appendTo(e);return(0,o.default)().style("progress-wheel-label").tweak(t.initialiseLabel).appendTo(e).text.bind(t.label),e.style.bindVariable("progress",t.progress),e}}))))),r=Object.assign(i,{Length(e,t){const o=n.default.MapManual([e,t],((e,t)=>void 0!==e&&t?1-e/t:void 0)),r=n.default.MapManual([e,t],((e,t)=>void 0!==e&&t?t-e:void 0));return a.default.using(n.default.UseManual({unusedPercent:o,unusedChars:r}),((e,{unusedPercent:t,unusedChars:o})=>void 0===t||void 0===o?void 0:i().set({progress:t,label:e=>e["shared/form/progress-wheel/remaining/label"](o),initialiseIcon:e=>e.style.bind(t<0,"progress-wheel-icon--overflowing")})))},Progress:e=>i().set({progress:e,label:e.mapManual((e=>t=>t["shared/form/progress-wheel/progress/label"](100*(e??0))))})});t.default=r})),define("ui/utility/AnchorManipulator",["require","exports","ui/utility/Mouse","ui/utility/Viewport","utility/State","utility/Time"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AllowXOffscreen=t.AllowYOffscreen=t.ANCHOR_LOCATION_ALIGNMENTS=t.ANCHOR_SIDE_VERTICAL=t.ANCHOR_SIDE_HORIZONTAL=t.ANCHOR_TYPES=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),t.ANCHOR_TYPES=["off","aligned"],t.ANCHOR_SIDE_HORIZONTAL=["left","right"],t.ANCHOR_SIDE_VERTICAL=["top","bottom"];const r=new Set(t.ANCHOR_TYPES.flatMap((e=>[t.ANCHOR_SIDE_HORIZONTAL,t.ANCHOR_SIDE_VERTICAL].flatMap((t=>t.map((t=>`${e} ${t}`)))))).flatMap((e=>[e,`sticky ${e}`])));function l(e){const t=e.startsWith("sticky");t&&(e=e.slice(7));const o=e;if("centre"===o)return{sticky:t,type:"centre",side:"centre",offset:0};const[a,n,i]=o.split(" ");return{sticky:t,type:a,side:n,offset:i?+i:0}}r.add("centre"),r.add("sticky centre"),t.ANCHOR_LOCATION_ALIGNMENTS=["left","centre","right"],t.AllowYOffscreen={allowYOffscreen:!0},t.AllowXOffscreen={allowXOffscreen:!0},t.default=function(e){let t,u;const s=(0,n.default)(void 0);let d,c,p,f=0;const m=[],h=e=>e&&m.push(e);let g,v=0,y=!1;const b={state:s,isMouse:()=>!t?.length,from:t=>(g?.(),c=t,g=c?.removed.useManual((e=>{e&&(c=void 0,g?.(),g=void 0)})),e),reset:()=>(t=void 0,b.markDirty(),e),add:(...o)=>{const a="string"==typeof o[o.length-1]?void 0:o.pop();let[n,i,u,s]=o;return function(e){if(r.has(e))return!0;if("string"!=typeof e)return!1;const t=e.lastIndexOf(" ");if(-1===t)return!1;const o=e.slice(0,t);if(!r.has(o))return!1;const a=e.slice(t+1);return!isNaN(+a)}(i)&&(s=u,u=i,i="*"),s??="*",t??=[],t.push({xAnchor:l(n),xRefSelector:i,yAnchor:l(u),yRefSelector:s,options:a}),b.markDirty(),e},orElseHide:()=>(t?.push(!1),e),markDirty:()=>{const t=e?.rect.value;if(!t.width||!t.height)return e;if(s.value=void 0,f){const e=Date.now()-f;e>i.default.frame?b.apply():void 0===p&&(p=window.setTimeout(b.apply,i.default.frame-e))}return e},get:()=>{if(s.value)return s.value;for(const e of m)e();m.length=0;const n=e?.rect.value;if(!n.width||!n.height)return s.value=void 0,{x:0,y:0,mouse:!1};if(n&&t&&c)for(const o of t){if(!o)return s.value??={mouse:!1,x:-1e4,y:-1e4,padX:!1};let t="left";const i=o.xAnchor,r=_(o.xRefSelector);if("*"!==o.xRefSelector&&!r)continue;const l=r?.rect.value;h(r?.rect.subscribe(e,b.markDirty));const u=(l?.left??0)+(l?.width??a.default.size.value.w)/2,d=("right"===i.side?l?.right:"left"===i.side?l?.left:u)??u;let c;switch(i.type){case"aligned":c="right"===i.side?d-n.width-i.offset:d+i.offset,t=i.side;break;case"off":c="right"===i.side?d+i.offset:d-n.width-i.offset,t="left"===i.side?"right":"left";break;case"centre":c=d-n.width/2,t="centre"}if(!1===o.options?.xValid?.(c,l,n))continue;if(!i.sticky&&n.width<a.default.size.value.w&&!o.options?.allowXOffscreen){if(c<0||c+n.width>a.default.size.value.w)continue}const p=o.yAnchor,f=_(o.yRefSelector);if("*"!==o.yRefSelector&&!f)continue;const m=f?.rect.value;h(f?.rect.subscribe(e,b.markDirty));const g=(m?.top??0)+(m?.height??a.default.size.value.h)/2,v=("bottom"===p.side?m?.bottom:"top"===p.side?m?.top:g)??g;let y;switch(p.type){case"aligned":y="bottom"===p.side?v-n.height-p.offset:v+p.offset;break;case"off":y="bottom"===p.side?v+p.offset:v-n.height-p.offset;break;case"centre":y=v-n.height/2}if(!1!==o.options?.yValid?.(y,m,n)){if(!p.sticky&&n.height<a.default.size.value.h&&!o.options?.allowYOffscreen){if(y<0||y+n.height>a.default.size.value.h)continue}return s.value??={mouse:!1,padX:"off"===i.type,alignment:t,x:c,y:y,yRefBox:m,xRefBox:l,preference:o}}}return s.value??={mouse:!0,padX:!0,...o.default.state.value}},apply:()=>{const t=b.get();let o=t.alignment??d;if(t.mouse){("centre"===d||("right"===d?t.x<a.default.size.value.w/2-200:t.x>a.default.size.value.w/2+200))&&(o="left"===d?"right":"left")}if(d!==o&&(d=o),e.element.style.left=`${t.x}px`,e.element.style.top=`${t.y}px`,e.rect.markDirty(),!t.mouse&&!y){const t=++v;e.style.setProperty("display","none"),e.style.setProperty("transition-duration","0s"),new Promise((e=>setTimeout(e,50))).then((()=>{v===t&&(e.style.removeProperties("display","transition-duration"),y=!0)}))}return p=void 0,f=Date.now(),e}};return b;function _(e){const t=u?.[e];let o;if(t)o=t.deref();else if(o=e.startsWith(">>")?c?.element.querySelector(e.slice(2))?.component:c?.element.closest(e)?.component,o){if("contents"===getComputedStyle(o.element).display){const e=o.element.children;e.length?(o=e[0].component??o,e.length>1&&console.warn("Anchor ref has display: contents and multiple children")):console.warn("Anchor ref has display: contents and no children")}u??={},u[e]=new WeakRef(o)}return o}}})),define("ui/component/core/ext/Input",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Popover","ui/component/core/ProgressWheel","ui/component/core/Slot","ui/utility/AnchorManipulator","ui/utility/StringApplicator","ui/utility/Viewport","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d){function c(e){return(0,o.default)().style("input-popover-hint-text").text.bind(e)}Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),u=__importStar(u),s=__importDefault(s),d=__importDefault(d);const p=Object.assign(o.default.Extension((e=>{const t=(0,d.default)(void 0),o=(0,d.default)(void 0),p=(0,d.default)(void 0),f=(0,d.default)(""),m=(0,d.default)(!1),h=d.default.MapManual([t,o,m],((e,t,o)=>o||!!e||!!t));let g;h.subscribeManual((u=>{if(!u)return g?.remove(),void(g=void 0);e.removed.value||(g=(0,n.default)().setNormalStacking().style("input-popover").setOwner(e).tweak((e=>{m.value||(r.default.using(t,((e,t)=>t?c(t):void 0)).appendTo(e),i.default.Length(p,o).appendTo(e))})).tweak(w,e).appendTo(document.body),s.default.tablet.use(g,(t=>{const o=t();g?.type.toggle(!o,"flush"),o?g?.anchor.reset().anchor.from(e).anchor.add("aligned left","aligned top").anchor.add("aligned left","aligned bottom").setCloseOnInput(!0):g?.anchor.reset().anchor.from(e).anchor.add("off right",`.${a.BlockClasses.Main}`,"aligned top",{...l.AllowYOffscreen,yValid:(e,t,o)=>o.height>(t?.height??0)}).anchor.add("off right",`.${a.BlockClasses.Main}`,"centre",l.AllowYOffscreen).setCloseOnInput(!1)})))}));let v=!1;e.hasFocused.subscribeManual((e=>{v||s.default.tablet.value||g?.toggle(e).anchor.apply()}));const y=(0,d.default)(void 0);let b,w;y.subscribe(e,(t=>{const o="function"==typeof t?t(u.quilt,u.QuiltHelper)?.toString():t,a=b?.element??e.element;a.setCustomValidity?.(o??"")})),e.event.subscribe(["input","change"],T);const k=e.extend((e=>({required:(0,d.default)(!1),hint:(0,u.default)(e,(e=>t.value=e)),maxLength:o,length:p,invalid:f,hasPopover:h,disableDefaultHintPopoverVisibilityHandling:()=>(v=!0,e),getPopover:()=>g,setMaxLength:t=>(d.default.is(t)?o.bind(e,t):o.value=t,e),setRequired:(t=!0)=>(e.attributes.toggle(t,"required"),e.required.asMutable?.setValue(t),e),setLabel:t=>(e.setName(t?.for),e.setId(t?.for),t?.setInput(e),e),tweakPopover:t=>(w=t,e),setCustomHintPopover:t=>(w=t,m.value=!0,e),pipeValidity:t=>(b=t,e),setCustomInvalidMessage:t=>(y.value=t,T(),e),refreshValidity:T})));return k;function T(){return f.value=_??y.value?.toString()??e.element.validationMessage??"",k}})),{createHintText:c});t.default=p})),define("ui/component/core/Checkbutton",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/ext/Input","utility/State"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i);const r=Symbol("CheckButton"),l=o.default.Builder("label",(e=>{const t=(0,o.default)("input").style("checkbutton-input").attributes.set("type","checkbox").setRandomId(),l=t.element,u=(0,i.default)(!1);let s;const d=e.and(a.default).and(n.default).style("checkbutton").tabIndex("auto").ariaChecked(u).ariaRole("checkbox").setIcon("check").attributes.bind("for",t.id).tweak((e=>e.icon?.style("checkbutton-icon").style.bind(u,"checkbutton-icon--checked"))).append(t).extend((()=>({[r]:!0,input:t,checked:u,isChecked:()=>l.checked,setChecked:e=>e===l.checked?d:s?(d.event.emit("TrySetChecked",e),d):(l.checked=e,c(),d),use:e=>(s?.(),s=e.use(d,(e=>{l.checked!==e&&(l.checked=e,c())})),d),unuse:()=>(s?.(),s=void 0,d)})));function c(){u.value=l.checked,d.style.toggle(l.checked,"checkbutton--checked"),d.event.emit("SetChecked",l.checked)}return d.pipeValidity(t),t.event.subscribe("change",(()=>{if(s){const e=l.checked;return l.checked=!e,void d.event.emit("TrySetChecked",e)}c()})),d}));t.default=l})),define("ui/component/core/RadioButton",["require","exports","ui/Component","ui/component/core/Checkbutton"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=Symbol("RadioButton"),i=o.default.Builder((()=>{const e=(0,a.default)();return e.ariaRole("radio"),e.input.attributes.set("type","radio"),e.extend((e=>({[n]:!0})))}));t.default=i})),define("ui/component/core/text-editor/TextEditorMSWordHandler",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isPasteHTML=function(e){return e.slice(0,300).includes('xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"')},e.fixPasteHTML=function(e){return e.replaceAll(/\bname(?=="_ftn)/g,"id")}}(o||(o={})),t.default=o})),define("ui/view/shared/ext/ViewTransition",["require","exports","ui/Component","utility/Arrays"],(function(e,t,o,a){function n(e){return e?.replace(/[^a-z0-9-]+/g,"-").toLowerCase()}var i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){const t="data-view-transition-name",i="data-subview-transition-name",r="data-view-transition-id",l="view-transition",u="subview-transition",s="view-transition-delay",d=100;o.default.extend((e=>e.extend((e=>({viewTransition:o=>(o?(o=o.replace(/[^a-z0-9-]+/g,"-").toLowerCase(),e.attributes.set(t,o),e.attributes.compute(r,(()=>""+p++))):(e.attributes.remove(t),e.attributes.remove(r)),e),subviewTransition:t=>(t?(t=n(t),e.attributes.set(i,t),e.attributes.compute(r,(()=>""+p++))):(e.attributes.remove(i),e.attributes.remove(r)),e)})))));let c,p=0,f=0;function m(e,o){const a=v(e,o).filter(g);let n=0;if("view"===e)for(const e of a){e.classes.add(l);const o=e.attributes.get(t).value;e.style.setVariable("view-transition-delay",`${s}-${n}`),e.style.setProperty("view-transition-name",`${l}-${o}-${n++}`)}else for(const e of a){e.classes.add(u);const t=e.attributes.get(i).value,o=+e.attributes.get(r).value||0;e.style.setProperty("view-transition-name",`${u}-${t}-${o}`),e.style.setVariable("view-transition-delay",`${s}-${n++}`)}}function h(e){for(const e of[...v("view"),...v("subview")])e.classes.remove(l),e.classes.remove(u),e.style.removeProperties("view-transition-name"),e.style.removeVariables("view-transition-delay")}function g(e){const t=e.element.getBoundingClientRect();return t.bottom>-100&&t.top<window.innerHeight+d&&t.right>-100&&t.left<window.innerWidth+d}function v(e,o){return[...document.querySelectorAll(`[${"view"===e?t:i}${o?`="${o}"`:""}]`)].map((e=>e.component)).filter(a.NonNullish)}e.perform=function(e,t,o){async function a(){await o(),m(e,t)}c=void 0,"function"==typeof t&&(o=t,t=void 0),t=n(t),m(e,t);const i=document.startViewTransition(a),r=c=f++;return i.finished.catch((async e=>{String(e).includes("AbortError")?await a():console.error("Error during view transition:",e)})).finally((()=>{c===r&&h(e)})),{finished:i.finished.catch((()=>{})),ready:i.ready.catch((()=>{})),updateCallbackDone:i.updateCallbackDone.catch((()=>{})),skipTransition:()=>i.skipTransition()}},e.reapply=m,e.unapply=h}(i||(i={})),t.default=i})),define("ui/component/core/TextEditor",["require","exports","lang/en-nz","model/Session","prosemirror-commands","prosemirror-dropcursor","prosemirror-example-setup","prosemirror-gapcursor","prosemirror-history","prosemirror-inputrules","prosemirror-keymap","prosemirror-markdown","prosemirror-model","prosemirror-schema-list","prosemirror-state","prosemirror-transform","prosemirror-view","ui/Announcer","ui/Component","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/Dialog","ui/component/core/ext/Input","ui/component/core/Popover","ui/component/core/RadioButton","ui/component/core/Slot","ui/component/core/text-editor/TextEditorMSWordHandler","ui/InputBus","ui/utility/MarkdownContent","ui/utility/StringApplicator","ui/utility/Viewport","ui/view/shared/ext/ViewTransition","utility/Arrays","utility/Define","utility/Env","utility/Objects","utility/State","utility/Store","utility/string/Markdown","utility/Time","w3c-keyname"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T,x,D,O,S,E,M,I,C,R,P,A,j,N,$,B,L,q){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),O=__importDefault(O),E=__importDefault(E),M=__importDefault(M),I=__importDefault(I),C=__importDefault(C),R=__importDefault(R),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N),$=__importDefault($),B=__importDefault(B),L=__importDefault(L);const G=(q=__importDefault(q)).default.keyName;q.default.keyName=e=>{const t=e;if(t.code.startsWith("Numpad")&&!t.shiftKey&&(t.ctrlKey||t.altKey)){Object.defineProperty(e,"shiftKey",{value:!0});const o=t.code.slice(6);if("Decimal"===o)return".";if(!isNaN(+o))return o}return G(e)},(0,P.default)(p.ResolvedPos.prototype,"closest",(function(e,t,o){"number"==typeof t&&(o=t,t=void 0);const a=t;o??=this.depth;for(let t=o;t>=0;t--){const o=this.node(t);if(o.type===e&&(!a||o.hasAttrs(a)))return o}})),(0,P.default)(p.Node.prototype,"matches",(function(e,t){return(void 0===e||this.type===e)&&(void 0===t||this.hasAttrs(t))})),(0,P.default)(p.Node.prototype,"hasAttrs",(function(e){for(const[t,o]of Object.entries(e))if(this.attrs[t]!==o)return!1;return!0})),(0,P.default)(p.Node.prototype,"pos",(function(e){if(e===this)return 0;let t;return e.descendants(((e,o)=>void 0===t&&(e===this?(t=o,!1):void 0))),t})),(0,P.default)(p.Node.prototype,"parent",(function(e){if(e===this)return;const t=this;return function e(o){let a;return o.forEach((n=>{a??=(n===t?o:void 0)??e(n)})),a}(e)})),(0,P.default)(p.Node.prototype,"depth",(function(e){if(e===this)return 0;const t=this;return function e(o,a){let n;return o.forEach((o=>{n??=(o===t?a:void 0)??e(o,a+1)})),n}(e,1)})),(0,P.default)(p.Fragment.prototype,"pos",(function(e){let t;return e.descendants(((e,o)=>void 0===t&&(e.content===this?(t=o+1,!1):void 0))),t})),(0,P.default)(p.Fragment.prototype,"range",(function(e){const t=this.pos(e);if(!t)return;const o=e.resolve(t),a=e.resolve(t+this.size);return new p.NodeRange(o,a,Math.min(o.depth,a.depth))})),(0,P.default)(p.Fragment.prototype,"parent",(function(e){if(e.content===this)return e;let t;return e.descendants(((e,o)=>void 0===t&&(e.content===this?(t=e,!1):void 0))),t})),(0,P.default)(h.Transform.prototype,"stripNodeType",(function(e,t){const o=this;let a=e instanceof p.Fragment?e.range(o.doc):e;if(!a)return this;for(;n(););return this;function n(){let e=!1;return a.parent.forEach(((o,n,r)=>{if(!e&&r>=a.startIndex&&r<a.endIndex){if(o.type===t)return i(o),void(e=!0);if(function(e){let o=!1;return e.descendants(((e,a)=>{if(!o)return e.type===t?(i(e),void(o=!0)):void 0})),o}(o))return void(e=!0)}})),e}function i(e){const t=e.pos(o.doc);if(void 0===t)throw new Error("Unable to continue stripping, no pos");const n=e.content.range(o.doc);if(!n)throw new Error("Unable to continue stripping, unable to resolve node range");const i=(0,h.liftTarget)(n);if(null!==i&&o.lift(n,i),a){let n=a.$from.pos;n=n<=t?n:n-1;let i=a.$to.pos;i=i<t+e.nodeSize?i-1:i-2;const r=o.doc.resolve(n).blockRange(o.doc.resolve(i));if(!r)throw new Error("Unable to continue stripping, unable to resolve new range");a=r}}})),a.default.setClearedWithSessionChange("textEditorDrafts"),q.default.keyName;const W=new p.Schema({nodes:j.default.filterNullish({...c.schema.spec.nodes.toObject(),image:void 0,heading:{...c.schema.spec.nodes.get("heading"),content:"text*",toDOM(e){const t=(0,y.default)(`h${e.attrs.level}`);return t.style("markdown-heading",`markdown-heading-${e.attrs.level}`),{dom:t.element,contentDOM:t.element}}},text_align:{attrs:{align:{default:"left",validate:e=>"left"===e||"center"===e||"right"===e}},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"center",getAttrs:()=>({align:"center"}),consuming:!1},{tag:"*",getAttrs:e=>{const t=e.style.getPropertyValue("text-align");return!!t&&{align:"justify"===t||"start"===t?"left":"end"===t?"right":t}},consuming:!1,priority:51}],toDOM:e=>["div",j.default.filterNullish({class:"left"===e.attrs.align?"align-left":void 0,style:`text-align:${e.attrs.align}`}),0]},id_block:{attrs:{id:{validate:e=>"string"==typeof e&&e.length>0&&!e.startsWith("docs-internal-guid")}},content:"block+",group:"block",defining:!0,parseDOM:[{tag:"*",getAttrs:e=>{const t=e.getAttribute("id");return!(!t?.length||t.startsWith("docs-internal-guid"))&&{id:t}},consuming:!1,priority:51}],toDOM:e=>["div",{id:e.attrs.id},0]}}),marks:{...c.schema.spec.marks.toObject(),underline:{parseDOM:[{tag:"u"},{style:"text-decoration=underline",clearMark:e=>"underline"===e.type.name}],toDOM:()=>["u"]},strikethrough:{parseDOM:[{tag:"s"},{style:"text-decoration=line-through",clearMark:e=>"strikethrough"===e.type.name}],toDOM(){const e=document.createElement("span");return e.style.setProperty("text-decoration","line-through"),e}},subscript:{parseDOM:[{tag:"sub"}],toDOM:()=>["sub"]},superscript:{parseDOM:[{tag:"sup"}],toDOM:()=>["sup"]},mention:{attrs:{vanity:{validate:e=>"string"==typeof e&&e.length>0}},parseDOM:[{tag:"a",getAttrs:e=>{const t=e.getAttribute("vanity");return!!t&&{vanity:t}},priority:51}],toDOM(e){const t=document.createElement("a");return t.setAttribute("vanity",e.attrs.vanity),t.href=`${A.default.URL_ORIGIN}author/${e.attrs.vanity}`,t.textContent=`@${e.attrs.vanity}`,t}},id_mark:{attrs:{id:{validate:e=>"string"==typeof e&&e.length>0&&!e.startsWith("docs-internal-guid")}},parseDOM:[{tag:"*",getAttrs:e=>{const t=e.getAttribute("id");return!(!t?.length||t.startsWith("docs-internal-guid"))&&{id:t}},consuming:!1,priority:51}],toDOM:e=>{const t=document.createElement("span");return t.id=e.attrs.id,t}}}}),U=(0,B.default)(),F=(new RegExp("([a-zA-Z_:][a-zA-Z0-9:._-]*)(?:\\s*=\\s*((?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\")))(?= |$)","g"),{text_align:{getAttrs:e=>{const t=e.style?.get("text-align");if(["left","center","right"].includes(t))return{align:t}}},id_block:{getAttrs:e=>{const t=e.attrGet("id");if(t?.length)return{id:t}}}}),V={subscript:{getAttrs:e=>"sub"===e.tag||void 0},superscript:{getAttrs:e=>"sup"===e.tag||void 0},mention:{getAttrs:e=>{const t=e.attrGet("vanity");if(t)return{vanity:t}},getChildren:e=>{const t=e.attrGet("vanity");if(!t)return[];const o=new(0,e.constructor);return o.content=`@${t}`,o.type="text",[o]}},id_mark:{getAttrs:e=>{const t=e.attrGet("id");if(t?.length)return{id:t}}},link:{getAttrs:e=>{if("a"!==e.tag)return;const t=e.attrGet("href");return t?{href:t}:void 0}}},H=U.parse;U.parse=(e,t)=>{const o=H.call(U,e,t);for(const e of o)"inline"===e.type&&e.children&&(e.children=n(a(e.children)));return a(o).flatMap((e=>{if("softbreak"===e.type){const t=e.constructor;return[Object.assign(new t,{nesting:1,tag:"p",type:"paragraph_open",block:!0,hidden:!1,level:0}),Object.assign(new t,{nesting:-1,tag:"p",type:"paragraph_close",block:!0,hidden:!1,level:0})]}return e}));function a(e){if(!e.length)return e;const t=[];let o=0;const n=e[0].constructor;for(let i of e){const e="html_inline"===i.type||"html_block"===i.type;if(e||"html_block_open"===i.type||"html_block_close"===i.type||"html_inline_open"===i.type||"html_inline_close"===i.type)if(!e&&i.nesting<0){const e=t.findLast((e=>e.level===o));if(!e){console.warn("Invalid HTML in markdown:",i.raw);continue}i.type=`${e.type.slice(0,-5)}_close`,t.push(i),o=i.level+i.nesting}else{for(const[e,t]of Object.entries(F)){const o=t.getAttrs(i);if(o){i.type=e,!0!==o&&(i.nodeAttrs=o);const a=t.getChildren?.(i);a&&(i.children=a);break}}for(const[e,t]of Object.entries(V)){const o=t.getAttrs(i);if(o){const r=i;"html_block"===i.type&&(i=new n,i.type="inline",i.level=1,i.nesting=0,i.tag="",i.block=!0,i.children=[r]),r.type=e,!0!==o&&(r.nodeAttrs=o);const l=t.getChildren?.(r);l&&(r.children=l),"inline"===i.type&&(i.children=a(i.children));break}}if(e||(i.type=i.type.endsWith("_open")?i.type:`${i.type}_open`,o=i.level),"inline"!==i.type)t.push(i);else{const e=new n;e.type="paragraph_open",e.nesting=1;const o=new n;o.type="paragraph_close",o.nesting=-1,t.push(e,i,o)}}else t.push(i)}return t.flatMap((e=>{const t=e.children;if(!t?.length||"inline"===e.type)return e;const o=new n;return o.type=`${e.type}_close`,e.type=`${e.type}_open`,e.children=null,[e,...t,o]}))}function n(e){for(const t of e)t.type.startsWith("html_inline")&&(t.type="text",t.content=t.raw??"");return e}};const Y=new c.MarkdownParser(W,U,j.default.filterNullish({...c.defaultMarkdownParser.tokens,image:void 0,u:{mark:"underline"},s:{mark:"strikethrough"},...Object.entries(F).toObject((([e,t])=>[e,{block:e,getAttrs:e=>e.nodeAttrs??Object.fromEntries(e.attrs??[])}])),...Object.entries(V).toObject((([e,t])=>[e,{mark:e,getAttrs:e=>e.nodeAttrs??Object.fromEntries(e.attrs??[])}]))})),z=new c.MarkdownSerializer({...c.defaultMarkdownSerializer.nodes,text_align:(e,t,o,a)=>{e.write(`<div style="text-align:${t.attrs.align}">\n`),e.renderContent(t),e.write("</div>"),e.closeBlock(t)},id_block:(e,t,o,a)=>{e.write(`<div id="${t.attrs.id}">\n`),e.renderContent(t),e.write("</div>"),e.closeBlock(t)},paragraph:(e,t,o,a)=>{0===t.content.size?e.write("<br>\n"):e.renderInline(t),e.closeBlock(t)}},{...c.defaultMarkdownSerializer.marks,strikethrough:{open:"~~",close:"~~",expelEnclosingWhitespace:!0},underline:{open:"__",close:"__",expelEnclosingWhitespace:!0},mention:{open:(e,t,o,a)=>`<mention vanity="${t.attrs.vanity}">`,close:(e,t,o,a)=>{const n=e,i=`<mention vanity="${t.attrs.vanity}">`,r=n.out.lastIndexOf(i);return-1===r||(n.out=n.out.slice(0,r+i.length)),""}},id_mark:{open:(e,t,o,a)=>`<span id="${t.attrs.id}">`,close:"</span>",expelEnclosingWhitespace:!0},subscript:{open:"<sub>",close:"</sub>",expelEnclosingWhitespace:!0},superscript:{open:"<sup>",close:"</sup>",expelEnclosingWhitespace:!0}});const J=["paragraph","code_block"];let K=0;const Q=Object.assign(y.default.Builder((e=>{const t=K++,a=(0,N.default)(!1),c=(0,N.default)(""),p=(0,N.default)(!1),P=(0,N.default)(!1),A=(0,N.default)(!1),j=N.default.MapManual([A,c],((e,t)=>e&&!t.trim()));let B;const q=(0,N.default)(void 0);q.subscribe(e,(()=>{if(!B.mirror?.hasFocus()||!B.mirror.state.selection.empty)return;const e=B.mirror.state.selection.from+1,t=B.mirror.state.doc.resolve(e>B.mirror.state.doc.content.size?e-1:e);v.default.interrupt("text-editor/format/inline",(e=>{const o=Object.keys(W.marks);let a=!1;for(const n of o)"id_mark"!==n&&Ae(W.marks[n],t)&&(a=!0,e(`text-editor/formatting/${n}`));a||e("text-editor/formatting/none")}))}));const G=y.default.Extension(((e,t)=>{const o=W.marks[t];return e.ariaLabel.use(`text-editor/toolbar/button/${t}`).extend((()=>({mark:o})))})),U=y.default.Extension(((e,t)=>{const o=W.nodes[t.replaceAll("-","_")];return e.ariaLabel.use(`text-editor/toolbar/button/${t}`).extend((()=>({node:o})))})),F=y.default.Extension(((e,t)=>e.ariaLabel.use(`text-editor/toolbar/button/${t}`))),V=y.default.Builder((e=>e.ariaRole("group").style("text-editor-toolbar-button-group"))),H=y.default.Builder(((e,t)=>(0,b.default)().style("text-editor-toolbar-button").clearPopover().receiveFocusedClickEvents().event.subscribe("click",(e=>{e.preventDefault(),t(e.host)})))),X=y.default.Builder(((e,t,o)=>(0,_.default)().style("text-editor-toolbar-button").style.bind(t,"text-editor-toolbar-button--enabled").tweak((e=>e.icon?.style.remove("checkbutton-icon"))).use(t).clearPopover().receiveFocusedClickEvents().event.subscribe("click",(e=>{e.preventDefault(),o(e.host)})))),Z=y.default.Builder(((e,t,o,a)=>(0,x.default)().style("text-editor-toolbar-button").setName(t).style.bind(o,"text-editor-toolbar-button--enabled").tweak((e=>e.icon?.style.remove("checkbutton-icon"))).use(o).clearPopover().receiveFocusedClickEvents().event.subscribe("click",(e=>{e.preventDefault(),a(e.host)})))),ee=y.default.Builder(((e,t)=>(0,b.default)().style("text-editor-toolbar-button","text-editor-toolbar-button--has-popover").clearPopover().setPopover("hover/click",((e,o)=>{e.style("text-editor-toolbar-popover").style.bind(e.popoverParent.nonNullish,"text-editor-toolbar-popover-sub",`text-editor-toolbar-popover-sub--${t}`).anchor.add("centre"===t?t:`aligned ${t}`,"off bottom").style.toggle("left"===t,"text-editor-toolbar-popover--left").style.toggle("right"===t,"text-editor-toolbar-popover--right").setMousePadding(20),o.style.bind(e.visible,"text-editor-toolbar-button--has-popover-visible")})).receiveInsertEvents().receiveAncestorInsertEvents().event.subscribe(["insert","ancestorInsert"],(e=>e.host.style.toggle(!!e.host.closest(T.default),"text-editor-toolbar-button--has-popover--within-popover"))))),te=y.default.Builder(((t,o)=>{const a=W.marks[o],n=se(a),i=q.map(e,(e=>Ae(a)));return X(i,n).and(G,o)})),oe=y.default.Builder(((o,a)=>{const n=de(W.nodes.text_align,{align:"centre"===a?"center":a}),i=q.map(e,(e=>$e(a)));return Z(`text-editor-${t}-text-align`,i,n).and(F,`align-${a}`)})),ae=y.default.Builder(((o,a)=>{const n=W.nodes[a.replaceAll("-","_")],i=pe(n),r=q.map(e,(e=>je(n)));return Z(`text-editor-${t}-block-type`,r,i).and(U,a)})),ne=y.default.Builder(((o,a)=>{const n=W.nodes.heading,i=pe(n,{level:a}),r=q.map(e,(e=>je(n,{level:a})));return Z(`text-editor-${t}-block-type`,r,i).setIcon(`${a}`)})),ie=y.default.Builder(((e,t)=>H(de(W.nodes[t.replaceAll("-","_")])).and(U,t))),re=y.default.Builder(((e,t)=>H(fe(W.nodes[t.replaceAll("-","_")])).and(U,t)));let le=!1;function ue(e){return t=>{q.value&&(le=!0,e(q.value,B.mirror?.dispatch,B.mirror),le=!1,t.hasFocused.value||B.document?.focus())}}function se(e){return ue((0,n.toggleMark)(e))}function de(e,t){return ue(ce(e,t))}function ce(e,t){return e===W.nodes.text_align?(o,a)=>{const{$from:n,$to:i}=o.selection;let r=n.blockRange(i);if(r){const e=n.closest(W.nodes.text_align,r.depth);if(e&&!r.startIndex&&r.endIndex===e.childCount){const n=e.pos(o.doc);return void 0!==n&&(a&&a(o.tr.setNodeMarkup(n,void 0,t).stripNodeType(e.content,W.nodes.text_align).scrollIntoView()),!0)}}const l=r&&(0,h.findWrapping)(r,e,t);if(!l)return!1;if(a){const e=o.tr;if(e.wrap(r,l),r=e.doc.resolve(n.pos+1).blockRange(e.doc.resolve(i.pos+1)),!r)throw new Error("Unable to strip nodes, unable to resolve new range");e.stripNodeType(r,W.nodes.text_align),e.scrollIntoView(),a(e)}return!0}:(0,n.wrapIn)(e,t)}function pe(e,t){return ue((0,n.setBlockType)(e,t))}function fe(e,t){return ue((0,f.wrapInList)(e,t))}const me=(0,y.default)().style("text-editor-toolbar").style.bind(p,"text-editor-toolbar--fullscreen").style.bind(j,"text-editor-toolbar--minimal").ariaRole("toolbar").append((0,y.default)().style("text-editor-toolbar-left").append(V().ariaLabel.use("text-editor/toolbar/group/inline").append(te("strong").setIcon("bold")).append(te("em").setIcon("italic")).append(ee("left").and(F,"other-formatting").setIcon("other-formatting").tweakPopover((e=>e.append(te("underline").setIcon("underline")).append(te("strikethrough").setIcon("strikethrough")).append(te("subscript").setIcon("subscript")).append(te("superscript").setIcon("superscript")).append(te("code").setIcon("code")))))).append(V().ariaLabel.use("text-editor/toolbar/group/block").append(ee("centre").tweakPopover((e=>e.ariaRole("radiogroup").append(oe("left").setIcon("align-left")).append(oe("centre").setIcon("align-center")).append(oe("right").setIcon("align-right")))).tweak((e=>{q.use(e,(()=>{const t=B?.mirror?.hasFocus()||le?Be()??"mixed":"left";e.ariaLabel.set(o.default["text-editor/toolbar/button/align"](o.default[`text-editor/toolbar/button/align/currently/${t}`]()).toString()),e.setIcon("mixed"===t?"asterisk":`align-${"centre"===t?"center":t}`)}))})))).append(V().ariaRole().append(ee("centre").tweakPopover((e=>e.ariaRole("radiogroup").append(ae("paragraph").setIcon("paragraph")).append(ee("centre").setIcon("heading").tweakPopover((e=>e.append(ne(1)).append(ne(2)).append(ne(3)).append(ne(4)).append(ne(5)).append(ne(6))))).append(ae("code-block").setIcon("code")))).tweak((e=>{q.use(e,(()=>{const t=B?.mirror?.hasFocus()||le?Ne()??"mixed":"paragraph";e.ariaLabel.set(o.default["text-editor/toolbar/button/block-type"](o.default[`text-editor/toolbar/button/block-type/currently/${t}`]()).toString()),e.setIcon(("paragraph"===t?"paragraph":"code-block"===t&&"code")||"asterisk")}))})))).append(V().ariaLabel.use("text-editor/toolbar/group/wrapper").append(H(ue(n.lift)).and(F,"lift").setIcon("outdent").style.bind(q.map(e,(e=>!e||!(0,n.lift)(e))),"text-editor-toolbar-button--hidden")).append(ie("blockquote").setIcon("quote-left")).append(re("bullet-list").setIcon("list-ul")).append(re("ordered-list").setIcon("list-ol"))).append(V().ariaLabel.use("text-editor/toolbar/group/insert").append(H(ue(((e,t)=>(t?.(e.tr.replaceSelectionWith(W.nodes.horizontal_rule.create())),!0)))).and(F,"hr").style("text-editor-toolbar-hr")))).append((0,y.default)().style("text-editor-toolbar-right").append(V().ariaLabel.use("text-editor/toolbar/group/actions").append(H(ue(u.undo)).and(F,"undo").setIcon("undo")).append(H(ue(u.redo)).and(F,"redo").setIcon("redo")).append(H((function(){C.default.perform("subview",_e,(()=>{p.value=!p.value,y.default.getDocument().style.toggle(p.value,"has-fullscreen-text-editor"),we.appendTo(p.value?Se:B),we.rect.markDirty()}))})).bindIcon(p.map(e,(e=>e?"compress":"expand"))).ariaLabel.bind(p.map(e,(e=>o.default["text-editor/toolbar/button/"+(e?"unfullscreen":"fullscreen")]().toString()))))));let he,ge,ve;const ye=()=>{he=void 0,ve?.(),ve=void 0,ge?.(),ge=void 0},be=(0,y.default)("input").style("text-editor-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`text-editor-validity-pipe-input-${Math.random().toString(36).slice(2)}`),_e="text-editor",we=(0,y.default)().subviewTransition(_e).style("text-editor").style.bind(p,"text-editor--fullscreen").event.subscribe("click",(e=>{const t=y.default.get(e.target);(t===me||t?.is(Q))&&B.document?.focus()})).append(be).append(me);let ke=!1;B=e.and(D.default).and(k.default).and(S.HandlesKeyboardEvents).style.bind(j,"text-editor--minimal").append(we).pipeValidity(be).extend((e=>({content:c,touched:P,default:(0,M.default)(e,(e=>Re(e))),toolbar:me,editor:we,setRequired:(t=!0)=>(e.style.toggle(t,"text-editor--required"),e.required.asMutable?.setValue(t),Ie(),e),setLabel:t=>(ye(),he=t,Ie(),ve=he?.removed.use(e,(e=>e&&ye())),ge=he?.for.use(e,Pe),he?.setInput(e),e),useMarkdown:()=>(Ce(),q.value?E.default.trim(z.serialize(q.value?.doc)):""),setMinimalByDefault:(t=!0)=>(A.value=t,e),disablePersistence:()=>(Ce(),ke=!0,e),importMarkdown:t=>(Re(t),e),ready:()=>(e.mirror?.domObserver?.flush(),e)})));const Te=(0,D.default)();Te.style.bind(p,"text-editor-document-slot--fullscreen").use(a,((e,o)=>{if(!o)return function(e){const o=new g.EditorView(e.element,{transformPastedHTML:(e,t)=>(O.default.isPasteHTML(e)&&(e=O.default.fixPasteHTML(e)),e.replaceAll(/(?<=<\/\s*p\s*>\s*)<\s*br\s*\/?\s*>(?=\s*<\s*p\b)/g,"<p></p>").replaceAll(/<\s*br\s*class="Apple-interchange-newline"\s*\/?\s*>/g,"")),state:m.EditorState.create({doc:Y.parse(c.value),plugins:[(0,r.buildInputRules)(W),(0,s.inputRules)({rules:[Me({regex:/\*\*((?:(?!\*\*).)+)\*\*$/g,type:W.marks.strong,getContent:e=>e[1]}),Me({regex:/__((?:(?!__).)+)__$/g,type:W.marks.underline,getContent:e=>e[1]}),Me({regex:/\/\/((?:(?!\/\/).)+)\/\/$/g,type:W.marks.em,getContent:e=>e[1]}),Me({regex:/~~((?:(?!~~).)+)~~$/g,type:W.marks.strikethrough,getContent:e=>e[1]}),Me({regex:/`([^`]+?)`$/g,type:W.marks.code,getContent:e=>e[1]}),Me({regex:/\[(.+?)\]\(([^ ]+?)(?:[  ](?:\((.+?)\)|["'“”‘’](.+?)["'“”‘’]))?\)$/g,type:W.marks.link,getAttrs:([e,t,o,a,n])=>({href:o,title:a||n||void 0}),getContent:e=>e[1]}),Me({regex:/@([a-zA-Z0-9-]+)$/g,type:W.marks.mention,getAttrs:e=>({vanity:e[1]}),getContent:e=>`@${e[1]}`})]}),(0,d.keymap)((0,r.buildKeymap)(W,{})),(0,d.keymap)(n.baseKeymap),(0,d.keymap)({"Mod-s":(0,n.toggleMark)(W.marks.strikethrough),"Mod-S":(0,n.toggleMark)(W.marks.strikethrough),"Mod-.":(0,n.toggleMark)(W.marks.superscript),"Mod-,":(0,n.toggleMark)(W.marks.subscript),"Alt-Ctrl-0":(0,n.setBlockType)(W.nodes.paragraph),"Alt-ArrowLeft":ce(W.nodes.text_align,{align:"left"}),"Alt-ArrowDown":ce(W.nodes.text_align,{align:"center"}),"Alt-ArrowRight":ce(W.nodes.text_align,{align:"right"}),...R.default.range(1,7).toObject((e=>[`Alt-Ctrl-${e}`,(0,n.setBlockType)(W.nodes.heading,{level:e})]))}),(0,i.dropCursor)(),(0,l.gapCursor)(),(0,u.history)(),new m.Plugin({appendTransaction(e,t,o){const a=[];let n=!1;if(o.doc.descendants(((e,t)=>{const i=e.marks.find((e=>e.type===W.marks.mention));if(!i)return;let r,l=t+e.nodeSize;for(;(r=o.doc.nodeAt(l))&&r.marks.find((e=>e.type===W.marks.mention&&e.attrs.vanity==e.attrs.vanity));)l+=r.nodeSize;let u,s=o.doc.textBetween(t,l);return!!s.startsWith("@")&&(s=s.slice(1),[,s,u]=s.match(/^([a-zA-Z0-9-]+)(.*)$/)??[],!!s&&(l-=u.length,i.attrs.vanity!==s&&(a.push({start:t,end:l,vanity:s,textAfter:u}),n=!0),!1))})),!n)return null;const i=o.tr;for(const{start:e,end:t,vanity:o,textAfter:n}of a.reverse()){const a=W.marks.mention.create({vanity:o});i.removeMark(e,t+n.length,W.marks.mention),i.insertText(n,t),i.replaceWith(e,t+n.length,W.text(`@${o}`)),i.addMark(i.mapping.map(e),i.mapping.map(t),a)}return i},view:()=>({update(e,t){q.value=e.state,q.value===t&&q.emit()}})})]})});return B.mirror=o,B.document=(0,y.default)().and(k.default).replaceElement(B.mirror.dom).ariaRole("textbox").classes.add("markdown").style("text-editor-document").style.bind(p,"text-editor-document--fullscreen").setId(`text-editor-${t}`).attributes.set("aria-multiline","true").event.subscribe("scroll",(()=>De.element.scrollTo({left:B.document?.element.scrollLeft??0,behavior:"instant"}))),Object.assign(B.document,{required:B.required,invalid:B.invalid,touched:B.touched}),me.ariaControls(B.document),Ie(),()=>{c.value=E.default.trim(z.serialize(o.state.doc)),B.mirror=void 0,B.document=void 0,Ie(),o.destroy()}}((0,D.default)().appendTo(e));q.value=void 0})).appendTo(we),e.onRemoveManual((()=>B.mirror?.destroy()));const xe=N.default.Generator((()=>`${B.document?.element.scrollWidth??0}px`)).observe(e,q,I.default.size,p),De=(0,y.default)().style("text-editor-document-scrollbar-proxy").style.bind(p,"text-editor-document-scrollbar-proxy--fullscreen").style.bind(xe.map(e,(()=>(B.document?.element.scrollWidth??0)>(B.document?.rect.value.width??0))),"text-editor-document-scrollbar-proxy--visible").style.bindVariable("content-width",xe).event.subscribe("scroll",(()=>B.document?.element.scrollTo({left:De.element.scrollLeft,behavior:"instant"}))).appendTo(we),Oe=N.default.Generator((()=>`${Te.element.scrollWidth??0}px`)).observe(e,q,I.default.size);Te.style.bindVariable("content-width",Oe),q.use(B,(e=>{!function(e=B.document?.name.value,t){const o=t?E.default.trim(z.serialize(t)):"";if(c.value=o,B.length.asMutable?.setValue(o.length),P.value||=!!o,Ee(),!e)return;if(ke)return;if(o===B.default.state.value)return Ce();$.default.items.textEditorDrafts=[...o?[{name:e,body:o,created:Date.now()}]:[],...($.default.items.textEditorDrafts??[]).filter((t=>t.name!==e&&Date.now()-t.created<L.default.days(1)&&!0))].slice(0,4)}(void 0,e?.doc),me.rect.markDirty()}));const Se=(0,w.default)().and(D.default).style.remove("slot").style("text-editor-fullscreen-dialog").setFullscreen().setOwner(B).bind(p).appendTo(document.body);return B.length.use(B,((e=0)=>{let t;e>(B.maxLength.value??1/0)&&(t=e=>e["shared/form/invalid/too-long"]()),B.setCustomInvalidMessage(t),B.document?.setCustomInvalidMessage(t),be.event.bubble("change")})),B;function Ee(){let e;(B.length.value??0)>(B.maxLength.value??1/0)&&(e=e=>e["shared/form/invalid/too-long"]()),!B.length.value&&B.required.value&&(e=e=>e["shared/form/invalid/required"]()),B.setCustomInvalidMessage(e)}function Me(e){return new s.InputRule(e.regex,((t,o,a,n)=>{const i=e.getAttrs instanceof Function?e.getAttrs(o):e.getAttrs,r=e.getContent instanceof Function?e.getContent(o):e.getContent??"",l=t.tr;l.replaceWith(a,n,"string"==typeof r?W.text(r):r);const u=e.type.create(i);return l.addMark(l.mapping.map(a),l.mapping.map(n),u),l.removeStoredMark(u),e.regex.lastIndex=0,l}))}function Ie(){he?.setInput(B.document),B.document?.setName(he?.for),B.document?.setId(he?.for),he?.setId(he.for.map(e,(e=>`${e}-label`))),me.ariaLabelledBy(he),B.document?.ariaLabelledBy(he),B.document?.attributes.toggle(B.required.value,"aria-required","true"),Ee()}function Ce(e=B.document?.name.value){e&&($.default.items.textEditorDrafts=$.default.items.textEditorDrafts?.filter((t=>t.name!==e)))}function Re(e=""){(B.mirror?.docView).dirty=2,B.mirror?.updateState(m.EditorState.create({plugins:B.mirror.state.plugins.slice(),doc:Y.parse(e)})),c.value=e,B.length.asMutable?.setValue(e.length),Ee()}function Pe(e=B.document?.name.value){if(!e)return;if(ke)return;const t=$.default.items.textEditorDrafts?.find((t=>t.name===e));t&&Re(t.body)}function Ae(e,t){if(!q.value)return!1;const o=q.value.selection;return t??=o.empty?o.$from:void 0,t?!!e.isInSet(q.value.storedMarks||t.marks()):q.value.doc.rangeHasMark(o.from,o.to,e)}function je(e,t,o){if(!q.value)return!1;const a=q.value.selection;if(o??=a.empty?a.$from:void 0,o)return!!o.closest(e,t);let n=!1;return q.value.doc.nodesBetween(a.from,a.to,(o=>{n||=o.matches(e,t)})),n}function Ne(e){if(!q.value)return;const t=q.value.selection;if(e??=t.empty?t.$from:void 0,e){for(const t of J)if(je(W.nodes[t],e))return t.replaceAll("_","-");return"paragraph"}const o=new Set;if(q.value.doc.nodesBetween(t.from,t.to,((e,t)=>{if(e.type!==W.nodes.text)return;const a=q.value?.doc.resolve(t);if(a)for(const e of J)if(je(W.nodes[e],a))return void o.add(e.replaceAll("_","-"))})),!o.size)return Ne(t.$from);if(o.size>1)return;const[a]=o;return a}function $e(e,t){if(!q.value)return!1;e="centre"===e?"center":e;const o=q.value.selection;if(t??=o.empty?o.$from:void 0,t)return(t.closest(W.nodes.text_align)?.attrs.align??"left")===e;let a=!1;return q.value.doc.nodesBetween(o.from,o.to,((t,o)=>{const n=q.value?.doc.resolve(o);a||=n?$e(e,n):"left"===e})),a}function Be(e){if(!q.value)return;const t=q.value.selection;if(e??=t.empty?t.$from:void 0,e){const t=e.closest(W.nodes.text_align)?.attrs.align??"left";return"center"===t?"centre":t}const o=new Set;if(q.value.doc.nodesBetween(t.from,t.to,((e,t)=>{if(e.type===W.nodes.text){const e=q.value?.doc.resolve(t);e&&o.add(Be(e))}})),!o.size)return Be(t.$from);if(o.size>1)return;const[a]=o;return a}})),{passThrough:function(e,t=!0){const o=Q().style("text-editor--internal").appendTo(document.body),a=e(o),n=o.content.value;if(o.remove(),!a&&t)throw new Error("Unable to convert HTML to markdown");return a?n:void 0}});t.default=Q})),define("ui/component/core/TextInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/utility/StringApplicator","utility/State"],(function(e,t,o,a,n,i){function r(e){return(t,o,a)=>void 0===o?e("",t,"").join(""):e(t,o,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.FilterFunction=r,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),function(e){e.mapped=function(t){return e(((...e)=>e.map((e=>t(e)))))},e.DEFAULT=e(((...e)=>e));const t=/[^0-9]/g;e.NUMERIC=e.mapped((e=>e.replace(t,"")));const o=/[^0-9.]|(?<=\..*)\./g;e.DECIMAL=e(((e,a,n)=>(e=e.replace(o,""),a=a.replace(e.includes(".")?t:o,""),n=n.replace(e.includes(".")||a.includes(".")?t:o,""),[e,a,n])))}(r||(t.FilterFunction=r={}));const l=o.default.Builder("input",(e=>{let t,l,u=!1;const s=(0,i.default)(""),d=e.and(a.default).style("text-input").attributes.set("type","text").attributes.set("autocomplete","off").extend((e=>({value:"",state:s,default:(0,n.default)(e,(t=>{""===e.value&&(t=(t??"").trim(),e.value=t,s.value=t,e.length.asMutable?.setValue(t.length),c())})),placeholder:(0,n.default)(e,(t=>{e.attributes.set("placeholder",t)})),ignoreInputEvent:(t=!0)=>(u=t,e),filter:o=>(t=o,e),setReadonly:()=>(e.attributes.append("readonly"),e),setValidityHandler:t=>(l=t,e),wrap:()=>(e.style("text-input--wrapped"),(0,o.default)().style("text-input","text-input-wrapper").append(e))}))).extendMagic("value",(e=>({get:()=>e.element.value||"",set:t=>{const o=e.element;o.value=t,p("change"),s.value=o.value,e.length.asMutable?.setValue(o.value.length),c()}})));return d.length.asMutable?.setValue(0),c(),d.event.subscribe(["input","change"],(e=>{p(e.type),u||(s.value=d.value.trim(),d.length.asMutable?.setValue(d.value.trim().length),c())})),d;function c(){let e;(d.length.value??0)>(d.maxLength.value??1/0)&&(e=e=>e["shared/form/invalid/too-long"]()),e??=l?.(d),d.setCustomInvalidMessage(e)}function p(e){const o=d.element.asType("input");if(!o)return;const a=t??r.DEFAULT;if("change"===e)return void(o.value=a(d.value.trim(),"","").join("").trim());let{selectionStart:n,selectionEnd:i,value:l}=o;const u=null!==n||null!==i;n??=l.length,i??=l.length;const s=l.slice(0,n).trimStart();let c=l.slice(i).trimEnd(),p=l.slice(n,i);s.length||(p=p.trimStart()),c.length||(p=p.trimEnd()),p.length||s.length||(c=c.trimStart());const[f,m,h]=a(s,p,c);o.value=f+m+h,u&&o.setSelectionRange(f.length,f.length+m.length)}}));t.default=l})),define("ui/view/about/AboutViewRoadmap",["require","exports","endpoint/changelog/EndpointChangelogAdd","endpoint/changelog/EndpointChangelogDelete","endpoint/changelog/EndpointChangelogGet","endpoint/changelog/EndpointChangelogUpdate","model/FormInputLengths","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/Form","ui/component/core/InfiniteScroll","ui/component/core/LabelledTable","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Small","ui/component/core/TextEditor","ui/component/core/TextInput","utility/Env","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w),t.default=u.default.Builder((e=>{(0,s.default)().tweak((e=>{e.title.text.use("document/roadmap/title"),e.content.useMarkdownContent("document/roadmap")})).appendTo(e);const t=(0,p.default)().and(g.default);return(0,s.default)().type("flush").style("view-type-about-changelog-wrapper").tweak((e=>{e.title.text.use("view/about/roadmap/changelog/title"),e.content.style("view-type-about-changelog");const p=(0,w.default)(void 0),g=(0,y.default)().setMaxLength(r.default.map(e,(e=>e?.changelog?.body))).setRequired(),k=(0,b.default)().setValidityHandler((e=>{if(e.length.value)return isNaN(new Date(e.value).getTime())?e=>e["shared/form/invalid/time"]():void 0})).placeholder.use("shared/form/time/placeholder"),T=(0,b.default)().filter(((...e)=>e.map((e=>e.replace(/[^0-9]/g,""))))).placeholder.set(`v${+_.default.BUILD_NUMBER||0}`),x=(0,s.default)().tweak((e=>{e.title.text.bind(p.map(e,(e=>t=>t[e?"view/about/roadmap/changelog-editor/title/update":"view/about/roadmap/changelog-editor/title/create"]())));const a=e.and(c.default,e.title),n=(0,f.default)().appendTo(a.content);n.label((e=>e.text.use("view/about/roadmap/changelog-editor/label/body"))).content(((e,t)=>e.append(g.setLabel(t))));const r=w.default.Generator((()=>(new Date).toLocaleString(navigator.language))),l=setInterval((()=>r.refresh()),1e3);e.onRemoveManual((()=>clearInterval(l))),n.label((e=>e.text.use("view/about/roadmap/changelog-editor/label/time"))).content(((e,t)=>e.append(k.setLabel(t)).append((0,m.default)().and(h.default).and(v.default).text.bind(w.default.Map(e,[k.state,r],((e,t)=>e?new Date(e).toLocaleString(navigator.language):t)))))),n.label((e=>e.text.use("view/about/roadmap/changelog-editor/label/version"))).content(((e,t)=>e.append(T.setLabel(t))));let u=!1;a.submit.text.bind(p.map(a,(e=>t=>t[e?"view/about/roadmap/changelog-editor/action/submit/save":"view/about/roadmap/changelog-editor/action/submit/create"]()))).event.subscribe("click",(async()=>{if(T.value&&isNaN(+T.value))return;if(u)return;u=!0;const e={body:g.useMarkdown(),version:T.value?+T.value:+_.default.BUILD_NUMBER||0,time:k.value?new Date(k.value).toISOString():void 0},a=p.value?await i.default.query({params:{id:p.value.id},body:e}):await o.default.query({body:e});u=!1,toast.handleError(a)||(g.importMarkdown(""),T.value="",k.value="",t.reset())})),(0,d.default)().text.use("view/about/roadmap/changelog-editor/action/cancel").event.subscribe("click",(()=>{g.importMarkdown(""),T.value="",k.value="",p.value=void 0})).appendToWhen(p.truthy,e.footer.left)})).appendToWhen(l.default.Auth.privileged.ChangelogModify,e.content);t.setFromEndpoint(n.default.prep(),((e,o,n)=>{for(const n of e)(0,s.default)().style("view-type-about-changelog-item").tweak((e=>e.content.style("view-type-about-changelog-item-content").append((0,u.default)().style("view-type-about-changelog-item-body").setMarkdownContent(n.body)))).tweak((e=>e.footer.left.and(h.default).and(v.default).text.set(`v${n.version}`))).tweak((e=>e.footer.right.and(h.default).and(v.default).text.set(new Date(n.time).toLocaleDateString(navigator.language)))).setActionsMenu((e=>{l.default.Auth.privileged.ChangelogModify.value&&((0,d.default)().type("flush").setIcon("pencil").text.use("view/about/roadmap/changelog-editor/action/edit").event.subscribe("click",(()=>{p.value=n,g.importMarkdown(n.body),T.value=`${n.version}`,k.value=new Date(n.time).toISOString(),x.header.element.scrollIntoView({behavior:"smooth"})})).appendTo(e),(0,d.default)().type("flush").setIcon("trash").text.use("view/about/roadmap/changelog-editor/action/delete").event.subscribe("click",(async()=>{const e=await a.default.query({params:{id:n.id}});toast.handleError(e)||t.reset()})).appendTo(e))})).tweak((e=>{e.primaryActions.style("view-type-about-changelog-item-primary-actions").appendTo(e.content),e.header.remove()})).appendTo(o)})).appendTo(e.content)})).appendTo(e),e}))})),define("ui/component/core/RSSButton",["require","exports","ui/Component","ui/component/core/Button"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),t.default=o.default.Builder("a",((e,t)=>e.replaceElement("a").and(a.default).attributes.bind("href",t).attributes.set("target","_blank").setIcon("rss").type("flush").style("rss-button").event.subscribe("click",(e=>{e.stopPropagation()}))))})),define("ui/component/core/Breadcrumbs",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Heading","ui/component/core/Link","ui/component/core/RSSButton","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=o.default.Builder((e=>{const t=(0,o.default)().style("breadcrumbs-path","breadcrumbs-path--hidden").viewTransition("breadcrumbs-path");let u;const s=(0,l.default)(void 0);return e.style("breadcrumbs").append(t).extend((e=>({meta:void 0,info:void 0,title:void 0,description:void 0,actions:void 0,path:t,backButton:s,setPath:(...n)=>(t.removeContents().style.toggle(!n.length,"breadcrumbs-path--hidden").append(...n.flatMap((([e,t],n)=>[n&&(0,o.default)().style("breadcrumbs-path-separator"),(0,i.default)(e).and(a.default).type("flush").text.use(t)]))),e),setBackButton:(t,o)=>(s.value?.remove(),t?(s.value=(0,i.default)(t).and(a.default).type("flush").style("breadcrumbs-back-button").setIcon("arrow-left").text.use("shared/action/return").tweak(o).appendTo(e.meta),e):e),setRSSButton:t=>(t=l.default.get(t),(0,r.default)(t.mapManual((e=>e??""))).style("breadcrumbs-rss-button").appendToWhen(t.truthy,e.info),e),getTitleIfExists:()=>u}))).extendJIT("meta",(e=>(0,o.default)().viewTransition("breadcrumbs-meta").style("breadcrumbs-meta").prependTo(e))).extendJIT("info",(e=>(0,o.default)().style("breadcrumbs-info").prependTo(e.meta))).extendJIT("title",(e=>u=(0,n.default)().style("breadcrumbs-title").setAestheticStyle(!1).prependTo(e.info))).extendJIT("description",(e=>(0,o.default)().style("breadcrumbs-description").appendTo(e.info))).extendJIT("actions",(e=>(0,o.default)().style("breadcrumbs-actions").appendTo(e.meta)))}));t.default=u})),define("ui/view/shared/component/View",["require","exports","ui/Component","ui/component/core/Breadcrumbs","ui/component/core/Heading","ui/view/shared/ext/ViewTitle","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder(((e,t)=>{const l=(0,o.default)().style("view-content");return e.style("view",`view-type-${t}`).attributes.set("data-view",t).append(l).extend((e=>({viewId:t,hash:"",breadcrumbs:void 0,content:l,titleComponent:void 0}))).extendJIT("hash",(e=>`${e.viewId}${e.params?`_${JSON.stringify(e.params)}`:""}`.replaceAll(/\W+/g,"-"))).extendJIT("breadcrumbs",(e=>(0,a.default)().style("view-breadcrumbs").tweak((e=>{e.path.style("view-breadcrumbs-path");const t=e.setBackButton;e.backButton.value?.style("view-breadcrumbs-back-button"),e.setBackButton=(...o)=>(t(...o),e.backButton.value?.style("view-breadcrumbs-back-button"),e),e.tweakJIT("meta",(e=>e.style("view-breadcrumbs-meta"))),e.tweakJIT("info",(e=>e.style("view-breadcrumbs-info"))),e.tweakJIT("title",(e=>e.style("view-breadcrumbs-title"))),e.tweakJIT("description",(e=>e.style("view-breadcrumbs-description")))})).prependTo(e))).extendJIT("titleComponent",(e=>{const t=(0,r.default)(void 0);return o(),e.receiveDescendantInsertEvents(),e.receiveDescendantRemoveEvents(),e.event.subscribe(["descendantInsert","descendantRemove"],o),t;function o(){t.value=_??e.breadcrumbs.getTitleIfExists()??e.getFirstDescendant(i.default)??e.getFirstDescendant(n.default)}}))}));t.default=l})),define("utility/Errors",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Impossible=()=>new Error("Something impossible appears to have happened, what are you?"),e.NotFound=()=>Object.assign(new Error("Not found"),{code:404}),e.Forbidden=()=>Object.assign(new Error("Forbidden"),{code:403}),e.BadData=e=>Object.assign(new Error("Bad data was sent by the server",{cause:e}),{code:500}),e.create=e=>Object.assign(new Error(e),{code:600});const t=Symbol("REDIRECTING");e.redirection=e=>()=>(navigate.toURL(e),t)}(o||(o={})),t.default=o})),define("ui/view/shared/component/ViewDefinition",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={...e,navigate:(e,o)=>e.view.show(t,o)};return t}})),define("ui/view/AboutView",["require","exports","ui/component/core/Block","ui/component/core/Tabinator","ui/view/about/AboutViewRoadmap","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importStar(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),t.default=(0,r.default)({create({tab:e}={}){const t=(0,i.default)("about"),r=(0,a.default)().appendTo(t.content);return(0,a.Tab)().text.use("view/about/main/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/about/title"))).tweak((e=>e.content.useMarkdownContent("document/about")))))).addTo(r),(0,a.Tab)("roadmap").text.use("view/about/roadmap/tab").tweak((e=>e.content.append((0,n.default)()))).addTo(r),(0,a.Tab)("supporters").text.use("view/about/supporters/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/about-supporters/title"))).tweak((e=>e.content.useMarkdownContent("document/about-supporters")))))).addTo(r),r.bindURL(e,(e=>e?`/about/${e}`:"/about")),r.bindViewTitle(),t}})})),define("endpoint/auth/EndpointAuthSetRequiredCount",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/set-required-count","post")})),define("endpoint/author/EndpointAuthorDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/author/delete","post").noResponse()})),define("endpoint/auth/EndpointAuthServices",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/services","get")})),define("model/DangerToken",["require","exports","utility/Env","utility/Popup","utility/Store"],(function(e,t,o,a,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),function(e){const t=new Map;function i(e){for(const e of[...t.values()])(e.expiryTime<=new Date||e.uses<=0)&&t.delete(e.type);return t.get(e)}let r;e.canRequest=function(){return!r},e.canUse=function(e){return!!i(e)};const l=(0,a.default)({width:600,height:900});e.request=async function(e,a,u){const s=i(a);if(s)return s.uses--,!0;if(r)return!1;r=!0;const d=await l.show(e,{translation:e=>e["shared/popup/danger-token/title"](u.name),url:`${o.default.API_ORIGIN}danger-token/request/${a}/${u.id}/begin`}).toastError();if(r=!1,!d)return!1;const c=n.default.items.dangerTokenMetadataTransfer;if(c){delete n.default.items.dangerTokenMetadataTransfer;const e=c.uses-1;e&&t.set(a,{type:a,uses:e,expiryTime:new Date(c.expiryTime)})}return d},e.handleAuthParams=function(e){const t=e.get("danger-token-uses"),o=e.get("danger-token-expiry");if(!t||!o)return;const a=+t,i=new Date(o);isNaN(a)||isNaN(i.getTime())||(n.default.items.dangerTokenMetadataTransfer={uses:a,expiryTime:o})}}(i||(i={})),t.default=i})),define("ui/component/core/BlockDialog",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Dialog","utility/Task"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i);const r=o.default.Builder((e=>{const t=e.and(n.default).and(a.default).viewTransition(!1).style.remove("block");t.style("dialog-block-wrapper").style.bind(t.opened.not,"dialog-block-wrapper--closed");const o=(0,a.default)().style("dialog-block").style.bind(t.opened.not,"dialog-block--closed").appendTo(t);t.extend((e=>({type:o.type,content:o.content,setActionsMenu:o.setActionsMenu,setActionsMenuButton:o.setActionsMenuButton}))).extendJIT("header",(()=>o.header)).extendJIT("title",(()=>o.title)).extendJIT("primaryActions",(()=>o.primaryActions)).extendJIT("description",(()=>o.description)).extendJIT("footer",(()=>o.footer));const r=t.open;return t.extend((e=>({block:o,open:()=>(r(),o.style("dialog-block--opening"),e.style("dialog-block-wrapper--opening"),i.default.yield().then((()=>{o.style.remove("dialog-block--opening"),e.style.remove("dialog-block-wrapper--opening")})),e)})))}));t.default=r})),define("ui/component/core/ConfirmDialog",["require","exports","model/DangerToken","model/Session","ui/Component","ui/component/core/BlockDialog","ui/component/core/Button","ui/component/core/Paragraph","ui/component/core/Placeholder","utility/Errors","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d){let c;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d);const p=Object.assign(n.default.Builder((async(e,t)=>{const p=e.and(i.default).style("confirm-dialog");if(!1===t?.cancelButtonTranslation&&!1===t.confirmButtonTranslation)throw s.default.create("At least one ConfirmDialog button must be enabled");const f=(0,d.default)(void 0);p.title.text.use(t?.titleTranslation??"shared/prompt/confirm");const m=t?.bodyTranslation?(0,n.default)().style("confirm-dialog-body").useMarkdownContent({body:t.bodyTranslation}).appendTo(p.content):void 0,h=!1===t?.cancelButtonTranslation?void 0:(0,r.default)().text.use(t?.cancelButtonTranslation??"shared/action/cancel").appendTo(p.footer.right),g=!1===t?.confirmButtonTranslation?void 0:(0,r.default)().type("primary").text.use(t?.confirmButtonTranslation??"shared/action/confirm").appendTo(p.footer.right);let v;if(t?.dangerToken&&!o.default.canUse(t.dangerToken)){g?.setDisabled(!0,"danger-token"),v=(0,n.default)().appendTo(p.content),(0,l.default)().and(u.default).style("confirm-dialog-danger-token-hint").text.use("shared/prompt/reauth").appendTo(v);(await c(a.default.Auth.state,t.dangerToken)).event.subscribe("DangerTokenGranted",(()=>g?.setDisabled(!1,"danger-token"))).appendTo(v)}const y=p.extend((e=>({state:f,cancelButton:h,confirmButton:g,body:m,dangerTokenAuthWrapper:v,await:t=>(f.value=void 0,e.open(),new Promise((o=>t?e.state.match(t,[!0,!1],o):e.state.matchManual([!0,!1],o)))),cancel(){f.value=!1,e.close()},confirm(){f.value=!0,e.close()}}))).onRooted((e=>{e.cancelButton?.event.subscribe("click",e.confirmButton?e.cancel:e.confirm),e.confirmButton?.event.subscribe("click",e.confirm)}));return await(t?.tweak?.(y)),y})),{prompt:async(e,t)=>(await p(t)).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e),ensureDangerToken:async(e,t)=>!!o.default.canUse(t.dangerToken)||(await p(t)).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e),setOauthServicesComponent(e){c=e}});t.default=p})),define("ui/component/auth/OAuthService",["require","exports","model/Session","ui/Component","ui/component/core/Checkbutton","ui/component/core/ConfirmDialog","utility/Objects","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),l=__importDefault(l);const u=a.default.Builder(((e,t,u)=>{const s=!!o.default.Auth.get(t.name),d=_??u?.authorisationState??o.default.Auth.authorisations.map(e,(e=>e.find((e=>e.service===t.name)))),c=l.default.Truthy(e,d),p=e.and(n.default).setChecked(s).style("oauth-service").ariaRole("button").attributes.remove("aria-checked").setIcon().use(c).style.bind(c,"oauth-service--authenticated").style.setVariable("colour",`#${t.colour.toString(16)}`).append((0,a.default)("img").style("oauth-service-icon").attributes.set("src",t.icon)).append((0,a.default)().style("oauth-service-name").text.set(t.name)).extend((e=>({service:t,stateIndicatorWrapper:void 0,stateIndicator:void 0})));p.style.bind(p.disabled,"button--disabled","oauth-service--disabled"),(0,r.mutable)(p).stateIndicatorWrapper=(0,a.default)().style("oauth-service-state-wrapper").style.bind(p.hoveredOrFocused,"oauth-service-state-wrapper--focus").appendTo(p),(0,r.mutable)(p).stateIndicator=(0,a.default)().style("oauth-service-state").style.bind(c,"oauth-service-state--authenticated").style.bind(l.default.Map(p,[p.hoveredOrFocused,p.disabled],((e,t)=>e&&!t)),"oauth-service-state--focus").appendTo(p.stateIndicatorWrapper);const f=(0,a.default)().style("oauth-service-username").style.bind(c,"oauth-service-username--has-username").ariaHidden().appendTo(p);return d.use(p,(e=>{p.ariaLabel.use((o=>o["view/account/auth/service/accessibility/"+(e?"disconnect":"connect")](t.name,e?.display_name))),f.text.set(e?.display_name??"")})),p.onRooted((()=>{p.event.subscribe("click",(async e=>{if(p.disabled.value)return;if(e.preventDefault(),await(u?.onClick?.(p)))return;const a=o.default.Auth.get(t.name);if(a){if(o.default.Auth.loggedIn.value){if(!await i.default.prompt(p,{dangerToken:"remove-auth-service",bodyTranslation:e=>e["view/account/auth/service/disconnect/confirm"](t.name,a.display_name)}))return!1}await o.default.Auth.unauth(a.id)}else await o.default.Auth.auth(p,t)}))})),p}));t.default=u})),define("ui/component/auth/OAuthServices",["require","exports","endpoint/auth/EndpointAuthServices","model/DangerToken","model/Session","ui/Component","ui/component/auth/OAuthService","ui/component/core/Block","ui/component/core/ConfirmDialog","ui/component/core/Placeholder","ui/component/core/Slot","utility/Objects","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importStar(c),p=__importDefault(p);const f=i.default.Builder((async(e,t,u)=>{const f=e.and(l.default).viewTransition("oauth-services").style("oauth-service-container").style.toggle(!!u,"oauth-service-container--reauth-list").extend((e=>({data:void 0})));u?f.type("flush"):t.use(e,(e=>{f.title.text.use(`view/account/auth/${e}/title`),f.description.text.use("partial-login"===e?void 0:`view/account/auth/${e}/description`)}));const m=(0,i.default)().style("oauth-service-list").appendTo(f.content),h=await o.default.query();return toast.handleError(h)?(console.error(h),f):((0,c.mutable)(f).data=h.data,(0,d.default)().use(n.default.has,((t,o)=>{if(!o)return(0,i.default)().and(s.default).text.use("view/account/auth/none/needs-session").appendTo(t);for(const o of c.default.values(h.data))o.disabled||u&&!n.default.Auth.isAuthed(o)||(0,r.default)(o,{async onClick(e){if(!u)return!1;if(!a.default.canRequest())return!0;return await a.default.request(e,u,o)&&e.event.bubble("DangerTokenGranted",u),!0}}).bindDisabled(p.default.Use(e,{authorisations:n.default.Auth.authorisations,author:n.default.Auth.author}).map(e,(({authorisations:e,author:t})=>!u&&!!t&&1===e.length&&e[0].service===o.name)),"singly-authed-service").tweak((e=>{u&&e.stateIndicatorWrapper.remove()})).appendTo(t)})).appendTo(m),f)}));u.default.setOauthServicesComponent(f),t.default=f})),define("ui/utility/Applicator",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=function(e,t,a){const n=a?t:void 0;let i;a??=t;const r=function e(t){return{state:(0,o.default)(n),set:e=>(i?.(),l(e),t),bind:e=>(i?.(),i=e?.use(t,l),e||l(n),t),unbind:()=>(i?.(),l(n),t),rehost:e}}(e);return r;function l(e){r.state.value!==e&&(r.state.value=e,a(e))}}})),define("ui/component/core/RangeInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/utility/Applicator","utility/State"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i);const r=o.default.Builder(((e,t,r,l=1)=>{const u=(0,o.default)("input").style("range-input-input").attributes.set("type","range"),s=u.element;s.min=`${t}`,s.max=`${r}`,s.step=`${l}`;const d=(0,i.default)(void 0),c=(0,i.default)(s.valueAsNumber);s.addEventListener("input",(()=>c.value=s.valueAsNumber));const p=(0,o.default)().style("range-input-display").text.bind(c.mapManual((e=>e.toString()))),f=(0,i.default)(0),m=e.and(a.default).style("range-input").tabIndex("auto").append(u,p).extend((e=>({input:u,display:p,state:d,liveState:c,default:(0,n.default)(e,0,(e=>f.value=e))})));return i.default.MapManual([d,f],((e,t)=>c.value=s.valueAsNumber=e??t)),u.event.subscribe("change",(()=>c.value=d.value=s.valueAsNumber)),m}));t.default=r})),define("endpoint/author/EndpointAuthorCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/author/create","post")})),define("endpoint/author/EndpointAuthorUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/author/update","post")})),define("ui/component/core/ext/GradientText",["require","exports","ui/Component","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),t.default=o.default.Extension(((e,t,o="to right")=>{let n;return e.extend((e=>({useGradient:i=>(n?.(),n=a.default.get(i).use(e,(a=>e.style.toggle(!!a?.length&&!t,"gradient-text").style.setProperty(t?`--${t}`:"background-image",a?.length?`linear-gradient(${o} in oklch, ${a.map((e=>`#${e.toString(16).padStart(6,"0")}`)).map((e=>`light-dark(\n\t\t\t\t\t\t\toklch(from ${e} min(0.5, L) C H),\n\t\t\t\t\t\t\toklch(from ${e} max(0.75, L) C H)\n\t\t\t\t\t\t)`)).map(((e,t)=>0===t?`${e} var(--gradient-offset-start, 0%)`:t===a.length-1?`${e} calc(100% - var(--gradient-offset-end, 0%))`:e)).join(", ")})`:void 0))),e)})))}))})),define("ui/component/core/ColourInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/utility/Applicator","utility/State"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i);const r=o.default.Builder("input",(e=>{const t=(0,i.default)(0);return e.replaceElement("input").and(a.default).style("colour-input").attributes.set("type","color").event.subscribe("input",(e=>{t.value=parseInt(e.host.element.value.slice(1),16)})).tweak((e=>{t.use(e,(t=>e.element.value=`#${t.toString(16).padStart(6,"0")}`))})).extend((e=>({value:t,default:(0,n.default)(e,(t=>e.value.value=t??0))})))}));t.default=r})),define("ui/component/core/GradientInput",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/ColourInput","ui/component/core/ext/Input","ui/component/core/Slot","ui/InputBus","ui/utility/Applicator","utility/State"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s);const d=o.default.Builder((e=>{const t=(0,s.default)([],((e,t)=>e.length===t.length&&e.every(((e,o)=>e===t[o])))),d=t.mapManual((e=>e.slice()),((e,t)=>e?.length===t.length));let c;return e.and(i.default).style("gradient-input").append((0,r.default)().use(d,((e,i)=>{const r=[];for(let a=0;a<i.length;a++){const u=i[a];(0,o.default)().style("gradient-input-stop").append((0,n.default)().tweak((o=>{r[a]=o,o.value.value=u,o.value.subscribe(e,(e=>{t.value[a]=e,t.emit()})),c===a&&(o.onRooted((()=>o.focus())),c=void 0),l.default.until(o,(e=>e.subscribe("down",(e=>{e.targetComponent===o&&(e.use("Backspace")||e.use("Delete"))&&(c="Backspace"===e.key?Math.max(0,a-1):a,t.value.splice(a,1),t.emit())}))))})).event.subscribe("mousedown",(e=>{1===e.button&&(e.preventDefault(),t.value.splice(a,1),t.emit())}))).appendTo(e)}i.length<5&&(0,a.default)().setIcon("plus").style("gradient-input-add-stop").event.subscribe("click",(()=>{c=i.length,t.value.push(0),t.emit()})).tweak((e=>{c===i.length&&(e.onRooted((()=>e.focus())),c=void 0)})).appendTo(e)}))).extend((e=>({value:t,default:(0,u.default)(e,(t=>e.value.value=t?.length?t:[]))})))}));t.default=d})),define("ui/component/core/TextInputBlock",["require","exports","ui/Component","ui/component/core/TextInput"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=o.default.Builder((e=>{const t=[];return e.style("text-input-block").extend((e=>({inputs:t,addInput:n=>{const i=(0,a.default)().style("text-input-block-input").tweak(n).tweak((e=>e.removed.matchManual(!0,(()=>{t.filterInPlace((t=>t!==e));const o=t.at(0);o?.style("text-input-block-input--first"),o?.previousSibling?.remove(),t.at(-1)?.style("text-input-block-input--last"),t.at(-1)?.parent?.style("text-input-block-input-wrapper--last")})))).appendTo((0,o.default)().style("text-input-block-input-wrapper").appendTo(e));return t.length||i.style("text-input-block-input--first"),t.at(-1)?.style.remove("text-input-block-input--last"),t.at(-1)?.parent?.style.remove("text-input-block-input-wrapper--last"),t.push(i),i.style("text-input-block-input--last"),i.parent?.style("text-input-block-input-wrapper--last"),e}})))}));t.default=n})),define("ui/component/core/LabelledTextInputBlock",["require","exports","ui/Component","ui/component/core/Label","ui/component/core/TextInputBlock"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const i=o.default.Builder((e=>{e.style("labelled-text-input-block","labelled-row").ariaRole("group");const t=(0,o.default)().style("labelled-text-input-block-labels").appendTo(e),i=(0,n.default)().style("labelled-text-input-block-inputs").appendTo(e);let r,l;return e.extend((e=>({labels:t,inputs:i,label:o=>(r=o,l??={input:o=>{const n=i.inputs.length+1,l=(0,a.AutoLabel)().style("labelled-text-input-block-label").style.setProperty("grid-row",`${n}`).appendTo(t);let u;return r(l),i.addInput((e=>u=e.style("labelled-text-input-block-input").style.setProperty("grid-row",`${n}`).tweak((e=>o(e.setLabel(l),l))))),u.parent?.style("labelled-text-input-block-input-wrapper"),r=void 0,e}})})))}));t.default=i})),define("ui/component/core/toast/ToastList",["require","exports","model/Session","ui/Component","ui/component/core/toast/Toast","utility/Async","utility/Task","utility/Time"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=a.default.Builder((e=>{const t=(0,a.default)().style("toast-title").appendTo(e);return e.style("toast").extend((e=>({title:t,content:void 0,type:Object.assign(((...t)=>{for(const o of t)e.style(`toast-type-${o}`);return e}),{remove(...t){for(const o of t)e.style.remove(`toast-type-${o}`);return e}})}))).extendJIT("content",(e=>(0,a.default)().style("toast-content").appendTo(e)))})).setName("Toast"),s=a.default.Builder((e=>{const t=e.style("toast-list").extend((e=>({info:s.bind(null,"info"),success:s.bind(null,"success"),warning:s.bind(null,"warning"),handleError(t,a="shared/toast/error-occurred"){if(t instanceof Error){const i=t;return 401!==i.code||"Invalid session token"!==i.detail&&"This endpoint requires a session"!==i.detail?(e.warning(n.TOAST_ERROR,a,t),!0):(o.default.refresh(),!0)}return!1}})));return Object.assign(window,{toast:t}),t;function s(e,o,...n){const s=u().type(e).style("toast--measuring").tweak(o.initialise,...n);return async function(e,o){const n=(0,a.default)().style("toast-wrapper").appendTo(t);o.style("toast--measuring").appendTo(n),await r.default.yield();const u=o.rect.value;o.style.remove("toast--measuring"),n.style.setProperty("height",`${u.height}px`),await i.default.sleep(e.duration),o.style("toast--hide"),n.style.removeProperties("height"),await Promise.race([new Promise((e=>o.event.subscribe("animationend",e))),i.default.sleep(l.default.seconds(1))]),n.remove()}(o,s),s}}));t.default=s})),define("ui/component/core/toast/Toast",["require","exports","ui/Component"],(function(e,t,o){function a(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.TOAST_ERROR=t.TOAST_SUCCESS=void 0,o=__importDefault(o),t.default=a,t.TOAST_SUCCESS={duration:2e3,initialise(e,t){e.title.text.use(t)}},t.TOAST_ERROR={duration:5e3,initialise(e,t,a){console.error(a),e.title.text.use(t),function(e){return void 0!==e.headers}(a)&&a.detail?e.content.append((0,o.default)().style("toast-error-type").text.set(a.message)).text.append(": ").text.append(a.detail):e.content.text.set(a.message)}}})),define("utility/Functions",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NO_OP=()=>{},e.resolve=function(e,...t){return"function"==typeof e?e(...t):e},e.throwing=function(e){return()=>{throw new Error(e)}}}(o||(o={})),t.default=o})),define("ui/component/core/Dropdown",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/ext/Input","ui/component/core/Form","ui/component/core/RadioButton","ui/component/core/TextInput","ui/utility/Applicator","ui/utility/StringApplicator","utility/Arrays","utility/Async","utility/Functions","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m){Object.defineProperty(t,"__esModule",{value:!0}),t.CheckDropdown=t.RadioDropdown=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m);const h=o.default.Builder(((e,t)=>{const h=e.and(i.default).style("dropdown"),g=(0,m.default)(void 0),v=(0,m.default)(!1),y={};let b=0;const w=(0,u.default)().placeholder.use("shared/form/dropdown/filter/placeholder").style("dropdown-popover-input"),k=(0,o.default)().style("dropdown-popover-content"),T=(0,m.default)(void 0),x=(0,a.default)().style("dropdown-button").text.bind(g.mapManual((e=>void 0===e||Array.isArray(e)&&0===e.length?e=>e["shared/form/dropdown/selection/none"]():_??t.translateSelection?.(h,e)??(t=>t["shared/form/dropdown/selection/join"](...c.default.resolve(e).map((e=>f.default.resolve(y[e]?.translation,e))).map((e=>"string"==typeof e?e:f.default.resolve(e,t,d.QuiltHelper)))))))).setPopover("click",(e=>{const t=T.value;T.value=e.style("dropdown-popover").anchor.add("aligned left","aligned top").anchor.add("aligned left","aligned bottom").anchor.add("aligned left","sticky centre").anchor.orElseHide(),T.value.appendTo(h),T.value.visible.subscribeManual((async e=>{await p.default.sleep(20),e&&w.focus()})),k.appendTo(T.value),T.value.anchor.state.useManual((e=>{if(!T.value)return;const t="bottom"===e?.preference?.yAnchor.side;T.value.style.toggle(t,"dropdown-popover--is-bottom"),t?w.appendTo(T.value):w.prependTo(T.value)})),t?.remove()})).appendTo(h),D=(0,o.default)("input").style("dropdown-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`dropdown-validity-pipe-input-${Math.random().toString(36).slice(2)}`).appendTo(h);let O,S;return h.pipeValidity(D).ariaRole("group").extend((e=>({options:y,selection:g,touched:v,default:(0,s.default)(e,(e=>g.value=e)),button:x,popover:T,add(o,a){const i=t.createButton().style("dropdown-option").tweak((e=>e.is(l.default)&&e.setIcon(void 0))).type("flush").setId(o).setName(O).text.bind(f.default.resolve(a.translation,o)).use(g.mapManual((e=>c.default.resolve(e).includes(o)))).receiveFocusedClickEvents().tweak((e=>e.as(n.default)?.event.subscribe("click",(t=>{w.focus(),t.preventDefault(),t.stopImmediatePropagation();const a=e.is(l.default);if(a&&T.value?.hide(),g.value){const e=c.default.resolve(g.value);e.includes(o)?g.value=e.filter((e=>e!==o)):g.value=a?o:[...e,o].sort(((e,t)=>y[e].index-y[t].index))}else g.value=a?o:[o];v.value=!0,E()})))).tweak(a.tweakButton,o).appendTo(k);y[o]=Object.assign(a,{button:i,index:b++}),i.style.bind(i.checked,"dropdown-option--selected");const r=m.default.Map(i,[w.state,i.checked],((e,t)=>!t&&!!e&&!i.element.textContent?.toLowerCase()?.includes(e.toLowerCase())));return i.style.bind(r,"dropdown-option--filtered-out"),i.is(l.default)&&i.bindDisabled(i.checked,"selection"),e},clear(){for(const e of Object.values(y))e.button.remove();for(const e of Object.keys(y))delete y[e];return e}}))).extend((e=>({setLabel(t){S?.(),S=T.useManual((e=>e?.ariaLabel.bind(t?.text.state))),O=t?.for;for(const e of Object.values(y))e.button.setName(O);return t?.setInput(e),e}}))),h.onRooted(E),h.required.useManual(E),h;function E(){let e;!g.value&&h.required.value&&(e=e=>e["shared/form/invalid/required"]()),h.setCustomInvalidMessage(e),h.closest(r.default)?.refreshValidity()}}));t.RadioDropdown=o.default.Builder(((e,t)=>e.and(h,{createButton:l.default,...t}))).setName("RadioDropdown"),t.CheckDropdown=o.default.Builder(((e,t)=>e.and(h,{createButton:n.default,...t}))).setName("CheckDropdown")})),define("ui/utility/License",["require","exports","utility/Objects"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),t.LICENSES_NO_LINK=t.LICENSES=void 0,o=__importDefault(o),t.LICENSES=o.default.keys({"all-rights-reserved":!0,"cc-by":!0,"cc-by-sa":!0,"cc-by-nc":!0,"cc-by-nc-sa":!0,"cc-by-nd":!0,"cc-by-nc-nd":!0,cc0:!0,custom:!0}),t.LICENSES_NO_LINK=o.default.keys({"all-rights-reserved":!0,custom:!0})})),define("ui/component/LicenseFormFragment",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/Button","ui/component/core/Dropdown","ui/component/core/LabelledTextInputBlock","ui/utility/License"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const u=(0,i.RadioDropdown)().tweak((e=>{t&&e.add("inherit",{translation:e=>e=>e["shared/form/license/inherit"]()});for(const t of l.LICENSES)e.add(t,{translation:e=>e=>e[`license/${t}`](),tweakButton(e,t){e.style("license-input-dropdown-option"),"all-rights-reserved"!==t&&"custom"!==t&&e.style("license-input-dropdown-option--has-link").append((0,a.default)("a").attributes.use("href",(e=>e[`license/${t}/link`]())).attributes.set("target","_blank").and(n.default).style("license-input-dropdown-option-link-button").type("icon").setIcon("circle-question").ariaLabel.use("shared/form/license/link-view-text").event.subscribe("click",(e=>{e.stopPropagation()})))}});e.button.style("license-input-dropdown-button").event.subscribe("click",(t=>{e.button.element.scrollIntoView({behavior:"smooth"})}))}));let s,d;return e.label((e=>e.text.use("shared/form/license/label"))).content(((e,t)=>e.append(u.setLabel(t)))),(0,r.default)().style("labelled-row--in-labelled-table").ariaLabel.use("shared/form/license/aria-label").label((e=>e.text.use("shared/form/license/link"))).input((t=>s=t.setMaxLength(o.default.map(e,(e=>e?.license?.link))))).label((e=>e.text.use("shared/form/license/name"))).input((t=>d=t.setMaxLength(o.default.map(e,(e=>e?.license?.name))))).appendToWhen(u.selection.equals("custom"),e),{dropdown:u,customLinkInput:s,customNameInput:d,getFormData:()=>!(!u.selection.value||"inherit"===u.selection.value)&&("custom"===u.selection.value?{name:d.value,link:s.value}:{name:u.selection.value,link:""})}},o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),r=__importDefault(r)})),define("ui/component/SupportersOnlyLabel",["require","exports","ui/Component","ui/component/core/Label"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),t.default=o.default.Builder("label",(e=>e.and(a.default).style("label--supporter").prepend((0,o.default)().style("label-supporter","label-supporter--in-label").text.use("shared/term/supporters"))))})),define("ui/component/core/PrefixedInput",["require","exports","ui/Component","ui/component/core/ext/Input","ui/component/core/TextInput"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder(((e,t)=>{const i=(0,n.default)().style("prefixed-input-input").appendTo(e);return e.and(a.default).style("prefixed-input").append((0,o.default)().style("prefixed-input-prefix").text.use(t)).extend((e=>({input:i,required:i.required,hint:i.hint.rehost(e),maxLength:i.maxLength,length:i.length,invalid:i.invalid,hasPopover:i.hasPopover,getPopover:()=>i.getPopover(),disableDefaultHintPopoverVisibilityHandling:()=>(i.disableDefaultHintPopoverVisibilityHandling(),e),setMaxLength:t=>(i.setMaxLength(t),e),setRequired:t=>(i.setRequired(t),e),setLabel:t=>(i.setLabel(t),e),tweakPopover:t=>(i.tweakPopover(t),e),setCustomHintPopover:t=>(i.setCustomHintPopover(t),e),pipeValidity:t=>(i.pipeValidity(t),e),setCustomInvalidMessage:t=>(i.setCustomInvalidMessage(t),e),refreshValidity:()=>(i.refreshValidity(),e),state:i.state,value:void 0,default:i.default.rehost(e),placeholder:i.placeholder.rehost(e),ignoreInputEvent:(t=!0)=>(i.ignoreInputEvent(t),e),filter:t=>(i.filter(t),e),setReadonly:()=>(i.setReadonly(),e),setValidityHandler:t=>(i.setValidityHandler(t),e),wrap:()=>i.wrap()}))).extendMagic("value",(e=>({get:()=>i.value,set(e){i.value=e}})))}));t.default=i})),define("ui/component/VanityInput",["require","exports","ui/Component","ui/component/core/PrefixedInput","ui/component/core/TextInput"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),t.FilterVanity=void 0,o=__importDefault(o),a=__importDefault(a);const i=o.default.Builder((e=>e.and(a.default,"shared/prefix/vanity").filter(t.FilterVanity)));function r(e){return e.replace(/[\W_-]+/g,"-")}t.default=i,t.FilterVanity=(0,n.FilterFunction)(((e,t,o)=>(e=r(e),t=r(t),o=r(o),e||o?(e.startsWith("-")&&(e=e.slice(1)),e.endsWith("-")&&t.startsWith("-")&&(t=t.slice(1)),o.endsWith("-")&&(o=o.slice(0,-1)),t.endsWith("-")&&o.startsWith("-")&&(o=o.slice(1))):t=t.replace(/^-|-$/g,""),[e,t,o])))})),define("ui/view/account/AccountViewForm",["require","exports","endpoint/author/EndpointAuthorCreate","endpoint/author/EndpointAuthorUpdate","lang/en-nz","model/FormInputLengths","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Checkbutton","ui/component/core/ext/GradientText","ui/component/core/Form","ui/component/core/GradientInput","ui/component/core/LabelledTable","ui/component/core/LabelledTextInputBlock","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/core/toast/Toast","ui/component/LicenseFormFragment","ui/component/SupportersOnlyLabel","ui/component/VanityInput","ui/utility/License"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),b=__importDefault(b),_=__importStar(_),t.default=l.default.Builder("form",((e,t)=>{const k=e.and(u.default),T=k.and(c.default,k.title);T.viewTransition("account-form"),T.title.text.use(`view/account/${t}/title`),T.setName(n.default[`view/account/${t}/title`]().toString()),"create"===t&&T.description.text.use("view/account/create/description"),T.submit.textWrapper.text.use(`view/account/${t}/submit`);const x=(0,f.default)().appendTo(T.content),D=(0,g.default)().setRequired().default.bind(r.default.Auth.author.map(e,(e=>e?.name))).hint.use("view/account/name/hint").setMaxLength(i.default.map(x,(e=>e?.author?.name))),O=(0,l.default)().and(d.default).text.bind(D.state).style("text-input-display");x.label((e=>e.text.use("view/account/name/label"))).content(((e,t)=>e.append(D.setLabel(t).style("text-input--wrapped--hidden").wrap().append(O))));const S=(0,p.default)().default.bind(r.default.Auth.author.map(e,(e=>e?.supporter?.username_colours)));x.label((e=>e.and(b.default).text.use("view/account/vanity-colours/label"))).content(((e,t)=>e.append(S.setLabel(t)))),O.useGradient(S.value);const E=(0,_.default)().placeholder.bind(D.state.map(e,(e=>(0,_.FilterVanity)(e)))).default.bind(r.default.Auth.author.map(e,(e=>e?.vanity))).hint.use("view/account/vanity/hint").setMaxLength(i.default.map(x,(e=>e?.author?.vanity)));x.label((e=>e.text.use("view/account/vanity/label"))).content(((e,t)=>e.append(E.setLabel(t))));const M=(0,g.default)().default.bind(r.default.Auth.author.map(e,(e=>e?.pronouns))).hint.use("view/account/pronouns/hint").setMaxLength(i.default.map(x,(e=>e?.author?.pronouns)));x.label((e=>e.text.use("view/account/pronouns/label"))).content(((e,t)=>e.append(M.setLabel(t))));const I=(0,h.default)().default.bind(r.default.Auth.account.map(e,(e=>e?.description.body))).hint.use("view/account/description/hint").setMaxLength(i.default.map(x,(e=>e?.author?.description)));let C,R;x.label((e=>e.text.use("view/account/description/label"))).content(((e,t)=>e.append(I.setLabel(t)))),(0,m.default)().style("labelled-row--in-labelled-table").ariaLabel.use("view/account/external-link/label").label((e=>e.text.use("view/account/external-link/label"))).input((t=>C=t.default.bind(r.default.Auth.author.map(e,(e=>e?.support_link))).hint.use("view/account/external-link/hint").setMaxLength(i.default.map(x,(e=>e?.author?.support_link))))).label((e=>e.text.use("view/account/external-label/label"))).input((t=>R=t.default.bind(r.default.Auth.author.map(e,(e=>e?.support_message))).hint.use("view/account/external-label/hint").setMaxLength(i.default.map(x,(e=>e?.author?.support_message))))).appendTo(x);const P=(0,p.default)().default.bind(r.default.Auth.author.map(e,(e=>e?.supporter?.card_colours)));x.label((e=>e.and(b.default).text.use("view/account/card-colours/label"))).content(((e,t)=>e.append(P.setLabel(t)))),k.useGradient(P.value);const A=(0,y.default)(x);let j,N;return A.dropdown.default.bind(r.default.Auth.account.map(e,(e=>{const t=e?.license?.name;return t?w.LICENSES.includes(t)?t:"custom":"all-rights-reserved"}))),A.customLinkInput.default.bind(r.default.Auth.account.map(e,(e=>e?.license?.link))),A.customNameInput.default.bind(r.default.Auth.account.map(e,(e=>e?.license?.name))),x.label((e=>e.text.use("view/account/age/label"))).content(((e,t)=>{t.setRequired(),e.style("view-type-account-form-age-row"),j=(0,s.default)().text.use("view/account/age/option/sixteen-plus").setChecked(!!r.default.Auth.author.value).appendTo(e),N=(0,s.default)().text.use("view/account/age/option/eighteen-plus").setChecked("eighteen_plus"===r.default.Auth.account.value?.age).appendToWhen(j.checked,e),j.checked.use(e,(e=>{j.setCustomInvalidMessage(e?void 0:e=>e["view/account/age/invalid"]()),e||N.setChecked(!1)}))})),"create"===t&&x.label((e=>e.text.use("view/account/terms/label"))).content(((e,t)=>{t.setRequired();const o=(0,s.default)().text.use("view/account/terms/button").appendTo(e);o.checked.use(e,(e=>{o.setCustomInvalidMessage(e?void 0:e=>e["view/account/terms/invalid"]())}))})),T.onSubmit((async e=>{const n=j.checked.value?N.checked.value?"eighteen_plus":"sixteen_plus":void 0;if(!n)return;const i=await("create"===t?o.default:a.default).query({body:{name:D.value,vanity:E.value,description:I.useMarkdown(),pronouns:M.value,support_link:C.value,support_message:R.value,username_colours:S.value.value.slice(),card_colours:P.value.value.slice(),age:n,license:A.getFormData()}});toast.handleError(i,"view/account/toast/failed-to-save")||(toast.success(v.TOAST_SUCCESS,"view/account/toast/saved"),r.default.setAuthor(i.data))})),T}))})),define("endpoint/patreon/EndpointPatreonCampaignRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/patreon/campaign/remove","post")})),define("ui/view/account/AccountViewPatreonCampaign",["require","exports","endpoint/Endpoint","endpoint/patreon/EndpointPatreonCampaignRemove","model/Session","ui/Component","ui/component/auth/OAuthService","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/Slot","utility/Popup"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c);const f=(0,(p=__importDefault(p)).default)({translation:"view/account/patreon/campaign/popup/title",url:o.default.path("/auth/patreon/campaign/begin"),width:600,height:900});t.default=i.default.Builder(((e,t)=>{const o=e.and(l.default).style("view-type-account-patreon-campaign");o.title.text.use("view/account/patreon/campaign/title"),o.description.text.use("view/account/patreon/campaign/description");const p=n.default.Auth.account.map(o,(e=>e?.patreon_campaign??void 0));return(0,i.default)().style("view-type-account-patreon-campaign-oauth-row").append((0,r.default)(t,{authorisationState:p,onClick:async()=>(p.value?await async function(){if(!await s.default.prompt(e,{titleTranslation:"view/account/patreon/campaign/unlink/title",bodyTranslation:"view/account/patreon/campaign/unlink/description",confirmButtonTranslation:"view/account/patreon/campaign/unlink/confirm"}))return;await a.default.query(),await n.default.refresh()}():await m(),!0)}),(0,c.default)().use(p,((e,t)=>t&&(0,u.default)().style("view-type-account-patreon-campaign-oauth-row-relink-button").setIcon("rotate").event.subscribe("click",m)))).appendTo(o.content),(0,c.default)().use(p,((e,t)=>t&&(0,i.default)().style("view-type-account-patreon-campaign-tier-list-wrapper").append((0,d.default)().setAestheticStyle(!1).style("view-type-account-patreon-campaign-tier-list-heading").text.use("view/account/patreon/campaign/tiers")).append((0,i.default)().style("view-type-account-patreon-campaign-tier-list").append(...t.tiers.sort(((e,t)=>e.amount-t.amount)).map((e=>(0,i.default)().style("view-type-account-patreon-campaign-tier").append((0,i.default)().style("view-type-account-patreon-campaign-tier-amount").text.set(`$${(e.amount/100).toFixed(2)}`)).append((0,i.default)().style("view-type-account-patreon-campaign-tier-name").text.set(e.tier_name)))))))).appendTo(o.content),o;async function m(){await f.show(e).toastError(),await n.default.refresh()}}))})),define("endpoint/supporter/EndpointSupporterStatus",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/supporter/status","get")})),define("model/PagedData",["require","exports","ui/utility/EventManipulator","utility/Objects","utility/State"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n);const i=Object.assign((function(e){const t=(0,n.default)(void 0),i=(0,n.default)([],!1),r={pageCount:t,event:void 0,get pages(){return i.value.filter((e=>!(e instanceof Promise)))},rawPages:i,get(t){if(i.value[t]instanceof Promise)return i.value[t];const o=i.value[t]?.value;return void 0!==o&&!1!==o||(i.value[t]=Promise.resolve(e.get(t,r)).then((e=>{if(!n.default.is(i.value[t])){let o;n.default.is(e)?(o=(0,n.default)(null,!1),o.bindManual(e)):o=(0,n.default)(e,!1),i.value[t]=o,i.emit()}return i.value[t]})),i.emit()),i.value[t]},set(e,o,a){n.default.is(i.value[e])?i.value[e].value=o:i.value[e]=(0,n.default)(o,!1),a?i.value.length=t.value=e+1:void 0!==t.value&&e>=t.value&&(t.value=void 0),i.emit(),r.event.emit("SetPage",e,o)},unset(e,t=e){for(let o=e;o<=t;o++)delete i.value[o];i.emit(),r.event.emit("UnsetPages",e,t)},delete(e){i.value.splice(e,1),i.emit(),r.event.emit("DeletePage",e)},setPageCount(e){t.value=!0===e?void 0:e},clear(){i.value=[],t.value=void 0}};return(0,a.mutable)(r).event=(0,o.default)(r),r}),{fromEndpoint:function(e,t,o){const a=e,r={},l=i({async get(e){const i=await a.query(void 0,{page:e});if(404===i.code)return t?t(e):null;if(toast.handleError(i))return!1;if(o){const{content:e,auxiliary:t}=o(i.data);for(const[o,a]of Object.entries(t)){if(a===e)continue;const t=r[o]??=(0,n.default)([]),i=e;i[o]??=t,l[o]??=t,Object.assign(l,{aux:r}),Array.isArray(a)?t.value.push(...a):t.value.push(a),t.emit()}return e}return!Array.isArray(i.data)||i.data.length?i.data:t?t(e):null}});return l}});t.default=i})),define("model/PagedListData",["require","exports","model/PagedData","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=Object.assign((function(e,t){const i=(0,o.default)(t);return Object.assign(i,{pageSize:e,resized(t){const o=n(t,{get:l}),r=i.aux;if(r){const e=o;for(const[t,o]of Object.entries(r))e[t]=o}i.rawPages.subscribeManual((()=>{const e=o.rawPages.value;for(let t=0;t<e.length;t++){const n=e[t];if(a.default.is(n)){const u=n,s=l(t);function d(e){a.default.is(e)?u.bindManual(e):u.value=e,o.rawPages.emit()}s instanceof Promise?s.then(d):d(s);continue}const i=l(t);function r(n){const i=e[t]=(0,a.default)(null,!1);return a.default.is(n)?i.bindManual(n):i.value=n,o.rawPages.emit(),i}e[t]=i instanceof Promise?i.then(r):r(i),o.rawPages.emit()}}));return delete o.resized,o;function l(o){const n=o*t,r=(o+1)*t,l=Math.floor(n/e),s=Math.ceil(r/e),d=n%e,c=r%e||e,p=i.rawPages.value.slice();for(let e=l;e<s;e++){const t=p[e];e>=l&&e<s&&(!t||a.default.is(t)&&!1===t.value)&&(p[e]=i.get(e))}const f=p.slice(l,s);return f.some((e=>e instanceof Promise))?Promise.all(f).then((e=>u(e,d,c))):u(f,d,c)}function u(e,t,o){const n=[];for(let a=0;a<e.length;a++){const i=e[a];if(!1===i?.value)return!1;i?.value&&(0===a&&a===e.length-1?n.push(...i.value.slice(t,o)):0===a?n.push(...i.value.slice(t)):a===e.length-1?n.push(...i.value.slice(0,o)):n.push(...i.value))}return a.default.Generator((()=>n),!1).observeManual(...e)}}})}),{fromEndpoint:function(e,t,o){const i=t,r={},l=n(e,{async get(e,t){const n=await i.query(void 0,{page:e});if(404===n.code)return null;if(toast.handleError(n))return!1;if(t.setPageCount(n.page_count),o){const{content:e,auxiliary:t}=o(n.data);for(const[o,n]of Object.entries(t)){if(n===e)continue;const t=r[o]??=(0,a.default)([]),i=e;i[o]??=t,l[o]??=t,Object.assign(l,{aux:r}),Array.isArray(n)?t.value.push(...n):t.value.push(n),t.emit()}return e}return!Array.isArray(n.data)||n.data.length?n.data:null}});return l},fromArray:function(e,t){return n(e,{get(o,a){const n=o*e,i=(o+1)*e,r=t.slice(n,i);return r.length?(a.setPageCount(Math.ceil(t.length/e)),r):null}})}});t.default=n})),define("ui/component/core/ButtonRow",["require","exports","ui/Component","ui/component/core/Button"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),t.default=o.default.Builder((e=>{const t=(0,o.default)().style("button-row-content"),n=(0,a.default)().style("button-row-button");return e.style("button-row").append(t,n).extend((e=>({content:t,button:n})))}))})),define("ui/component/core/Details",["require","exports","ui/Component","ui/component/core/Button","utility/State"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder("details",(e=>{const t=(0,n.default)(!1),i=(0,o.default)("summary").and(a.default).appendTo(e),r=e.style("details").extend((e=>({state:t,summary:i})));return t.use(r,(e=>r.element.open=e)),r.event.subscribe("toggle",(e=>{t.value=e.host.element.open}))}));t.default=i})),define("ui/component/core/Paginator",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/Loading","ui/component/core/Popover","ui/component/core/Slot","ui/utility/MarkdownContent","ui/view/shared/ext/ViewTransition","utility/Async","utility/State","utility/string/Strings","utility/Style"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m);const h=o.default.Builder((e=>{const t=e.and(n.default),s=t.type.state.mapManual((e=>e.has("flush"))),h=m.default.measure("--masthead-height"),v=m.default.measure("--space-4");h.value,v.value,t.style.bind(s,"paginator--flush"),t.tweakJIT("header",(o=>{o.style("paginator-header").style.bind(s,"paginator-header--flush").style.bind(e.getStateForClosest(l.default).truthy,"paginator-header--within-popover"),t.content.style("paginator-content--has-header")}));const y=t.content.style("paginator-content").style.bind(s,"paginator-content--flush");t.footer;const b=(0,o.default)().style("paginator-after-anchor").appendTo(t),_=(0,p.default)(0),w=(0,p.default)(void 0,!1),k=w.mapManual((e=>e?.pageCount)),T=k.mapManual((e=>void 0===e)),x=k.mapManual((e=>void 0===e||e>1)),D=(0,p.default)(!1,!1);let O=Symbol();p.default.Use(e,{cursor:_,allData:w}).use(e,(async({cursor:t,allData:o})=>{if(!o)return D.value=!1;const a=O=Symbol(),n=await(o?.get(t));O===a&&D.bind(e,n)}));const S=_.mapManual((e=>e<=0)),E=p.default.Map(e,[_,k],((e,t)=>e+1>=(t??1/0)));function M(e){e.style("paginator-actions").style.bind(s,"paginator-actions--flush").style.bind(x.not,"paginator-actions--hidden"),e.left.style("paginator-actions-left"),e.right.style("paginator-actions-right"),e.middle.style("paginator-actions-middle"),(0,i.default)().setIcon("angles-left").type("icon").style("paginator-button").style.bind(S,"paginator-button--disabled").ariaLabel.use("paginator/first/label").event.subscribe("click",(()=>_.value=0)).appendTo(e.left),(0,i.default)().setIcon("angle-left").type("icon").style("paginator-button").style.bind(S,"paginator-button--disabled").ariaLabel.use("paginator/previous/label").event.subscribe("click",(()=>_.value=Math.max(_.value-1,0))).appendTo(e.left),(0,i.default)().setIcon("angle-right").type("icon").style("paginator-button").style.bind(E,"paginator-button--disabled").ariaLabel.use("paginator/next/label").event.subscribe("click",(()=>_.value=Math.min(_.value+1,void 0===k.value?1/0:k.value-1))).appendTo(e.right),(0,i.default)().setIcon("angles-right").type("icon").style("paginator-button").style.bind(E,"paginator-button--disabled").style.bind(T,"paginator-button--hidden").ariaLabel.use("paginator/last/label").event.subscribe("click",(()=>_.value=k.value?k.value-1:_.value)).appendTo(e.right)}let I,C,R,P,A;M(t.footer);const j=t.viewTransition("paginator").style("paginator").extend((e=>({headerActions:void 0,page:_,data:D,scrollAnchorBottom:b,set(t,o,a){I=a,G?.(),G=void 0,q?.(),q=void 0,P?.(),P=void 0,A?.(),A=void 0,_.setValueSilent(o),w.value=t,_.emit();const n=()=>_.emit();return t.event.subscribe("DeletePage",n),P=()=>t.event.unsubscribe("DeletePage",n),A=e.removed.matchManual(!0,P),this},orElse(e){return C=e,this},setScroll(e=!0){return R=e,this},getPages:()=>W,onReset:(e,t)=>e?w.use(e,(()=>t())):w.useManual((()=>t()))}))).extendJIT("headerActions",(e=>(0,a.default)().tweak(M).style("paginator-actions--header").style.bind(s,"paginator-actions--header--flush").prependTo(e)));let N,$,B,L,q,G;const W=[];return(0,u.default)().use(w,((o,a)=>{const n=(0,u.default)().appendTo(o);W.splice(0,1/0);const i=(e,t)=>{const o=W[t];o?.style.remove("paginator-page--initial-load","paginator-page--bounce").style("paginator-page--hidden").style.setVariable("page-direction",0),W.splice(t,1)};a?.event.subscribe("DeletePage",i),o.closed.matchManual(!0,(()=>a?.event.unsubscribe("DeletePage",i)));const r=(e,t,o)=>{for(let e=t;e<=o;e++)W[e]?.remove(),delete W[e]};let p;function m(o,a=!1){if(!o||!1===R)return;if(e.closest(l.default))return;const n=o>0?t.element:b.element;if(n)if("function"!=typeof R)if(o>0){const e=n.getBoundingClientRect().top+window.scrollY-h.value-v.value;window.scrollTo({top:e,behavior:a?"instant":"smooth"})}else{const e=n.getBoundingClientRect().top+window.scrollY+v.value-window.innerHeight;window.scrollTo({top:e,behavior:a?"instant":"smooth"})}else R(n,o>0?"forward":"backward",{scrollRect:new DOMRect(0,window.scrollY,window.innerWidth,document.documentElement.scrollHeight),scrollAnchorTopRect:t.element.getBoundingClientRect(),scrollAnchorBottomRect:b.element.getBoundingClientRect(),previousScrollRect:L,scrollAnchorTopPreviousRect:B,scrollAnchorBottomPreviousRect:$})}a?.event.subscribe("UnsetPages",r),o.closed.matchManual(!0,(()=>a?.event.unsubscribe("UnsetPages",r))),G?.(),G=_.use(o,(async(e,i)=>{if(p??=e,e===p)return void(p=!1);L=new DOMRect(0,window.scrollY,window.innerWidth,document.documentElement.scrollHeight),B=j.element.getBoundingClientRect(),$=b.element.getBoundingClientRect(),q?.(),q=void 0;const r=!W.length,l=W[e]??=function(e){const n=`paginator-page${f.default.uid()}`,i=(0,u.default)().style("paginator-page");function r(){return i.removeContents(),(0,u.default)().style.remove("slot").style("paginator-page-content").style.bind(s,"paginator-page-content--flush").subviewTransition(n).appendTo(i)}if(!a)return;F().appendTo(r());const l=a.get(e);return Promise.resolve(l).then((l=>{l.use(o,(async o=>{if(g(o))d.default.perform("subview",n,(async()=>{await(I?.(r(),o,e,a,j))}));else for(i.removeContents();!1===o;)j.event.emit("PageError",e),await new Promise((e=>{d.default.perform("subview",n,(()=>{U(e).appendTo(r())})),t.header.element.scrollIntoView()})),d.default.perform("subview",n,(()=>{F().appendTo(r())})),o=(await a.get(e)).value}))})),Object.assign(i,{content:l})}(e)?.appendTo(n),h=Math.sign(e-(i??e)),v=void 0===i?void 0:W[i];if(v?.style.remove("paginator-page--initial-load","paginator-page--bounce").style("paginator-page--hidden").style.setVariable("page-direction",h),l?.style.toggle(r,"paginator-page--initial-load").style.setVariable("page-direction",h),!a||!l)return;const y=await l.content;if(!1===y?.value||g(y?.value))return l.style.remove("paginator-page--hidden"),void m(h);if(void 0!==i){if(N===i)return;W[i]?.style("paginator-page--bounce"),m(-1,!0),await c.default.sleep(200),N=e,_.value=i}else{if(0===a.pageCount.value||a.pages.every((e=>!1===e.value||null===e.value||Array.isArray(e.value)&&!e.value.length)))return C?.(l,j),void l.style.remove("paginator-page--hidden")}}))})).appendTo(y),j;function U(e){return(0,o.default)().style("paginator-error").append((0,o.default)().style("paginator-error-text").text.use("paginator/error")).append((0,i.default)().type("primary").style("paginator-error-retry-button").text.use("paginator/error/retry").event.subscribe("click",(()=>e())))}function F(){return(0,o.default)().style("paginator-loading").append((0,r.default)().style("paginator-loading-flag"))}}));function g(e){if(null==e||!1===e)return!1;if("object"!=typeof e)return!0;if(Array.isArray(e))return e.length>0;for(const t of Object.values(e))if(g(t))return!0;return!1}s.default.handle(((e,t)=>{if(e.getAttribute("id")?.length)return()=>{const t=(0,o.default)().replaceElement(e,!0).style("link-anchor");t.onRooted((()=>{const e=t.getStateForClosest(h).map(t,(e=>e?.getPages().find((e=>e?.element.contains(t.element)))?.style.getState(t,"paginator-page--hidden"))),o=t.element.id;t.attributes.remove("id"),t.attributes.bind(e.falsy,"id",o)}))}})),t.default=h})),define("ui/component/core/Timestamp",["require","exports","ui/Component","utility/State","utility/Time"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder(((e,t)=>{let o,i=!1;const r=(0,a.default)(new Date(t??Date.now()));return r.use(e,l),e.style("timestamp").setTooltip((e=>e.text.set(r.value.toLocaleString(navigator.language,{dateStyle:"long",timeStyle:"short"})))).extend((e=>({time:r,setTranslation:t=>(o=t,e),setSimple:(t=!0)=>(i=t,e)}))).onRooted((e=>{l();const t=setInterval(l,n.default.seconds(1));e.removed.matchManual(!0,(()=>clearInterval(t)))}));function l(){const t=n.default.relative(r.value.getTime(),{components:i?1:2,secondsExclusive:!0});e.text.set(o?e=>o(e)(t):t)}}));t.default=i})),define("endpoint/patreon/EndpointPatreonPatronRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/patreon/patron/delete","post")})),define("ui/component/PatronAuthDialog",["require","exports","endpoint/Endpoint","endpoint/patreon/EndpointPatreonPatronRemove","model/Session","ui/component/auth/OAuthService","ui/component/auth/OAuthServices","ui/component/core/ConfirmDialog","utility/Popup","utility/State"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s);const d=(0,u.default)({translation:"view/chapter/dialog/patron/popup/title",url:o.default.path("/auth/patreon/patron/begin"),width:600,height:900});var c;!function(e){e.auth=function(e){return l.default.prompt(e,{titleTranslation:"view/chapter/dialog/patron/title",bodyTranslation:"view/chapter/dialog/patron/description",confirmButtonTranslation:"view/chapter/dialog/patron/done",cancelButtonTranslation:!1,async tweak(e){const t=n.default.Auth.account.map(e,(e=>e?.patreon_patron??void 0)),o=await(0,r.default)((0,s.default)("none"));(0,i.default)(o.data.patreon,{authorisationState:t,onClick:async()=>(t.value?await async function(){await a.default.query(),await n.default.refresh()}():await async function(){await d.show(e).toastError(),await n.default.refresh()}(),!0)}).appendTo(e.content)}})}}(c||(c={})),t.default=c})),define("ui/view/account/AccountViewSupporter",["require","exports","endpoint/supporter/EndpointSupporterStatus","model/PagedListData","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/ButtonRow","ui/component/core/Details","ui/component/core/Heading","ui/component/core/Loading","ui/component/core/Paginator","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Small","ui/component/core/Timestamp","ui/component/PatronAuthDialog","utility/Popup","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_);const w=(0,b.default)({translation:"view/account/supporter/popup/start/title",width:1e3,height:900}),k=(0,b.default)({translation:"view/account/supporter/popup/manage/title",width:1e3,height:900});t.default=i.default.Builder((e=>{const t=e.and(r.default);t.title.text.use("view/account/supporter/title"),t.description.text.use("view/account/supporter/description");const b=(0,h.default)().style.remove("slot").style("view-type-account-supporter").appendTo(t.content),T=_.default.Async.fromEndpoint(b,o.default.prep());return b.use(T.state,((e,t)=>{if(!t.settled)return(0,c.default)().use(T);if(t.error)return(0,i.default)().append((0,f.default)().text.use((e=>e["view/account/supporter/status/error"](t.error.message)))).append((0,l.default)().text.use("view/account/supporter/status/action/retry").event.subscribe("click",(()=>T.refresh())));(t.value.status||t.value.months_remaining)&&((0,i.default)().append((0,i.default)().useMarkdownContent("view/account/supporter/status/supporter")).append("has_active_subscription"!==t.value.status&&t.value.end_time?(0,f.default)().and(m.default).text.use((e=>e["view/account/supporter/status/end-date"]((0,v.default)(t.value.end_time).style.remove("timestamp")))):void 0).append(t.value.total_paid?(0,f.default)().style("view-type-account-supporter-status-total").text.use((e=>e["view/account/supporter/status/total"]((t.value.total_paid/100).toFixed(2)))):void 0).appendTo(e),t.value.patreon_subscriptions.length&&(0,p.default)().type("flush").style("view-type-account-supporter-order-paginator").tweak((e=>e.title.text.use("view/account/supporter/order/list-title/patreon"))).tweak((e=>e.header.style("view-type-account-supporter-order-paginator-header").append((0,l.default)().setIcon("rotate").type("flush").event.subscribe("click",(async()=>{T.refresh()}))))).tweak((e=>e.content.style("view-type-account-supporter-order-paginator-content"))).tweak((e=>e.footer.style("view-type-account-supporter-order-paginator-footer"))).set(a.default.fromArray(25,t.value.patreon_subscriptions),0,((e,t)=>{e.style("view-type-account-supporter-order-list");const o=()=>(0,i.default)().style("view-type-account-supporter-order-list-header-label"),a=()=>o().style("view-type-account-supporter-order-list-header-amount");(0,i.default)().style("view-type-account-supporter-order-list-header").style("view-type-account-supporter-order").append(o().text.use("view/account/supporter/order/label/timestamp")).append(a().text.use("view/account/supporter/order/label/amount")).append(o()).append(o().text.use("view/account/supporter/order/label/status")).append(a().text.use("view/account/supporter/order/label/total")).appendTo(e);for(const o of t){const t="https://www.patreon.com/settings/memberships/fluff4me";(0,i.default)("a").attributes.set("href",t).attributes.set("target","_blank").style("view-type-account-supporter-order","view-type-account-supporter-order--patreon").append((0,v.default)(o.timestamp).setSimple().style("view-type-account-supporter-order-date")).append((0,i.default)().style("view-type-account-supporter-order-amount-value").text.use((e=>e["view/account/supporter/order/amount/subscription/value"](o.interval_amount?(o.interval_amount/100).toFixed(2):"?"))),(0,i.default)().style("view-type-account-supporter-order-amount-unit").text.use((e=>e["view/account/supporter/order/amount/subscription/unit"](!1)))).append((0,i.default)()).append((0,i.default)().style("view-type-account-supporter-order-status").text.use((e=>o.renewal_timestamp?e["view/account/supporter/order/renews"]((0,v.default)(o.renewal_timestamp).setSimple().style.remove("timestamp")):e["view/account/supporter/order/status"](o.status)))).append((0,i.default)().and(g.default).style("view-type-account-supporter-order-amount-value").text.use((e=>e["view/account/supporter/order/amount/total/value"]((o.amount/100).toFixed(2)))),(0,i.default)().and(g.default).style("view-type-account-supporter-order-amount-unit").text.use("view/account/supporter/order/amount/total/unit")).event.subscribe("click",(async e=>{e.preventDefault(),await k.show(e.host,{url:t}).toastError(),T.refresh()})).appendTo(e)}})).appendTo(e));const o=!!t.value.months_remaining||!!t.value.patreon_subscriptions.length||"has_active_subscription"===t.value.status,r=(0,s.default)().appendTo(e);r.summary.type("primary").text.use("view/account/supporter/action/add-plan"),r.state.value=!o,o||r.summary.style("view-type-account-supporter-add-plan-button--hidden"),o&&(0,f.default)().appendTo(r);const h=(0,i.default)().style("view-type-account-supporter-product-list").appendTo(r),b=["monthly","yearly","founder"];for(let e=0;e<b.length;e++){const t=b[e];"yearly"===t&&(0,f.default)().and(g.default).style("view-type-account-supporter-product-special-plans-hint").useMarkdownContent("view/account/supporter/product/special-plans-hint").appendTo(h);const o={monthly:"https://www.patreon.com/checkout/fluff4me?rid=25959404&slug=fluff4me",yearly:"https://www.patreon.com/checkout/fluff4me?rid=26004082&slug=fluff4me",founder:"https://www.patreon.com/checkout/fluff4me?rid=26004089&slug=fluff4me"}[t];(0,i.default)("a").and(l.default).attributes.set("href",o).attributes.set("target","_blank").style("view-type-account-supporter-product").style.setVariable("colour-rotation-index",e).event.subscribe("click",(async e=>{e.preventDefault(),await w.show(e.host,{url:o}).toastError(),T.refresh()})).append((0,d.default)().setAestheticStyle(!1).style("view-type-account-supporter-product-title").tweak((e=>e.textWrapper.remove())).append((0,i.default)().style("view-type-account-supporter-product-name").text.use(`view/account/supporter/product/${t}/name`)).append((0,i.default)().style("view-type-account-supporter-product-price").text.use(`view/account/supporter/product/${t}/default-price`))).append((0,f.default)().style("view-type-account-supporter-product-description").text.use("founder"===t?e=>e["view/account/supporter/product/founder/description"]():`view/account/supporter/product/${t}/description`)).appendTo(h)}t.value.patreon_subscriptions.length||(0,u.default)().style("view-type-account-supporter-patreon-row").tweak((e=>e.content.append((0,i.default)().text.use("view/account/supporter/already-patron-hint")))).tweak((t=>t.button.setIcon("patreon").style("view-type-account-supporter-patreon-row-button").text.bind(n.default.Auth.account.map(e,(e=>e?.patreon_patron?t=>t["view/chapter/action/unlink-patreon"](e.patreon_patron.display_name):e=>e["view/chapter/action/auth-to-patreon"]()))).event.subscribe("click",(async()=>{await y.default.auth(e),T.refresh()})))).appendTo(e)})),(0,i.default)().style("view-type-account-supporter-about").append((0,d.default)().text.use("view/account/supporter/about/title")).append((0,i.default)().useMarkdownContent("document/about-supporters")).appendTo(t.content),e}))})),define("endpoint/auth/EndpointTOTPCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/totp/create","post")})),define("endpoint/auth/EndpointTOTPDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/totp/delete","post")})),define("endpoint/auth/EndpointTOTPEnable",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/totp/enable","post")})),define("ui/component/core/CodeInput",["require","exports","ui/Component","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=o.default.Builder(((e,t=6)=>{e.style("code-input");const n=[],i=a.default.JIT((()=>n.map((e=>e.element.value.trim())).join("")));for(let a=0;a<t;a++){const r=(0,o.default)("input").style("code-input-input","text-input").attributes.set("type","text").attributes.set("inputmode","numeric").attributes.set("maxlength","1").attributes.set("autocomplete","one-time-code").attributes.set("size","1").event.subscribe("focus",(e=>e.host.element.select())).event.subscribe("paste",(e=>{e.preventDefault();const o=e.clipboardData?.getData("text");if(o&&new RegExp(`^\\d{${t}}`).test(o)){for(let e=0;e<t;e++)n[e].element.value=o[e];i.markDirty()}})).event.subscribe("input",(e=>{const t=e.host.element;!t.value.length||t.value.match(/^\d$/)?(t.value.length&&n[a+1]?.focus(),i.markDirty()):t.value=""})).event.subscribe("keydown",(t=>{if("ArrowLeft"===t.key){t.preventDefault();const e=n[a-1];return e?.focus(),void e?.element.select()}if("ArrowRight"===t.key){t.preventDefault();const e=n[a+1];return e?.focus(),void e?.element.select()}const o=t.host.element;if("Backspace"===t.key){if(o.value.trim())return o.value="",void i.markDirty();const e=n[a-1];if(!e)return;return e.focus(),e.element.select(),e.element.value="",void i.markDirty()}if("Delete"===t.key){if(o.value.trim())return o.value="",void i.markDirty();const e=n[a+1];if(!e)return;return e.focus(),e.element.select(),e.element.value="",void i.markDirty()}if("Enter"===t.key)return t.preventDefault(),void e.cast().event.emit("Enter")})).appendTo(e);n.push(r)}return e.extend((e=>({state:i,valid:i.mapManual((e=>e.length===t)),clear(){for(const e of n)e.element.value="";i.markDirty()}})))}));t.default=n})),define("ui/view/account/AccountViewTOTP",["require","exports","endpoint/auth/EndpointTOTPCreate","endpoint/auth/EndpointTOTPDelete","endpoint/auth/EndpointTOTPEnable","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/CodeInput","ui/component/core/ConfirmDialog","ui/component/core/Loading","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/TextInput","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),t.default=r.default.Builder(((e,t)=>{const g=e.and(l.default).style("view-type-account-totp");g.title.text.use("view/account/totp/title"),"disabled"===t.value?.author?.totp_state&&delete t.value.author.totp_state;const v=(0,h.default)(!1),y=h.default.Map(g,[t,v],((e,t)=>{if(!e)return;if(!e.author)return e.partial_login?.totp_required?"login":void 0;const o=e.author.totp_state;return"enabled"===o?"secured":"disabled"!==o?"none":t?"enter":"starting"}));g.content.style.bindFrom(y.mapManual((e=>e?`view-type-account-totp-content--state-${e}`:void 0)));const b=(0,r.default)().style("view-type-account-totp-content-guide").append((0,p.default)().append((0,f.default)().text.bind(y.mapManual((e=>e?t=>t[`view/account/totp/${e}/description`]():""))))).appendTo(g.content);(0,u.default)().type("primary").text.use("view/account/totp/none/action/setup").event.subscribe("click",(async()=>{if("none"!==y.value)return;const e=await o.default.query();if(toast.handleError(e))return;const t=i.default.state.value?.author;if(!t)return;const a=e.data.uri,n=new URL(a).searchParams.get("secret");n&&(t.totp_state="disabled",i.default.state.emit(),T.value=!0,w.value=n,_.value=await QRCode.toDataURL(a,{color:{dark:"#fff",light:"#0000"}}))})).appendToWhen(y.equals("none"),g.footer.right);const _=(0,h.default)(void 0),w=(0,h.default)(void 0);(0,c.default)().style("view-type-account-totp-qrcode").appendToWhen(h.default.Every(e,y.equals("starting"),_.falsy),g.content),(0,r.default)("img").attributes.bind("src",_).style("view-type-account-totp-qrcode").appendToWhen(h.default.Every(e,y.equals("starting"),_.truthy),g.content);const k=h.default.Every(e,y.equals("starting"),w.truthy),T=(0,h.default)(!0);(0,p.default)().append((0,f.default)().text.use("view/account/totp/starting/or-enter-key")).append((0,u.default)().type("inline","primary").text.bind(T.mapManual((e=>t=>t[e?"view/account/totp/starting/action/reveal-key":"view/account/totp/starting/action/hide-key"]()))).event.subscribe("click",(()=>T.value=!T.value))).appendToWhen(k,b),(0,m.default)().style("view-type-account-totp-key").attributes.bind(T,"inert").style.bind(T,"view-type-account-totp-key--disabled").placeholder.use("view/account/totp/starting/key-placeholder").setReadonly().tweak((e=>h.default.UseManual({keyHidden:T,secret:w}).useManual((({secret:t,keyHidden:o})=>e.value=o?"":t??"")))).appendToWhen(k,b),(0,u.default)().text.use("view/account/totp/starting/action/cancel").event.subscribe("click",(async()=>{if("starting"!==y.value)return;const e=await a.default.query();if(toast.handleError(e))return;const t=i.default.state.value?.author;t&&(delete t.totp_state,i.default.state.emit(),v.value=!1,_.value=void 0,w.value=void 0)})).appendToWhen(y.equals("starting"),g.footer.right),(0,u.default)().type("primary").text.use("view/account/totp/starting/action/continue").event.subscribe("click",(()=>{"starting"===y.value&&(v.value=!0)})).appendToWhen(y.equals("starting"),g.footer.right);const x=(0,s.default)().event.subscribe("Enter",(()=>D.element.click())).appendToWhen(y.equals("enter"),g.content);(0,u.default)().text.use("view/account/totp/enter/action/cancel").event.subscribe("click",(async()=>{if("enter"!==y.value)return;const e=await a.default.query();if(toast.handleError(e))return;const t=i.default.state.value?.author;t&&(delete t.totp_state,i.default.state.emit(),v.value=!1,_.value=void 0,w.value=void 0,x.clear())})).appendToWhen(y.equals("enter"),g.footer.right);const D=(0,u.default)().type("primary").text.use("view/account/totp/enter/action/enable").bindDisabled(x.valid.falsy,"invalid code").event.subscribe("click",(async()=>{if("enter"!==y.value)return;if(!x.valid.value)return;if(!await d.default.ensureDangerToken(e,{dangerToken:"totp-enable"}))return;const t=await n.default.query({body:{token:x.state.value}});if(toast.handleError(t))return;const o=i.default.state.value?.author;o&&(o.totp_state="enabled",i.default.state.emit())})).appendToWhen(y.equals("enter"),g.footer.right);return(0,u.default)().text.use("view/account/totp/secured/action/disable").event.subscribe("click",(async()=>{if("secured"!==y.value)return;if(!await d.default.ensureDangerToken(e,{dangerToken:"totp-delete"}))return;const t=await a.default.query();toast.handleError(t)||(delete i.default.state.value?.author?.totp_state,i.default.state.emit(),v.value=!1,_.value=void 0,w.value=void 0,x.clear())})).appendToWhen(y.equals("secured"),g.footer.right),g}))})),define("ui/view/AccountView",["require","exports","endpoint/auth/EndpointAuthSetRequiredCount","endpoint/author/EndpointAuthorDelete","model/Session","ui/component/auth/OAuthServices","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/RangeInput","ui/component/core/Slot","ui/component/core/Tabinator","ui/view/account/AccountViewForm","ui/view/account/AccountViewPatreonCampaign","ui/view/account/AccountViewSupporter","ui/view/account/AccountViewTOTP","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Errors","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importStar(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T);const x=k.default.redirection("/login");t.default=(0,w.default)({async load(){if("logged-in"!==n.default.Auth.state.value)return x();return{services:await(0,i.default)(n.default.Auth.state)}},create({tab:e}={},{services:t}){const i="account",w=(0,_.default)(i),k=n.default.Auth.state;n.default.Auth.author.use(w,(e=>w.breadcrumbs.setBackButton(e?.vanity?`/author/${e.vanity}`:void 0,(t=>t.subText.set(e?.name)))));const x=(0,h.default)().appendTo(w.content);return(0,h.Tab)("profile").setIcon("circle-user").text.use("view/account/tab/profile").tweak((e=>(0,g.default)("update").subviewTransition(i).appendTo(e.content))).addTo(x),(0,h.Tab)("patreon").setIcon("patreon").text.use("view/account/tab/patreon").tweak((e=>(0,m.default)().use(k,((e,o)=>"logged-in"===o&&(0,v.default)(t.data.patreon).subviewTransition(i))).appendTo(e.content))).addTo(x),(0,h.Tab)("supporter").setIcon("heart").text.use("view/account/tab/supporter").tweak((e=>(0,y.default)().appendTo(e.content))).addTo(x),(0,h.Tab)("security").setIcon("shield-halved").text.use("view/account/tab/security").tweak((e=>{t.subviewTransition(i).appendTo(e.content);const a=n.default.state.map(t,(e=>e?.author?.authorisations?.length??1)),r=n.default.state.map(t,(e=>e?.author?.auth_services_required??1));(0,m.default)().appendTo(t.content).use(T.default.UseManual({availableCount:a,requiredCount:r}),((e,{availableCount:t,requiredCount:a})=>{if(t<=1)return;(0,s.default)().style("view-type-account-oauth-services-mfa-heading").text.use("view/account/auth/logged-in/mfa/title").appendTo(e),(0,p.default)().text.use("view/account/auth/logged-in/mfa/description").appendTo((0,c.default)().appendTo(e));const i=(0,d.default)().style("view-type-account-oauth-services-mfa-required-count-row").appendTo(e);i.label.text.use("view/account/auth/logged-in/mfa/label/required-count");const r=(0,f.default)(1,t).default.set(a).appendTo(i.content.style("view-type-account-oauth-services-mfa-required-count-row-content"));(0,l.default)().type("primary").text.use("view/account/auth/logged-in/mfa/action/save").bindDisabled(r.state.mapManual((e=>!e||e===a)),"no change").event.subscribe("click",(async()=>{const e=r.state.value??1;if(e<a&&!await u.default.ensureDangerToken(i,{dangerToken:"decrease-auth-service-count-required"}))return;const t=await o.default.query({body:{required_count:r.state.value??1}});toast.handleError(t)||(n.default.state.value?.author&&(n.default.state.value.author.auth_services_required=e,n.default.state.emit()),n.default.refresh())})).appendTo(i.content)})),(0,b.default)(n.default.state).subviewTransition(i).appendToWhen(n.default.Auth.loggedIn,e.content)})).addTo(x),(0,h.Tab)("more").setIcon("ellipsis-vertical").tweak((e=>e.icon?.style("button-icon--unpad-left"))).text.use("view/account/tab/more").tweak((e=>(0,m.default)().use(k,(e=>e.append((0,r.default)().style("view-type-account-more-row").tweak((e=>e.left.append((0,l.default)().text.use("view/account/action/logout").event.subscribe("click",(()=>n.default.reset())))))).append((0,r.default)().style("view-type-account-more-row").tweak((e=>e.left.append((0,l.default)().text.use("view/account/action/delete").event.subscribe("click",(async()=>{if(!await u.default.prompt(w,{dangerToken:"delete-account",bodyTranslation:"view/account/action/delete/confirm"}))return;const e=await a.default.query();return toast.handleError(e)?void 0:n.default.reset()})))))))).appendTo(e.content))).addTo(x),x.bindURL(e,(e=>e?`/account/${e}`:"/account")),k.equals("logged-in").match(w,!1,(()=>navigate.toURL("/login"))),w}})})),define("endpoint/author/EndpointAuthorGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/author/{vanity}/get","get")})),define("endpoint/work/EndpointWorkGetAllAuthor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/works/{author}","get")})),define("endpoint/moderation/EndpointModerateAuthorCensor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/moderation/author/{vanity}/censor","post")})),define("endpoint/moderation/EndpointModerateAuthorDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/moderation/author/{vanity}/delete","post")})),define("endpoint/moderation/EndpointModerateAuthorGrantSupporter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/moderation/author/{vanity}/grant-supporter","post")})),define("endpoint/report/EndpointReportAuthor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/report/author/{vanity}","post")})),define("endpoint/follow/EndpointFollowAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default={Author:(0,o.default)("/follow/author/{id}","post"),Work:(0,o.default)("/follow/work/{id}","post"),Tag:(0,o.default)("/follow/tag/{id}","post"),Category:(0,o.default)("/follow/category/{id}","post")}})),define("endpoint/follow/EndpointFollowAddWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/follow/work/{author}/{vanity}","post")})),define("endpoint/follow/EndpointFollowGetManifest",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/following","get")})),define("endpoint/follow/EndpointFollowRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default={Author:(0,o.default)("/unfollow/author/{id}","post"),Work:(0,o.default)("/unfollow/work/{id}","post"),Tag:(0,o.default)("/unfollow/tag/{id}","post"),Category:(0,o.default)("/unfollow/category/{id}","post")}})),define("endpoint/follow/EndpointFollowRemoveWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/unfollow/work/{author}/{vanity}","post")})),define("endpoint/follow/EndpointIgnoreAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default={Author:(0,o.default)("/ignore/author/{id}","post"),Work:(0,o.default)("/ignore/work/{id}","post"),Tag:(0,o.default)("/ignore/tag/{id}","post"),Category:(0,o.default)("/ignore/category/{id}","post")}})),define("endpoint/follow/EndpointIgnoreAddWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/ignore/work/{author}/{vanity}","post")})),define("endpoint/follow/EndpointIgnoreRemove",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default={Author:(0,o.default)("/unignore/author/{id}","post"),Work:(0,o.default)("/unignore/work/{id}","post"),Tag:(0,o.default)("/unignore/tag/{id}","post"),Category:(0,o.default)("/unignore/category/{id}","post")}})),define("endpoint/follow/EndpointIgnoreRemoveWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/unignore/work/{author}/{vanity}","post")})),define("ui/utility/PageListener",["require","exports","utility/State"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.visible=(0,o.default)("visible"===document.visibilityState),document.addEventListener("visibilitychange",(()=>e.visible.asMutable?.setValue("visible"===document.visibilityState)))}(a||(a={})),t.default=a})),define("model/Manifest",["require","exports","model/Session","ui/utility/PageListener","utility/State","utility/Time"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),t.default=function(e){let t,r,l;const u=(0,n.default)(void 0,!1);let s=!1;c();const d=Object.assign(u,{isFresh:t=>!!t&&(Date.now()-(c()?.time??0)<e.valid||!a.default.visible.value),getManifest:async a=>s||!a&&d.isFresh(u.value)?u.value:!e.requiresAuthor||o.default.Auth.loggedIn.value?t??=(async()=>{try{const t=await e.get();if(t instanceof Error)throw t;r=Date.now(),u.value=t.data,p()}catch(t){if(!e.orElse)throw t;r=Date.now(),u.value=e.orElse()}return t=void 0,u.value})():void 0});return e.refresh&&setInterval((async()=>{if(d.isFresh(u.value))return;const t=`manifest:last-fetch-attempt:${e.cacheId}`,o=+localStorage.getItem(t)||0;Date.now()-o<i.default.seconds(60)||(localStorage.setItem(t,`${Date.now()}`),await d.getManifest(!0),localStorage.setItem(t,`${Date.now()}`))}),100),d;function c(){if(!e.cacheId)return;const t=localStorage.getItem(`manifest:${e.cacheId}`);if(t)try{const e=JSON.parse(t);if(!e||!("time"in e)||!("data"in e))return;const o=+e.time||0;return r===o?{time:r,data:u.value}:(s=!0,r=o,u.value=e.data,{time:o,data:u.value})}catch(e){return void console.log(e)}finally{s=!1,p()}}function p(){e.cacheId&&(l?.(),l=u.useManual((t=>{s||localStorage.setItem(`manifest:${e.cacheId}`,JSON.stringify({time:r,data:t}))})))}}})),define("endpoint/work/EndpointWorkDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/delete","post")})),define("utility/Enums",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.type=function(){return{values:(...e)=>e.distinctInPlace()}}}(o||(o={})),t.default=o})),define("model/Works",["require","exports","endpoint/work/EndpointWorkDelete","ui/component/core/ConfirmDialog","utility/Enums"],(function(e,t,o,a,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.WORK_STATUS_ICONS=t.WORK_STATUSES=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.WORK_STATUSES=n.default.type().values("Complete","Ongoing","Hiatus","Cancelled"),t.WORK_STATUS_ICONS={Cancelled:"circle-xmark",Complete:"circle-check",Ongoing:"circle-play",Hiatus:"circle-pause"},function(e){e.resolve=function(e,t){return e?t.find((t=>t.author===e.author&&t.vanity===e.vanity)):void 0},e.equals=function(e,t){return!!e&&!!t&&e.author===t.author&&e.vanity===t.vanity},e.reference=function(e){return e?{author:e.author,vanity:e.vanity}:null}}(i||(i={})),t.default=Object.assign(i,{async delete(e,t){if(!e)return!0;if(!await a.default.prompt(t??null,{dangerToken:"delete-work",bodyTranslation:t=>t["work/action/delete/confirm"](e.name)}))return!1;const n=await o.default.query({params:e});return!toast.handleError(n)&&(navigate.isURL(`/work/${e.author}/${e.vanity}/**`)&&navigate.toURL(`/author/${e.author}`),!0)}})})),define("model/Follows",["require","exports","endpoint/follow/EndpointFollowAdd","endpoint/follow/EndpointFollowAddWork","endpoint/follow/EndpointFollowGetManifest","endpoint/follow/EndpointFollowRemove","endpoint/follow/EndpointFollowRemoveWork","endpoint/follow/EndpointIgnoreAdd","endpoint/follow/EndpointIgnoreAddWork","endpoint/follow/EndpointIgnoreRemove","endpoint/follow/EndpointIgnoreRemoveWork","model/Manifest","model/Works","utility/Time"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f);const m=(0,c.default)({valid:f.default.minutes(5),refresh:!0,cacheId:"follows",requiresAuthor:!0,get:()=>n.default.query(),orElse:()=>({following:{work:[],author:[],tag:[],category:[]},ignoring:{work:[],author:[],tag:[],category:[]}})}),h={getTotalFollowing:()=>0+(m.value?.following.author?.length??0)+(m.value?.following.work?.length??0)+(m.value?.following.tag?.length??0)+(m.value?.following.category?.length??0),getTotalIgnoring:()=>0+(m.value?.ignoring.author?.length??0)+(m.value?.ignoring.work?.length??0)+(m.value?.ignoring.tag?.length??0)+(m.value?.ignoring.category?.length??0),followingAuthor:e=>!!m.value?.following.author?.some((t=>t.author===e)),ignoringAuthor:e=>!!m.value?.ignoring.author?.some((t=>t.author===e)),async toggleFollowingAuthor(e){h.followingAuthor(e)?await h.unfollowAuthor(e):await h.followAuthor(e)},async followAuthor(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(h.followingAuthor(e))return;const t=await o.default.Author.query({params:{id:e}});toast.handleError(t)||(m.value.ignoring.author?.filterInPlace((t=>t.author!==e)),m.value.following.author?.push({author:e,updated:(new Date).toISOString()}),m.emit())},async unfollowAuthor(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!h.followingAuthor(e))return;const t=await i.default.Author.query({params:{id:e}});toast.handleError(t)||(m.value.following.author?.filterInPlace((t=>t.author!==e)),m.emit())},async toggleIgnoringAuthor(e){h.ignoringAuthor(e)?await h.unignoreAuthor(e):await h.ignoreAuthor(e)},async ignoreAuthor(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(h.ignoringAuthor(e))return;const t=await l.default.Author.query({params:{id:e}});toast.handleError(t)||(m.value.following.author?.filterInPlace((t=>t.author!==e)),m.value.ignoring.author?.push({author:e,updated:(new Date).toISOString()}),m.emit())},async unignoreAuthor(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!h.ignoringAuthor(e))return;const t=await s.default.Author.query({params:{id:e}});toast.handleError(t)||(m.value.ignoring.author?.filterInPlace((t=>t.author!==e)),m.emit())},followingWork:e=>!!m.value?.following.work?.some((t=>p.default.equals(t.work,e))),ignoringWork:e=>!!m.value?.ignoring.work?.some((t=>p.default.equals(t.work,e))),async toggleFollowingWork(e){h.followingWork(e)?await h.unfollowWork(e):await h.followWork(e)},async followWork(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(h.followingWork(e))return;const t=await a.default.query({params:{author:e.author,vanity:e.vanity}});toast.handleError(t)||(m.value.ignoring.work?.filterInPlace((t=>!p.default.equals(t.work,e))),m.value.following.work?.push({work:p.default.reference(e),updated:(new Date).toISOString()}),m.emit())},async unfollowWork(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!h.followingWork(e))return;const t=await r.default.query({params:{author:e.author,vanity:e.vanity}});toast.handleError(t)||(m.value.following.work?.filterInPlace((t=>!p.default.equals(t.work,e))),m.emit())},async toggleIgnoringWork(e){h.ignoringWork(e)?await h.unignoreWork(e):await h.ignoreWork(e)},async ignoreWork(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(h.ignoringWork(e))return;const t=await u.default.query({params:{author:e.author,vanity:e.vanity}});toast.handleError(t)||(m.value.following.work?.filterInPlace((t=>!p.default.equals(t.work,e))),m.value.ignoring.work?.push({work:p.default.reference(e),updated:(new Date).toISOString()}),m.emit())},async unignoreWork(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!h.ignoringWork(e))return;const t=await d.default.query({params:{author:e.author,vanity:e.vanity}});toast.handleError(t)||(m.value.ignoring.work?.filterInPlace((t=>!p.default.equals(t.work,e))),m.emit())},followingTag:e=>!!m.value?.following.tag?.some((t=>t.tag===e)),ignoringTag:e=>!!m.value?.ignoring.tag?.some((t=>t.tag===e)),async toggleFollowingTag(e){h.followingTag(e)?await h.unfollowTag(e):await h.followTag(e)},async followTag(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(h.followingTag(e))return;const t=await o.default.Tag.query({params:{id:e}});toast.handleError(t)||(m.value.ignoring.tag?.filterInPlace((t=>t.tag!==e)),m.value.following.tag?.push({tag:e,updated:(new Date).toISOString()}),m.emit())},async unfollowTag(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!h.followingTag(e))return;const t=await i.default.Tag.query({params:{id:e}});toast.handleError(t)||(m.value.following.tag?.filterInPlace((t=>t.tag!==e)),m.emit())},async toggleIgnoringTag(e){h.ignoringTag(e)?await h.unignoreTag(e):await h.ignoreTag(e)},async ignoreTag(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(h.ignoringTag(e))return;const t=await l.default.Tag.query({params:{id:e}});toast.handleError(t)||(m.value.following.tag?.filterInPlace((t=>t.tag!==e)),m.value.ignoring.tag?.push({tag:e,updated:(new Date).toISOString()}),m.emit())},async unignoreTag(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!h.ignoringTag(e))return;const t=await s.default.Tag.query({params:{id:e}});toast.handleError(t)||(m.value.ignoring.tag?.filterInPlace((t=>t.tag!==e)),m.emit())},followingCategory:e=>m.value?.following.category?.some((t=>t.tag_category===e)),ignoringCategory:e=>m.value?.ignoring.tag?.some((t=>t.tag_category===e)),async toggleFollowingCategory(e){h.followingCategory(e)?await h.unfollowCategory(e):await h.followCategory(e)},async followCategory(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(h.followingCategory(e))return;const t=await o.default.Category.query({params:{id:e}});toast.handleError(t)||(m.value.ignoring.category?.filterInPlace((t=>t.tag_category!==e)),m.value.following.category?.push({tag_category:e,updated:(new Date).toISOString()}),m.emit())},async unfollowCategory(e){if(!m.value)return void console.warn("Cannot modify follows state, not loaded yet");if(!h.followingCategory(e))return;const t=await i.default.Category.query({params:{id:e}});toast.handleError(t)||(m.value.following.category?.filterInPlace((t=>t.tag_category!==e)),m.emit())},async toggleIgnoringCategory(e){h.ignoringCategory(e)?await h.unignoreCategory(e):await h.ignoreCategory(e)},async ignoreCategory(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(h.ignoringCategory(e))return;const t=await l.default.Category.query({params:{id:e}});toast.handleError(t)||(m.value.following.category?.filterInPlace((t=>t.tag_category!==e)),m.value.ignoring.category?.push({tag_category:e,updated:(new Date).toISOString()}),m.emit())},async unignoreCategory(e){if(!m.value)return void console.warn("Cannot modify ignores state, not loaded yet");if(!h.ignoringCategory(e))return;const t=await s.default.Category.query({params:{id:e}});toast.handleError(t)||(m.value.ignoring.category?.filterInPlace((t=>t.tag_category!==e)),m.emit())}};t.default=Object.assign(m,h)})),define("ui/component/core/ExternalLink",["require","exports","navigation/RoutePath","ui/Component","ui/InputBus","ui/utility/MarkdownContent","utility/Env"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=a.default.Builder("a",((e,t)=>{e.and(n.HandlesMouseEvents).style("link","link-external").style.bind(e.attributes.get("href").truthy,"link-external--has");const o=(0,a.default)().appendTo(e),i=o.text.state.mapManual((e=>!!e&&e!==t&&/^https?:?\/\/?/.test(e)));return e.style.bind(i,"link-external--is-masked").extendJIT("text",(e=>o.text.rehost(e))),void 0!==t&&e.attributes.set("href",t),(0,a.default)().style("link-external-real-domain","link-external--has").text.bind(e.attributes.get("href").mapManual((e=>`[${e}]`))).appendToWhen(i,e),e}));i.default.handle(((e,t)=>{if("A"!==e.tagName)return;let n=e.getAttribute("href");return n?.startsWith(r.default.URL_ORIGIN)&&(n=n.slice(r.default.URL_ORIGIN.length-1)),n?.startsWith("#")||!n||o.RoutePath.is(n)?void 0:()=>{(0,a.default)().replaceElement(e,!0).and(l,n)}})),t.default=l})),define("ui/component/core/TextLabel",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});const a=(o=__importDefault(o)).default.Builder((e=>{e.style("text-label");const t=(0,o.default)().style("text-label-label"),a=(0,o.default)().style("text-label-punctuation").text.set(": "),n=(0,o.default)().style("text-label-content");return e.append(t,a,n).extend((()=>({label:t,content:n})))}));t.default=a})),define("ui/component/FollowingBookmark",["require","exports","model/Follows","ui/Component"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o);const n=(a=__importDefault(a)).default.Builder(((e,t)=>{const a=o.default.map(e,(()=>t(o.default)));return e.style("following-bookmark").style.bind(a.falsy,"following-bookmark--hidden").extend((e=>({isFollowing:a})))}));t.default=n})),define("ui/component/License",["require","exports","ui/Component","ui/component/core/ExternalLink","ui/component/core/Slot","ui/utility/License","ui/utility/StringApplicator","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),l=__importDefault(l),t.default=o.default.Builder(((e,t,o)=>(e.and(n.default).style.remove("slot").style("license").use(l.default.Use(e,{quilt:r.Quilt.State,license:l.default.get(o),authorName:l.default.get(t)}),((e,{quilt:t,license:o,authorName:n})=>{let r=o?.name??"all-rights-reserved",l=o?.link;const u=r;return i.LICENSES.includes(u)&&(r=e=>e[`license/${u}`](n),i.LICENSES_NO_LINK.includes(u)||(l=t[`license/${o?.name}/link`]().toString())),(0,a.default)(l).text.set(r)})),e)))})),define("ui/component/core/InfoDialog",["require","exports","ui/Component","ui/component/core/BlockDialog","ui/component/core/Button","ui/utility/StringApplicator","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),r=__importDefault(r);const l=Object.assign(o.default.Builder(((e,t)=>{const l=e.and(a.default),u=(0,r.default)(void 0);l.title.text.use(t?.titleTranslation),t?.bodyTranslation&&(0,o.default)().setMarkdownContent({body:i.QuiltHelper.toString(t.bodyTranslation)}).appendTo(l.content);const s=(0,n.default)().type("primary").text.use(t?.continueButtonTranslation??"shared/action/continue").appendTo(l.footer.right);return l.extend((e=>({state:u,continueButton:s,await:t=>(u.value=void 0,e.open(),new Promise((o=>t?e.state.match(t,[!0,!1],o):e.state.matchManual([!0,!1],o)))),continue(){u.value=!0,e.close()}}))).onRooted((e=>{e.continueButton.event.subscribe("click",e.continue)}))})),{prompt:async(e,t)=>l(t).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e)});t.default=l})),define("ui/component/ModerationDialog",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/ConfirmDialog","ui/component/core/InfoDialog","ui/component/core/Slot","ui/component/core/Tabinator","ui/utility/StringApplicator","utility/Objects"],(function(e,t,o,a,n,i,r,l,u,s,d,c){function p(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.ModerationCensor=p,t.ModerationDefinition=function(e){return{create:e}},o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importStar(s),c=__importDefault(c),function(e){e.plaintext=function(e){return{type:"plaintext",content:e}},e.markdown=function(e){return{type:"markdown",content:e}}}(p||(t.ModerationCensor=p={}));const f=o.default.Builder(((e,t)=>{const p=e.and(l.default,{titleTranslation:e=>e["shared/prompt/moderation/title"](e[t.titleTranslation]())});p.description.text.use((e=>e["shared/prompt/moderation/subtitle"](d.QuiltHelper.arg(t.moderatedContentName)))),p.continueButton.type.remove("primary").text.use("shared/action/done");const f=(0,s.default)().appendTo(p.content),m=(t.custom??[]).filter((e=>"general"===e.type));return(t.delete||m.length)&&(0,s.Tab)().text.use("shared/prompt/moderation/tab/general").tweak((e=>e.content.style("moderation-dialog-general").append(...m.map((e=>(0,u.default)().style.remove("slot").style("moderation-dialog-general-slot").tweak(e.tweak))),t.delete&&(0,n.default)().text.use("shared/prompt/moderation/action/delete").event.subscribe("click",(async e=>{await r.default.prompt(e.host,{bodyTranslation:e=>e["shared/prompt/moderation/action/delete/body"](d.QuiltHelper.arg(t.moderatedContentName)),dangerToken:"moderate"})&&t.delete?.()}))))).addTo(f),t.censor&&(0,s.Tab)().text.use("shared/prompt/moderation/tab/censor").tweak((e=>{const l=t.censor.properties,u={},s=(0,o.default)().style("moderation-dialog-censor-list").appendTo(e.content);for(const[e,t]of c.default.entries(l))t.content&&(0,i.default)().style("moderation-dialog-censor").setIcon("xmark").append((0,o.default)().style("moderation-dialog-censor-key").text.use(`shared/prompt/moderation/censor/key/${e}`)).append((0,o.default)("blockquote").style("moderation-dialog-censor-content").tweak((e=>"plaintext"===t.type?e.text.set(t.content):e.style("moderation-dialog-censor-content--markdown").setMarkdownContent(t.content,256,!0)))).event.subscribe("SetChecked",((t,o)=>{o?u[e]=!0:delete u[e]})).appendTo(s);const p=(0,a.default)().appendTo(e.content);(0,n.default)().type("primary").text.use("shared/prompt/moderation/action/censor").event.subscribe("click",(async e=>{await r.default.prompt(e.host,{bodyTranslation:e=>e["shared/prompt/moderation/action/censor/body"](d.QuiltHelper.arg(t.moderatedContentName),Object.keys(l)),dangerToken:"moderate"})&&t.censor?.censor(u)})).appendTo(p.right)})).addTo(f),p}));t.default=Object.assign(f,{prompt:async(e,t)=>f(t).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e)})})),define("ui/component/core/Textarea",["require","exports","ui/Component","ui/component/core/ext/Input","ui/component/core/TextInput","ui/utility/StringApplicator","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder((e=>{let t,l=!1,u=!1;const s=(0,o.default)().style("text-input","text-area").attributes.set("contenteditable","plaintext-only").ariaRole("textbox").attributes.set("aria-multiline","true").event.subscribe("blur",(()=>{u&&s.event.emit("change")})).event.subscribe("keydown",(e=>{if("Enter"===e.key){e.stopPropagation();const t=window.getSelection();if(!t)return;if(!s.element.contains(t.anchorNode)||!s.element.contains(t.focusNode))return;const o=document.createTextNode("\n");t.getRangeAt(0).replaceContents(document.createTextNode("\n"),o),t.empty(),t.collapse(o),s.event.emit("input")}})),d=(0,o.default)("input").style("text-area-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`text-area-validity-pipe-input-${Math.random().toString(36).slice(2)}`),c=(0,r.default)(""),p=(0,r.default)(!1),f=e.and(a.default).style("text-area-wrapper").pipeValidity(d).append(s,d).extend((e=>({value:"",touched:p,state:c,default:(0,i.default)(e,(t=>{""===e.value&&(e.value=t??"",c.value=t??"",e.length.asMutable?.setValue(t?.length??0),p.value=!0,m())})),placeholder:(0,i.default)(e,(e=>{s.attributes.set("placeholder",e)})),ignoreInputEvent:(t=!0)=>(l=t,e),setLabel:t=>(s.setName(t?.for),s.setId(t?.for),t?.setInput(e),s.ariaLabelledBy(t),e),filter:o=>(t=o,e)}))).extendMagic("value",(e=>({get:()=>s.element.textContent||"",set:t=>{s.element.textContent=t,g("change"),c.value=t,e.length.asMutable?.setValue(t.length),m()}})));return f.length.asMutable?.setValue(0),f.onRooted((e=>{m(),s.event.subscribe(["input","change"],(t=>{g(t.type),l||(c.value=e.value.trim(),e.length.asMutable?.setValue(e.value.trim().length),p.value=!0,m())}))})),f;function m(){let e;(f.length.value??0)>(f.maxLength.value??1/0)&&(e=e=>e["shared/form/invalid/too-long"]()),!f.length.value&&f.required.value&&(e=e=>e["shared/form/invalid/required"]()),f.setCustomInvalidMessage(e)}function h(e){if(!e)return 0;let t=0;for(;e=e.previousSibling;)t+=e.textContent?.length??0;return t}function g(e){const o=s.element;if(!o)return;const a=t??n.FilterFunction.DEFAULT,i=f.value;if("change"===e)return void(o.textContent=a(i.trim(),"","").join("").trim());u=!0;let{selectionStart:r=null,selectionEnd:l=null}=function(){const e=window.getSelection();if(!e?.anchorNode&&!e?.focusNode)return null;const t=s.element.contains(e.anchorNode),o=t?e.anchorOffset+h(e.anchorNode):0;return e.isCollapsed&&t?{selectionStart:o,selectionEnd:o}:{selectionStart:o,selectionEnd:s.element.contains(e.focusNode)?e.focusOffset+h(e.focusNode):s.element.textContent?.length??0}}()??{};const d=null!==r||null!==l;r??=i.length,l??=i.length;const c=i.slice(0,r).trimStart();let p=i.slice(l).trimEnd(),m=i.slice(r,l);c.length||(m=m.trimStart()),p.length||(m=m.trimEnd()),m.length||c.length||(p=p.trimStart());const[g,v,y]=a(c,m,p);if(o.textContent=g+v+y+"\n",d){const e=o.childNodes[0];if(e){const t=window.getSelection();t?.empty();const o=document.createRange();o.setStart(e,g.length),o.setEnd(e,g.length+v.length),t?.addRange(o)}}}}));t.default=l})),define("ui/component/ReportDialog",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/ConfirmDialog","ui/component/core/Dropdown","ui/component/core/LabelledTable","ui/component/core/Textarea","ui/utility/StringApplicator","utility/Objects"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),t.ReportDefinition=function(e){return e},o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),r=__importDefault(r),l=__importDefault(l),s=__importDefault(s);const d=a.default.Builder((async(e,t,a)=>{const d=await e.and(n.default,{titleTranslation:e=>e["shared/prompt/report/title"](e[t.titleTranslation]()),bodyTranslation:e=>e["shared/prompt/report/body"](u.QuiltHelper.arg(a.reportedContentName))}),c=(0,r.default)().appendTo(d.content),p=(0,i.RadioDropdown)().setRequired().tweak((e=>{for(const[o,a]of s.default.entries(t.reasons))a&&e.add(o,{translation:e=>e=>e[`shared/prompt/report/reason/option/${o}`]()})}));c.label((e=>e.text.use("shared/prompt/report/reason/label"))).content(((e,t)=>e.append(p.setLabel(t))));const f=(0,l.default)().setMaxLength(o.default.map(c,(e=>e?.report?.reason_body)));return c.label((e=>e.text.use("shared/prompt/report/details/label"))).content(((e,t)=>e.append(f.setLabel(t)))),d.confirmButton?.event.subscribe("click",(()=>{a.onReport({reason:p.selection.value,reason_body:f.value})})),d}));t.default=Object.assign(d,{prompt:async(e,t,o)=>(await d(t,o)).appendTo(document.body).event.subscribe("close",(e=>e.host.event.subscribe("transitionend",(e=>e.host.remove())))).await(e)})})),define("ui/component/Author",["require","exports","endpoint/author/EndpointAuthorGet","endpoint/moderation/EndpointModerateAuthorCensor","endpoint/moderation/EndpointModerateAuthorDelete","endpoint/moderation/EndpointModerateAuthorGrantSupporter","endpoint/report/EndpointReportAuthor","model/Follows","model/Session","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ButtonRow","ui/component/core/ConfirmDialog","ui/component/core/ext/GradientText","ui/component/core/ExternalLink","ui/component/core/LabelledRow","ui/component/core/Loading","ui/component/core/Placeholder","ui/component/core/Popover","ui/component/core/RangeInput","ui/component/core/RSSButton","ui/component/core/Slot","ui/component/core/TextInput","ui/component/core/TextLabel","ui/component/core/Timestamp","ui/component/FollowingBookmark","ui/component/License","ui/component/ModerationDialog","ui/component/ReportDialog","utility/Async","utility/Env","utility/Objects","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T,x,D,O,S,E,M,I,C,R,P,A){Object.defineProperty(t,"__esModule",{value:!0}),t.AuthorFooter=t.AuthorSubtitle=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importStar(x),D=__importDefault(D),O=__importDefault(O),S=__importDefault(S),E=__importDefault(E),M=__importStar(M),I=__importStar(I),C=__importDefault(C),R=__importDefault(R),A=__importDefault(A);const j=(0,I.ReportDefinition)({titleTranslation:"shared/term/author",reasons:{"inappropriate-field":!0,spam:!0,harassment:!0,impersonation:!0,phishing:!0,"tos-violation":!0}}),N=(0,M.ModerationDefinition)((e=>({titleTranslation:"shared/term/author",moderatedContentName:e.name,custom:[{type:"general",tweak(t){const o=(0,f.default)().appendTo(t),a=(0,w.default)(0,15).appendTo(o.content),n=(0,x.default)().style.remove("text-input").style("range-input-display").filter(x.FilterFunction.NUMERIC).default.set("0");a.display.element.replaceWith(n.element),(0,P.mutable)(a).display=n,a.liveState.use(n,(e=>{switch(e){case 15:n.value="9999";break;case 14:n.value="36";break;case 13:n.value="24";break;default:n.value=`${e??0}`}})),o.button.text.use("shared/prompt/moderation/action/grant-supporter").bindDisabled(n.state.map(t,(e=>!+e)),"no months to give").event.subscribe("click",(async t=>{if(!await m.default.prompt(t.host,{bodyTranslation:t=>t["shared/prompt/moderation/action/grant-supporter/body"](e.name,n.value),dangerToken:"moderate"}))return;const o=await i.default.query({params:{vanity:e.vanity},body:{months:+n.value}});toast.handleError(o)}))}}],async delete(){const t=await n.default.query({params:{vanity:e.vanity}});toast.handleError(t)},censor:(0,M.ModerationCensor)({properties:{name:M.ModerationCensor.plaintext(e.name),vanity:M.ModerationCensor.plaintext(e.vanity),pronouns:M.ModerationCensor.plaintext(e.pronouns),description:M.ModerationCensor.markdown(e.description?.body),support_link:M.ModerationCensor.plaintext(e.support_link),support_message:M.ModerationCensor.plaintext(e.support_message),license:M.ModerationCensor.plaintext(e.license&&`${e.license.name}: ${e.license.link}`)},async censor(t){const o=await a.default.query({params:{vanity:e.vanity},body:t});toast.handleError(o)}})})));t.AuthorSubtitle=s.default.Builder(((e,t)=>(t=A.default.get(t),e.and(T.default).use(t,((e,t)=>e.append((0,s.default)().style("author-vanity").text.set(`@${t.vanity}`)).append(t.pronouns&&(0,T.default)().text.append(" · ").append((0,s.default)().style("author-pronouns").text.set(t.pronouns)))))))),t.AuthorFooter=s.default.Builder(((e,t)=>{const o=e.and(d.default),a=t.work_count?(0,D.default)().tweak((e=>e.label.text.use("work/work-count/label"))).tweak((e=>e.content.text.set(t.work_count.toLocaleString(navigator.language)))).appendTo(o.left):void 0,n=t.word_count?(0,D.default)().tweak((e=>e.label.text.use("work/word-count/label"))).tweak((e=>e.content.text.set(t.word_count.toLocaleString(navigator.language)))).appendTo(o.left):void 0,i=(0,D.default)().tweak((e=>e.label.text.use("author/time-join/label"))).tweak((e=>(0,O.default)(t.time_join).style("author-timestamp").appendTo(e.content))).appendTo(o.right);return o.extend((e=>({workCount:a,wordCount:n,timeJoin:i})))}));const $=s.default.Builder(((e,a)=>{const n=(0,A.default)(a);e.viewTransition("author").style("author");const i=e.and(c.default),d=n.map(i,(e=>e.supporter?.card_colours));i.useGradient(d),i.title.style("author-name").text.set(n.value.name).tweak((e=>e.textWrapper.style("author-name-text").and(h.default).useGradient(n.map(i.title,(e=>e.supporter?.username_colours))))).setUnderlineColours(d),i.description.append((0,t.AuthorSubtitle)(n)),(0,S.default)((e=>e.followingAuthor(n.value.vanity))).appendTo(i.header),i.footer.and(t.AuthorFooter,n.value),(0,k.default)(`${R.default.API_ORIGIN}author/${n.value.vanity}/rss.xml`).appendTo(i.footer.right);const f=(0,y.default)();f.appendToWhen(f.enabled,i.content),f.enabled.value=!1;const m=(0,s.default)().style("author-description").tweak((e=>{n.useManual((t=>{e.removeContents(),(0,T.default)().appendTo(e).tweak((e=>{const o=t.description?.body;o?e.setMarkdownContent(t.description):e.and(b.default).text.use("author/description/empty")}))}))})).appendToWhen(n.mapManual((e=>!!e.description)),i.content);(0,T.default)().use(n,((e,t)=>t.support_link&&(0,g.default)(t.support_link).style("author-support-link").text.set(t.support_message||t.support_link))).appendTo(i.content),(0,T.default)().appendTo(i.content).use(n,((e,t)=>t.license&&(0,v.default)().style("author-license").tweak((e=>e.label.text.use("author/default-license"))).tweak((e=>e.content.and(E.default,t.name,t.license))))),e.is(_.default)||i.setActionsMenu((e=>{u.default.Auth.author.use(e,(t=>{t?.vanity===n.value.vanity?(0,p.default)().type("flush").setIcon("pencil").text.use("author/action/label/edit").event.subscribe("click",(()=>navigate.toURL("/account"))).appendTo(e):u.default.Auth.loggedIn.value&&((0,p.default)().type("flush").bindIcon(l.default.map(e,(()=>l.default.followingAuthor(n.value.vanity)?"circle-check-big":"circle"))).text.bind(l.default.map(e,(()=>e=>l.default.followingAuthor(n.value.vanity)?e["author/action/label/unfollow"]():e["author/action/label/follow"]()))).event.subscribe("click",(()=>l.default.toggleFollowingAuthor(n.value.vanity))).appendTo(e),(0,p.default)().type("flush").bindIcon(l.default.map(e,(()=>l.default.ignoringAuthor(n.value.vanity)?"ban":"circle"))).text.bind(l.default.map(e,(()=>e=>l.default.ignoringAuthor(n.value.vanity)?e["author/action/label/unignore"]():e["author/action/label/ignore"]()))).event.subscribe("click",(()=>l.default.toggleIgnoringAuthor(n.value.vanity))).appendTo(e),u.default.Auth.isModerator.value||(0,p.default)().type("flush").setIcon("flag").text.use("author/action/label/report").event.subscribe("click",(e=>I.default.prompt(e.host,j,{reportedContentName:n.value.name,async onReport(e){const t=await r.default.query({body:e,params:{vanity:n.value.vanity}});toast.handleError(t)}}))).appendTo(e)),u.default.Auth.isModerator.value&&(0,p.default)().type("flush").setIcon("shield-halved").text.use("author/action/label/moderate").event.subscribe("click",(e=>M.default.prompt(e.host,N.create(n.value)))).appendTo(e)}))}));let w=!1;return i.extend((e=>({bio:m,async loadFull(){if(w||f.enabled.value)return;if(n.value.description)return w=!0,void n.emit();f.enabled.value=!0,await C.default.sleep(1e3);const e=await o.default.query({params:n.value});f.enabled.value=!1,e instanceof Error||(w=!0,Object.assign(n.value,e.data),n.emit())}})))}));t.default=$})),define("endpoint/moderation/EndpointModerateWorkCensor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/moderation/work/{author}/{vanity}/censor","post")})),define("endpoint/moderation/EndpointModerateWorkLock",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/moderation/work/{author}/{vanity}/lock","post")})),define("endpoint/moderation/EndpointModerateWorkUnlock",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/moderation/work/{author}/{vanity}/unlock","post")})),define("endpoint/report/EndpointReportWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/report/work/{author}/{vanity}","post")})),define("model/Patreon",["require","exports","lang/en-nz","ui/utility/StringApplicator","utility/Arrays","utility/Functions"],(function(e,t,o,a,n,i){var r;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),i=__importDefault(i),function(e){function t(e){return t=>t["shared/term/patreon-tier"]({NAME:e.tier_name,PRICE:`$${(e.amount/100).toFixed(2)}`})}e.getMoreRestrictive=function(e,t){return e?.length?t?.length?Math.min(...e.map((e=>e.amount)))>Math.min(...t.map((e=>e.amount)))?e:t:e||[]:t||[]},e.translateTier=t,e.translateTiers=function(e,r){const l=e.map((e=>r?.find((t=>t.tier_id===e)))).filter(n.NonNullish).sort(((e,t)=>e.amount-t.amount));if(!l.length)return e=>e["shared/form/visibility-patreon-tier/selection/none"]();if(r?.length===l.length)return e=>e["shared/form/visibility-patreon-tier/selection/all"]();const u=l[0];if(r?.every((t=>t.amount<=u.amount||e.includes(t.tier_id)))){const e=t(u),n=i.default.resolve(e,o.default,a.QuiltHelper);return e=>e["shared/form/visibility-patreon-tier/selection/tier-and-up"](n)}}}(r||(r={})),t.default=r})),define("ui/component/popover/PopoverBlock",["require","exports","ui/Component","ui/component/core/Block","ui/component/core/Popover"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.default=o.default.Builder((e=>{const t=e.and(n.default).and(a.default).style("popover-block").anchor.add("aligned left","off bottom").anchor.add("aligned left","off top").anchor.add("aligned right","off bottom").anchor.add("aligned right","off top").anchor.orElseHide().viewTransition(!1);return t.header.style("popover-block-header"),t.content.style("popover-block-content"),t.tweakJIT("title",(e=>e.setAestheticLevel(3).style("popover-block-title"))),t}))})),define("ui/component/popover/AuthorPopover",["require","exports","ui/Component","ui/component/Author","ui/component/core/Popover","ui/component/popover/PopoverBlock"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),t.default=o.default.Builder(((e,t)=>e.and(n.default).setDelay(500).and(i.default).and(a.default,t).tweak((e=>e.bio.style("author-description--in-popover"))).tweak((e=>e.visible.matchManual(!0,e.loadFull)))))})),define("ui/component/AuthorLink",["require","exports","ui/Component","ui/component/core/ext/GradientText","ui/component/core/Link","ui/component/popover/AuthorPopover"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),t.default=o.default.Builder("a",((e,t)=>e.and(n.default,`/author/${t.vanity}`).style("author-link").text.set(t.name).setPopover("hover/longpress",(e=>e.and(i.default,t))).and(a.default).useGradient(t.supporter?.username_colours)))})),define("ui/component/core/Icon",["require","exports","ui/Component","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=o.default.Builder(((e,t)=>{const o=(0,a.default)(a.default.value(t));return n(t),e.style("button-icon","button-icon--inline").style.bindFrom(o.map(e,(e=>[`button-icon-${e}`]))).extend((e=>({setIcon:t=>(n(t),e)})));function n(t){a.default.is(t)?o.bind(e,t):o.value=t}}));t.default=n})),define("ui/component/Statistics",["require","exports","ui/Component","ui/component/core/Heading","ui/component/core/TextLabel"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),t.StatisticsSection=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder(((e,t)=>e.style("statistics-section").append((0,a.default)().setAestheticStyle(!1).style("statistics-section-heading").text.use(t)).extend((e=>({stat(t,a,i){return void 0!==a&&(0,n.default)().style("statistics-stat").tweak((e=>e.label.style("statistics-stat-label").text.use(t))).tweak((e=>e.content.style("statistics-stat-value").append((0,o.default)().text.set("number"!=typeof a&&"bigint"!=typeof a?a:a.toLocaleString(navigator.language))))).tweak(i,a).appendTo(e),this}})))));t.StatisticsSection=i;const r=o.default.Builder((e=>(e.style("statistics"),e.extend((e=>({section(t,o){const a=i(t);return o(a),e.append(a)}}))))));t.default=r})),define("endpoint/tag/EndpointTagManifest",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/manifest/tags","get")})),define("model/Tags",["require","exports","endpoint/tag/EndpointTagManifest","model/Manifest","utility/Arrays","utility/Time"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=s,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i);const r=Object.assign((0,a.default)({cacheId:"tags",valid:i.default.minutes(5),async get(){const e=await o.default.query();if(!e.data)return e;const t=e.data;for(const e of Object.values(t.categories))u(e);for(const e of Object.values(t.tags))l(e);return e}}),{resolve:s,toId:function(e,t){return"string"==typeof e?`${e}: ${t}`:`${e.category}: ${e.name}`},isId:e=>"string"==typeof e&&(!!r.value?.tags&&e in r.value.tags),addTag(e){r.value&&(r.value.tags[`${e.category}: ${e.name}`]=l(e),r.emit())},removeTags(...e){if(r.value){for(const t of e)delete r.value.tags[t],delete r.value.relationships[t];r.emit()}},recategoriseTags(e,...t){if(r.value&&t.length){for(const o of t){const t=r.value.tags[o];if(!t)continue;const a=r.toId(e,t.name);r.value.tags[a]=t,delete r.value.tags[o],r.value.relationships[a]=r.value.relationships[o],delete r.value.relationships[o]}r.emit()}},addCategory(e){r.value&&(r.value.categories[e.name]=u(e),r.emit())},removeCategory(e){r.value&&(delete r.value.categories[e],r.emit())},setAliases(e,...t){if(!r.value)return;const o=r.value.tags[e];o&&(o.aliases=t,r.emit())},addAliases(e,...t){if(!r.value)return;if(!t.length)return;const o=r.value.tags[e];o&&((o.aliases??=[]).push(...t),r.emit())},addRelationships(e,t){if(r.value&&e&&t){e=n.default.resolve(e),t=n.default.resolve(t);for(const o of e){if(r.value.tags[o])for(const e of t){r.value.tags[e]&&(r.value.relationships[o]??=[]).push(e)}}r.emit()}}});function l(e){const t=e;return t.nameLowercase=t.name.toLowerCase(),t.wordsLowercase=t.nameLowercase.split(" "),t.categoryLowercase=t.category.toLowerCase(),t.categoryWordsLowercase=t.categoryLowercase.split(" "),t}function u(e){const t=e;return t.nameLowercase=t.name.toLowerCase(),t.wordsLowercase=t.nameLowercase.split(" "),t}async function s(e,t){if(!e?.length)return[];if(Array.isArray(e))return d(e);const o=t?`${e}: ${t}`:e,[a]=await d([o]);return a}async function d(e){const t=[];let o=await r.getManifest();return a(),t.length===e.length||r.isFresh()||(o=await r.getManifest(!0),a()),t;function a(){t.splice(0,1/0);for(const a of e)for(const[e,n]of Object.entries(o.tags))e.toLowerCase()!==a.toLowerCase()||t.push(n)}}t.default=r})),define("ui/component/core/ext/Draggable",["require","exports","ui/Component","utility/maths/Vector2","utility/State"],(function(e,t,o,a,n){var i;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),function(e){e[e.None=0]="None",e[e.Starting=1]="Starting",e[e.Delayed=2]="Delayed",e[e.Dragging=3]="Dragging"}(i||(i={}));const r=(0,n.default)(!1),l=Object.assign(o.default.Extension(((e,t={})=>{e.style("draggable");const o=(0,n.default)(i.None),l=(0,n.default)(void 0),u=(0,n.default)(void 0),s=n.default.MapManual([l,t.stickyDistance],((e,t)=>e??t??0)),d=n.default.MapManual([u,t.delay],((e,t)=>e??t??0));let c,p;e.onRemoveManual(v),e.event.subscribe(["mousedown","touchstart"],(function(e){const a=y(e);if(!a)return;e.preventDefault(),r.value=!0,c=a,o.value=i.Starting,"touchstart"===e.type?(window.addEventListener("touchmove",m,{passive:!0}),window.addEventListener("touchend",h,{passive:!0})):(window.addEventListener("mousemove",m,{passive:!0}),window.addEventListener("mouseup",h,{passive:!0}));d&&(o.value=i.Delayed,p=window.setTimeout((()=>{if(o.value===i.Delayed){if(o.value=t.stickyDistance?.value?i.Starting:i.Dragging,!t.stickyDistance?.value){const e=t.onMoveStart?.(f,a);if(!1===e)return void h();f.style("draggable-dragging")}m(e)}}),d.value))}));const f=e.extend((e=>({state:o,dragging:o.mapManual((e=>e===i.Dragging)),setStickyDistance:t=>(l.value=t,e),setDelay:t=>(u.value=t,e),stopDragging:v})));return f;function m(e){if(o.value===i.Delayed)return;const n=y(e);if(!n)return;const r=a.default.subtract(n,c),l=s.value;if(o.value===i.Starting&&(l<5||!a.default.distanceWithin(l,r,a.default.ZERO))){const e=t.onMoveStart?.(f,n);if(!1===e)return void h();o.value=i.Dragging,f.style("draggable-dragging")}if(o.value!==i.Dragging)return;const u=t.onMove?.(f,r,n);if(!1!==u)return r;h()}function h(e){if(g(),o.value===i.Dragging&&e){const o=y(e),n=o?m(e):void 0;t.onMoveEnd?.(f,n??a.default.ZERO,o??c)}v()}function g(){window.clearTimeout(p),window.removeEventListener("touchmove",m),window.removeEventListener("mousemove",m),window.removeEventListener("touchend",h),window.removeEventListener("mouseup",h)}function v(){return g(),r.value=!1,o.value=i.None,c=void 0,f.style.remove("draggable-dragging"),f}function y(e){const t=e.touches?.[0];if(0===e.button||t)return a.default.fromClient(t??e)}})),{isDragging:r});t.default=l})),define("ui/component/Tag",["require","exports","model/Tags","ui/Component","ui/component/core/Button","ui/component/core/ext/Draggable","ui/component/core/Link","ui/component/FollowingBookmark","ui/utility/BrowserListener"],(function(e,t,o,a,n,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u);const s=/\W+/g,d=e=>e.replaceAll(s,"-").toLowerCase(),c=Object.assign(a.default.Builder("a",((e,t)=>{"A"===e.tagName&&e.and(r.default,"string"==typeof t?void 0:`/tag/${d(t.category)}/${d(t.name)}`);const s=e.and(n.default).style("tag").style.toggle("string"==typeof t,"tag-custom").style.toggle("string"!=typeof t,"tag-global"),c="string"==typeof t?void 0:(0,l.default)((e=>e.followingTag(o.default.toId(t)))).tweak((t=>t.style("tag-following-bookmark").style.bind(e.hoveredOrFocused,"tag-following-bookmark--active").style.bind(u.default.isWebkit,"tag-following-bookmark--webkit").appendTo(e.style.bind(t.isFollowing,"tag--has-following-bookmark")))),p="string"==typeof t?void 0:(0,a.default)().style("tag-category").text.set(t.category).appendTo(e),f=(0,a.default)().style("tag-name").text.set("string"==typeof t?t:t.name).appendTo(e);"object"==typeof t&&t.is_mature&&s.setIcon("circle-exclamation").tweak((e=>e.icon?.style("tag-mature-icon").prependTo(f)));const m=e.supers.useManual((()=>{e.is(i.default)&&(m(),e.style.bind(e.dragging,"tag--dragging"))}));return e.extend((e=>({tag:t,categoryWrapper:p,nameWrapper:f,followingBookmark:c,addDeleteButton:t=>(c?.style("tag-following-bookmark--has-delete-button"),(0,n.default)().style("tag-delete-button").setIcon("xmark").event.subscribe("click",t).appendTo(e),e)})))})),{Category:a.default.Builder("button",((e,t)=>e.and(c,{category:t.name,name:"...",description:{body:t.description},is_mature:!1}))).setName("TagCategory")});t.default=c})),define("ui/component/core/ext/Sortable",["require","exports","ui/Component","ui/component/core/ext/Draggable","utility/Arrays","utility/maths/Vector2","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.SortableDefinition=function(e){return e},o=__importDefault(o),a=__importDefault(a),i=__importDefault(i);const l=(0,(r=__importDefault(r)).default)(!1),u=Object.assign(o.default.Extension(((e,t)=>{const u=(0,r.default)(!1),s=(0,r.default)(t.sortDelay??0),d=(0,r.default)(t.stickyDistance??0),c=(0,r.default)([]);let p,f;const m={stickyDistance:d,delay:s,onMoveStart:function(e,o){if(void 0===t.getID(e))return console.warn("Failed to begin sorting, draggable without ID"),!1;e.style("sortable-item-sorting").style.setProperty("position","fixed").style.setProperty("z-index",999999999),p=e,l.value=!0,b(e,i.default.ZERO,o),u.value=!0},onMove:b,onMoveEnd:function(e,t,o){e.insertTo(h,"after",f),y()}};for(const t of e.getChildren())t.and(a.default,m).style("sortable-item");v(),e.receiveChildrenInsertEvents(),e.event.subscribe("childrenInsert",((e,t)=>{for(const e of t)e!==f?.element&&e.component?.and(a.default,m).style("sortable-item");v()}));const h=e.extend((e=>({sorting:u,order:c,setSortDelay:o=>(s.value=o??t.sortDelay??0,e),setStickyDistance:o=>(d.value=o??t.stickyDistance??0,e),cancel:()=>(y(!1),e)})));return t.onOrderChange&&c.subscribeManual(t.onOrderChange),h;function g(){return[...e.getChildren()].map((e=>e.as(a.default))).filter(n.NonNullish)}function v(){c.value=g().map(t.getID).filter(n.NonNullish)}function y(e=!0){if(!u.value)return;u.value=!1,l.value=!1;const t=p;p=void 0,t?.style.remove("sortable-item-sorting").style.removeProperties("position","left","top"),t?.stopDragging(),f?.remove(),f=void 0,e&&v()}function b(e,t,a){const n=e.rect.value;e.style.setProperty("left",a.x-n.width/2+"px"),e.style.setProperty("top",a.y-n.height/2+"px"),function(e,t){f??=(0,o.default)().style("sortable-slot").tweak((t=>{const o=e.rect.value;t.style.setProperty("width",`${o.width}px`),t.style.setProperty("height",`${o.height}px`)}));const a=h.rect.value,n=g().filter((t=>t!==e)),r=i.default.subtract(t,a.position),l=function(e,t,o){const{left:a,top:n}=h.rect.value;let i;for(let r=0;r<o.length;r++){const l=o[r];if(l===e)continue;let{left:u,top:s,width:d,height:c}=l.rect.value;if(u-=a-d/2,s-=n,r===(o[0]===e?1:0)){if(t.y<s)return;if(t.x<u&&t.y<s+c)return}if(void 0!==i&&i!==s){if(t.y<s)return o[r-1];if(t.y>=s&&t.y<s+c&&t.x<u)return o[r-1]}if(i=s,t.x>=u&&t.x<u+d&&t.y>=s&&t.y<s+c)return l}return o.at(-1)}(e,r,n),u=new Set(f.getNextSiblings());l?f.insertTo(h,"after",l):f.prependTo(h);for(const e of f.getNextSiblings())u.add(e);for(const e of u)e.rect.markDirty()}(e,a)}})),{isSorting:l});t.default=u})),define("utility/Mouse",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return"number"==typeof e[0]?e.reverse():e}function o(...e){const[o,a]=t(e);if("click"!==o.type&&"mousedown"!==o.type&&"mouseup"!==o.type)return;const n=o;return n.button===a?n:void 0}function a(...e){const[o,a]=t(e);if("click"!==o.type&&"mousedown"!==o.type&&"mouseup"!==o.type)return!1;return o.button===a}function n(...e){const[o,n]=t(e);return!!a(o,n)&&(o.preventDefault(),!0)}e.asLeft=o.bind(null,0),e.asMiddle=o.bind(null,1),e.asRight=o.bind(null,2),e.as=o,e.isLeft=a.bind(null,0),e.isMiddle=a.bind(null,1),e.isRight=a.bind(null,2),e.is=a,e.handleLeft=n.bind(null,0),e.handleMiddle=n.bind(null,1),e.handleRight=n.bind(null,2),e.handle=n}(o||(o={})),t.default=o})),define("ui/component/TagsEditor",["require","exports","model/Tags","ui/Component","ui/component/core/Block","ui/component/core/ext/Input","ui/component/core/ext/Sortable","ui/component/core/ProgressWheel","ui/component/core/Slot","ui/component/core/TextInput","ui/component/Tag","ui/utility/AnchorManipulator","ui/utility/Applicator","ui/utility/StringApplicator","utility/AbortPromise","utility/Mouse","utility/State","utility/string/Strings","utility/Task"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y){Object.defineProperty(t,"__esModule",{value:!0}),t.filterTagSegment=w,o=__importDefault(o),a=__importDefault(a),i=__importDefault(i),r=__importStar(r),l=__importDefault(l),u=__importDefault(u),s=__importStar(s),d=__importDefault(d),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y);const b=a.default.Builder((e=>{const t=(0,g.default)({global_tags:[],custom_tags:[]}),b=(0,g.default)(!1),w=(0,g.default)(void 0),k=(0,u.default)().style("tags-editor-current").use(t,m.default.asyncFunction((async(e,n,i)=>{const l=await o.default.resolve(i.global_tags);if(e.aborted)return;l.length&&(0,a.default)().and(r.default,(0,r.SortableDefinition)({stickyDistance:10,getID:e=>T(e.as(d.default)?.tag),onOrderChange:e=>t.value.global_tags.splice(0,1/0,...e)})).style("tags-editor-current-type","tags-editor-current-global").append(...l.map((e=>(0,d.default)(e).setNavigationDisabled(!0).event.subscribe("auxclick",(e=>e.preventDefault())).event.subscribe("mouseup",(t=>h.default.handleMiddle(t)&&j(e))).addDeleteButton((()=>j(e)))))).appendTo(n),i.custom_tags.length&&(0,a.default)().and(r.default,(0,r.SortableDefinition)({stickyDistance:10,getID:e=>T(e.as(d.default)?.tag),onOrderChange:e=>t.value.custom_tags.splice(0,1/0,...e)})).style("tags-editor-current-type","tags-editor-current-custom").append(...i.custom_tags.map((e=>(0,d.default)(e).setNavigationDisabled(!0).event.subscribe("auxclick",(e=>e.preventDefault())).event.subscribe("mouseup",(t=>h.default.handleMiddle(t)&&j(e))).addDeleteButton((()=>j(e)))))).appendTo(n);const u=!!l.length||!!i.custom_tags.length;k.style.toggle(u,"tags-editor-current")})));function T(e){return e?"string"==typeof e?e:`${e.category}: ${e.name}`:""}const x=(0,a.default)().style("text-input","tags-editor-input-wrapper").event.subscribe("click",(()=>D.focus())),D=(0,s.default)().style("tags-editor-input").style.remove("text-input").placeholder.use("shared/form/tags/placeholder").filter(_).appendTo(x),O=g.default.Some(e,e.hasFocused,e.hadFocusedLast),S=(0,u.default)().style("tags-editor-suggestions").use(g.default.UseManual({tags:t,filter:D.state,focus:O}),m.default.asyncFunction((async(e,n,{tags:i,filter:r,focus:l})=>{if(!r&&!l)return;const u=await o.default.getManifest();if(e.aborted)return;let[s,c]=v.default.splitOnce(r,":");if(void 0===c&&(c=s,s=""),s=s.trim(),c=c.trim(),"custom"!==w.value){const e=s?[]:Object.values(u.categories).filter((e=>e.nameLowercase.startsWith(c))).filter((e=>Object.entries(u.tags).some((([t,o])=>o.category===e.name&&!i.global_tags.some((e=>t===e)))))).sort((e=>-Object.values(u.tags).filter((t=>t.category===e.name)).length),((e,t)=>e.name.localeCompare(t.name))).map((e=>d.default.Category(e).event.subscribe("click",(()=>D.value=`${e.name}: `))));e.length&&(0,a.default)().style("tags-editor-suggestions-type").append(...e).appendTo(n);const o=s?Object.entries(u.tags).filter((([,e])=>e.categoryLowercase.startsWith(s)&&e.nameLowercase.startsWith(c))):c?Object.entries(u.tags).filter((([,e])=>e.wordsLowercase.some((e=>e.startsWith(c))))):[];o.filterInPlace((([e])=>!i.global_tags.some((t=>t===e)))),o.length&&(0,a.default)().style("tags-editor-suggestions-type").append(...o.map((([,e])=>(0,d.default)(e).setNavigationDisabled(!0).event.subscribe("click",(o=>{i.global_tags.push(`${e.category}: ${e.name}`),t.emit(),D.value="",b.value=!0,""===o.pointerType&&D.focus()}))))).appendTo(n)}if("global"!==w.value){const e=select((()=>c?s?[(0,d.default)(`${c} ${s}`),(0,d.default)(`${s} ${c}`)]:[(0,d.default)(c)]:[]));e.length&&(0,a.default)().style("tags-editor-suggestions-type").append((0,a.default)().style("tags-editor-suggestions-type-label").text.use("shared/form/tags/suggestion/add-as-custom")).append(...e.map((e=>e.setNavigationDisabled(!0).event.subscribe("click",(o=>{i.custom_tags.push(e.tag),t.emit(),D.value="",b.value=!0,""===o.pointerType&&D.focus()}))))).appendTo(n)}n.size&&(0,a.default)().style("tags-editor-suggestions-label").text.use("shared/form/tags/suggestion/label").prependTo(n),A.rect.markDirty()}))).appendTo(x),E=(0,a.default)("input").style("tags-editor-validity-pipe-input").tabIndex("programmatic").attributes.set("type","text").setName(`tags-editor-validity-pipe-input-${Math.random().toString(36).slice(2)}`),M=(0,g.default)(void 0),I=(0,g.default)(void 0),C=(0,g.default)(void 0),R=(0,g.default)(void 0),P=(0,g.default)(void 0),A=e.and(i.default).style("tags-editor").append(k).append(x).append(E).pipeValidity(E).extend((o=>({state:t,get tags(){return t.value},default:(0,p.default)(o,(e=>t.value={global_tags:e?.global_tags?.slice()??[],custom_tags:e?.custom_tags?.slice()??[]})),touched:b,maxLengthGlobal:M,maxLengthCustom:I,lengthGlobal:t.mapManual((e=>e.global_tags.length)),lengthCustom:t.mapManual((e=>e.custom_tags.length)),setMaxLengthGlobal:t=>(g.default.is(t)?M.bind(e,t):M.value=t,o),setMaxLengthCustom:t=>(g.default.is(t)?I.bind(e,t):I.value=t,o),input:D,inputWrapper:x,setCustomTagsOnly:()=>(w.value="custom",o),setGlobalTagsOnly:()=>(w.value="global",o),mainHint:(0,f.default)(o,(e=>C.value=e)),globalHint:(0,f.default)(o,(e=>R.value=e)),customHint:(0,f.default)(o,(e=>P.value=e))})));return A.disableDefaultHintPopoverVisibilityHandling(),O.subscribeManual((e=>A.getPopover()?.toggle(e).anchor.apply())),A.setCustomHintPopover((e=>e.appendWhen(w.falsy,i.default.createHintText(C.map(e,(e=>e??(e=>e["shared/form/tags/hint/main"]()))))).appendWhen(w.equals("custom").falsy,i.default.createHintText(R.map(e,(e=>e??(e=>e["shared/form/tags/hint/global"]())))),l.default.Length(A.lengthGlobal,A.maxLengthGlobal)).appendWhen(w.equals("global").falsy,i.default.createHintText(P.map(e,(e=>e??(e=>e["shared/form/tags/hint/custom"]())))),l.default.Length(A.lengthCustom,A.maxLengthCustom)).anchor.reset().anchor.from(D).anchor.add("off right",`.${n.BlockClasses.Main}`,"centre",c.AllowYOffscreen))),t.use(A,(e=>{let t;e.global_tags.length>(A.maxLengthGlobal.value??1/0)?t=e=>e["shared/form/invalid/tags/too-many-global"]():e.custom_tags.length>(A.maxLengthCustom.value??1/0)&&(t=e=>e["shared/form/invalid/tags/too-many-custom"]()),A.setCustomInvalidMessage(t)})),D.event.subscribe("keydown",(async e=>{"Enter"===e.key&&(e.preventDefault(),S.getFirstDescendant(d.default)?.element.click(),b.value=!0,await y.default.yield(),D.focus())})),A;function j(e){const o="string"==typeof e?e:`${e.category}: ${e.name}`;"string"==typeof e?t.value.custom_tags.filterInPlace((e=>e!==o)):t.value.global_tags.filterInPlace((e=>e!==o)),t.emit(),b.value=!0}})),_=(0,s.FilterFunction)(((e,t,o)=>{e=w(e),t=w(t),o=w(o),e.includes(":")?(t=t.replaceAll(":"," "),o=o.replaceAll(":"," ")):t.includes(":")&&(o=o.replaceAll(":"," "));return e.endsWith(" ")&&(t.startsWith(" ")||t.startsWith(":")||!t&&(o.startsWith(" ")||o.startsWith(":")))&&(e=e.trimEnd()),t.endsWith(" ")&&(o.startsWith(" ")||o.startsWith(":"))&&(t=t.trimEnd()),e=e.trimStart(),o=o.trimEnd(),e||(t=t.trimStart()),o||(t=t.trimEnd()),[e,t,o]}));function w(e){return e.toLowerCase().replace(/[^\w/!?&$'.,: -]/g," ").replace(/(?<=:.*?):/g," ").replace(/ {2,}/g," ").replace(" :",":")}t.default=b})),define("ui/component/Tags",["require","exports","model/Tags","ui/Component","ui/component/core/Slot","ui/component/Tag","utility/AbortPromise","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=a.default.Builder((e=>{const t=(0,l.default)(void 0);let u;return(0,n.default)().use(t.map(e,(e=>e?.global_tags)),r.default.asyncFunction((async(e,t,n)=>{const r=await o.default.resolve(n);return r?.length&&(0,a.default)().style("work-tags","work-tags-global").tweak(u?.initialiseGlobalTags,r).append(...r.map((e=>(0,i.default)(e))))}))).appendTo(e),(0,n.default)().use(t.map(e,(e=>e?.custom_tags)),((e,t)=>t?.length&&(0,a.default)().style("work-tags","work-tags-custom").tweak(u?.initialiseCustomTags,t).append(...t.map((e=>(0,i.default)(e)))))).appendTo(e),e.extend((e=>({set:(o,a)=>(l.default.is(o)?t.bind(e,o):t.value=o,u=a,e)})))}));t.default=u})),define("ui/component/Work",["require","exports","endpoint/moderation/EndpointModerateWorkCensor","endpoint/moderation/EndpointModerateWorkLock","endpoint/moderation/EndpointModerateWorkUnlock","endpoint/report/EndpointReportWork","model/Follows","model/FormInputLengths","model/Patreon","model/Session","model/Works","ui/Component","ui/component/AuthorLink","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ButtonRow","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/Icon","ui/component/core/Link","ui/component/core/Popover","ui/component/core/RSSButton","ui/component/core/Slot","ui/component/core/Textarea","ui/component/core/TextLabel","ui/component/core/Timestamp","ui/component/FollowingBookmark","ui/component/License","ui/component/ModerationDialog","ui/component/ReportDialog","ui/component/Statistics","ui/component/Tags","utility/Env","utility/State","utility/Time"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,w,k,T,x,D,O,S,E,M,I,C,R,P,A,j,N){Object.defineProperty(t,"__esModule",{value:!0}),t.WorkFooter=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importStar(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importStar(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),O=__importDefault(O),S=__importDefault(S),E=__importDefault(E),M=__importDefault(M),I=__importStar(I),C=__importStar(C),R=__importDefault(R),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N);const $=(0,C.ReportDefinition)({titleTranslation:"shared/term/work",reasons:{"inadequate-tags":!0,"inappropriate-field":!0,spam:!0,harassment:!0,plagiarism:!0,"tos-violation":!0,"work-unlock":!1}}),B=(0,I.ModerationDefinition)((e=>({titleTranslation:"shared/term/work",moderatedContentName:e.name,custom:[{type:"general",tweak(t){const o=(0,j.default)(e.lock_reason);t.use(o,((t,i)=>{const r=(0,g.default)().appendTo(t),l=(0,D.default)().text.set(i).appendTo(r.content);i?(l.attributes.set("disabled","disabled"),r.button.text.use("work/action/unlock").event.subscribe("click",(async t=>{if(!await v.default.prompt(t.host,{bodyTranslation:null,dangerToken:"moderate"}))return;const a=await n.default.query({params:d.default.reference(e)});toast.handleError(a)||(o.value=void 0)}))):r.button.text.use("work/action/lock").bindDisabled(l.state.falsy,"no lock reason").event.subscribe("click",(async t=>{if(!await v.default.prompt(t.host,{bodyTranslation:null,dangerToken:"moderate"}))return;const n=await a.default.query({params:d.default.reference(e),body:{reason:l.value}});toast.handleError(n)||(o.value=l.value)}))}))}}],censor:(0,I.ModerationCensor)({properties:{name:I.ModerationCensor.plaintext(e.name),vanity:I.ModerationCensor.plaintext(e.vanity),description:I.ModerationCensor.plaintext(e.description),synopsis:I.ModerationCensor.markdown(e.synopsis?.body),license:I.ModerationCensor.plaintext(e.license&&`${e.license.name}: ${e.license.link}`)},async censor(t){const a=await o.default.query({params:d.default.reference(e),body:t});toast.handleError(a)}})})));t.WorkFooter=c.default.Builder(((e,t)=>{t=j.default.get(t);const o=e.and(f.default).style("work-footer");o.left.style("work-footer-left");const a=(0,j.default)(void 0),n=(0,j.default)(void 0);(0,x.default)().appendTo(o.left).use(t,((e,t)=>{let o,i=t.status;"Ongoing"===i&&Date.now()-new Date(t.time_last_update??0).getTime()>N.default.months(3)&&(o="no-recent-updates",i="Hiatus");const r=t.status.toLowerCase();return a.value=(0,c.default)().style("button","work-status",`work-status--${r}`).append(n.value=(0,b.default)(d.WORK_STATUS_ICONS[t.status]).style("work-status-icon")).append((0,c.default)().text.use(`work/status/${o??r}`))}));const i=(0,O.default)().tweak((e=>e.label.text.use("work/chapters/label"))).tweak((e=>{t.use(e,(t=>{const o=t.chapter_count_public.toLocaleString(navigator.language);if(!t.frequency||"Complete"===t.status||"Cancelled"===t.status)return e.content.text.set(o);let a,n;switch(t.frequency.interval){case 1:n="daily",a=1;break;case 7:n="weekly",a=7;break;case 30:n="monthly",a=30;break;default:t.frequency.interval<7?(n="every-x-days",a=t.frequency.interval):t.frequency.interval<30?(n="every-x-weeks",a=t.frequency.interval/7):(n="every-x-months",a=t.frequency.interval/30)}a=Math.round(a);const i=(e,t)=>0===t?e:i(t,e%t),r=i(a,t.frequency.amount),l=t.frequency.amount/r;a/=r,"every-x-days"===n&&1===a?n="daily":"every-x-weeks"===n&&1===a?n="weekly":"every-x-months"===n&&1===a&&(n="monthly"),e.content.text.use((e=>e["work/chapters/value"](o,l.toLocaleString(navigator.language),e[`shared/term/interval/${n}`](a.toLocaleString(navigator.language)))))}))})).appendTo(o.left),r=t.map(e,(e=>e.word_count)),l=(0,O.default)().tweak((e=>e.label.text.use("work/word-count/label"))).tweak((e=>e.content.text.bind(r.map(e,(e=>e.toLocaleString(navigator.language)))))).appendToWhen(r.truthy,o.left);o.right.style("work-footer-right");const u=(0,j.default)(void 0),s=(0,j.default)(void 0);return(0,x.default)().appendTo(o.right).use(t,((e,t)=>{u.value=void 0,s.value=void 0,"Private"===t.visibility?e.append(s.value=(0,c.default)().style("timestamp","work-timestamp").text.use("work/state/private")):t.chapter_count_public?t.time_last_update&&e.append(u.value=(0,S.default)(t.time_last_update).setSimple().style("work-timestamp")):e.append(s.value=(0,c.default)().style("timestamp","work-timestamp").text.use("work/state/private-no-chapters"))})),o.extend((e=>({status:a,statusIcon:n,chapterCount:i,wordCount:l,timestampAlternative:s,timestamp:u})))}));const L=c.default.Builder(((e,o,a,n)=>{const f=j.default.get(o),g=j.default.get(a),v=j.default.Map(e,[f,g],((e,t)=>t??e.synopsis?.mentions[0])),D=f.map(e,(e=>"Patreon"===e.visibility));e.viewTransition("work").style("work").style.bind(f.map(e,(e=>"Private"===e.visibility||!e.chapter_count_public)),"work--private").style.bind(D,"work--patreon");const O=e.and(m.default),S=j.default.Map(e,[f,s.default.Auth.author],((e,t)=>e.author!==s.default.Auth.author.value?.vanity||s.default.Auth.author.value.supporter?.tier?e.card_colours:void 0));O.useGradient(S);const L=O.type.state.mapManual((e=>e.has("flush")));O.header.style("work-header").style.bind(L,"work-header--flush").style.bind(D,"work-header--patreon"),O.title.style("work-name").text.bind(f.map(e,(e=>e.name))).setResizeRange(32,Math.min(l.default.value?.work?.name??1/0,128)).setUnderlineColours(S),(0,x.default)().use(f,((e,t)=>(0,E.default)((e=>e.followingWork(t))))).appendTo(O.header),O.description.style.bind(v.truthy,"work-author-list").style.bind(j.default.Every(e,L,v.truthy),"work-author-list--flush").append((0,x.default)().use(v,((e,t)=>t&&(0,p.default)(t).style("work-author")))),O.content.style.bind(f.map(e,(e=>!!e.bookmarks)),"work-actions-and-content");const q=(0,c.default)().style("work-content").appendTo(O.content),G=(0,x.default)().style("work-actions").appendTo(O.content),W=c.default.Builder((e=>e.and(h.default).style("work-actions-action").useGradient(S))),U=(0,j.default)(void 0),F=(0,j.default)(void 0);G.use(f,((e,t)=>{if(U.value=void 0,F.value=void 0,t.bookmarks&&t.bookmarks){const o=!t.bookmarks.url_read_last&&Date.now()-new Date(t.time_publish??0).getTime()<N.default.weeks(1);U.value=(0,y.default)().setAestheticStyle(!1).style("work-bookmarks-status").style.toggle(!!o,"work-bookmarks-status--new").text.use((e=>{if(t.bookmarks){if(t.bookmarks.read_completed)return e["work/bookmarks/label/finished"]();if(t.bookmarks.url_read_last!==t.bookmarks.url_read_furthest)return e["work/bookmarks/label/progress"]((t.bookmarks?.chapters_from_last_patreon?t.chapter_count_public-t.bookmarks.chapters_from_last_patreon:1).toLocaleString(navigator.language),t.chapter_count_public.toLocaleString(navigator.language));if(t.bookmarks.chapters_from_last_patreon){const o=t.bookmarks?.chapters_from_last_patreon??1;return 1===o?e["work/bookmarks/label/new-content-single"](o):e["work/bookmarks/label/new-content"](o)}return t.bookmarks.url_read_last?e["work/bookmarks/label/caught-up"]():o?e["work/bookmarks/label/not-tried-new"]():e["work/bookmarks/label/not-tried"]()}})).prepend(o&&(0,b.default)("star").style("work-bookmarks-status-icon")).appendTo(e);const a=t.bookmarks.url_next||t.bookmarks.read_completed||!t.bookmarks.url_read_last?`/work/${t.author}/${t.vanity}/chapter/${!t.bookmarks.read_completed&&t.bookmarks.url_next||t.bookmarks.url_first}`:`/work/${t.author}/${t.vanity}`;F.value=(0,w.default)(a).and(W).ariaLabel.use((e=>e[t.bookmarks?.read_completed?"work/action/alt/reread":t.bookmarks?.url_next?"work/action/alt/continue":t.bookmarks?.url_read_last?"work/action/alt/see-all":"work/action/alt/read"](t.name))).text.use(t.bookmarks.read_completed?"work/action/label/reread":t.bookmarks.url_next?"work/action/label/continue":t.bookmarks.url_read_last?"work/action/label/see-all":"work/action/label/read").appendTo(e)}}));const V=f.map(e,(e=>"Patreon"===e.visibility&&e.patreon?.tiers[0]||void 0));(0,c.default)().style("work-patreon-visibility-header","patreon-icon-before").style.bind(L,"work-patreon-visibility-header--flush").append((0,c.default)().style("work-patreon-visibility-header-label").text.use("work/patreon/label")).append((0,c.default)().style("work-patreon-visibility-header-tier").text.bind(V.map(e,(e=>e&&u.default.translateTier(e))))).appendToWhen(V.truthy,q);const H=f.map(e,(e=>e.lock_reason));(0,c.default)().style("work-lock-reason").style.bind(L,"work-lock-reason--flush").classes.add("markdown").append((0,c.default)().style("work-lock-reason-heading").append((0,b.default)("lock")).append((0,c.default)().text.use("work/locked/label"))).append((0,c.default)().text.use("work/locked/description")).append((0,c.default)("blockquote").style("work-lock-reason-text").text.bind(H)).appendToWhen(H.truthy,q);const Y=f.map(e,(e=>e.description)),z=f.map(e,(e=>e.synopsis),((e,t)=>e?.body===t?.body&&e?.mentions.length===t?.mentions.length&&e?.mentions[0]?.vanity===t?.mentions[0]?.vanity));(0,x.default)().use(j.default.Use(e,{isFlush:L,description:Y,synopsis:z}),((e,{isFlush:t,description:o,synopsis:a})=>{const i=t;t||=n??!1;(t||a?.body&&o)&&(0,c.default)().style("work-description").style.toggle(!a?.body,"work-description--solo").style.toggle(i,"work-description--flush").style.toggle(!o,"placeholder").tweak((e=>{o?e.text.set(o):e.text.use("work/description/empty")})).appendTo(e),t||(0,c.default)().style("work-synopsis").style.toggle(!a?.body&&!o,"placeholder").append((0,x.default)().tweak((e=>{const t=a?.body?a:o;"string"==typeof t?e.text.set(t):t.body?e.setMarkdownContent(t):e.text.use("work/description/empty")}))).appendTo(e)})).appendTo(q),(0,P.default)().set(f,{initialiseGlobalTags:e=>e.style.bind(L,"work-tags--flush"),initialiseCustomTags:e=>e.style.bind(L,"work-tags--flush")}).appendTo(q);const J=j.default.Map(e,[v,f,s.default.Auth.account],((e,t,o)=>_??t.license??(e?.vanity===o?.vanity?o?.license:void 0)??void 0),((e,t)=>typeof e==typeof t&&e?.name===t?.name&&e?.link===t?.link));(0,x.default)().appendTo(q).use(j.default.Use(e,{work:f,author:v,license:J}),((e,{work:t,author:o,license:a})=>{if(t.synopsis)return(0,M.default)(o?.name,a).style("work-license")})),O.footer.and(t.WorkFooter,f),(0,T.default)(f.map(e,(e=>`${A.default.API_ORIGIN}work/${e.author}/${e.vanity}/rss.xml`))).appendTo(O.footer.right);const K=f.map(e,(e=>e.author)),Q=s.default.Auth.loggedInAs(e,K),X=f.map(e,(e=>e.statistics)),Z=(0,x.default)().appendTo(O.footer).use(j.default.Use(e,{isOwnWork:Q,statistics:X}),((e,{isOwnWork:t,statistics:o})=>t&&o&&(0,R.default)().style("work-author-statistics").section("shared/stat/section/logged-in",(e=>e.stat("work/stat/reads/label",o?.read_count).stat("work/stat/hearts/label",o?.reaction_count).stat("work/stat/comments/label",o?.comment_count))).section("shared/stat/section/logged-out",(e=>e.stat("work/stat/visits/label",o?.visits?BigInt(o.visits):void 0).stat("work/stat/chapter-visits/label",o?.chapter_visits?BigInt(o.chapter_visits):void 0)))));return e.is(k.default)||O.setActionsMenu(((e,t)=>{e.subscribeReanchor(((e,t)=>{t||e.anchor.reset().anchor.add("off right","centre",`.${m.BlockClasses.Main}`).anchor.orElseHide()})),f.value.author===s.default.Auth.author.value?.vanity?((0,h.default)().type("flush").setIcon("pencil").text.use("work/action/label/edit").event.subscribe("click",(()=>navigate.toURL(`/work/${f.value.author}/${f.value.vanity}/edit`))).appendTo(e),(0,h.default)().type("flush").setIcon("plus").text.use("work/action/label/new-chapter").event.subscribe("click",(()=>navigate.toURL(`/work/${f.value.author}/${f.value.vanity}/chapter/new`))).appendTo(e),(0,h.default)().type("flush").setIcon("plus").text.use("view/work-edit/update/action/bulk-chapters").event.subscribe("click",(()=>navigate.toURL(`/work/${f.value.author}/${f.value.vanity}/chapter/new/bulk`))).appendTo(e),(0,h.default)().type("flush").setIcon("trash").text.use("work/action/label/delete").event.subscribe("click",(()=>d.default.delete(f.value,e))).appendTo(e)):s.default.Auth.loggedIn.value&&((0,h.default)().type("flush").bindIcon(j.default.Map(e,[r.default,f],((e,t)=>r.default.followingWork(t)?"circle-check-big":"circle"))).text.bind(j.default.Map(e,[r.default,f],((e,t)=>e=>r.default.followingWork(t)?e["work/action/label/unfollow"]():e["work/action/label/follow"]()))).event.subscribe("click",(()=>r.default.toggleFollowingWork(f.value))).appendTo(e),(0,h.default)().type("flush").bindIcon(j.default.Map(e,[r.default,f],((e,t)=>r.default.ignoringWork(t)?"ban":"circle"))).text.bind(j.default.Map(e,[r.default,f],((e,t)=>e=>r.default.ignoringWork(t)?e["work/action/label/unignore"]():e["work/action/label/ignore"]()))).event.subscribe("click",(()=>r.default.toggleIgnoringWork(f.value))).appendTo(e),s.default.Auth.isModerator.value||(0,h.default)().type("flush").setIcon("flag").text.use("work/action/label/report").event.subscribe("click",(e=>C.default.prompt(e.host,$,{reportedContentName:f.value.name,async onReport(e){const t=await i.default.query({body:e,params:d.default.reference(f.value)});toast.handleError(t)}}))).appendTo(e)),s.default.Auth.isModerator.value&&(0,h.default)().type("flush").setIcon("shield-halved").text.use("work/action/label/moderate").event.subscribe("click",(e=>I.default.prompt(e.host,B.create(f.value)))).appendTo(e)})),O.extend((e=>({work:f,statistics:Z,actions:G,bookmarkStatus:U,bookmarkAction:F})))}));t.default=L})),define("ui/view/AuthorView",["require","exports","endpoint/author/EndpointAuthorGet","endpoint/work/EndpointWorkGetAllAuthor","model/PagedListData","model/Session","ui/Component","ui/component/Author","ui/component/core/Block","ui/component/core/Button","ui/component/core/Link","ui/component/core/Paginator","ui/component/core/Slot","ui/component/Work","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),t.default=(0,h.default)({async load(e){const t=await o.default.query({params:e});if(t instanceof Error)throw t;return{author:t.data}},create(e,{author:t}){const o=(0,m.default)("author");(0,l.default)(t).viewTransition("author-view-author").setContainsHeading().appendTo(o.content);const h=n.default.fromEndpoint(25,a.default.prep({params:{author:e.vanity}}));return(0,c.default)().viewTransition("author-view-works").tweak((e=>e.title.text.use("view/author/works/title"))).setActionsMenu((t=>t.append((0,p.default)().if(i.default.Auth.author.map(t,(t=>t?.vanity===e.vanity)),(()=>(0,s.default)().type("flush").setIcon("plus").text.use("view/author/works/action/label/new").event.subscribe("click",(()=>navigate.toURL("/work/new")))))))).set(h,0,((e,o)=>e.append(...o.map((o=>(0,d.default)(`/work/${t.vanity}/${o.vanity}`).and(f.default,o,t).viewTransition(!1).type("flush").appendTo(e)))))).orElse((e=>(0,u.default)().type("flush").tweak((e=>(0,r.default)().style("placeholder").text.use("view/author/works/content/empty").appendTo(e.content))).appendTo(e))).appendTo(o.content),o}})})),define("endpoint/chapter/EndpointChapterGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/get","get")})),define("endpoint/chapter/EndpointChapterGetPaged",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapters/paged","get")})),define("endpoint/work/EndpointWorkGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/get","get")})),define("endpoint/chapter/EndpointChapterDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/delete","post")})),define("model/Chapters",["require","exports","endpoint/chapter/EndpointChapterDelete","ui/component/core/ConfirmDialog"],(function(e,t,o,a){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),function(e){e.resolve=function(e,t){return e?t.find((t=>t.author===e.author&&t.work===e.work&&t.url===e.url)):void 0},e.work=function(e){return e?{author:e.author,vanity:e.work}:void 0},e.reference=function(e){return e?{author:e.author,work:e.work,url:e.url}:void 0}}(n||(n={})),t.default=Object.assign(n,{async delete(e,t){if(!e)return!0;if(!await a.default.prompt(t??null,{dangerToken:"delete-chapter",bodyTranslation:t=>t["chapter/action/delete/confirm"](e.name)}))return!1;const n=await o.default.query({params:e});return!toast.handleError(n)&&(navigate.isURL(`/work/${e.author}/${e.work}/chapter/${e.url}/**`)&&navigate.toURL(`/work/${e.author}/${e.work}`),!0)}})})),define("endpoint/chapter/EndpointChapterCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/chapter/create","post")})),define("endpoint/chapter/EndpointChapterUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/update","post")})),define("ui/component/core/RadioRow",["require","exports","ui/Component","ui/component/core/ext/Input","ui/component/core/RadioButton","ui/utility/Applicator","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder((e=>{const t=(0,r.default)(void 0),o={};let l;return e.and(a.default).style("radio-row").ariaRole("group").extend((e=>({selection:t,default:(0,i.default)(e,(e=>t.value=e)),add(a,i){const r=o[a]=(0,n.default)().style("radio-row-option").type("flush").setIcon().tweak(i,a).setId(a).setName(l).use(t.map(e,(e=>e===a))).receiveFocusedClickEvents().event.subscribe("click",(e=>{t.value=a,e.preventDefault(),e.stopImmediatePropagation()})).appendTo(e);return r.style.bind(r.checked,"radio-row-option--selected"),r.bindDisabled(r.checked,"selection"),e}}))).extend((e=>({setLabel(t){l=t?.for;for(const e of Object.values(o))e.setName(l);return t?.setInput(e),e}})))}));t.default=l})),define("ui/component/VisibilityOptions",["require","exports","model/Patreon","model/Session","ui/component/core/Dropdown","ui/component/core/RadioRow","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),i=__importDefault(i),r=__importDefault(r),t.default=function(e,t){const l=(e,t)=>e.style("visibility-options-option").text.use(`shared/form/visibility/${t.toLowerCase()}`),u=a.default.Auth.account.map(e,(e=>e?.patreon_campaign)),s=(0,i.default)().add("Public",l).add("Patreon",((e,t)=>e.tweak(l,t).style("visibility-options-option-patreon").style.bind(u.falsy,"radio-row-option--hidden"))).add("Private",l).default.bind(t.map(e,(e=>e?.visibility??"Private")));e.label((e=>e.text.use("shared/form/visibility/label"))).content(((e,t)=>e.append(s.setLabel(t))));const d=s.selection.map(e,(e=>"Patreon"===e)),c=r.default.Use(e,{campaign:u,visibilityStateIsPatreon:d}).map(e,(({campaign:e,visibilityStateIsPatreon:t})=>e&&t?e.tiers:void 0)),p=(0,n.CheckDropdown)({translateSelection:(e,t)=>o.default.translateTiers(t,c.value??[])});return e.label((e=>e.text.use("shared/form/visibility-patreon-tier/label"))).if(c.truthy).content(((o,a)=>o.append(p.tweak((e=>{c.use(e,(t=>{e.clear();for(const o of t??[])e.add(o.tier_id,{translation:e=>e=>e["shared/term/patreon-tier"]({NAME:o.tier_name,PRICE:`$${(o.amount/100).toFixed(2)}`})})})),e.selection.subscribeManual(((t,o)=>{if(o?.length||1!==t?.length)return;const a=c.value?.find((e=>e.tier_id===t[0]));if(!a)return;const n=c.value?.filter((e=>e.amount>a.amount)).sort(((e,t)=>e.amount-t.amount));n?.length&&(e.selection.value=[...t,...n.map((e=>e.tier_id))])}))})).default.bind(t.map(e,(e=>e?.patreonTiers??[]))).setLabel(a)))),{visibility:s,patreonTiers:p}}})),define("ui/component/WorkStatusDropdown",["require","exports","model/Works","ui/Component","ui/component/core/Dropdown","utility/State"],(function(e,t,o,a,n,i){var r;Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),i=__importDefault(i),function(e){e.Radio=a.default.Builder(((e,t)=>{t=i.default.get(t);const a=e.and(n.RadioDropdown).style("work-status-dropdown");a.button.style("work-status-dropdown-button");for(const e of o.WORK_STATUSES){const t=e.toLowerCase();a.add(e,{translation:e=>e=>e[`work/status/${t}`](),tweakButton:(a,n)=>a.setIcon(o.WORK_STATUS_ICONS[e]).tweak((e=>e.icon?.style("work-status-icon"))).style("work-status-dropdown-option").style(`work-status-dropdown-option--${t}`)})}return a.selection.value=t.value,a.selection.use(a,(e=>{e??=t.value;const n=e.toLowerCase();a.button.setIcon(o.WORK_STATUS_ICONS[e]).tweak((e=>e.icon?.style("work-status-icon"))).style.remove(...o.WORK_STATUSES.map((e=>`work-status-dropdown-button--${e.toLowerCase()}`))).style(`work-status-dropdown-button--${n}`)})),a})),e.Check=a.default.Builder(((e,t)=>{t=i.default.get(t);const a=e.and(n.CheckDropdown).style("work-status-dropdown");a.button.style("work-status-dropdown-button");for(const e of o.WORK_STATUSES){const t=e.toLowerCase();a.add(e,{translation:e=>e=>e[`work/status/${t}`](),tweakButton:(a,n)=>a.setIcon(o.WORK_STATUS_ICONS[e]).tweak((e=>e.icon?.style("work-status-icon","work-status-dropdown-button-icon"))).tweak((e=>e.textWrapper.style.bind(e.checked.falsy,"work-status-dropdown-button-label--unchecked"))).style.bind(a.checked.falsy,"work-status-dropdown-button--unchecked").style("work-status-dropdown-option").style(`work-status-dropdown-option--${t}`)})}return a.selection.value=t.value,a.selection.use(a,(e=>{e??=t.value,a.button.setIcon(0===e.length?"circle":e.length>1?"circle-dot":o.WORK_STATUS_ICONS[e[0]]).tweak((e=>e.icon?.style("work-status-icon"))).style.remove(...o.WORK_STATUSES.flatMap((e=>[`work-status-dropdown-button--${e.toLowerCase()}`,...o.WORK_STATUSES.flatMap((t=>[`work-status-dropdown-button--${e.toLowerCase()}-${t.toLowerCase()}`,...o.WORK_STATUSES.flatMap((a=>[`work-status-dropdown-button--${e.toLowerCase()}-${t.toLowerCase()}-${a.toLowerCase()}`,...o.WORK_STATUSES.map((o=>`work-status-dropdown-button--${e.toLowerCase()}-${t.toLowerCase()}-${a.toLowerCase()}-${o.toLowerCase()}`))]))]))])));const n=e.join("-").toLowerCase();a.button.style(`work-status-dropdown-button--${n}`)})),a}))}(r||(r={})),t.default=r})),define("endpoint/chapter/EndpointChapterCreateBulkCancel",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/chapter/create/bulk/cancel","post")})),define("endpoint/chapter/EndpointChapterCreateBulkFinish",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/chapter/create/bulk/finish","post")})),define("endpoint/chapter/EndpointChapterCreateBulkQueue",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/chapter/create/bulk/queue","post")})),define("endpoint/chapter/EndpointChapterGetAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/chapters/list","get")})),define("endpoint/moderation/EndpointModerateChapterCensor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/moderation/work/{author}/{work}/chapter/{url}/censor","post")})),define("endpoint/report/EndpointReportChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/report/work/{author}/{work}/chapter/{url}","post")})),define("model/Authors",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.resolve=function(e,t){return e?t.find((t=>t.vanity===e)):void 0}}(o||(o={})),t.default=o})),define("ui/component/Chapter",["require","exports","endpoint/moderation/EndpointModerateChapterCensor","endpoint/report/EndpointReportChapter","model/Chapters","model/Session","ui/Component","ui/component/core/Button","ui/component/core/ext/CanHasActionsMenu","ui/component/core/Link","ui/component/core/Timestamp","ui/component/ModerationDialog","ui/component/ReportDialog","utility/maths/Maths","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importStar(c),p=__importStar(p),f=__importDefault(f),m=__importDefault(m);const h=(0,p.ReportDefinition)({titleTranslation:"shared/term/author",reasons:{"inadequate-tags":!0,"inappropriate-field":!0,spam:!0,harassment:!0,plagiarism:!0,"tos-violation":!0}}),g=(0,c.ModerationDefinition)((e=>({titleTranslation:"shared/term/chapter",moderatedContentName:e.name??(t=>t["view/chapter/number/label"](e.url)),censor:(0,c.ModerationCensor)({properties:{name:c.ModerationCensor.plaintext(e.name),body:c.ModerationCensor.markdown(e.body),notes_before:c.ModerationCensor.markdown(e.notes_before),notes_after:c.ModerationCensor.markdown(e.notes_after)},async censor(t){const a=await o.default.query({params:n.default.reference(e),body:t});toast.handleError(a)}})})));function v(e,t,o,u,s=!1){return e.appendAction("patreon",m.default.get(t),((e,t)=>!s&&"Patreon"===t.visibility&&t.patreon&&(0,r.default)().style("chapter-patreon-tier","patreon-icon-after").text.use((e=>t.patreon&&e["shared/term/patreon-tier"]({NAME:t.patreon.tiers[0].tier_name,PRICE:`$${((t.patreon.tiers[0].amount??0)/100).toFixed(2)}`}))))).appendAction("edit",i.default.Auth.author,((e,a)=>u&&u.vanity===a?.vanity&&(0,l.default)().type("flush").setIcon("pencil").text.use("chapter/action/label/edit").event.subscribe("click",(()=>navigate.toURL(`/work/${u.vanity}/${o.vanity}/chapter/${m.default.value(t).url}/edit`))))).appendAction("delete",i.default.Auth.author,((e,o)=>u&&u.vanity===o?.vanity&&(0,l.default)().type("flush").setIcon("trash").text.use("chapter/action/label/delete").event.subscribe("click",(()=>n.default.delete(m.default.value(t)))))).appendAction("report",i.default.Auth.author,((e,o)=>o&&u?.vanity!==o?.vanity&&!i.default.Auth.isModerator.value&&(0,l.default)().type("flush").setIcon("flag").text.use("chapter/action/label/report").event.subscribe("click",(e=>p.default.prompt(e.host,h,{reportedContentName:m.default.value(t).name??(e=>e["view/chapter/number/label"](m.default.value(t).url)),async onReport(e){const o=await a.default.query({body:e,params:n.default.reference(m.default.value(t))});toast.handleError(o)}}))))).appendAction("moderate",i.default.Auth.author,((e,o)=>i.default.Auth.isModerator.value&&"body"in m.default.value(t)&&(0,l.default)().type("flush").setIcon("shield-halved").text.use("chapter/action/label/moderate").event.subscribe("click",(e=>c.default.prompt(e.host,g.create(m.default.value(t)))))))}const y=Object.assign(r.default.Builder(((e,t,o,a)=>{e=(0,s.default)(`/work/${a.vanity}/${o.vanity}/chapter/${t.url}`).style("chapter").style.toggle("Private"===t.visibility,"chapter--private").style.toggle("Patreon"===t.visibility,"chapter--patreon","patreon-icon-after");const n=f.default.parseIntOrUndefined(t.url),i=(0,r.default)().style("chapter-number").text.set(n?`${n.toLocaleString(navigator.language)}`:"").appendTo(e),l=(0,r.default)().style("chapter-name").style.toggle(!t.name,"chapter-name--auto").text.set(_||t.name||(n?e=>e["view/chapter/number/label"](n):void 0)||(t.url.includes(".")?e=>e["view/chapter/number/interlude/label"](t.url):void 0)).appendTo(e),c=(0,r.default)().style("chapter-right").appendTo(e);let p;return p="Private"===t.visibility?(0,r.default)().style("timestamp","chapter-timestamp").text.use("chapter/state/private").appendTo(c):t.time_publish?(0,d.default)(t.time_publish).style("chapter-timestamp").appendTo(c):void 0,e.and(u.default).setActionsMenuButton((e=>e.type("inherit-size").style("chapter-actions-menu-button").appendTo(c))).setActionsMenu(((e,n)=>v(e,t,o,a))).extend((e=>({chapter:t,number:i,chapterName:l,timestamp:p})))})),{initActions:v});t.default=y})),define("ui/component/core/SlotArray",["require","exports","ui/Component","ui/component/core/Slot"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=o.default.Builder((e=>{let t;return e.and(a.default),e.extend((e=>({use(o,n){t?.();const i=[];return t=o.useEach(e,{onItem(t,o){const r=(0,a.default)().extend((()=>({index:0}))),l=t.map(r,(e=>e.index));l.use(r,(e=>r.index=e));const u=t.map(r,(e=>e.value),!1);r.use(u,((t,o)=>n(Object.assign(t,{index:l,wrapper:e,getSiblings:()=>e.getChildren(a.default)}),o)));const s=i.findIndex((e=>e.index>t.value.index)),d=i[s];e.insert("before",d,r),-1===s?i.push(r):i.splice(s,0,r),t.value.removed.match(e,!0,(()=>{r.remove(),i.filterInPlace((e=>e!==r))}))},onMove(t,o,a){const n=i.splice(t,o-t),r=t<a?a-(o-t)+1:a,l=n.map((e=>e.index)).splat(Math.max),u=i.find((e=>e.index>l));i.splice(r,0,...n);for(const t of n)e.insert("before",u,t)},onMoveAt(t,o){const a=t.map((e=>i[e]));i.sort(((e,t)=>e.index-t.index));const n=a.map((e=>e.index)).splat(Math.max),r=i.find((e=>e.index>n));for(const t of a)e.insert("before",r,t)}}),e}})))}));t.default=n})),define("utility/Documents",["require","exports","jszip","mammoth","ui/component/core/TextEditor","utility/Functions","utility/State","utility/Task"],(function(e,t,o,a,n,i,r,l){var u;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),function(e){function t(e){return e=(e=(e=e.slice(e.lastIndexOf("/")+1)).slice(e.lastIndexOf("\\")+1)).slice(0,e.lastIndexOf("."))}e.basename=t,e.importFrom=function(e,u){return r.default.Async(e,u,(async(e,r,u)=>{if(!e)return;const s=[],d=[];for(let t=0;t<e.length;t++){const o=e[t];if(r.aborted)return;u(t/e.length*.1,(o=>o["utility/documents/load/discovering"](t,e.length))),await l.default.yield(),await c("",o.name,{text:()=>o.text().then((e=>({text:e,error:void 0})),(e=>({text:void 0,error:e}))),json:()=>o.text().then((e=>JSON.parse(e))).then((e=>({data:e,error:void 0})),(e=>({data:void 0,error:e}))),raw:()=>o.arrayBuffer().then((e=>({buffer:e,error:void 0})),(e=>({buffer:void 0,error:e})))})}async function c(e,t,a,n){const i=t.slice(t.lastIndexOf(".")),r=e+"/"+(n??t);if(".zip"!==i)d.push({dir:e,path:t,file:a});else{const{buffer:e,error:n}=await a.raw();if(n)return void s.push({file:r,error:n});const i=t,l=await o.default.loadAsync(e);for(const[e,t]of Object.entries(l.files)){if(t.dir)return;await c(i,e,{text:()=>t.async("text").then((e=>({text:e,error:void 0})),(e=>({text:void 0,error:e}))),json:()=>t.async("text").then((e=>JSON.parse(e))).then((e=>({data:e,error:void 0})),(e=>({data:void 0,error:e}))),raw:()=>t.async("arraybuffer").then((e=>({buffer:e,error:void 0})),(e=>({buffer:void 0,error:e})))})}}}for(let e=0;e<d.length;e++){const{dir:t,path:o,file:a}=d[e];if(r.aborted)return;u(.1+e/d.length*.9,(t=>t["utility/documents/load/processing"](e,d.length))),await l.default.yield(),await p(t,o,a,o)}async function p(e,o,n,r){const u=o.slice(o.lastIndexOf(".")),d=e+"/"+(r??o);switch(u){case".txt":{const{text:e,error:t}=await n.text();return t?void s.push({file:d,error:t}):f(d,(t=>!!t.mirror?.pasteText(e)))}case".md":{const{text:e,error:t}=await n.text();return t?void s.push({file:d,error:t}):f(d,(t=>(t.importMarkdown(e),!0)))}case".docx":{const{buffer:r,error:u}=await n.raw();if(u)return void s.push({file:d,error:u});const{result:c,error:f}=await a.default.convertToHtml({arrayBuffer:r}).then((e=>({result:e,error:void 0})),(e=>({result:void 0,error:new Error("Unable to convert docx to html:",{cause:e})})));return f?void s.push({file:d,error:f}):(await l.default.yield(),p(e,o+`/${t(o)}.html`,{text:()=>Promise.resolve({text:c.value,error:void 0}),json:i.default.throwing("This file's text should be processed as HTML"),raw:i.default.throwing("This file's text should be processed as HTML")},o))}case".html":{const{text:e,error:t}=await n.text();return t?void s.push({file:d,error:t}):f(d,(t=>!!t.mirror?.pasteHTML(e)))}default:return void s.push({file:d,error:new Error(`Unsupported file type ${u}`)})}}function f(e,o){try{const a=n.default.passThrough(o);s.push({file:e,title:t(e),body:a})}catch(t){s.push({file:e,error:t})}}return s.sort(((e,t)=>e.file.localeCompare(t.file)))}))}}(u||(u={})),t.default=u})),define("ui/view/ChapterNewBulkView",["require","exports","endpoint/chapter/EndpointChapterCreateBulkCancel","endpoint/chapter/EndpointChapterCreateBulkFinish","endpoint/chapter/EndpointChapterCreateBulkQueue","endpoint/chapter/EndpointChapterGetAll","endpoint/work/EndpointWorkGet","lang/en-nz","model/Chapters","model/PagedListData","model/Patreon","model/Session","ui/Component","ui/component/Chapter","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/ConfirmDialog","ui/component/core/Details","ui/component/core/LabelledTable","ui/component/core/Link","ui/component/core/Loading","ui/component/core/Paginator","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/SlotArray","ui/component/core/Small","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/VisibilityOptions","ui/component/Work","ui/InputBus","ui/view/chapter/ChapterEditForm","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Documents","utility/maths/Maths","utility/Objects","utility/State","utility/string/Strings","utility/Task"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,w,k,T,x,D,O,S,E,M,I,C,R,P,A,j,N,$,B,L,q,G,W,U){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),O=__importDefault(O),S=__importDefault(S),E=__importDefault(E),M=__importDefault(M),I=__importStar(I),C=__importDefault(C),R=__importDefault(R),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N),$=__importDefault($),B=__importDefault(B),L=__importDefault(L),q=__importDefault(q),G=__importDefault(G),W=__importDefault(W),U=__importDefault(U),t.default=(0,$.default)({requiresLogin:!0,async load(e){const t=await r.default.query({params:u.default.work(e)});if(t instanceof Error)throw t;const o=t.data.synopsis?.mentions.find((t=>t.vanity===e.author));return{work:t.data,author:o}},create(e,{work:t,author:r}){const u=(0,N.default)("chapter-bulk");delete t.synopsis,delete t.custom_tags,(0,k.default)(`/work/${r?.vanity}/${t.vanity}`).and(P.default,t,r).viewTransition("chapter-view-work").style("view-type-chapter-work").setContainsHeading().appendTo(u.content);const $=(e,t)=>(0,S.default)().append((()=>{const t=L.default.parseIntOrUndefined(e);if(t)return(0,p.default)().style("view-type-chapter-bulk-chapter-display-number").text.use((e=>e["view/chapter/number/label"](t)))})()).append((0,p.default)().style("view-type-chapter-bulk-chapter-display-title").text.set(t)),F=(0,p.default)().style("view-type-chapter-bulk-content").appendTo(u.content),V=(0,G.default)(void 0),H=(0,I.default)().tabType("steps").appendTo(F),Y=(0,G.default)(void 0),z=()=>S.default.using(Y,((e,t)=>t&&(0,p.default)().style("view-type-chapter-bulk-position-display").append((0,p.default)().style("view-type-chapter-bulk-position-display-label").text.use(`view/chapter-create-bulk/position/label/position/${t.position}`)).append($(t.relative_to,t.title)).appendWhen(Y.truthy,(0,g.default)().tweak((e=>{J.use(e,(t=>{t?e.type.remove("primary"):e.type("primary")}))})).style("view-type-chapter-bulk-position-display-action").text.bind(J.map(e,(e=>t=>t["view/chapter-create-bulk/position/action/"+(e?"cancel-change":"change")]()))).event.subscribe("click",(e=>{J.value=!J.value,Q.header.element.scrollIntoView({behavior:"instant"})}))))),J=(0,G.default)(!1),K=(0,I.Tab)().text.use("view/chapter-create-bulk/position/tab").bindDisabled(V.truthy,"uploading or done").addTo(H),Q=(0,h.default)().type("flush").style("view-type-chapter-bulk-block","view-type-chapter-bulk-block--not-last").tweak((e=>e.title.text.use("view/chapter-create-bulk/position/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/position/description"))).tweak((o=>o.content.appendWhen(G.default.Some(o,Y.falsy,J),(0,x.default)().viewTransition("work-view-chapters").style("view-type-work-chapter-list").set(s.default.fromEndpoint(25,i.default.prep({params:t})),0,((a,n)=>{a.style("chapter-list").style("view-type-work-chapter-list--moving-chapter");const i=n.at(0);i&&l("before",i).appendTo(a);for(const o of n)(0,f.default)(o,t,r??{vanity:e.author}).style("view-type-work-chapter","view-type-work-chapter--has-moving-sibling").attributes.append("inert").appendTo(a),l("after",o).appendTo(a);function l(e,t){const n={relative_to:t.url,position:e,title:t.name??(e=>e["view/chapter/number/label"](t.url))},i=Y.map(a,(e=>!!e&&e.relative_to===n.relative_to&&e.position===n.position));return(0,p.default)().style("view-type-work-chapter-slot-wrapper").style("view-type-work-chapter-slot-wrapper--has-moving-chapter").append((0,g.default)().style("chapter","view-type-work-chapter-slot").style.bind(i,"view-type-work-chapter-slot--chosen").event.subscribe("click",(()=>{Y.value=n,J.value=!1,o.header.element.scrollIntoView({behavior:"instant"})})))}})).orElse((e=>(0,h.default)().type("flush").tweak((e=>(0,O.default)().text.use("view/work/chapters/content/empty").appendTo(e.content))).appendTo(e)))).append(z()).append((0,m.default)().style("view-type-chapter-bulk-step-action-row").tweak((e=>e.right.append(K.createNextButton())))))).appendToWhen(V.falsy,K.content),X=(0,G.default)(null),Z=(0,G.default)(void 0),ee=Z.mapManual((e=>{if(!e)return;const t=new RegExp(`(?:${e.source})|`).exec("");return(t?.length??0)<=1?void 0:t})),te=(0,G.default)(void 0),oe=B.default.importFrom(u,X),ae=oe.state.map(u,(e=>({loading:!e.settled,imports:(e.value??[]).map((e=>({...e,enabled:!e.error})))}))),ne=e=>`light-dark(oklch(30% 100% ${(100+60*e)%360}deg), oklch(70% 100% ${(100+60*e)%360}deg))`,ie=e=>{if("{auto}"===te.value)return"";const t=e.title;if(!Z.value)return e.title;const o=Z.value.exec(t);return!o||o.length<=1&&o[0].length===t.length?e.title:(te.value??"{filename}").replaceAll(/{filename(?::(\d+))?}/g,((e,a)=>{const n=+a;return isNaN(n)?t:o[n]??""}))},re=(0,p.default)("input").style("view-type-chapter-bulk-import-list-actions-import-input").attributes.set("type","file").attributes.append("multiple").event.subscribe("change",(e=>X.value=e.host.element.files)).appendTo(F),le=(0,I.Tab)().text.use("view/chapter-create-bulk/import/tab").bindDisabled(V.truthy,"uploading or done").addTo(H);(0,h.default)().type("flush").style("view-type-chapter-bulk-block","view-type-chapter-bulk-block--not-last").tweak((e=>e.title.text.use("view/chapter-create-bulk/import/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/import/description"))).tweak((e=>e.content.style("view-type-chapter-bulk-import-list-wrapper").append((0,p.default)().style("view-type-chapter-bulk-import-list").append((0,m.default)().style("view-type-chapter-bulk-import-list-actions").tweak((e=>{(0,g.default)().setIcon("file-import").type("flush").text.bind(X.map(e,(e=>t=>t[e?.length?"view/chapter-create-bulk/import/action/replace":"view/chapter-create-bulk/import/action/select"]()))).event.subscribe("click",(()=>re.element.click())).appendTo(e.left),(0,g.default)().setIcon("square-check").type("flush").text.use("view/chapter-create-bulk/shared/action/select-all").event.subscribe("click",(()=>{for(const e of ae.value.imports)e.error||(e.enabled=!0);ae.emit()})).appendToWhen(ae.map(e,(e=>!e.imports.every((e=>e.enabled)))),e.right),(0,g.default)().setIcon("square-minus").type("flush").text.use("view/chapter-create-bulk/shared/action/deselect-all").event.subscribe("click",(()=>{for(const e of ae.value.imports)e.error||(e.enabled=!1);ae.emit()})).appendToWhen(ae.map(e,(e=>e.imports.some((e=>e.enabled)))),e.right)}))).append(S.default.using(ae,((t,o)=>{if(o.loading)return(0,T.default)().style("view-type-chapter-bulk-import-list-loading").use(oe);const a=o.imports;if(!a.length)return(0,O.default)().style("view-type-chapter-bulk-import-list-empty-paragraph").text.use("view/chapter-create-bulk/import/empty");let n=!0;for(const o of a)(0,b.default)().style("view-type-chapter-bulk-import").style.toggle(n=!n,"view-type-chapter-bulk-import--odd").tweak((e=>{e.style.bind(e.state,"view-type-chapter-bulk-import--open"),e.summary.style.remove("button").style("view-type-chapter-bulk-import-summary").style.bind(e.state,"view-type-chapter-bulk-import-summary--open");const t=e.summary.hoveredOrHasFocused.mapManual((e=>!e&&!o.enabled)),a=(0,p.default)().style("view-type-chapter-bulk-import-summary-meta").style.bind(t,"view-type-chapter-bulk-import-summary-meta--disabled").appendTo(e.summary);o.title&&(0,p.default)().style("view-type-chapter-bulk-import-summary-title").text.bind(Z.map(a,(e=>{if(!e)return o.title;e.lastIndex=0;const t=e.exec(o.title);if(!t||!t[1]||!t[0])return o.title;if(t[1]){const e={content:[]};let a=0;for(let n=1;n<t.length;n++){const[i,r]=t.indices[n],l=o.title.slice(a,i);a=r,e.content.push({content:l,tag:"SM"},{content:(0,p.default)("strong").style.setProperty("color",ne(n)).text.set(t[n])})}const n=o.title.slice(a);return e.content.push({content:n,tag:"SM"}),t=>e}const[a,n]=t.indices[0],i=o.title.slice(0,a),r=o.title.slice(n);return e=>({content:[{content:i,tag:"SM"},{content:t[0],tag:"B"},{content:r,tag:"SM"}]})}))).appendTo(a),(0,O.default)().style("view-type-chapter-bulk-import-summary-filename").text.set(o.file).appendTo(a),o.error&&(0,p.default)().style("view-type-chapter-bulk-import-summary-error").text.set(o.error.message).appendTo(a),o.error||(0,v.default)().type("flush").style("view-type-chapter-bulk-import-summary-checkbox").tweak((e=>e.icon?.style("view-type-chapter-bulk-import-summary-checkbox-icon").style.bind(e.hoveredOrHasFocused,"view-type-chapter-bulk-import-summary-checkbox-icon--focus"))).setChecked(o.enabled).event.subscribe("change",(e=>{o.enabled=e.host.checked.value,ae.emit()})).appendTo(e.summary),o.body&&(0,p.default)().style("view-type-chapter-bulk-import-body").setMarkdownContent(o.body,512,!1).appendTo(e)})).event.subscribe("toggle",(t=>{t.host.state.value&&(t.host.element.scrollIntoView({behavior:"smooth"}),e.header.element.scrollIntoView({behavior:"smooth"}))})).appendTo(t)})))))).tweak((e=>e.footer.style("view-type-chapter-bulk-import-list-wrapper-footer").tweak((e=>{const t=X.map(e,(e=>!!e?.length));(0,b.default)().style("view-type-chapter-bulk-import-list-wrapper-footer-config-details").tweak((e=>{e.style.bind(e.state,"view-type-chapter-bulk-import-list-wrapper-footer-config-details--open"),e.summary.style("view-type-chapter-bulk-import-list-wrapper-footer-config-button").text.use("view/chapter-create-bulk/import/action/config").tweak((t=>e.state.use(t,(e=>t.setIcon(e?"angles-up":"angles-down")))))})).append((0,h.default)().style("view-type-chapter-bulk-import-list-wrapper-footer-config").tweak((e=>e.content.and(w.default).label((e=>e.text.use("view/chapter-create-bulk/import/form/filename/label"))).content(((e,t)=>e.append((0,C.default)().setLabel(t).placeholder.set("(.*)").setValidityHandler((e=>!e.value||ee.value?void 0:e=>e["view/chapter-create-bulk/import/form/filename/invalid"]())).tweak((e=>e.state.useManual((e=>Z.value=W.default.optionalParseRegex(e,"d")))))).append((0,M.default)().text.bind(ee.map(e,(e=>t=>t["view/chapter-create-bulk/import/form/filename/variables"](...[...e??[""]].map(((e,t)=>t?(0,p.default)().style.setProperty("color",ne(t)).text.set(`{filename:${t}}`):(0,p.default)().style.setProperty("color","var(--colour-3)").text.set("{filename}"))).slice((e?.length??0)>1?1:0),(0,p.default)().style.setProperty("color","var(--colour-3)").text.set("{auto}")))))))).label((e=>e.text.use("view/chapter-create-bulk/import/form/name/label"))).content(((e,t)=>e.append((0,C.default)().setLabel(t).placeholder.set("{filename}").setValidityHandler((e=>{const t=e.value.trim();if(!(t.length&&("{auto}"===t||/\{filename(:\d+)?\}/.test(t))))return e=>e["view/chapter-create-bulk/import/form/name/invalid"]()})).tweak((e=>e.state.useManual((e=>te.value=e.trim()||void 0))))).append((0,M.default)().text.bind(G.default.Generator((()=>{const e=ae.value.imports.filter((e=>!e.error&&e.enabled)),t=[];for(let o=0;o<Math.min(e.length,5);o++)t.push({content:[{content:ie(e[o])||l.default["view/chapter/number/label"](o+1).toString(),tag:"B"}]});return e=>e["view/chapter-create-bulk/import/form/name/examples"](...t)})).observe(e,ae,ee,te)))))))).prependToWhen(t,e),(0,g.default)().setIcon("xmark").text.use("view/chapter-create-bulk/import/action/clear").event.subscribe("click",(()=>{re.element.value="",X.value=null})).appendToWhen(t,e.right),(0,g.default)().type("primary").bindDisabled(ae.map(e,(e=>!e.imports.some((e=>e.enabled)))),"no enabled documents").text.use("view/chapter-create-bulk/import/action/import").event.subscribe("click",(()=>{for(const e of ae.value.imports)!e.error&&e.enabled&&ue.push({open:!1,selected:!1,body:(0,G.default)({name:ie(e),body:e.body,visibility:"Private"})});ue.emit(),le.showNextTab()})).appendTo(e.right)})))).appendToWhen(V.falsy,le.content);const ue=G.default.Array(),se=ue.mapManual((e=>e.some((e=>e.selected)))),de=ue.mapManual((e=>e.some((e=>!e.selected))));let ce;const pe=p.default.Builder("details",((e,o,a)=>e.and(b.default).and(h.default).style("view-type-chapter-bulk-create-chapter").tweak((n=>{n.state.value=o.open,n.state.subscribeManual((e=>{e&&a.closeAllSiblings((e=>e!==n)),o.open=e})),se.use(n,(e=>{e&&(n.state.value=!1)})),n.style.bind(n.state.falsy,"view-type-chapter-bulk-create-chapter--closed"),Object.assign(n,{header:n.summary.style("block-header")}),n.summary.style("view-type-chapter-bulk-create-chapter-summary").style.bind(n.state,"view-type-chapter-bulk-create-chapter-summary--open").style.bind(n.state.falsy,"view-type-chapter-bulk-create-chapter-summary--closed").style.bind(o.body.map(n.summary,(e=>"Patreon"===e.visibility)),"view-type-chapter-bulk-create-chapter-summary--patreon").style.bind(o.body.map(n.summary,(e=>"Private"===e.visibility)),"view-type-chapter-bulk-create-chapter-summary--private").append(S.default.using(G.default.Use(n.summary,{number:a.number,body:o.body}),((e,{number:t,body:o})=>$(t.url,_||o.name||(e=>e[t.url.includes(".")?"view/chapter/number/interlude/label":"view/chapter/number/label"](t.url))).style.remove("slot").append("Patreon"===o.visibility&&o.tier_ids?.length?(0,p.default)().style("view-type-chapter-bulk-create-chapter-summary-patreon","patreon-icon-before").text.use(d.default.translateTiers(o.tier_ids,c.default.Auth.account?.value?.patreon_campaign?.tiers??[])):void 0).append("Private"!==o.visibility?void 0:(0,O.default)().style("view-type-chapter-bulk-create-chapter-summary-private").text.use("view/chapter-create-bulk/create/visibility/private"))))).event.subscribe("click",(e=>{const t=document.activeElement?.component?.closest(g.default);if(t===i)return e.preventDefault(),i.setChecked(!i.checked.value),n.element.scrollIntoView({behavior:"smooth"}),void e.host.focus();e.targetComponent?.closest(g.default)===e.host&&se.value&&(e.preventDefault(),i.setChecked(!i.checked.value))}));const i=(0,v.default)().style("view-type-chapter-bulk-create-chapter-summary-checkbox").setChecked(o.selected).attributes.bind(se,"inert").tweak((e=>e.checked.subscribeManual((e=>{o.selected=e,ue.emit()})))).event.subscribe("click",(e=>e.stopPropagation())).prependTo(n.summary);n.style.bind(G.default.Every(e,se,i.checked.falsy),"view-type-chapter-bulk-create-chapter--has-selected-sibling"),n.state.matchManual(!0,(async()=>{const e=j.default.Content(o.body,t,a.number).appendTo(n);e.state.useManual((e=>{q.default.deepEquals(e,o.body.value)||(o.body.asMutable?.setValue(e),ue.emit())})),e.numbered.selection.subscribe(n,(e=>{Y.emit()})),await U.default.yield(),n.element.scrollIntoView()})),e.onRooted((async()=>{if(!ce)return;Date.now()-ce.time>300?ce=void 0:a.index.value===ce.index&&(ce=void 0,await U.default.yield(),n.summary.focus())}))})).extend((e=>({chapter:o,index:a.index}))))).setName("ChapterDetails"),fe=(0,I.Tab)().text.use("view/chapter-create-bulk/create/tab").bindDisabled(ue.length.falsy,"no chapters").bindDisabled(V.truthy,"uploading or done").addTo(H);(0,h.default)().type("flush").style("view-type-chapter-bulk-block","view-type-chapter-bulk-block--not-last").tweak((e=>e.title.text.use("view/chapter-create-bulk/create/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/create/description"))).tweak((e=>e.content.style("view-type-chapter-bulk-create").append(z()).append((0,E.default)().use(ue,((e,o)=>pe(o,{index:e.index,number:G.default.Map(e,[e.index,Y],((e,o)=>{const a=o?.relative_to??t.last_chapter??"0";let n=parseInt(a)||0,i=+a-n;"before"===o?.position&&(i?i=Math.max(0,i-1):n=Math.max(0,n-1));for(let t=0;t<=e;t++){ue.value[t].body.value.is_numbered??1?(n++,i=0):i++}return{chapterNumber:n,interludeNumber:i,url:`${n}${i?`.${i}`:""}`}})),closeAllSiblings(t){for(const o of e.wrapper.getDescendants(pe))t&&!t(o)||(o.chapter.open=!1,o.state.value=!1)}})))).appendWhen(ue.length.truthy,(0,m.default)().style("view-type-chapter-bulk-create-selection-actions").tweak((e=>e.left.appendWhen(de,(0,g.default)().setIcon("square-check").type("flush").text.use("view/chapter-create-bulk/shared/action/select-all").event.subscribe("click",(()=>{for(let e=0;e<ue.length.value;e++){const t=ue.value[e];t.selected||(t.selected=!0,ue.emitItem(e))}ue.emit()}))).appendWhen(se,(0,g.default)().setIcon("square-minus").type("flush").text.use("view/chapter-create-bulk/shared/action/deselect-all").event.subscribe("click",(()=>{for(let e=0;e<ue.length.value;e++){const t=ue.value[e];t.selected&&(t.selected=!1,ue.emitItem(e))}ue.emit()}))))).appendWhen(se,(0,b.default)().style("view-type-chapter-bulk-create-selection-actions-details").tweak((e=>e.summary.style("view-type-chapter-bulk-create-selection-actions-summary").type("flush").setIcon("ellipsis-vertical").text.use("view/chapter-create-bulk/create/action/actions"))).append((0,I.default)().style("view-type-chapter-bulk-create-selection-actions-details-tabinator").allowNoneVisible().tweak((e=>{function t(e){const t=a(e),o=Math.max(0,L.default.isIncrementing(t)?Math.min(...t)-1:Math.min(...t));ce={index:o,time:Date.now()},ue.moveAt(t,o)}function o(e){const t=a(e),o=Math.min(ue.length.value-1,L.default.isIncrementing(t)?Math.min(...t)+1:Math.max(...t)-t.length+1);ce={index:o,time:Date.now()},ue.moveAt(t,o)}function a(e){const t=e?.targetComponent?.parent?.as(pe)?.chapter,o=ue.value.indexOf(t);return ue.value.entries().filter((([,e])=>e.selected)).map((([e])=>e)).toArray().concat(...-1===o?[]:[o]).distinctInPlace().sort(((e,t)=>e-t))}se.subscribe(e,(t=>{t||e.showNone()})),e.addTab((0,I.Tab)().text.use("view/chapter-create-bulk/create/action/tab/visibility").tweak((e=>{e.content.style("view-type-chapter-bulk-create-selection-actions-details-tabinator-tab-content");const t=(0,w.default)().appendTo(e.content),{visibility:o,patreonTiers:a}=(0,R.default)(t,(0,G.default)(void 0));ue.use(o,(e=>{const t=e.filter((e=>e.selected)).map((e=>e.body.value.visibility)).distinct();o.default.set(1===t.length?t[0]:null)})),(0,m.default)().style("view-type-chapter-bulk-create-selection-actions-details-tabinator-tab-content-actions").tweak((e=>e.right.append((0,g.default)().type("primary").text.use("view/chapter-create-bulk/create/action/apply").event.subscribe("click",(()=>{if(o.selection.value){for(let e=0;e<ue.length.value;e++){const t=ue.value[e];t.selected&&(t.body.value.visibility=o.selection.value,t.body.value.tier_ids=a?.selection.value,ue.emitItem(e))}ue.emit()}}))))).appendTo(e.content)}))),e.addTab((0,I.Tab)().text.use("view/chapter-create-bulk/create/action/tab/movement").tweak((e=>{e.content.style("view-type-chapter-bulk-create-selection-actions-details-tabinator-tab-content"),(0,m.default)().tweak((e=>e.left.append((0,g.default)().type("primary").setIcon("arrow-up").text.use("view/chapter-create-bulk/create/action/move-up").event.subscribe("click",(()=>t()))))).tweak((e=>e.left.append((0,g.default)().type("primary").setIcon("arrow-down").text.use("view/chapter-create-bulk/create/action/move-down").event.subscribe("click",(()=>o()))))).appendTo(e.content)}))),e.header.append((0,g.default)().style("view-type-chapter-bulk-create-selection-actions-details-right-button").setIcon("xmark").type("flush").text.use("view/chapter-create-bulk/create/action/remove").event.subscribe("click",(async e=>{const t=ue.value.filter((e=>e.selected));await y.default.prompt(e.host,{bodyTranslation:e=>e["view/chapter-create-bulk/create/action/remove/confirm"](t.map((e=>e.body.value.name||"")).slice(0,5),Math.max(0,t.length-5))})&&ue.filterInPlace((e=>!e.selected))}))),A.default.until(e,(e=>e.subscribe("down",(e=>{e.use("ArrowUp","ctrl")&&t(e),e.use("ArrowDown","ctrl")&&o(e)}))))}))))).append((0,m.default)().style("view-type-chapter-bulk-step-action-row").tweak((e=>e.right.append(fe.createNextButton())))))).appendToWhen(V.falsy,fe.content);const me=(0,I.Tab)().text.use("view/chapter-create-bulk/upload/tab").bindDisabled(ue.length.falsy,"no chapters").addTo(H);return(0,h.default)().type("flush").style("view-type-chapter-bulk-block").tweak((e=>e.title.text.use("view/chapter-create-bulk/upload/title"))).tweak((e=>e.description.text.use("view/chapter-create-bulk/upload/description"))).tweak((e=>{const i=G.default.Async(e,V,(async(i,l,u)=>{if(!i||i.done)return;u(0,(e=>e["view/chapter-create-bulk/upload/loading/clearing"]()));const s=await o.default.query({params:t});if(toast.handleError(s))return r();for(let e=0;e<i.chapters.length;e++){if(l.aborted)return;const o=i.chapters[e];u(e/(i.chapters.length+2),(t=>t["view/chapter-create-bulk/upload/loading/queuing"](o.body.value.name||"",e,i.chapters.length)));const a=await n.default.query({params:t,body:{name:o.body.value.name||"",body:o.body.value.body,visibility:o.body.value.visibility,is_numbered:o.body.value.is_numbered,notes_before:o.body.value.notes_before,notes_after:o.body.value.notes_after}});if(toast.handleError(a))return r()}if(l.aborted)return;u((i.chapters.length+1)/(i.chapters.length+2),(e=>e["view/chapter-create-bulk/upload/loading/finishing"]()));if(!await y.default.ensureDangerToken(e,{dangerToken:"chapter-create-bulk"}))return r();const d=await a.default.query({params:t,body:{position:i.position&&{relative_to:i.position.relative_to,position:i.position.position},chapters:i.chapters.map((e=>({tier_ids:e.body.value.tier_ids,custom_tags:e.body.value.custom_tags,global_tags:e.body.value.global_tags})))}});if(toast.handleError(d))return r();V.value={done:!0}}));function r(){V.value=void 0,e.element.scrollIntoView()}(0,p.default)().style("view-type-chapter-bulk-import-list-wrapper").append((0,p.default)().style("view-type-chapter-bulk-import-list").appendWhen(V.map(e,(e=>!1===e?.done)),(0,T.default)().use(i).style("view-type-chapter-bulk-import-list-loading")).appendWhen(V.falsy,(0,p.default)().style("view-type-chapter-bulk-upload-box").append((0,g.default)().type("primary").text.use("view/chapter-create-bulk/upload/action/upload").event.subscribe("click",(()=>V.value={chapters:ue.value,position:Y.value,done:!1})))).appendWhen(V.map(e,(e=>!!e?.done)),(0,p.default)().style("view-type-chapter-bulk-upload-box").append((0,D.default)().text.use("view/chapter-create-bulk/upload/notice/complete"),(0,g.default)().type("primary").text.use((e=>e["view/chapter-create-bulk/upload/action/return"](t.name))).event.subscribe("click",(()=>navigate.toURL(`/work/${t.author}/${t.vanity}`)))))).appendTo(e.content)})).appendToWhen(ue.length.truthy,me.content),u}})})),define("ui/view/chapter/ChapterEditForm",["require","exports","endpoint/chapter/EndpointChapterCreate","endpoint/chapter/EndpointChapterUpdate","lang/en-nz","model/FormInputLengths","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Form","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/LabelledTable","ui/component/core/Placeholder","ui/component/core/RadioRow","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/core/toast/Toast","ui/component/TagsEditor","ui/component/VisibilityOptions","ui/component/WorkStatusDropdown","utility/Functions","utility/Objects","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,w,k,T,x){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x);const D=l.default.Builder(((e,t,o,a)=>{const n=e.and(p.default),r=t.map(e,(e=>{const t=O(e);return t?t.url:"N"})),l=a?a.map(e,(e=>e.url.includes(".")?t=>t["view/chapter/number/interlude/label"](e.url):t=>t["view/chapter/number/label"](e.chapterNumber))):r.map(e,(e=>e.includes(".")?t=>t["view/chapter/number/interlude/label"](e):t=>t["view/chapter/number/label"](_||parseInt(e)||(o.chapter_count?o.chapter_count+1:0)||"N"))),u=(0,m.default)().add("numbered",(e=>e.text.use("view/chapter-edit/shared/form/type/numbered").append((0,f.default)().style("view-type-chapter-edit-type-example").text.bind(a?a.map(e,(e=>t=>t["view/chapter-edit/shared/form/type/numbered/example"](e.chapterNumber))):r.map(e,(e=>t=>t["view/chapter-edit/shared/form/type/numbered/example"](k.default.resolve((()=>e.includes(".")?parseInt(e)+1:parseInt(e)||(o.chapter_count?o.chapter_count+1:0)||"N"))))))))).add("other",(e=>e.text.use("view/chapter-edit/shared/form/type/other").append((0,f.default)().style("view-type-chapter-edit-type-example").text.use("view/chapter-edit/shared/form/type/other/example")))).default.bind(t.map(e,(e=>!1===e?.is_numbered?"other":"numbered")));n.label((e=>e.text.use("view/chapter-edit/shared/form/type/label"))).content(((e,t)=>e.append(u.setLabel(t))));const s=(0,g.default)().default.bind(t.map(e,(e=>e?.name||""))).hint.use("view/chapter-edit/shared/form/name/hint").placeholder.bind(l).setMaxLength(i.default.map(n,(e=>e?.chapter?.name)));n.label((e=>e.text.use("view/chapter-edit/shared/form/name/label"))).content(((e,t)=>e.append(s.setLabel(t))));const d=(0,y.default)().default.bind(t).setMaxLengthGlobal(i.default.map(n,(e=>e?.work_tags?.global))).setMaxLengthCustom(i.default.map(n,(e=>e?.work_tags?.custom)));n.label((e=>e.text.use("view/chapter-edit/shared/form/tags/label"))).content(((e,t)=>e.append(d.setLabel(t))));const c=(0,h.default)().default.bind(t.map(e,(e=>e?.notes_before??void 0))).hint.use("view/chapter-edit/shared/form/notes/hint").setMaxLength(i.default.map(n,(e=>e?.chapter?.notes))).setMinimalByDefault();n.label((e=>e.text.use("view/chapter-edit/shared/form/notes/label"))).content(((e,t)=>e.append(c.setLabel(t))));const v=(0,h.default)().default.bind(t.map(e,(e=>e?.body??void 0))).hint.use("view/chapter-edit/shared/form/body/hint");n.label((e=>e.text.use("view/chapter-edit/shared/form/body/label"))).content(((e,t)=>e.append(v.setLabel(t))));const w=(0,h.default)().default.bind(t.map(e,(e=>e?.notes_after??void 0))).hint.use("view/chapter-edit/shared/form/notes/hint").setMaxLength(i.default.map(n,(e=>e?.chapter?.notes))).setMinimalByDefault();n.label((e=>e.text.use("view/chapter-edit/shared/form/notes/label"))).content(((e,t)=>e.append(w.setLabel(t))));const{patreonTiers:D,visibility:E}=(0,b.default)(n,t.map(n,(e=>({visibility:e?.visibility??"Private",...S(e)}))));e.onRooted((()=>{c.ready(),v.ready(),w.ready()}));const M=x.default.Use(e,{name:s.state.map(e,(e=>e||!1)),body:v.content,notes_before:c.content,notes_after:w.content,visibility:E.selection.coalesce("Private"),global_tags:d.state.mapManual((e=>e.global_tags)),custom_tags:d.state.mapManual((e=>e.custom_tags)),is_numbered:u.selection.equals("numbered"),tier_ids:D?.selection});return n.extend((e=>({state:M,numbered:u,hasUnsavedChanges:I})));function I(){if(!t.value)return!0;const e=M.value,o=T.default.keys(e).filter((e=>"custom_tags"!==e&&"global_tags"!==e&&"tier_ids"!==e));for(const a of o){let o=e[a],n=t.value[a];if(""===o&&(n??=""),""===n&&(o??=""),"string"==typeof o&&(o=o.trim()),"string"==typeof n&&(n=n.trim()),o!==n)return!0}const a=e.tier_ids??[],n=O(t.value)?.patreon?.tiers.map((e=>e.tier_id))??[];return a.length!==n.length||(!!a.some((e=>!n.includes(e)))||((e.custom_tags?.length??0)!==(t.value.custom_tags?.length??0)||(!!e.custom_tags?.some((e=>!t.value?.custom_tags?.includes(e)))||((e.global_tags?.length??0)!==(t.value.global_tags?.length??0)||!!e.global_tags?.some((e=>!t.value?.global_tags?.includes(e)))))))}})),O=e=>e&&"url"in e?e:void 0,S=e=>{if(!e)return;const t=e;return t.patreon?{patreonTiers:t.patreon.tiers.map((e=>e.tier_id))}:{patreonTiers:t.tier_ids}},E=Object.assign(l.default.Builder(((e,t,i,p)=>{const f=e.and(u.default),m=f.and(s.default,f.title);m.viewTransition("chapter-edit-form");const h=t.value?"update":"create";m.title.text.use(`view/chapter-edit/${h}/title`),t.use(m,(e=>m.setName(n.default[`view/chapter-edit/${h}/title`](O(e)?.url).toString()))),m.submit.textWrapper.text.use(`view/chapter-edit/${h}/submit`);const g=D(t,p).appendTo(m.content),y=(0,l.default)().style("view-type-chapter-edit-work-changes").appendTo(m.content);(0,d.default)().style("view-type-chapter-edit-work-changes-heading").text.use((e=>e["view/chapter-edit/shared/form/work/heading"](p.name))).appendTo(y);const b=w.default.Radio(p.status);return(0,c.default)().tweak((e=>e.label.style("view-type-chapter-edit-work-changes-status-label").text.bind(b.selection.map(e,(e=>e===p.status?e=>e["view/chapter-edit/shared/form/work/status/label/no-change"]():e=>e["view/chapter-edit/shared/form/work/status/label/change"]()))))).tweak((e=>e.content.append(b))).appendTo(y),m.onSubmit((async e=>{await _()})),m.extend((e=>({hasUnsavedChanges:g.hasUnsavedChanges,save:_})));async function _(){const e=await(()=>{switch(h){case"create":return o.default.query({params:i,body:{...g.state.value,work:{status:b.selection.value}}});case"update":{const e=O(t.value);if(!e)return;const o=r.default.Auth.author.value?.vanity;return o?a.default.query({params:{author:i.author,work:i.vanity,url:e.url},body:{...g.state.value,work:{status:b.selection.value}}}):new Error("Cannot update a work when not signed in")}}})();toast.handleError(e,"view/chapter-edit/shared/toast/failed-to-save")||(toast.success(v.TOAST_SUCCESS,"view/chapter-edit/shared/toast/saved"),t.value=e?.data)}})),{Content:D});t.default=E})),define("ui/view/shared/component/PaginatedView",["require","exports","ui/Component","ui/component/core/Paginator","ui/view/shared/component/View"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder(((e,t)=>{let o;const i=[];return(0,n.default)(t).extend((e=>({setURL:r,paginator:()=>(o??=(0,a.default)().extend((e=>({setURL:r}))),o.onReset(null,(()=>{i.length=0})),o.page.subscribeManual((e=>{const t=i[e];t&&navigate.setURL(t)})),o)})));function r(e){void 0!==e&&navigate.setURL(e);const t=o?.page.value;void 0!==t&&(i[t]=e)}}));t.default=i})),define("ui/view/ChapterEditView",["require","exports","endpoint/chapter/EndpointChapterGet","endpoint/chapter/EndpointChapterGetPaged","endpoint/work/EndpointWorkGet","model/Chapters","model/PagedData","ui/Component","ui/component/core/Button","ui/component/core/Link","ui/component/Work","ui/view/chapter/ChapterEditForm","ui/view/shared/component/PaginatedView","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTitle","utility/State","utility/Type"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g);const v=Symbol("NEW_CHAPTER");t.default=(0,f.default)({requiresLogin:!0,async load(e){const t=e.url?await o.default.query({params:e}):void 0;if(t instanceof Error)throw t;const a=await n.default.query({params:i.default.work(e)});if(a instanceof Error)throw a;return{initialChapterResponse:t,work:a.data}},create(e,{initialChapterResponse:t,work:o}){const n="chapter-edit",f=(0,p.default)(n),y=o.synopsis?.mentions.find((t=>t.vanity===e.author));delete o.synopsis,delete o.custom_tags,(0,s.default)(`/work/${y?.vanity}/${o.vanity}`).and(d.default,o,y).viewTransition("chapter-view-work").style("view-type-chapter-work").setContainsHeading().appendTo(f.content);const b=(0,h.default)((g.default.as("number",t?.page_count)??o.chapter_count??0)+1),_=r.default.fromEndpoint(a.default.prep({params:e}),(e=>e===b.value-1?v:null));t&&_.set(t.page,t.data,!t.has_more),_.pageCount.use(f,(e=>{void 0!==e&&_.setPageCount(!0)}));const w=t?.page??b.value-1,k={},T=f.paginator().type("flush").setScroll(((e,t,o)=>{if(!o.previousScrollRect)return;const a=o.scrollRect.height,n=o.previousScrollRect.height,i=Math.max(o.scrollRect.top,o.previousScrollRect.top);window.scrollTo({top:i+(a-n),behavior:"instant"})})).set(_,w,(async(t,a,r,s,d)=>{k[r]?.remove();const p=k[r]=(0,l.default)(),f=(0,h.default)(a===v?void 0:a);f.subscribe(p,(e=>s.set(r,e??v))),f.use(p,(t=>{d.page.value===r&&(d.setURL(t?`/work/${e.author}/${e.work}/chapter/${t.url}/edit`:`/work/${e.author}/${e.work}/chapter/new`),t&&r===b.value-1&&b.value++)}));const g=(0,c.default)(f,i.default.work(e),o).tweak((e=>e.title.and(m.default))).subviewTransition(n).appendTo(t);d.page.use(p,((e,t)=>{f.value&&t===r&&e!==t&&g.hasUnsavedChanges()&&g.save()})),f.value&&(0,u.default)().setIcon("trash").text.use("view/chapter-edit/update/action/delete").event.subscribe("click",(async e=>{const t=f.value;if(!t)return;await i.default.delete(t,e.host)&&(_.delete(r),_.unset(r,b.value),b.value--,r>=b.value-2?await navigate.toURL(`/work/${t.author}/${t.work}`):d.page.emit(r-1))})).appendTo(g.footer.left)})).appendTo(f.content);return(0,u.default)().setIcon("angles-right").type("icon").style("paginator-button").event.subscribe("click",(()=>T.page.value=b.value-1)).appendTo(T.footer.right),T.data.use(f,(t=>f.breadcrumbs.setBackButton(t!==v&&t?`/work/${e.author}/${e.work}/chapter/${t.url}`:`/work/${e.author}/${e.work}`,(e=>e.subText.set(t===v?o.name:t?.name))))),f}})})),define("endpoint/history/EndpointHistoryAddChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/history/add/{author}/{work}/chapter/{url}","post")})),define("endpoint/reaction/EndpointReactChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/react/{type}","post")})),define("endpoint/reaction/EndpointSupporterReactChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/react/supporter/{type}","post")})),define("endpoint/reaction/EndpointSupporterUnreactChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/unreact/supporter","post")})),define("endpoint/reaction/EndpointUnreactChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/unreact","post")})),define("model/TextBody",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.resolve=function(e,t){return null==e?void 0:{body:"string"==typeof e?e:e.body,mentions:[...("string"==typeof e?void 0:e.mentions)??[],...t??[]].distinct((e=>e.vanity))}}}(o||(o={})),t.default=o})),define("endpoint/comment/EndpointCommentGetAllUnder",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/comments/{under}","get")})),define("endpoint/comment/EndpointCommentAdd",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/comment/add/{under}","post")})),define("endpoint/comment/EndpointCommentDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/comment/{id}/delete","post")})),define("endpoint/comment/EndpointCommentUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/comment/{id}/update","post")})),define("endpoint/reaction/EndpointReactComment",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/comment/{comment_id}/react/{type}","post")})),define("endpoint/reaction/EndpointUnreactComment",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/comment/{comment_id}/unreact","post")})),define("endpoint/report/EndpointReportComment",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/report/comment/{id}","post")})),define("ui/component/Reaction",["require","exports","ui/Component","ui/component/core/Button","utility/State"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i={love:"heart",author_heart:"author-heart",guest_heart:"guest-heart",supporter_heart:"supporter-heart"},r=o.default.Builder(((e,t,r=(0,n.default)(0),l=(0,n.default)(!1),u=(0,n.default)(!1))=>{const s=n.default.get(r),d=n.default.get(l),c=(0,a.default)().setIcon(i[t]).type("icon").style("reaction-button").style.bind(d,"reaction-button--reacted").tweak((e=>e.icon.style("reaction-button-icon").style.bind(u,"reaction-button-icon--changing-state").style.bind(d,"reaction-button-icon--reacted")));return e.style("reaction").append(c).appendWhen(s.truthy,(0,o.default)().style("reaction-count").text.bind(s.map(e,(e=>e?`${e}`:"")))).extend((e=>({reactions:s,reacted:d,icon:c})))}));t.default=r})),define("ui/component/Comment",["require","exports","endpoint/comment/EndpointCommentAdd","endpoint/comment/EndpointCommentDelete","endpoint/comment/EndpointCommentUpdate","endpoint/reaction/EndpointReactComment","endpoint/reaction/EndpointUnreactComment","endpoint/report/EndpointReportComment","lang/en-nz","model/FormInputLengths","model/Session","ui/Component","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/Link","ui/component/core/Loading","ui/component/core/Slot","ui/component/core/TextEditor","ui/component/core/Timestamp","ui/component/popover/AuthorPopover","ui/component/Reaction","ui/component/ReportDialog","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importStar(w),k=__importDefault(k);const T=(0,w.ReportDefinition)({titleTranslation:"shared/term/comment",reasons:{inappropriate:!0,spam:!0,harassment:!0,phishing:!0,"tos-violation":!0}}),x=c.default.Builder(((e,t,D,O)=>{const S=e.and(g.default).style("comment").extend((e=>({}))),E=t.comments.map(S,(e=>e.filter((e=>e===D||e.parent_id===D.comment_id))));return S.use(E,((e,M)=>{const I=!O?.noSiblings&&!!O?.hasParent||!(!O?.hasParent||O.hasGrandparent);S.style.toggle(I,"comment--is-thread");const C=(0,c.default)().style("comment-content").style.toggle(!!D.edit,"comment-content--has-editor").style.setProperty("z-index",""+(100-(O?.depth??0))).appendTo(e);if(D&&!O?.isRootComment){const x=(0,c.default)("header").style("comment-header").style.toggle(!!D.edit,"comment-header--editing").appendTo(C),O=t.authors.value.find((e=>e.vanity===D.author));(0,m.default)(O?.vanity?`/author/${O.vanity}`:void 0).style("comment-header-author").text.set(O?.name??u.default["comment/deleted/author"]().toString()).setPopover("hover/longpress",(e=>O&&e.and(b.default,O))).appendTo(x);const S=D.edited_time??D.created_time;if(S&&(0,y.default)(S).style("comment-header-timestamp").setTranslation(D.edited_time?e=>e["comment/timestamp/edited"]:void 0).appendTo(x),D.edit){const i=(0,v.default)().default.set(D.body?.body??"").setMaxLength(s.default.map(e,(e=>e?.comment?.body))).hint.use("comment/hint").appendTo(C);i.editor.style("comment-editor"),i.content.use(x,(e=>D.body={body:e}));const r=(0,c.default)("footer").and(p.default).style("comment-footer","comment-footer--editing").appendTo(C);D.comment_id&&(0,f.default)().style("comment-footer-action").text.use("comment/action/delete").event.subscribe("click",(async()=>{const e=await a.default.query({params:{id:D.comment_id}});toast.handleError(e)||(t.comments.value.filterInPlace((e=>e!==D)),t.comments.emit())})).appendTo(r.right),(0,f.default)().style("comment-footer-action").text.use("comment/action/cancel").event.subscribe("click",(()=>{D.created_time?delete D.edit:t.comments.value.filterInPlace((e=>e!==D)),t.comments.emit()})).appendTo(r.right);const l=(0,k.default)(!1);(0,f.default)().style("comment-footer-action").type("primary").text.use("comment/action/save").bindDisabled(i.invalid).event.subscribe("click",(async()=>{l.value=!0,await(async()=>{if(!D.parent_id)return;const e=D.comment_id?await n.default.query({params:{id:D.comment_id},body:{body:i.useMarkdown()}}):await o.default.query({params:{under:D.parent_id},body:{body:i.useMarkdown()}});if(toast.handleError(e))return;const a=e.data;t.comments.value.filterInPlace((e=>e!==D)),t.comments.value.push(a),t.comments.emit()})(),l.value=!1})).appendToWhen(l.falsy,r.right),(0,h.default)().tweak((e=>{e.style("comment-footer-action-loading"),e.enabled.bind(e,l),e.flag.style("comment-footer-action-loading-flag")})).appendToWhen(l,r.right)}else{(0,c.default)().style("comment-body").setMarkdownContent(D.body?.body?{body:D.body.body,mentions:t.authors.value}:u.default["comment/deleted/body"]().toString()).appendTo(C);const o=O;(0,g.default)().use(d.default.Auth.author,((e,n)=>{const u=(0,c.default)("footer").style("comment-footer").appendTo(e),s=(0,c.default)().style("comment-footer-section","comment-footer-section--reactions").appendTo(u),p=(0,c.default)().style("comment-footer-section").appendTo(u),m=(0,c.default)().style("comment-footer-section").appendTo(u),h=(0,k.default)(!1),g=t.threadAuthor===d.default.Auth.author.value?.vanity,v=g?h:(0,k.default)(!1);async function y(){h.value=!0;const e=await r.default.query({params:{comment_id:D.comment_id}});h.value=!1,toast.handleError(e)||(delete D.reacted,t.threadAuthor===d.default.Auth.author.value?.vanity?delete D.author_hearted:(D.reactions??=0,D.reactions--,D.reactions<0&&delete D.reactions),E.emit())}if(!D.reactions&&D.reacted&&g||(0,_.default)("love",D.reactions??0,!!D.reacted,h).event.subscribe("click",(async()=>{if(n){if(D.reacted)await y();else{h.value=!0;const e=await i.default.query({params:{comment_id:D.comment_id,type:"love"}});if(h.value=!1,toast.handleError(e))return;D.reacted=!0,g?D.author_hearted=!0:(D.reactions??=0,D.reactions++)}E.emit()}})).appendTo(s),D.author_hearted&&(0,_.default)("author_heart",0,!0,v).tweak((e=>e.icon.style("comment-author-heart").style.toggle(!g,"comment-author-heart--not-author"))).setTooltip((e=>e.text.use("comment/tooltip/author-heart"))).event.subscribe("click",(async()=>{g&&await y()})).appendTo(s),!n)return;const b=D.author===n.vanity;let x=!1;const O=()=>!0===x?void 0:(x=!0,(0,f.default)().style("comment-footer-action").type("flush").setIcon(D.author===n.vanity||t.threadAuthor===n.vanity?"trash":"shield-halved").text.use("comment/action/delete").event.subscribe("click",(async e=>{const t=await a.default.query({params:{id:D.comment_id}});toast.handleError(t)})));b&&(0,f.default)().style("comment-footer-action").type("flush").setIcon("pencil").text.use("comment/action/edit").event.subscribe("click",(()=>{D.edit=!0,E.refresh()})).appendTo(p),b&&O()?.appendTo(p),(0,f.default)().style("comment-footer-action").type("flush").setIcon("reply").text.use("comment/action/reply").event.subscribe("click",(()=>{t.comments.value.unshift({edit:!0,parent_id:D.comment_id,author:n.vanity}),E.refresh()})).appendTo(b?m:p),b||(0,f.default)().style("comment-footer-action").type("flush").setIcon("flag").text.use("comment/action/report").event.subscribe("click",(e=>w.default.prompt(e.host,T,{reportedContentName:e=>e["shared/term/comment-by"](o?.name),async onReport(e){const t=await l.default.query({body:e,params:{id:D.comment_id}});toast.handleError(t)}}))).appendTo(m),(t.threadAuthor===n.vanity||d.default.Auth.isModerator.value)&&O()?.appendTo(m)})).appendTo(e)}}if(!D.comment_id||M.length<=1)return;const R=M.length>2,P=!!O?.isRootComment||O?.noSiblings&&!R||M.length>3,A=(0,c.default)().style("comment-children").style.toggle(P,"comment-children--flush").appendTo(e),j=e=>e.created_time?new Date(e.created_time).getTime():1/0;for(const e of M.sort(((e,t)=>j(t)-j(e)))){if(e===D)continue;const o=M.length<=2||void 0;x(t,e,{noSiblings:o,hasParent:!O?.isRootComment||void 0,hasGrandparent:O?.hasParent,depth:(O?.depth??0)+1}).appendTo(A)}})),S}));t.default=x})),define("ui/component/Comments",["require","exports","endpoint/comment/EndpointCommentGetAllUnder","model/Session","ui/Component","ui/component/Comment","ui/component/core/Block","ui/component/core/Button","ui/component/core/Slot","utility/AbortPromise","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d);const c=n.default.Builder(((e,t,n,c)=>{const p=e.and(r.default).type("flush").style("comment-list").viewTransition("comments").extend((e=>({})));return(0,u.default)().use(a.default.Auth.author,s.default.asyncFunction((async(e,a,r)=>{const s={comment_id:t},f=(0,d.default)([s]),m=(0,d.default)(r?[r]:[]);r&&f.use(p,(e=>{e[0].edit||(e.unshift({edit:!0,parent_id:t,author:r.vanity}),f.emit())}));const h=(0,d.default)(void 0);async function g(){if(!h.value)return;const e=await(h.value?.());if(toast.handleError(e))throw e;m.value.push(...e.data.authors),m.emit(),f.value.push(...e.data.comments),f.emit(),h.value=e.next}h.value=o.default.prep({params:{under:t}}).query,(0,i.default)({comments:f,authors:m,threadAuthor:n},s,{isRootComment:c,noSiblings:!0}).appendTo(a),await g(),e.aborted||(0,u.default)().if(h.truthy,(()=>(0,l.default)().event.subscribe("click",g).text.set("load more"))).appendTo(a)}))).appendTo(p.content),p}));t.default=c})),define("utility/Random",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.shuffle=function(e){for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e}}(o||(o={})),t.default=o})),define("endpoint/author/EndpointAuthorUpdateSettings",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/author/update/settings","post")})),define("utility/Settings",["require","exports","endpoint/author/EndpointAuthorUpdateSettings","model/Session","utility/Define","utility/Functions","utility/State","utility/Store"],(function(e,t,o,a,n,i,r,l){var u;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),function(e){const t=[],u=r.default.JIT((()=>{const e=a.default.Auth.account.value?a.default.Auth.account.value?.settings:l.default.items.settings;return e?JSON.parse(e):{}})).observe(a.default.Auth.account);function s(e){return t.push({...e,settings:Object.values(e.settings).map((e=>{const t=()=>`${e.tag?`${i.default.resolve(e.tag)}:`:""}${e.name}`,s=u.mapManual((o=>o[t()]??e.default));return e.tweakState?.(s),n.default.magic(s,"value",{get:()=>r.default.getInternalValue(s),set:e=>{const n=u.value;if(e===n[t()])return;n[t()]=e??null;const i=a.default.Auth.account.value;i?(i.settings=JSON.stringify(n),a.default.Auth.account.emit(),o.default.query({body:{settings:i.settings}}),a.default.setAuthor(i)):l.default.items.settings=JSON.stringify(n)}}),Object.assign(e,{state:s})}))}),e.settings}e.boolean=function(e){return{...e,type:"boolean"}},e.string=function(e){return{...e,type:"string"}},e.number=function(e){return{...e,type:"number"}},e.get=function(){return t},e.registerGroup=function(e,t){return s({name:e,settings:t})},e.registerHiddenGroup=function(e,t){return s({name:e,settings:t,hidden:!0})}}(u||(u={})),Object.assign(window,{Settings:u}),t.default=u})),define("ui/view/ChapterView",["require","exports","endpoint/chapter/EndpointChapterGet","endpoint/chapter/EndpointChapterGetPaged","endpoint/history/EndpointHistoryAddChapter","endpoint/reaction/EndpointReactChapter","endpoint/reaction/EndpointSupporterReactChapter","endpoint/reaction/EndpointSupporterUnreactChapter","endpoint/reaction/EndpointUnreactChapter","endpoint/work/EndpointWorkGet","model/Chapters","model/PagedData","model/Patreon","model/Session","model/TextBody","ui/Component","ui/component/AuthorLink","ui/component/Chapter","ui/component/Comments","ui/component/core/Button","ui/component/core/ext/GradientText","ui/component/core/ExternalLink","ui/component/core/Heading","ui/component/core/Icon","ui/component/core/Link","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/PatronAuthDialog","ui/component/Reaction","ui/component/Statistics","ui/component/Tags","ui/component/Work","ui/utility/Viewport","ui/view/shared/component/PaginatedView","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTitle","utility/maths/Maths","utility/Objects","utility/Random","utility/Settings","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,w,k,T,x,D,O,S,E,M,I,C,R,P,A,j,N,$,B,L,q,G){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),O=__importDefault(O),S=__importDefault(S),E=__importDefault(E),M=__importDefault(M),I=__importDefault(I),C=__importDefault(C),R=__importDefault(R),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N),$=__importDefault($),B=__importDefault(B),L=__importDefault(L),q=__importDefault(q),G=__importDefault(G);const W=()=>P.default.state.value,U=e=>e.observeManual(P.default.state),F=q.default.registerGroup("settings/chapter/name",{fontSize:q.default.number({tag:W,tweakState:U,name:"settings/chapter/font-size/name",description:"settings/chapter/font-size/description",default:1,min:.5,max:3,step:.1}),lineHeight:q.default.number({tag:W,tweakState:U,name:"settings/chapter/line-height/name",description:"settings/chapter/line-height/description",default:1.4,min:1,max:3,step:.1}),paragraphGap:q.default.number({tag:W,tweakState:U,name:"settings/chapter/paragraph-gap/name",description:"settings/chapter/paragraph-gap/description",default:1,min:0,max:10,step:.5}),justified:q.default.boolean({tag:W,tweakState:U,name:"settings/chapter/text-align/name",description:"settings/chapter/text-align/description",default:!1})});t.default=(0,j.default)({async load(e){const t=await s.default.query({params:d.default.work(e)});if(t instanceof Error)throw t;const a=await o.default.query({params:e});if(a instanceof Error)throw a;return{workData:t.data,initialChapterResponse:a}},create(e,{workData:t,initialChapterResponse:o}){const s=(0,A.default)("chapter"),j=t.synopsis?.mentions.find((e=>e.vanity===t.author));delete t.synopsis,delete t.custom_tags,s.breadcrumbs.setBackButton(`/work/${t.author}/${t.vanity}`,(e=>e.subText.set(t.name))),(0,D.default)(`/work/${j?.vanity}/${t.vanity}`).and(R.default,t,j).tweak((e=>e.statistics.remove())).tweak((e=>e.actions.remove())).viewTransition("chapter-view-work").style("view-type-chapter-work").setContainsHeading().appendTo(s.content);const q=(0,G.default)(o.data),W=f.default.Auth.loggedInAs(s,t.author),U=q.mapManual((e=>!e.insufficient_pledge)),V=G.default.Some(s,W.truthy,U.falsy),H=c.default.fromEndpoint(a.default.prep({params:{author:t.author,work:t.vanity}}));H.set(o.page,o.data,!o.has_more),H.setPageCount(o.page_count);const Y=s.paginator().viewTransition("chapter-view-chapter").style("view-type-chapter-block").style.bindVariable("chapter-font-size-multiplier",F.fontSize.state).style.bindVariable("chapter-line-height",F.lineHeight.state).style.bindVariable("chapter-paragraph-gap-multiplier",F.paragraphGap.state).style.bindVariable("align-left-preference",F.justified.state.map(s,(e=>e?"justify":"left"))).type("flush").event.subscribe("PageError",(()=>f.default.refresh())).tweak((e=>{const t=q.mapManual((e=>e.url)),o=q.mapManual((e=>e.name)),a=t.mapManual((e=>$.default.parseIntOrUndefined(e)));e.title.and(N.default).style("view-type-chapter-block-title").text.bind(G.default.MapManual([o,t,a],((e,t,o)=>_||e||(o?e=>e["view/chapter/number/label"](o):void 0)||(t?.includes(".")?e=>e["view/chapter/number/interlude/label"](t):void 0)))),e.primaryActions.style("view-type-chapter-block-actions"),(0,S.default)().if(G.default.Every(e,o.truthy,a.mapManual((e=>void 0!==e))),(()=>(0,T.default)().setAestheticStyle(!1).style("view-type-chapter-block-number-label").style.bind(o.falsy,"view-type-chapter-block-number-label--auto-named-chapter").text.bind(a.mapManual((e=>t=>t["view/chapter/number/label"](e)))))).prependTo(e.header)})).appendTo(s.content).set(H,o.page,((e,o,a,i,r)=>{r.setURL(`/work/${t.author}/${t.vanity}/chapter/${o.url}`),f.default.Auth.loggedIn.value&&n.default.query({params:o});const l=f.default.Auth.loggedInAs(e,t.author);(0,S.default)().appendTo(e).if(l,(e=>(0,I.default)().style("view-type-chapter-block-author-statistics").section("shared/stat/section/logged-in",(e=>e.stat("chapter/stat/reads/label",o.statistics?.read_count).stat("chapter/stat/hearts/label",o.statistics?.reaction_count).stat("chapter/stat/comments/label",o.statistics?.comment_count))).section("shared/stat/section/logged-out",(e=>e.stat("chapter/stat/visits/label",o.statistics?.visits?BigInt(o.statistics.visits):void 0))))),(o.notes_before||o.global_tags?.length||o.custom_tags?.length)&&(0,h.default)().style("view-type-chapter-block-notes","view-type-chapter-block-notes-before").setMarkdownContent(m.default.resolve(o.notes_before,o.mentions)).prepend(o.notes_before&&(0,h.default)().style("view-type-chapter-block-notes-label").text.use("view/chapter/notes/label")).append((o.global_tags?.length||o.custom_tags?.length)&&(0,h.default)().style("view-type-chapter-block-notes-label","view-type-chapter-block-tags-title").text.use("view/chapter/tags/label")).append((0,C.default)().set(o).style("view-type-chapter-block-tags")).appendTo(e);const u="Patreon"===o.visibility||"Patreon"==t.visibility,s=p.default.getMoreRestrictive(o.patreon?.tiers,t.patreon?.tiers);u&&(0,S.default)().if(V,(()=>(0,h.default)().style("view-type-chapter-block-patreon-header").append((0,h.default)().style("view-type-chapter-block-patreon-header-label").text.use("view/chapter/patreon/label")).append((0,T.default)().style("view-type-chapter-block-patreon-header-title").setAestheticStyle(!1).removeContents().append((0,h.default)().text.use(p.default.translateTier(s[0])),(0,S.default)().style.remove("slot").style("view-type-chapter-block-patreon-header-actions").if(W.falsy,(e=>{s&&(0,S.default)().if(f.default.Auth.loggedIn,(e=>{(0,b.default)().style("view-type-chapter-block-patreon-header-button").text.bind(f.default.Auth.account.map(e,(e=>e?.patreon_patron?t=>t["view/chapter/action/unlink-patreon"](e.patreon_patron.display_name):e=>e["view/chapter/action/auth-to-patreon"]()))).event.subscribe("click",(()=>E.default.auth(e))).appendTo(e),(0,k.default)(o.patreon?.campaign.url).and(b.default).attributes.remove("type").style("view-type-chapter-block-patreon-header-button").text.use("view/chapter/action/become-patron").appendTo(e)})).else((()=>(0,O.default)().style("view-type-chapter-block-patreon-header-placeholder").text.use("view/chapter/placeholder/login-for-patreon"))).appendTo(e)})))))).appendTo(e),(0,h.default)().style("view-type-chapter-block-body").setMarkdownContent(o.body??"").appendTo(e),o.notes_after&&(0,h.default)().style("view-type-chapter-block-notes","view-type-chapter-block-notes-after").setMarkdownContent(m.default.resolve(o.notes_after,o.mentions)).prepend(o.notes_after&&(0,h.default)().style("view-type-chapter-block-notes-label").text.use("view/chapter/notes/label")).appendTo(e),(0,S.default)().if(W,(()=>u&&(0,h.default)().style("view-type-chapter-block-patreon-footer"))).appendTo(e)}));Y.header.style("view-type-chapter-block-header"),Y.content.style("view-type-chapter-block-content"),Y.header.setActionsMenu((e=>{v.default.initActions(e,q,t,j,!0),e.subscribeReanchor(((e,t)=>{t||e.anchor.reset().anchor.add("off right","centre").anchor.orElseHide()}))}));const z=q.mapManual((e=>e.reactions??0)),J=q.mapManual((e=>e.guest_reactions??0)),K=q.mapManual((e=>e.supporter_reactions?.length??0)),Q=q.mapManual((e=>!!e.reacted&&!!f.default.Auth.author.value)),X=q.mapManual((e=>!!e.reacted&&!f.default.Auth.author.value)),Z=q.mapManual((e=>!!e.supporter_reactions?.some((e=>e?.author===f.default.Auth.author.value?.vanity)))),ee=(0,G.default)(!1),te=(0,G.default)(!1),oe=(0,G.default)(!1),ae=()=>(0,S.default)().style.remove("slot").style("reaction-button-list").if(U,(e=>(0,S.default)().appendWhen(K.map(e,(e=>!!e||!!f.default.Auth.author.value?.supporter?.tier)),(0,M.default)("supporter_heart",K,Z,te).tweak((e=>e.icon.setDisabled(!f.default.Auth.author.value?.supporter?.tier,"not a supporter"))).and(w.default,"heart-gradient","115deg").useGradient(f.default.Auth.author.map(e,(e=>e?.supporter?.username_colours))).setTooltip((e=>{(0,h.default)().text.use("chapter/reaction/supporter-heart").appendTo(e);const t=(0,S.default)().style.remove("slot").appendTo(e);t.use(q,((e,o)=>{if(!o.supporter_reactions?.length)return;const a=L.default.shuffle(o.supporter_reactions),n=o.supporter_reactions.length<5;if(t.style("view-type-chapter-block-supporter-reaction-list").style.toggle(n,"view-type-chapter-block-supporter-reaction-list--detailed").style.toggle(!n,"view-type-chapter-block-supporter-reaction-list--compressed"),n)for(const t of a){const a=o.mentions?.find((e=>e.vanity===t?.author));a&&(0,h.default)().style("view-type-chapter-block-supporter-reaction-detailed").append((0,x.default)("supporter-heart").style("view-type-chapter-block-supporter-reaction").and(w.default,"heart-gradient","115deg").useGradient(a?.supporter?.username_colours)).append((0,g.default)(a)).appendTo(e)}else for(const t of a)(0,x.default)("supporter-heart").style("view-type-chapter-block-supporter-reaction").and(w.default,"heart-gradient","115deg").useGradient(o.mentions?.find((e=>e.vanity===t?.author))?.supporter?.username_colours).appendTo(e)}))})).event.subscribe("click",(async()=>{if(!f.default.Auth.loggedIn.value||te.value)return;const e={...d.default.reference(q.value),type:"heart"};if(Z.value){te.value=!0;const t=await l.default.query({params:e});if(te.value=!1,toast.handleError(t))return;q.value.supporter_reactions?.filterInPlace((e=>e?.author!==f.default.Auth.author.value?.vanity)),q.emit()}else{te.value=!0;const t=await r.default.query({params:e});if(te.value=!1,toast.handleError(t))return;(q.value.supporter_reactions??=[]).push({author:f.default.Auth.author.value.vanity,reaction_type:"heart"}),q.emit()}}))).appendWhen(z.map(e,(e=>!!e||!!f.default.Auth.author.value)),(0,M.default)("love",z,Q,ee).tweak((e=>e.icon.setDisabled(!f.default.Auth.author.value,"not logged in"))).setTooltip((e=>e.text.use("chapter/reaction/normal-heart"))).event.subscribe("click",(async()=>{if(!f.default.Auth.loggedIn.value||ee.value)return;const e={...d.default.reference(q.value),type:"love"};if(Q.value){ee.value=!0;const t=await u.default.query({params:e});if(ee.value=!1,toast.handleError(t))return;delete q.value.reacted,q.value.reactions&&q.value.reactions--,q.emit()}else{ee.value=!0;const t=await i.default.query({params:e});if(ee.value=!1,toast.handleError(t))return;q.value.reacted=!0,q.value.reactions??=0,q.value.reactions++,q.emit()}}))).appendWhen(J.map(e,(e=>!!e||!f.default.Auth.author.value)),(0,M.default)("guest_heart",J,X,oe).tweak((e=>e.icon.setDisabled(!!f.default.Auth.author.value,"not a guest"))).setTooltip((e=>e.text.use("chapter/reaction/guest-heart"))).event.subscribe("click",(async()=>{if(f.default.Auth.loggedIn.value||oe.value)return;const e={...d.default.reference(q.value),type:"love"};if(X.value){oe.value=!0;const t=await u.default.query({params:e});if(oe.value=!1,toast.handleError(t))return;delete q.value.reacted,q.value.guest_reactions&&q.value.guest_reactions--,q.emit()}else{oe.value=!0;const t=await i.default.query({params:e});if(oe.value=!1,toast.handleError(t))return;q.value.reacted=!0,q.value.guest_reactions??=0,q.value.guest_reactions++,q.emit()}})))));for(const e of[Y.footer,Y.headerActions])e.style("view-type-chapter-block-paginator-actions"),(0,D.default)(`/work/${t.author}/${t.vanity}`).and(b.default).type("flush").text.use("chapter/action/index").appendTo(e.middle),ae().appendToWhen(P.default.mobile.falsy,e.middle),ae().style.toggle(e===Y.footer,"reaction-button-list--footer").appendToWhen(P.default.mobile.truthy,e);Y.data.use(Y,(e=>q.value=e));const ne=q.mapManual((e=>!e.root_comment||e.insufficient_pledge?void 0:{threadId:e.root_comment,threadAuthor:e.author}),B.default.deepEquals);return(0,S.default)().use(ne,((e,t)=>{if(t)return(0,y.default)(t.threadId,t.threadAuthor,!0)})).appendTo(s.content),s}})})),define("ui/view/ContactView",["require","exports","ui/component/core/Block","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.default=(0,n.default)({create(){const e=(0,a.default)("contact");return(0,o.default)().tweak((e=>e.title.text.use("document/contact/title"))).tweak((e=>e.content.useMarkdownContent("document/contact"))).appendTo(e.content),e}})})),define("ui/view/debug/ButtonRegistry",["require","exports","model/Session","utility/Env"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.BUTTON_REGISTRY=void 0,o=__importDefault(o),a=__importDefault(a),t.BUTTON_REGISTRY={createAuthor:{name:"Create Author",async execute(e,t,n,i,r,l,u,s,d){const c=await fetch(`${a.default.API_ORIGIN}author/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:e,vanity:t,age:n,description:i,pronouns:r,feedback_preference_critique:l,feedback_preference_dont_hold_back:u,feedback_preference_typos:s,license:d})}).then((e=>e.json()));console.log(c),await o.default.refresh()}},updateAuthor:{name:"Update Author",async execute(e,t,o,n,i,r,l,u,s,d){await fetch(`${a.default.API_ORIGIN}author/update`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:e,description:t,age:o,vanity:n,support_link:i,support_message:r,feedback_preference_critique:l,feedback_preference_dont_hold_back:u,feedback_preference_typos:s,license:d})})}},deleteAuthor:{name:"Delete Author",async execute(){await fetch(`${a.default.API_ORIGIN}author/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},viewAuthor:{name:"View Author",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}author/${t}/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,o)}},clearSession:{name:"Clear Session",async execute(){await fetch(`${a.default.API_ORIGIN}session/reset`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}),await o.default.refresh()}},createWork:{name:"Create Work",async execute(e,t,o,n,i,r,l,u,s,d,c,p){const f=await fetch(`${a.default.API_ORIGIN}work/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,synopsis:t,description:o,vanity:n,status:i,visibility:r,global_tags:l,custom_tags:u,feedback_preference_critique:s,feedback_preference_dont_hold_back:d,feedback_preference_typos:c,license:p})}).then((e=>e.json()));console.log(f)}},updateWork:{name:"Update Work",async execute(e,t,o,n,i,r,l,u,s,d,c){await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,description:n,vanity:i,status:r,visibility:l,feedback_preference_critique:u,feedback_preference_dont_hold_back:s,feedback_preference_typos:d,license:c})})}},deleteWork:{name:"Delete Work",async execute(e,t){await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},viewWork:{name:"View Work",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}work/${t}/${o}/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,n)}},getWorkFeedback:{name:"Get Work Feedback",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}work/${t}/${o}/feedback`,{credentials:"include"}).then((e=>e.json()));console.log(e,n)}},getAllWorksByAuthor:{name:"View All Works By Author",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}works/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(e,o)}},createChapter:{name:"Create Chapter",async execute(e,t,o,n,i,r,l,u,s,d){const c=await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/chapter/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,body:n,visibility:i,is_numbered:r,notes_before:l,notes_after:u,global_tags:s,custom_tags:d})}).then((e=>e.json()));console.log(c)}},updateChapter:{name:"Update Chapter",async execute(e,t,o,n,i,r,l,u,s,d,c){const p=await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,body:i,visibility:r,is_numbered:l,notes_before:u,notes_after:s,global_tags:d,custom_tags:c})}).then((e=>e.json()));console.log(p)}},deleteChapter:{name:"Delete Chapter",async execute(e,t,o){await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},viewChapter:{name:"View Chapter",async execute(e,t,o,n){const i=await fetch(`${a.default.API_ORIGIN}work/${t}/${o}/chapter/${n}/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,i)}},viewChapterPaginated:{name:"View Chapter Paginated",async execute(e,t,o,n){const i=await fetch(`${a.default.API_ORIGIN}work/${t}/${o}/chapters/individual?page=${n}`,{credentials:"include"}).then((e=>e.json()));console.log(e,i)}},getAllChapters:{name:"Get All Chapters",async execute(e,t,o=0){const n=await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/chapters/list?page=${o}`,{credentials:"include"}).then((e=>e.json()));console.log(n)}},follow:{name:"Follow",async execute(e,t){await fetch(`${a.default.API_ORIGIN}follow/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},followWork:{name:"Follow",async execute(e,t){await fetch(`${a.default.API_ORIGIN}follow/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unfollow:{name:"Unfollow",async execute(e,t){await fetch(`${a.default.API_ORIGIN}unfollow/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unfollowWork:{name:"Unfollow",async execute(e,t){await fetch(`${a.default.API_ORIGIN}unfollow/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},getFollow:{name:"Get Follow",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}follows/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getFollowWork:{name:"Get Follow",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}follows/work/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllFollows:{name:"Get All Follows",async execute(e,t=0){const o=await fetch(`${a.default.API_ORIGIN}following/${e}?page=${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllFollowsMerged:{name:"Get All Follows Merged",async execute(e=0){const t=await fetch(`${a.default.API_ORIGIN}following?page=${e}`,{credentials:"include"}).then((e=>e.json()));console.log(t)}},ignore:{name:"Ignore",async execute(e,t){await fetch(`${a.default.API_ORIGIN}ignore/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},ignoreWork:{name:"Ignore",async execute(e,t){await fetch(`${a.default.API_ORIGIN}ignore/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unignore:{name:"Unignore",async execute(e,t){await fetch(`${a.default.API_ORIGIN}unignore/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},unignoreWork:{name:"Unignore",async execute(e,t){await fetch(`${a.default.API_ORIGIN}unignore/work/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},getIgnore:{name:"Get Ignore",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}ignores/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getIgnoreWork:{name:"Get Ignore",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}ignores/work/${e}/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllIgnores:{name:"Get All Ignores",async execute(e,t=0){const o=await fetch(`${a.default.API_ORIGIN}ignoring/${e}?page=${t}`,{credentials:"include"}).then((e=>e.json()));console.log(o)}},getAllIgnoresMerged:{name:"Get All Ignores Merged",async execute(e=0){const t=await fetch(`${a.default.API_ORIGIN}ignoring?page=${e}`,{credentials:"include"}).then((e=>e.json()));console.log(t)}},privilegeGetAllAuthor:{name:"Get All Author Privileges",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}privilege/get/${t}`,{credentials:"include"}).then((e=>e.json()));console.log(e,o)}},privilegeGrantAuthor:{name:"Grant Privileges to Author",async execute(e,...t){const o=await fetch(`${a.default.API_ORIGIN}privilege/grant/author/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("granted privileges",o)}},privilegeRevokeAuthor:{name:"Revoke Privileges from Author",async execute(e,...t){const o=await fetch(`${a.default.API_ORIGIN}privilege/revoke/author/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("revoked privileges",o)}},createRole:{name:"Create Role",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}role/create`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,below:o,description:"idk some test stuff",visibilty:t})}).then((e=>e.json()));console.log("created role",n)}},deleteRole:{name:"Delete Role",async execute(e){const t=await fetch(`${a.default.API_ORIGIN}role/delete/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log("deleted role",t)}},editRole:{name:"Edit Role",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}role/update/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:o})}).then((e=>e.json()));console.log("edited role",n)}},grantRoleToAuthor:{name:"Grant Role to Author",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}role/grant/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log("granted role",o)}},revokeRoleFromAuthor:{name:"Revoke Role from Author",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}role/revoke/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log("granted role",o)}},privilegeGrantRole:{name:"Grant Privileges to Role",async execute(e,...t){const o=await fetch(`${a.default.API_ORIGIN}privilege/grant/role/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("granted privileges to role",o)}},privilegeRevokeRole:{name:"Revoke Privileges from Role",async execute(e,...t){const o=await fetch(`${a.default.API_ORIGIN}privilege/revoke/role/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({privileges:t})}).then((e=>e.json()));console.log("revoked privileges from role",o)}},roleListAll:{name:"List all roles",async execute(e){const t=await fetch(`${a.default.API_ORIGIN}role/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,t)}},roleReorder:{name:"Reorder roles",async execute(...e){const t=await fetch(`${a.default.API_ORIGIN}role/reorder`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({roles:e})}).then((e=>e.json()));console.log("reordered roles",t)}},createCommentChapter:{name:"Create Comment Chapter",async execute(e,t,o,n,i){const r=await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/comment/add`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({body:n,parent_id:i})}).then((e=>e.json()));console.log(r)}},updateCommentChapter:{name:"Update Comment Chapter",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}comment/update/chapter`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:e,body:t})}).then((e=>e.json()));console.log(o)}},deleteCommentChapter:{name:"Delete Comment Chapter",async execute(e){await fetch(`${a.default.API_ORIGIN}comment/remove/chapter`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:e})})}},getComment:{name:"Get Comment",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}comment/get`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment_id:e})}).then((e=>e.json()));console.log(t,o)}},getAllComments:{name:"Get All Comments",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}work/${e}/${t}/chapter/${o}/comments`,{credentials:"include"}).then((e=>e.json()));console.log(n)}},patreonGetTiers:{name:"Get Tiers",async execute(e){const t=await fetch(`${a.default.API_ORIGIN}patreon/campaign/tiers/get`,{credentials:"include"}).then((e=>e.json()));console.log(e,t)}},patreonSetThresholds:{name:"Set Chapter Thresholds",async execute(e,t,o,n,i){const r=await fetch(`${a.default.API_ORIGIN}patreon/campaign/tiers/set/${e}/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({visibility:o,chapters:n,tier_id:i})}).then((e=>e.json()));console.log(r)}},tagCreateCategory:{name:"Tag Create Category",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}tag/create/category`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,description:t})}).then((e=>e.json()));console.log(o)}},tagCreateGlobal:{name:"Tag Create Global",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}tag/create/global`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,description:t,category:o})}).then((e=>e.json()));console.log(n)}},tagPromoteCustom:{name:"Tag Promote Custom",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}tag/promote/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({description:t,category:o})}).then((e=>e.json()));console.log(n)}},tagDemoteGlobal:{name:"Tag Demote Global",async execute(e){const t=await fetch(`${a.default.API_ORIGIN}tag/demote/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(t)}},tagUpdateCategory:{name:"Tag Update Category",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}tag/update/category/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:o})}).then((e=>e.json()));console.log(n)}},tagUpdateGlobal:{name:"Tag Update Global",async execute(e,t,o,n){const i=await fetch(`${a.default.API_ORIGIN}tag/update/global/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,description:o,category:n})}).then((e=>e.json()));console.log(i)}},tagRemoveCategory:{name:"Tag Remove Category",async execute(e){const t=await fetch(`${a.default.API_ORIGIN}tag/remove/category/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(t)}},tagRemoveGlobal:{name:"Tag Remove Global",async execute(e){const t=await fetch(`${a.default.API_ORIGIN}tag/remove/global/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(t)}},tagGetManifest:{name:"Tag Get Manifest",async execute(){const e=await fetch(`${a.default.API_ORIGIN}manifest/tags`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},manifestFormLengthGet:{name:"Form Length Manifest",async execute(){const e=await fetch(`${a.default.API_ORIGIN}manifest/form/lengths`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},notificationsGet:{name:"Get Notifications",async execute(){const e=await fetch(`${a.default.API_ORIGIN}notifications/get/all`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},notificationsGetUnread:{name:"Get Unread Notifications",async execute(){const e=await fetch(`${a.default.API_ORIGIN}notifications/get/unread`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},notificationsMark:{name:"Mark Notifications Read/Unread",async execute(e,t){await fetch(`${a.default.API_ORIGIN}notifications/mark/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({notification_ids:t})})}},seedBulk:{name:"Seed Bulk",async execute(){await fetch(`${a.default.API_ORIGIN}seed/bulk`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}},feedGet:{name:"Get Feed",async execute(){const e=await fetch(`${a.default.API_ORIGIN}feed/get`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(e)}},grantSupporter:{name:"Grant supporter",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}moderation/supporter/grant/${e}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({months:t})}).then((e=>e.json()));console.log(o)}},supporterTest:{name:"supporter test",async execute(e){console.log("button is working");const t=new URLSearchParams({amount:`${e}`}),o=await fetch(`${a.default.API_ORIGIN}supporter/checkout/single?${t.toString()}`,{method:"GET",credentials:"include"}).then((e=>e.json()));console.log(o)}},supporterStatusPatreon:{name:"supporter status patreon",async execute(){console.log("button is working");const e=await fetch(`${a.default.API_ORIGIN}supporter/status/patreon`,{method:"GET",credentials:"include"}).then((e=>e.json()));console.log(e)}},workLock:{name:"work lock",async execute(e,t,o){const n=await fetch(`${a.default.API_ORIGIN}moderation/work/${e}/${t}/lock`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:o})}).then((e=>e.json()));console.log(n)}},workUnlock:{name:"work unlock",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}moderation/work/${e}/${t}/unlock`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(o)}},workCensor:{name:"work unlock",async execute(e,t){const o=await fetch(`${a.default.API_ORIGIN}moderation/work/${e}/${t}/unlock`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json()));console.log(o)}}}})),define("ui/view/DebugView",["require","exports","endpoint/auth/EndpointAuthServices","model/Session","ui/Component","ui/component/core/Button","ui/utility/StringApplicator","ui/view/debug/ButtonRegistry","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Env","utility/Objects","utility/Popup"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p);const f=n.default.Builder((e=>e.style("debug-block")));t.default=(0,s.default)({async create(){const e=(0,u.default)("debug"),t=(e,...t)=>(0,i.default)().text.set(e.name).event.subscribe("click",(async()=>{try{await e.execute(...t)}catch(t){const o=t;console.warn(`Button ${e.name} failed to execute:`,o)}})),n=f().appendTo(e.content),s=await o.default.query();for(const e of c.default.values(s.data??{})){if(!e)continue;const t=(0,p.default)({translation:r.Quilt.fake(`OAuth ${e.name}`),url:e.url_begin,width:600,height:900});(0,i.default)().text.set(`OAuth ${e.name}`).event.subscribe("click",(async()=>{await t.show(n).toastError(),await a.default.refresh()})).appendTo(n),(0,i.default)().text.set(`UnOAuth ${e.name}`).event.subscribe("click",(async()=>{const t=a.default.Auth.get(e.id)?.id;void 0!==t&&await fetch(`${d.default.API_ORIGIN}auth/remove`,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:t})})})).appendTo(n)}n.append(t(l.BUTTON_REGISTRY.clearSession));const m=f().appendTo(e.content);m.append(t({name:"Seed Bulk Data",async execute(){await l.BUTTON_REGISTRY.seedBulk.execute()}})),m.append(t({name:"Create Profile 1",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("prolific author","somanystories","sixteen_plus",'wow a description that mentions <mention vanity="somanystories">',"she/her pronies m8"),await l.BUTTON_REGISTRY.createWork.execute("a debut work",'pretty decent by <mention vanity="somanystories">',"short description","debut","Complete","Public"),await l.BUTTON_REGISTRY.createChapter.execute("somanystories","debut","chapter 1","woo look it's prolific author's first story!","Public"),await l.BUTTON_REGISTRY.createWork.execute("sequel to debut","wow they wrote a sequel","sequel short description","sequel","Ongoing","Public"),await l.BUTTON_REGISTRY.createChapter.execute("somanystories","sequel","the chapters","pretend there's a story here","Public"),await l.BUTTON_REGISTRY.createWork.execute("work in progress","test","short description test","wip","Ongoing","Private"),await l.BUTTON_REGISTRY.createChapter.execute("somanystories","wip","draft","it's a rough draft","Private"),await l.BUTTON_REGISTRY.viewWork.execute("work","somanystories","debut"),await l.BUTTON_REGISTRY.viewWork.execute("work","somanystories","sequel"),await l.BUTTON_REGISTRY.viewWork.execute("work","somanystories","wip"),await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("all works","somanystories")}})),m.append(t({name:"View Profile 1",async execute(){await l.BUTTON_REGISTRY.viewAuthor.execute("author with many stories","somanystories"),await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("all works","somanystories")}})),m.append(t({name:"Create Profile 2",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("single story author","justonestory","sixteen_plus",'<mention vanity="somanystories"> writes so much',"she/her",!1,void 0,!0),await l.BUTTON_REGISTRY.createWork.execute("one big work",'made by <mention vanity="justonestory">',"wow description","bigstory","Ongoing","Public",["Protagonist: Transgender","Genre: Fantasy","Genre: Romance","Setting: Urban Fantasy"],["Just A Test Work lmao","Gotta Add Some custom tags","apparently (these) are allowed?"],void 0,void 0,!1),await l.BUTTON_REGISTRY.getWorkFeedback.execute("feedback:","justonestory","bigstory"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 1","start of a long story","Public"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story interlude","middle of a long story","Public",!1,"only notes before"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 2","aaaa","Public",!0,void 0,"only notes after"),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3","aaaaaaa","Public",!0,"both notes before","and notes after",[],["Capitalised Custom Tags","Capitalised Custom Tags Two","these are (also) allowed?"]),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3.1","aaaaaaaaaaaaaaaaaaa","Public",!1),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3.2","aaaaaaaaaaaaaaaaaaa","Private",!1),await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory","big story 3.3","aaaaaaaaaaaaaaaaaaa","Public");for(let e=4;e<50;e++)await l.BUTTON_REGISTRY.createChapter.execute("justonestory","bigstory",`big story ${e}`,"aaaaaaaaaaaaaaaaaaa","Public");await l.BUTTON_REGISTRY.updateChapter.execute("justonestory","bigstory",4,void 0,void 0,void 0,!1),await l.BUTTON_REGISTRY.updateAuthor.execute(void 0,void 0,"eighteen_plus")}})),m.append(t({name:"View Profile 2",async execute(){await l.BUTTON_REGISTRY.viewAuthor.execute("justonestory author","justonestory")}})),m.append(t({name:"View Profile 2's stories",async execute(){await l.BUTTON_REGISTRY.viewChapter.execute("","justonestory","bigstory",1),await l.BUTTON_REGISTRY.viewWork.execute("big story five chapters","justonestory","bigstory"),await l.BUTTON_REGISTRY.getAllChapters.execute("justonestory","bigstory",0),await l.BUTTON_REGISTRY.viewChapterPaginated.execute("0","justonestory","bigstory",0),await l.BUTTON_REGISTRY.viewChapterPaginated.execute("4 (3.1)","justonestory","bigstory",4),await l.BUTTON_REGISTRY.viewChapterPaginated.execute("6 (private)","justonestory","bigstory",6)}})),m.append(t({name:"Create licensed work",async execute(){await l.BUTTON_REGISTRY.createWork.execute("licensed work","wowowow","wawaawaw","licensed","Ongoing","Public",[],[],void 0,void 0,void 0,{name:"Test License",link:"https://fluff4.me"}),await l.BUTTON_REGISTRY.updateWork.execute("justonestory","licensed","post-update",void 0,void 0,void 0,void 0,void 0,void 0,void 0,{name:"wowowie",link:"https://www.youtube.com/"}),await l.BUTTON_REGISTRY.updateAuthor.execute(void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,{name:"default license",link:"hasdfasjd"}),await l.BUTTON_REGISTRY.createWork.execute("licensed work 2","wowowow","wawaawaw","licensed2","Ongoing","Public",[],[],void 0,void 0,void 0)}})),m.append(t({name:"Grant Supporter",async execute(){await l.BUTTON_REGISTRY.grantSupporter.execute("brushly",5),await l.BUTTON_REGISTRY.grantSupporter.execute("lunafirewalk",-5),await l.BUTTON_REGISTRY.grantSupporter.execute("justonestory",9999)}}));const h=f().appendTo(e.content);h.append(t({name:"Test New Following",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("new follows","thefollower","sixteen_plus"),await l.BUTTON_REGISTRY.createWork.execute("wow a work","test pls ignore","pls ignore","wowawork","Ongoing","Public"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.follow.execute("author","thefollower"),await l.BUTTON_REGISTRY.followWork.execute("thefollower","wowawork"),await l.BUTTON_REGISTRY.getFollow.execute("author","thefollower"),await l.BUTTON_REGISTRY.getFollow.execute("author","thefollower"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.getAllFollows.execute("work"),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(),await l.BUTTON_REGISTRY.unignoreWork.execute("thefollower","wowawork"),await l.BUTTON_REGISTRY.getFollowWork.execute("thefollower","wowawork")}})),h.append(t({name:"Create a work with loads of chapters",async execute(){await l.BUTTON_REGISTRY.createWork.execute("even longer story","aaaaaaaaa","short description aaaaa","wowbig","Ongoing","Public");for(let e=0;e<2e3;e++)await l.BUTTON_REGISTRY.createChapter.execute("justonestory","wowbig",`chapter ${e}`,`wow chapter body ${e}`,"Public")}})),h.append(t({name:"Follows testing",async execute(){await l.BUTTON_REGISTRY.getAllFollows.execute("work",0),await l.BUTTON_REGISTRY.getAllFollows.execute("work",1),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(0),await l.BUTTON_REGISTRY.getAllFollowsMerged.execute(1)}})),h.append(t({name:"Spam Create Follow Work Test",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("spam create works","manyworks","sixteen_plus");for(let e=0;e<100;e++)await l.BUTTON_REGISTRY.createWork.execute(`rapid story ${e}`,"aaaaaaaaa","rapid story aaaaa",`rapidstory${e}`,"Ongoing","Public"),await l.BUTTON_REGISTRY.follow.execute("work",`rapidstory${e}`)}})),h.append(t({name:"Test Ignore Endpoints",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("ignoring myself","ignorepls","sixteen_plus"),await l.BUTTON_REGISTRY.createWork.execute("to ignore","testing ignoring","test ignoring","worktoignore","Ongoing","Public"),await l.BUTTON_REGISTRY.ignore.execute("author","ignorepls"),await l.BUTTON_REGISTRY.ignore.execute("work","worktoignore"),await l.BUTTON_REGISTRY.getIgnore.execute("author","ignorepls"),await l.BUTTON_REGISTRY.getIgnore.execute("author","ignorepls"),await l.BUTTON_REGISTRY.getIgnore.execute("work","worktoignore"),await l.BUTTON_REGISTRY.getIgnore.execute("work","worktoignore"),await l.BUTTON_REGISTRY.getAllIgnores.execute("author"),await l.BUTTON_REGISTRY.getAllIgnores.execute("author"),await l.BUTTON_REGISTRY.getAllIgnores.execute("work"),await l.BUTTON_REGISTRY.getAllIgnoresMerged.execute(),await l.BUTTON_REGISTRY.getAllIgnoresMerged.execute()}}));const g=f().appendTo(e.content);g.append(t({name:"privileges initial test",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","WorkViewPrivate","PrivilegeViewAuthor"),await l.BUTTON_REGISTRY.privilegeGetAllAuthor.execute("privileges of somanystories","somanystories"),await l.BUTTON_REGISTRY.privilegeRevokeAuthor.execute("somanystories","WorkViewPrivate"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","RevokePrivilege"),await l.BUTTON_REGISTRY.privilegeRevokeAuthor.execute("somanystories","WorkViewPrivate"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","ThisPrivilegeDoesntExist"),await l.BUTTON_REGISTRY.privilegeGetAllAuthor.execute("privileges of somanystories","somanystories")}})),g.append(t({name:"grant privs for testing",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","PrivilegeRevoke","RoleCreate","RoleEdit","RoleDelete","RoleGrant","RoleRevoke","PrivilegeViewAuthor","RoleViewAll"),await l.BUTTON_REGISTRY.createRole.execute("TestingRevoke","Visible"),await l.BUTTON_REGISTRY.grantRoleToAuthor.execute("TestingRevoke","somanystories"),await l.BUTTON_REGISTRY.revokeRoleFromAuthor.execute("TestingRevoke","somanystories"),await l.BUTTON_REGISTRY.privilegeGrantRole.execute("TestingRevoke","ViewAllRoles"),await l.BUTTON_REGISTRY.privilegeRevokeRole.execute("TestingRevoke","ViewAllRoles"),await l.BUTTON_REGISTRY.deleteRole.execute("TestingRevoke"),await l.BUTTON_REGISTRY.createRole.execute("SecondAuthorRole","Visible"),await l.BUTTON_REGISTRY.grantRoleToAuthor.execute("SecondAuthorRole","justonestory"),await l.BUTTON_REGISTRY.privilegeGrantRole.execute("SecondAuthorRole","RoleEdit","RoleDelete","RoleCreate")}})),g.append(t({name:"second author test stuff",async execute(){await l.BUTTON_REGISTRY.createRole.execute("DontWork","Admin"),await l.BUTTON_REGISTRY.createRole.execute("DoWork","SecondAuthorRole"),await l.BUTTON_REGISTRY.editRole.execute("Admin","CantDoThis"),await l.BUTTON_REGISTRY.deleteRole.execute("SecondAuthorRole")}})),g.append(t({name:"see highest level",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","RoleViewAll","RoleGrant","RoleCreate"),await l.BUTTON_REGISTRY.createRole.execute("NotTopRole","Admin"),await l.BUTTON_REGISTRY.grantRoleToAuthor.execute("NotTopRole","somanystories"),await l.BUTTON_REGISTRY.roleListAll.execute("listing all roles"),await l.BUTTON_REGISTRY.roleListAll.execute("listing all roles")}})),g.append(t({name:"role reorder test",async execute(){await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("somanystories","RoleViewAll","RoleGrant","RoleCreate"),await l.BUTTON_REGISTRY.createRole.execute("Role1","Visible","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role2","Visible","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role3","Hidden","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role4","Hidden","Admin"),await l.BUTTON_REGISTRY.roleReorder.execute("Role1","Role2","Role3","Role4")}}));const v=f().appendTo(e.content);v.append(t({name:"Make ten billion works",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("lots of works test","manyworks","sixteen_plus","test description"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("manyworks","TagGlobalCreate","TagGlobalDelete","TagGlobalUpdate","TagCategoryCreate","TagCategoryUpdate","TagCategoryDelete","TagPromote","TagDemote"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category One","the first test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Two","the second test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Three","the third test category"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag One","test tag 1","Category One"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Two","test tag 1","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Three","test tag 1","Category Three");for(let e=0;e<333;e++)await l.BUTTON_REGISTRY.createWork.execute(`work${e}`,`description no ${e} mentions <mention vanity="manyworks">\n"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."`,"Lorem ipsum dolor sit amet, consectetur adipiscing elit,",`testwork${e}`,"Ongoing","Public",["Category One: Tag One","Category Two: Tag Two","Category Three: Tag Three"],["custom tag one",`custom tag two ${e}`]);for(let e=0;e<333;e++)await l.BUTTON_REGISTRY.createChapter.execute("manyworks",`testwork${e}`,`chapter ${e}`,`it's a test chapter ${e}`,"Public")}})),v.append(t({name:"view ten billion works",async execute(){await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("many works","manyworks")}})),v.append(t({name:"admin list roles test (profile 1)",async execute(){await l.BUTTON_REGISTRY.createRole.execute("Role4","Hidden","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role3","Visible","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role2","Hidden","Admin"),await l.BUTTON_REGISTRY.createRole.execute("Role1","Visible","Admin"),await l.BUTTON_REGISTRY.roleListAll.execute("all roles admin")}})),v.append(t({name:"user list roles test (profile 2)",async execute(){await l.BUTTON_REGISTRY.roleListAll.execute("all roles user")}})),v.append(t({name:"Delete Author Test",async execute(){await l.BUTTON_REGISTRY.deleteAuthor.execute()}}));const y=f().appendTo(e.content);y.append(t({name:"Author 2 lots of comments",async execute(){await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","base comments 1"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","2","base comments 2"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","3","base comments 3"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","4","base comments 4"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","5","base comments 5"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1",'child comment <mention vanity="justonestory">',"6"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","child comment 2","6"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1",'child comment 3<mention vanity="justonestory">',"11"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1",'child comment 4<mention vanity="justonestory">',"12"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","base comment index 1"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","child comment 6","13"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","child comment 7","11"),await l.BUTTON_REGISTRY.createCommentChapter.execute("justonestory","bigstory","1","base comment index 1 again"),await l.BUTTON_REGISTRY.getAllComments.execute("justonestory","bigstory","1"),await l.BUTTON_REGISTRY.getComment.execute("1","get comment")}})),y.append(t({name:"Author 2 just get comments",async execute(){await l.BUTTON_REGISTRY.getAllComments.execute("justonestory","bigstory","1")}})),y.append(t({name:"Author 1 single comment ping",async execute(){await l.BUTTON_REGISTRY.createCommentChapter.execute("somanystories","debut","1","wow you write so many stories @somanystories how do you do it"),await l.BUTTON_REGISTRY.createCommentChapter.execute("somanystories","debut","1","@somanystories you're so @somanystories amazing"),await l.BUTTON_REGISTRY.getComment.execute("4"),await l.BUTTON_REGISTRY.getComment.execute("5"),await l.BUTTON_REGISTRY.updateCommentChapter.execute("4","okay done fawning over @somanystories now"),await l.BUTTON_REGISTRY.getComment.execute("4"),await l.BUTTON_REGISTRY.deleteCommentChapter.execute("5"),await l.BUTTON_REGISTRY.getComment.execute("5")}})),y.append(t({name:"try to delete author 1's comment",async execute(){await l.BUTTON_REGISTRY.deleteCommentChapter.execute("4"),await l.BUTTON_REGISTRY.getComment.execute("4")}}));const b=f().appendTo(e.content),_=(0,p.default)({translation:r.Quilt.fake("Campaign OAuth"),url:`${d.default.API_ORIGIN}auth/patreon/campaign/begin`,width:600,height:900});(0,i.default)().text.set("Campaign Test").event.subscribe("click",(async()=>{await _.show(b).toastError(),await a.default.refresh()})).appendTo(b),b.append(t({name:"create patreon author",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("has a campaign","patreonuser","sixteen_plus"),await l.BUTTON_REGISTRY.createWork.execute("patreon only story","test","short description test","exclusive","Ongoing","Public"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 1","hewwo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 2","hewwoo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 3","hewwooo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 4","hewwooo","Private"),await l.BUTTON_REGISTRY.createChapter.execute("patreonuser","exclusive","chapter 5","hewwooo","Private")}})),b.append(t({name:"get patreon tiers",async execute(){await l.BUTTON_REGISTRY.patreonGetTiers.execute("patreon tiers"),await l.BUTTON_REGISTRY.patreonGetTiers.execute("patreon tiers")}})),b.append(t({name:"set patreon chapters",async execute(){await l.BUTTON_REGISTRY.updateChapter.execute("patreonuser","exclusive",1,void 0,void 0,"Public"),await l.BUTTON_REGISTRY.patreonSetThresholds.execute("patreonuser","exclusive","Public",["2","3"]),await l.BUTTON_REGISTRY.patreonSetThresholds.execute("patreonuser","exclusive","Patreon",["4","5"],"4392761")}}));const w=(0,p.default)({translation:r.Quilt.fake("Patron OAuth"),url:`${d.default.API_ORIGIN}auth/patreon/patron/begin`,width:600,height:900});(0,i.default)().text.set("Patron Test").event.subscribe("click",(async()=>{await w.show(b).toastError(),await a.default.refresh()})).appendTo(b),b.append(t({name:"get patreon-only chapters",async execute(){await l.BUTTON_REGISTRY.viewChapter.execute("public:","patreonuser","exclusive",3),await l.BUTTON_REGISTRY.viewChapter.execute("public:","patreonuser","exclusive",3),await l.BUTTON_REGISTRY.viewChapter.execute("patreon:","patreonuser","exclusive",4),await l.BUTTON_REGISTRY.viewChapter.execute("patreon:","patreonuser","exclusive",4)}})),b.append(t({name:"update patreon-only chapters",async execute(){await l.BUTTON_REGISTRY.patreonSetThresholds.execute("patreonuser","exclusive","Public",["4"])}}));const k=f().appendTo(e.content);k.append(t({name:"Create Tag Author",async execute(){await l.BUTTON_REGISTRY.createAuthor.execute("tagging test","thetagger","sixteen_plus","test description"),await l.BUTTON_REGISTRY.privilegeGrantAuthor.execute("thetagger","TagGlobalCreate","TagGlobalDelete","TagGlobalUpdate","TagCategoryCreate","TagCategoryUpdate","TagCategoryDelete","TagPromote","TagDemote")}})),k.append(t({name:"Update Tag Author",async execute(){await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger"),await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger"),await l.BUTTON_REGISTRY.updateAuthor.execute("the tagger 2",'wow i\'m <mention vanity="thetagger">'),await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger"),await l.BUTTON_REGISTRY.viewAuthor.execute("view post-update","thetagger")}})),k.append(t({name:"Tag Create Test",async execute(){await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category One","the first test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Two","the second test category"),await l.BUTTON_REGISTRY.tagCreateCategory.execute("Category Three","the third test category"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag One",'test tag 1 <mention vanity="thetagger">',"Category One"),await l.BUTTON_REGISTRY.tagUpdateGlobal.execute("Category One: Tag One","Tag One Updated","test tag 1 updated","Category Two"),await l.BUTTON_REGISTRY.tagUpdateCategory.execute("Category One","Category One Updated","first test category updated"),await l.BUTTON_REGISTRY.tagRemoveCategory.execute("Category One Updated"),await l.BUTTON_REGISTRY.tagRemoveGlobal.execute("Category Two: Tag One Updated"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("tag conflict","conflicting","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("tag conflict","conflicting","Category Three"),await l.BUTTON_REGISTRY.tagUpdateGlobal.execute("Category Three: tag conflict",void 0,void 0,"Category Two")}})),k.append(t({name:"Work Tag Test",async execute(){await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Two","test tag 2","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Three","test tag 2","Category Two"),await l.BUTTON_REGISTRY.tagCreateGlobal.execute("Tag Four","test tag 2","Category Two"),await l.BUTTON_REGISTRY.createWork.execute("Tag Test Work","test","desc test","testwork","Ongoing","Public",["Category Two: Tag Two","Category Two: Tag Three"],["custom tag 1","custom tag 2"]),await l.BUTTON_REGISTRY.createWork.execute("Tag Test Work Two","test2","desc test","testworktwo","Ongoing","Public",["Category Two: Tag Two","Category Two: Tag Three"],["custom tag 2","custom tag 3"]),await l.BUTTON_REGISTRY.viewWork.execute("work view 1","thetagger","testworktwo"),await l.BUTTON_REGISTRY.viewWork.execute("work view 2","thetagger","testworktwo"),await l.BUTTON_REGISTRY.updateWork.execute("thetagger","testworktwo","Test Work Two Updated"),await l.BUTTON_REGISTRY.viewWork.execute("work view 3","thetagger","testworktwo"),await l.BUTTON_REGISTRY.viewWork.execute("work view 4","thetagger","testworktwo"),await l.BUTTON_REGISTRY.getAllWorksByAuthor.execute("all works","thetagger")}})),k.append(t({name:"Chapter Tag Test",async execute(){await l.BUTTON_REGISTRY.createChapter.execute("thetagger","testworktwo","test chapter","test chapter body","Public",!0,void 0,void 0,["Category Two: Tag Two","Category Two: Tag Three"],["custom tag 2","custom tag 3","custom tag 4"]),await l.BUTTON_REGISTRY.viewChapter.execute("chapter","thetagger","testworktwo",1)}})),k.append(t({name:"Tag Promote/Demote",async execute(){await l.BUTTON_REGISTRY.tagPromoteCustom.execute("custom tag 1","test description","Category Two"),await l.BUTTON_REGISTRY.tagDemoteGlobal.execute("Category Two: Tag Three"),await l.BUTTON_REGISTRY.viewWork.execute("work view 3","thetagger","testwork"),await l.BUTTON_REGISTRY.viewWork.execute("work view 4","thetagger","testworktwo")}})),k.append(t({name:"manifest test",async execute(){await l.BUTTON_REGISTRY.tagGetManifest.execute()}})),k.append(t({name:"manifest test 2",async execute(){await l.BUTTON_REGISTRY.tagCreateGlobal.execute("extra tag","wow","Category Three"),await l.BUTTON_REGISTRY.tagGetManifest.execute()}})),k.append(t({name:"form length manifest",async execute(){await l.BUTTON_REGISTRY.manifestFormLengthGet.execute()}}));const T=f().appendTo(e.content);T.append(t({name:"Get Notifications",async execute(){await l.BUTTON_REGISTRY.notificationsGet.execute(),await l.BUTTON_REGISTRY.notificationsGetUnread.execute()}})),T.append(t({name:"Mark Notifications Read",async execute(){await l.BUTTON_REGISTRY.notificationsMark.execute("read",["ba397c1b-02e5-462c-b367-04b007d1f09a","d8830a0c-3e2c-4caa-ae4b-679a8c5cefa5"]),await l.BUTTON_REGISTRY.notificationsMark.execute("unread",["ba397c1b-02e5-462c-b367-04b007d1f09a","3b9781ea-d15d-4915-bbeb-4788ed734453"])}})),T.append(t({name:"Get Front Page Feed",async execute(){await l.BUTTON_REGISTRY.feedGet.execute()}})),T.append(t({name:"supporter test",async execute(){console.log("wow button"),await l.BUTTON_REGISTRY.supporterTest.execute(2e3)}})),T.append(t({name:"work lock",async execute(){await l.BUTTON_REGISTRY.workLock.execute("brushly","weirddrink","too stimulating"),await l.BUTTON_REGISTRY.workLock.execute("justonestory","bigstory","i dont like it")}})),T.append(t({name:"work unlock",async execute(){await l.BUTTON_REGISTRY.workUnlock.execute("brushly","weirddrink"),await l.BUTTON_REGISTRY.workUnlock.execute("justonestory","bigstory")}}));const x=f().appendTo(e.content),D=(0,p.default)({translation:r.Quilt.fake("Fluff Campaign OAuth"),url:`${d.default.API_ORIGIN}admin/auth/campaign/begin`,width:600,height:900});return(0,i.default)().text.set("Fluff Campaign Test").event.subscribe("click",(async()=>{await D.show(x).toastError(),await a.default.refresh()})).appendTo(x),x.append(t({name:"patreon status",async execute(){await l.BUTTON_REGISTRY.supporterStatusPatreon.execute()}})),e}})})),define("endpoint/feed/EndpointFeedGetFollowed",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/feed/get/followed","get")})),define("ui/component/WorkFeed",["require","exports","model/PagedListData","ui/Component","ui/component/core/Link","ui/component/core/Paginator","ui/component/Work","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=a.default.Builder((e=>{const t=e.and(i.default).type("flush"),u=(0,l.default)(void 0);let s;const d=t.extend((e=>({state:u,setPageHandler:t=>(s=t,e),setFromEndpoint(t,a){const n=(0,l.default)([]),i=(0,o.default)(t.getPageSize?.()??25,{async get(e){const o=await t.query(void 0,{page:e});return u.value=void 0,!toast.handleError(o)&&(o.data?(u.value=o.data,n.value.push(...o.data.authors),n.value.distinctInPlace((e=>e.vanity)),n.emit(),o.data.works):null)}});return e.setFromWorks(i,n,a),e},setFromWorks:(o,a,i=0)=>(t.set(o,i,((e,t,o)=>{s?.(o);for(const o of t){const t=a.value.find((e=>e.vanity===o.author));(0,n.default)(t&&`/work/${t.vanity}/${o.vanity}`).and(r.default,o,t,!0).viewTransition(!1).appendTo(e)}})),e)})));return t.orElse((e=>(0,a.default)().style("placeholder").text.use("feed/empty").appendTo(e))),d}));t.default=u})),define("ui/view/FeedView",["require","exports","endpoint/feed/EndpointFeedGetFollowed","model/Follows","ui/component/core/Button","ui/component/core/Link","ui/component/WorkFeed","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/State"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),t.default=(0,u.default)({create:()=>{const e=(0,l.default)("feed");e.breadcrumbs.title.text.use("view/feed/main/title"),e.breadcrumbs.description.text.use("view/feed/main/description");const t=(0,s.default)(void 0);return e.breadcrumbs.setRSSButton(t),(0,i.default)("/following").and(n.default).type("flush").setIcon("circle-check-big").text.bind(a.default.map(e,(()=>e=>e["view/shared/info/following"](a.default.getTotalFollowing())))).appendTo(e.breadcrumbs.actions),(0,i.default)("/ignoring").and(n.default).type("flush").setIcon("ban").text.bind(a.default.map(e,(()=>e=>e["view/shared/info/ignoring"](a.default.getTotalIgnoring())))).appendTo(e.breadcrumbs.actions),(0,r.default)().viewTransition("feed-view-feed").setFromEndpoint(o.default).tweak((e=>e.state.use(e,(e=>t.value=e?.rss_url)))).appendTo(e.content),e}})})),define("endpoint/author/EndpointAuthorsResolveReferences",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/authors/resolve","get")})),define("ui/view/following/FollowingAuthorsTab",["require","exports","endpoint/author/EndpointAuthorsResolveReferences","model/Follows","model/PagedListData","ui/Component","ui/component/Author","ui/component/core/Link","ui/component/core/Paginator","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","utility/AbortPromise","utility/Arrays"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),p=__importDefault(p);const m=i.default.Builder(((e,t)=>{const i=e.and(c.Tab).text.use("view/following/tab/authors").extend((e=>({}))),m=a.default.map(i,(e=>e?.[t].author??[]),((e,t)=>!!e==!!t&&e.length===t.length&&e.every((e=>t.some((t=>e.author===t.author))))));let h=0;return(0,d.default)().use(m,p.default.asyncFunction((async(e,a,i)=>{const d=(0,n.default)(25,{async get(e){const t=i.slice(25*e,25*(e+1))??[];if(!t.length)return null;const a=await o.default.query(void 0,{authors:t.map((e=>e.author)).filterInPlace(f.NonNullish)});return!toast.handleError(a)&&a.data}});await d.get(0),(0,u.default)().type("flush").viewTransition(!1).set(d,0,((e,t)=>{for(const o of t)(0,l.default)(`/author/${o.vanity}`).and(r.default,o).viewTransition(!1).appendTo(e)})).orElse((e=>(0,s.default)().text.use(`view/${t}/panel/authors/empty`).appendTo(e))).tweak((e=>e.page.asMutable?.setValue(h))).tweak((e=>e.page.use(a,(e=>h=e)))).appendTo(a)}))).appendTo(i.content),i}));t.default=m})),define("endpoint/feed/EndpointFeedGetAuthed",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/feed/get/authed","get")})),define("ui/view/SearchView",["require","exports","endpoint/feed/EndpointFeedGetAuthed","model/FormInputLengths","model/Session","model/Tags","model/Works","ui/component/core/Block","ui/component/core/Form","ui/component/core/LabelledTable","ui/component/core/Slot","ui/component/core/TextInput","ui/component/TagsEditor","ui/component/WorkFeed","ui/component/WorkStatusDropdown","ui/view/shared/component/PaginatedView","ui/view/shared/component/ViewDefinition","utility/Env","utility/Errors","utility/Objects","utility/State","utility/string/Strings"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w){Object.defineProperty(t,"__esModule",{value:!0}),t.createSearchParams=T,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importStar(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w);const k=y.default.redirection("/");function T(e){return Object.entries(e).filter((([e,t])=>null!=t&&""!==t&&(!Array.isArray(t)||t.length>0)&&("page"!==e||+t>0))).map((([e,t])=>[e,"string"==typeof t?t:JSON.stringify(t)])).collect((e=>new URLSearchParams(e.toObject()).toString()))}t.default=(0,g.default)({async load(){if("logged-in"!==n.default.Auth.state.value)return k()},create(){const e=(0,h.default)("search"),t=(0,_.default)(location.search.replaceAll("?",""));window.addEventListener("popstate",(()=>{t.value=location.search.replaceAll("?","")}));const n=(0,_.default)(void 0);return(0,d.default)().appendTo(e.content).use(t,((e,o)=>{const d=(0,l.default)().appendTo(e),f=d.and(u.default,d.title);f.title.text.use("view/search/title");const h=(0,s.default)().appendTo(f.content),g=e=>Array.isArray(e)&&e.every(i.default.isId),y=new URLSearchParams(`?${o}`).entries().toArray().toObject(),b={search:y.search,whitelist_tags:w.default.optionalParseJSON(y.whitelist_tags,g),blacklist_tags:w.default.optionalParseJSON(y.blacklist_tags,g),blacklisted_work_statuses:w.default.optionalParseJSON(y.blacklisted_work_statuses,(e=>Array.isArray(e)&&e.every((e=>"string"==typeof e&&r.WORK_STATUSES.includes(e))))),minimum_word_count:+y.minimum_word_count||void 0,maximum_word_count:+y.maximum_word_count||void 0,page:+y.page||void 0},_=(0,c.default)().setMaxLength(a.default.map(h,(e=>e?.feed_search?.search)));_.value=b.search||"",h.label((e=>e.text.use("view/search/input/text/label"))).content(((e,t)=>e.append(_.setLabel(t))));const k=(0,p.default)().setGlobalTagsOnly().globalHint.use("view/search/input/whitelist_tags/hint").setMaxLengthGlobal(a.default.map(h,(e=>e?.feed_search?.tag_whitelist)));k.state.value={global_tags:b.whitelist_tags??[],custom_tags:[]},h.label((e=>e.text.use("view/search/input/whitelist_tags/label"))).content(((e,t)=>e.append(k.setLabel(t))));const x=(0,p.default)().setGlobalTagsOnly().globalHint.use("view/search/input/blacklist_tags/hint").setMaxLengthGlobal(a.default.map(h,(e=>e?.feed_search?.tag_blacklist)));x.state.value={global_tags:b.blacklist_tags??[],custom_tags:[]},h.label((e=>e.text.use("view/search/input/blacklist_tags/label"))).content(((e,t)=>e.append(x.setLabel(t))));const D=(0,c.default)().filter(c.FilterFunction.NUMERIC);D.value=`${b.minimum_word_count??""}`,h.label((e=>e.text.use("view/search/input/minimum_word_count/label"))).content(((e,t)=>e.append(D.setLabel(t))));const O=(0,c.default)().filter(c.FilterFunction.NUMERIC);O.value=`${b.maximum_word_count??""}`,h.label((e=>e.text.use("view/search/input/maximum_word_count/label"))).content(((e,t)=>e.append(O.setLabel(t))));const S=m.default.Check(r.WORK_STATUSES.filter((e=>!b.blacklisted_work_statuses?.includes(e))));function E(e=!1){n.value={search:_.value.trim()||void 0,whitelist_tags:k.state.value.global_tags,blacklist_tags:x.state.value.global_tags,blacklisted_work_statuses:r.WORK_STATUSES.filter((e=>!S.selection.value?.includes(e))),minimum_word_count:!isNaN(+D.value)&&+D.value>99?+D.value:void 0,maximum_word_count:!isNaN(+O.value)&&+O.value>99&&+O.value>=(+D.value||0)?+O.value:void 0,page:e&&+b.page||0};const a=T(n.value);a!==o&&(o=a,t.setValueSilent(a),history.pushState(null,"",`${v.default.URL_ORIGIN}search${a?`?${a}`:""}`))}h.label((e=>e.text.use("view/search/input/statuses/label"))).content(((e,t)=>e.append(S.setLabel(t)))),f.submit.textWrapper.text.use("view/search/action/submit"),f.onSubmit((()=>E())),E(!0)})),e.paginator().and(f.default).tweak((e=>{e.headerActions,n.use(e,(t=>{e.setFromEndpoint(o.default.prep(void 0,t&&b.default.filterNullish(t)),t?.page||void 0)})),e.setPageHandler((o=>{const a=new URLSearchParams(t.value);0!==o?a.set("page",`${o}`):a.delete("page");const n=a.toString();e.setURL("/search"+(n?`?${n}`:""))}))})).appendTo(e.content),e}})})),define("ui/component/TagBlock",["require","exports","model/Follows","model/Session","model/Tags","ui/Component","ui/component/core/Block","ui/component/core/Button","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Popover","ui/component/core/Slot","ui/component/FollowingBookmark","ui/component/Tag","ui/view/SearchView","utility/AbortPromise","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),h=__importDefault(h),g=__importDefault(g);const v=i.default.Builder(((e,t,v)=>{const y=(0,g.default)(v);y.value||n.default.getManifest().then((e=>y.value=e));const b=e.and(r.default).style("tag-block").extend((e=>({}))),_=n.default.toId(t);b.header.style("tag-block-header"),(0,p.default)((e=>e.followingTag(_))).style("tag-block-following-bookmark").appendTo(b.header),b.setActionsMenu((e=>{a.default.Auth.loggedIn.use(e,(t=>{t&&((0,l.default)().type("flush").bindIcon(o.default.map(e,(()=>o.default.followingTag(_)?"circle-check-big":"circle"))).text.bind(o.default.map(e,(()=>e=>o.default.followingTag(_)?e["tag/action/label/unfollow"]():e["tag/action/label/follow"]()))).event.subscribe("click",(()=>o.default.toggleFollowingTag(_))).appendTo(e),(0,l.default)().type("flush").bindIcon(o.default.map(e,(()=>o.default.ignoringTag(_)?"ban":"circle"))).text.bind(o.default.map(e,(()=>e=>o.default.ignoringTag(_)?e["tag/action/label/unignore"]():e["tag/action/label/ignore"]()))).event.subscribe("click",(()=>o.default.toggleIgnoringTag(_))).appendTo(e))}))}));const w=(0,i.default)().style("tag-block-info").prependTo(b.header),k=(0,f.default)(t).replaceElement(document.createElement("span")).style("tag-block-tag").tweak((e=>e.followingBookmark?.remove())).appendTo(w);k.categoryWrapper?.style("tag-block-tag-category"),k.nameWrapper.style("tag-block-tag-name"),b.content.style("tag-block-content"),(0,i.default)().style("tag-block-description").setMarkdownContent(t.description).appendTo(b.content);const T=e=>(0,f.default)(e).style("tag-block-relationship");t.aliases?.length&&(0,i.default)().style("tag-block-aliases").append((0,u.default)().style("tag-block-section-heading").setAestheticStyle(!1).text.use("tag/label/aliases")).append(...t.aliases?t.aliases.map(T):[]).appendTo(b.content);const x=e.getStateForClosest(d.default);async function D(e){const t=await n.default.resolve(e);if(!t.length)return[];const o=[];o.push(...t.slice(0,4).map(T));const a=t.slice(4);return a.length&&o.push((0,c.default)().if(x.falsy,(e=>e.append(...a.map(T))))),o}const O=n.default.toId(t),S=y.mapManual((e=>e?.relationships[O]??[]));(0,c.default)().appendTo(b.content).use(S,h.default.asyncFunction((async(e,t,o)=>o.length?(0,i.default)().style("tag-block-relationships").append((0,u.default)().style("tag-block-section-heading").setAestheticStyle(!1).text.use("tag/label/relationships-to")).append(...await D(o)):void 0)));const E=y.mapManual((e=>e?Object.entries(e.relationships).filter((([e,t])=>t.includes(O))).map((([e])=>e)):[]));return(0,c.default)().appendTo(b.content).use(E,h.default.asyncFunction((async(e,t,o)=>o.length?(0,i.default)().style("tag-block-relationships").append((0,u.default)().style("tag-block-section-heading").setAestheticStyle(!1).text.use("tag/label/relationships-from")).append(...await D(o)):void 0))),b.footer.style("tag-block-footer").append((0,s.default)(`/search?${(0,m.createSearchParams)({whitelist_tags:[_]})}`).and(l.default).style("tag-block-footer-button").text.use("tag/action/label/search")).appendToWhen(a.default.Auth.loggedIn,b),b}));t.default=v})),define("ui/view/following/FollowingTagsTab",["require","exports","model/Follows","model/Tags","ui/Component","ui/component/core/Link","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/TagBlock","utility/AbortPromise","utility/Arrays"],(function(e,t,o,a,n,i,r,l,u,s,d,c){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),s=__importDefault(s),d=__importDefault(d);const p=n.default.Builder(((e,t)=>{const n=e.and(u.Tab).text.use("view/following/tab/tags").extend((e=>({}))),p=o.default.map(n,(e=>e?.[t].tag??[]),((e,t)=>!!e==!!t&&e.length===t.length&&e.every((e=>t.some((t=>e.tag===t.tag))))));return(0,l.default)().use(p,d.default.asyncFunction((async(e,o,n)=>{const l=await a.default.resolve(n.map((e=>e.tag)).filterInPlace(c.NonNullish));if(!l.length)return(0,r.default)().text.use(`view/${t}/panel/tags/empty`).appendTo(o);for(const e of l)(0,i.default)(`/tag/${e.category.toLowerCase()}/${e.name.toLowerCase()}`).and(s.default,e).viewTransition(!1).appendTo(o)}))).appendTo(n.content),n}));t.default=p})),define("endpoint/work/EndpointWorksResolveReferences",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/works/resolve","get")})),define("ui/view/following/FollowingWorksTab",["require","exports","endpoint/work/EndpointWorksResolveReferences","model/Follows","model/PagedListData","model/Works","ui/Component","ui/component/core/Link","ui/component/core/Paginator","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/Work","utility/AbortPromise","utility/Arrays","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),p=__importDefault(p),f=__importDefault(f),h=__importDefault(h);const g=r.default.Builder(((e,t)=>{const r=e.and(c.Tab).text.use("view/following/tab/works").extend((e=>({}))),g=a.default.map(r,(e=>e?.[t].work??[]),((e,t)=>!!e==!!t&&e.length===t.length&&e.every((e=>t.some((t=>e.work?.author===t.work?.author&&e.work?.vanity===t.work?.vanity))))));let v=0;return(0,d.default)().use(g,f.default.asyncFunction((async(e,a,r)=>{const d=(0,h.default)([]),c=(0,n.default)(25,{async get(e){const t=r.slice(25*e,25*(e+1))??[];if(!t.length)return null;const a=await o.default.query(void 0,{works:t.map((e=>i.default.reference(e.work))).filterInPlace(m.NonNullish)});return!toast.handleError(a)&&(d.value.push(...a.data.authors),d.value.distinctInPlace((e=>e.vanity)),d.emit(),a.data.works)}});await c.get(0),(0,u.default)().type("flush").viewTransition(!1).set(c,0,((e,t)=>{for(const o of t)(0,l.default)(`/work/${o.author}/${o.vanity}`).and(p.default,o,d.value.find((e=>e.vanity===o.author)),!0).viewTransition(!1).appendTo(e)})).orElse((e=>(0,s.default)().text.use(`view/${t}/panel/works/empty`).appendTo(e))).tweak((e=>e.page.asMutable?.setValue(v))).tweak((e=>e.page.use(a,(e=>v=e)))).appendTo(a)}))).appendTo(r.content),r}));t.default=g})),define("ui/view/FollowingView",["require","exports","ui/component/core/Tabinator","ui/view/following/FollowingAuthorsTab","ui/view/following/FollowingTagsTab","ui/view/following/FollowingWorksTab","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=(0,l.default)({create:()=>{const e=(0,r.default)("following");return e.breadcrumbs.title.text.use("view/following/main/title"),e.breadcrumbs.description.text.use("view/following/main/description"),(0,o.default)().addTab((0,i.default)("following")).addTab((0,a.default)("following")).addTab((0,n.default)("following")).appendTo(e.content),e}})})),define("endpoint/site/EndpointSiteStatus",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/site/status","get")})),define("model/SiteStatus",["require","exports","endpoint/site/EndpointSiteStatus","model/Manifest","utility/Time"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.default=(0,a.default)({valid:n.default.minutes(30),refresh:!0,cacheId:"status",get:()=>o.default.query(),orElse:()=>({fundraisers:[]})})})),define("ui/component/FundraiserBar",["require","exports","ui/Component"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=o.default.Builder(((e,t,a,n)=>{const i=e=>(0,o.default)().style("view-type-fundraiser-progress-bar-amount").text.use((t=>t[`fundraiser/amount-${n}`](e.toLocaleString(navigator.language))));return e.style("view-type-fundraiser-progress-bar").style.setVariable("fundraiser-progress",Math.min(1,t/a)).append((0,o.default)().style("view-type-fundraiser-progress-bar-background").append((0,o.default)().style("view-type-fundraiser-progress-bar-progress"))).append(i(Math.round(t/100))).append(i(Math.round(a/100)))}))})),define("ui/view/FundraiserView",["require","exports","model/SiteStatus","ui/Component","ui/component/core/Block","ui/component/core/Slot","ui/component/FundraiserBar","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),t.default=(0,u.default)({create(){const e=(0,l.default)("fundraiser");return(0,n.default)().tweak((e=>e.title.text.use("fundraiser/title"))).tweak((e=>e.content.append((0,i.default)().use(o.default,((e,t)=>{const o=t?.fundraisers[0];if(o)return(0,a.default)().style("view-type-fundraiser-progress-bar-wrapper").append((0,r.default)(o.monthly_income,1e5,"monthly")).append((0,r.default)(o.funds_raised,o.thresholds[0],"total").style("view-type-fundraiser-progress-bar--total"))}))).append((0,a.default)().useMarkdownContent("fundraiser/description")))).appendTo(e.content),e}})})),define("endpoint/history/EndpointHistoryGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/history/get","get")})),define("ui/view/HistoryView",["require","exports","endpoint/history/EndpointHistoryGet","model/Authors","model/PagedListData","model/Works","ui/component/Chapter","ui/component/core/Block","ui/component/core/Link","ui/component/core/Paginator","ui/component/Work","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),t.default=(0,p.default)({create:()=>{const e=(0,c.default)("history");return e.breadcrumbs.title.text.use("view/history/main/title"),e.breadcrumbs.description.text.use("view/history/main/description"),(0,s.default)().type("flush").set(n.default.fromEndpoint(25,o.default.prep(),(e=>({content:e.items,auxiliary:e}))),0,((e,t,o,n)=>{let s,c;e.style("history");for(let e=t.length-1;e>=0;e--){const o=t[e];o.chapter&&!i.default.equals(o.work,s)&&t.splice(e+1,0,{work:o.work,view_time:o.view_time}),!o.chapter&&i.default.equals(o.work,s)&&t.splice(e,1),s=o.work}for(const o of t){const t=i.default.resolve(o.work,n.works.value),s=a.default.resolve(t?.author,n.authors.value);t&&s&&(o.chapter?(0,r.default)({...o.chapter,time_last_update:o.view_time},t,s).style("history-chapter").appendTo(c??=(0,l.default)().style("history-chapter-block","chapter-list").tweak((e=>e.content.remove())).appendTo(e)):((0,u.default)(`/work/${s.vanity}/${t.vanity}`).and(d.default,{...t,time_last_update:o.view_time},s).style("history-work").appendTo(e),c=void 0))}})).appendTo(e.content),e}})})),define("ui/view/IgnoringView",["require","exports","ui/component/core/Tabinator","ui/view/following/FollowingAuthorsTab","ui/view/following/FollowingTagsTab","ui/view/following/FollowingWorksTab","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=(0,l.default)({create:()=>{const e=(0,r.default)("ignoring");return e.breadcrumbs.title.text.use("view/ignoring/main/title"),e.breadcrumbs.description.text.use("view/ignoring/main/description"),(0,o.default)().addTab((0,i.default)("ignoring")).addTab((0,a.default)("ignoring")).addTab((0,n.default)("ignoring")).appendTo(e.content),e}})})),define("ui/view/LegalView",["require","exports","ui/component/core/Block","ui/component/core/Tabinator","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importStar(a),n=__importDefault(n),i=__importDefault(i),t.default=(0,i.default)({create({tab:e}={}){const t=(0,n.default)("legal"),i=(0,a.default)().appendTo(t.content);return(0,a.Tab)("terms").text.use("view/legal/terms-of-service/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/legal/terms-of-service/title"))).tweak((e=>e.content.useMarkdownContent("document/legal/terms-of-service/v0")))))).addTo(i),(0,a.Tab)("privacy").text.use("view/legal/privacy-policy/tab").tweak((e=>e.content.append((0,o.default)().tweak((e=>e.title.text.use("document/legal/privacy-policy/title"))).tweak((e=>e.content.useMarkdownContent("document/legal/privacy-policy/v0")))))).addTo(i),i.bindURL(e,(e=>e?`/legal/${e}`:"/legal")),i.bindViewTitle(),t}})})),define("endpoint/auth/EndpointTOTPVerify",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/auth/totp/verify","post")})),define("ui/view/LoginView",["require","exports","endpoint/auth/EndpointTOTPVerify","model/Session","ui/Component","ui/component/auth/OAuthServices","ui/component/core/Button","ui/component/core/CodeInput","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/view/account/AccountViewForm","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTransition","utility/Errors","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h);const g=m.default.redirection("/account");t.default=(0,p.default)({async load(){if("logged-in"===a.default.Auth.state.value)return g();const e=(0,h.default)(a.default.Auth.state.value);return{state:e,services:await(0,i.default)(e)}},create(e,{state:t,services:i}){const p="login",m=(0,c.default)(p);(0,d.default)("create").subviewTransition(p).appendToWhen(t.equals("has-authorisations"),m.content),i.subviewTransition(p).appendTo(m.content);const h=a.default.state.map(m,(e=>!!e?.partial_login?.totp_required&&!e.partial_login.additional_auth_services_required)),g=(0,l.default)().event.subscribe("Enter",(()=>v.element.click()));(0,n.default)().style("view-type-account-totp-login-wrapper").append((0,u.default)().append((0,s.default)().text.use("view/account/totp/login/description"))).append(g).appendToWhen(h,i.content);const v=(0,r.default)().type("primary").text.use("view/account/totp/login/action/login").event.subscribe("click",(async()=>{const e=await o.default.query({body:{token:g.state.value}});toast.handleError(e)||a.default.refresh()})).appendToWhen(h,i.footer.right);return i.footer.appendToWhen(h,i),a.default.Auth.state.subscribe(m,(()=>f.default.perform("subview",p,y))),t.match(m,"logged-in",(()=>navigate.toURL("/account"))),m;function y(e=a.default.Auth.state.value){t.value=e}}})})),define("endpoint/tag/EndpointTagCustomGetAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tags/custom","get")})),define("endpoint/tag/EndpointTagCustomDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/delete/custom","post")})),define("endpoint/tag/EndpointTagCustomPromote",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/promote","post")})),define("endpoint/tag/EndpointTagCustomRename",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/update/custom/{name}","post")})),define("ui/view/tags/TagEditForm",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/Checkbutton","ui/component/core/Dropdown","ui/component/core/Form","ui/component/core/LabelledTable","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/TagsEditor","ui/utility/StringApplicator","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),p=__importDefault(p),t.default=a.default.Builder(((e,t,a)=>{const f=t.map(e,(e=>e?.tags[a]));let m,h,g,v,y,b,_;const w=e.and(r.default,null);return w.content.and(l.default).label((e=>e.text.use("view/manage-tags/global-tag-form/category/label"))).content(((e,o)=>e.append(m=(0,i.RadioDropdown)().setLabel(o).setRequired().tweak((e=>{t.use(e,(t=>{const o=e.selection.value;if(e.clear(),t){for(const o of Object.values(t.categories))e.add(o.nameLowercase,{translation:e=>c.Quilt.fake(o.name)});o&&o in e.options?e.selection.value=o:e.selection.value=f.value?.categoryLowercase}}))}))))).label((e=>e.text.use("view/manage-tags/global-tag-form/name/label"))).content(((e,t)=>e.append(h=(0,s.default)().setLabel(t).setRequired().setMaxLength(o.default.map(e,(e=>e?.global_tag?.name))).default.bind(f.mapManual((e=>e?.name)))))).label((e=>e.text.use("view/manage-tags/global-tag-form/description/label"))).content(((e,t)=>e.append(g=(0,u.default)().setLabel(t).setRequired().disablePersistence().setMaxLength(o.default.map(e,(e=>e?.global_tag?.description))).default.bind(f.mapManual((e=>e?.description.body)))))).label((e=>e.text.use("view/manage-tags/global-tag-form/aliases/label"))).content(((e,t)=>e.append(v=(0,d.default)().setLabel(t).setCustomTagsOnly().default.bind(f.mapManual((e=>({custom_tags:e?.aliases||[]}))))))).label((e=>e.text.use("view/manage-tags/global-tag-form/relationships-to/label"))).content(((e,o)=>e.append(y=(0,d.default)().setLabel(o).setGlobalTagsOnly().default.bind(p.default.Use(o,{tag:f,manifest:t}).map(o,(({tag:e,manifest:t})=>{if(!e||!t)return;const o=`${e.category}: ${e.name}`;return{global_tags:t.relationships[o]||[]}})))))).label((e=>e.text.use("view/manage-tags/global-tag-form/relationships-from/label"))).content(((e,o)=>e.append(b=(0,d.default)().setLabel(o).setGlobalTagsOnly().default.bind(p.default.Use(o,{tag:f,manifest:t}).map(o,(({tag:e,manifest:t})=>{if(!e||!t)return;const o=`${e.category}: ${e.name}`;return{global_tags:Object.entries(t.relationships).filter((([e,t])=>t.includes(o))).map((([e])=>e))}})))))).label((e=>e.text.use("view/manage-tags/global-tag-form/mature/label"))).content(((e,t)=>e.append(_=(0,n.default)().setLabel(t).setChecked(f.value?.is_mature??!1).text.use("view/manage-tags/global-tag-form/mature/hint")))),w.footer.style("tag-edit-form-footer"),w.extend((e=>({categoryDropdown:m,nameInput:h,descriptionEditor:g,aliasesEditor:v,relationshipsToEditor:y,relationshipsFromEditor:b,isMature:_,getFormData(){const e=m.selection.value;if(e)return{name:h.state.value,description:g.useMarkdown(),category:e,aliases:v.state.value.custom_tags,relationships_to:y.state.value.global_tags,relationships_from:b.state.value.global_tags,is_mature:_.checked.value}}})))}))})),define("ui/view/tags/ManageCustomTags",["require","exports","endpoint/tag/EndpointTagCustomDelete","endpoint/tag/EndpointTagCustomPromote","endpoint/tag/EndpointTagCustomRename","model/Tags","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/Tag","ui/component/TagBlock","ui/component/TagsEditor","ui/view/tags/TagEditForm","utility/AbortPromise","utility/Arrays","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importStar(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importStar(b),_=__importDefault(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),t.default=r.default.Builder(((e,t,x)=>{const D=e.and(u.default);D.content.style("view-type-manage-tags-tag-block");const O=(0,g.default)().placeholder.use("view/manage-tags/shared/hint/filter").appendTo(D.content),S=e=>!O.state.value.length||e.name.includes(O.state.value),E=(0,r.default)().style("view-type-manage-tags-tag-list").appendTo(D.content),M=(0,T.default)([]);let I,C;x.use(E,(e=>{E.removeContents();for(const t of e.sort(((e,t)=>e.name.localeCompare(t.name)))){const o=M.mapManual((e=>e.includes(t.name))),a=T.default.MapManual([O.state,o],((e,o)=>!o&&!S(t)));(0,v.default)(t.name).style("view-type-manage-tags-tag").style.bind(a,"view-type-manage-tags-tag--filtered-out").style.bind(o,"tag--selected","view-type-manage-tags-tag--selected").event.subscribe("click",(o=>{const a=M.value.slice();if(M.value.includes(t.name)){if(o.shiftKey&&o.altKey&&C&&C!==t.name){const o=e.findIndex((e=>e.name===C)),n=e.indexOf(t),i=Math.min(o,n),r=Math.max(o,n);return k.default.remove(M.value,...e.slice(i,r+1).filterInPlace(S).mapInPlace((e=>e.name))),void M.emit(a)}return C=t.name,k.default.remove(M.value,t.name),void M.emit(a)}if(o.shiftKey&&I&&I!==t.name){const o=e.findIndex((e=>e.name===I)),n=e.indexOf(t),i=Math.min(o,n),r=Math.max(o,n);return k.default.add(M.value,...e.slice(i,r+1).filterInPlace(S).mapInPlace((e=>e.name))),void M.emit(a)}I=t.name,k.default.add(M.value,t.name),M.emit(a)})).appendTo(E)}})),(0,r.default)().style("view-type-manage-tags-tag-list").append((0,c.default)().setAestheticStyle(!1).style("view-type-manage-tags-section-heading").text.use("view/manage-tags/shared/label/selected-tags")).append((0,m.default)().use(M,((e,t)=>{for(const o of t)(0,v.default)(o).style("view-type-manage-tags-tag","tag--selected","view-type-manage-tags-tag--selected").event.subscribe("click",(()=>{const e=M.value.slice();k.default.remove(M.value,o),M.emit(e)})).appendTo(e)}))).appendToWhen(M.mapManual((e=>!!e.length)),D.content),(0,f.default)().text.use("view/manage-tags/shared/hint/select-tags").appendToWhen(M.mapManual((e=>!e.length)),D.footer.left);const R=(0,h.Tab)().text.use("view/manage-tags/custom-tags/action/rename"),P=(0,l.default)().style("view-type-manage-tags-custom-tag-action-rename-row").appendTo(R.content),A=(0,g.default)().placeholder.use("view/manage-tags/custom-tags/hint/rename").appendTo(P.left),j=(0,s.default)().type("primary").text.use("view/manage-tags/custom-tags/action/rename").event.subscribe("click",(async()=>{const e=M.value[0],t=(0,b.filterTagSegment)(A.state.value);if(!t||t===e)return;if(!await d.default.ensureDangerToken(j,{dangerToken:"tag-modify"}))return;const o=await n.default.query({params:{name:e},body:{name:t}});if(toast.handleError(o))return;const a=x.value.find((t=>t.name===e));a&&(a.name=t);const i=M.value.slice();k.default.remove(M.value,e),M.emit(i),x.emit(),A.value=""})).appendTo(P.right),N=(0,h.Tab)().text.use("view/manage-tags/custom-tags/action/promote"),$=(0,h.Tab)().text.use("view/manage-tags/custom-tags/action/promote/new-tag"),B=(0,_.default)(t).appendTo($.content);M.subscribeManual(((e,t)=>{const o=e.filter((e=>!t?.includes(e))),a=t?.filter((t=>!e.includes(t)));k.default.add(B.aliasesEditor.state.value.custom_tags,...o),k.default.remove(B.aliasesEditor.state.value.custom_tags,...a??[]),B.aliasesEditor.state.emit()})),B.submit.text.use("view/manage-tags/custom-tags/action/promote").event.subscribe("click",(async()=>{const e=M.value.slice();if(!e.length)return;const o=B.getFormData();if(!o)return;if(!await d.default.prompt(B,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/custom-tags/action/delete/confirm",tweak:t=>t.content.insert("after",t.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>(0,v.default)(e).style("tag--selected")))))}))return;const n=await a.default.query({body:{into_new_tag:o,promoted_from_tags:e}});if(toast.handleError(n))return;const l=M.value.slice();x.value.filterInPlace((t=>!e.includes(t.name))),k.default.remove(M.value,...e),x.emit(),M.emit(l);const u=i.default.toId(o);t.addTag(n.data),t.addRelationships(u,o.relationships_to),t.addRelationships(o.relationships_from,u)}));const L=(0,h.Tab)().text.use("view/manage-tags/custom-tags/action/promote/existing-tag"),q=(0,b.default)().setGlobalTagsOnly().setMaxLengthGlobal(1),G=q.state.mapManual((e=>e.global_tags.at(0)));q.appendToWhen(G.falsy,L.content),(0,m.default)().appendTo(L.content).use(G,w.default.asyncFunction((async(e,t,o)=>{if(!o)return;const a=await i.default.resolve(o);if(!a)return q.state.value.global_tags=[],void q.state.emit();(0,y.default)(a).style("view-type-manage-tags-custom-tag-action-promote-existing-tag").appendTo(t)})));const W=(0,p.default)().style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases").tweak((e=>e.label.style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-label").text.use("view/manage-tags/custom-tags/label/promote/existing-tag/new-aliases"))).appendToWhen(G.truthy,L.content),U=(0,b.default)().style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-editor").setCustomTagsOnly().tweak((e=>e.inputWrapper.style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-editor-input-wrapper"))).appendTo(W.content.style("view-type-manage-tags-custom-tag-action-promote-existing-tag-new-aliases-content"));M.subscribeManual(((e,t)=>{const o=e.filter((e=>!t?.includes(e))),a=t?.filter((t=>!e.includes(t)));k.default.add(U.state.value.custom_tags,...o),k.default.remove(U.state.value.custom_tags,...a??[]),U.state.emit()}));const F=(0,l.default)().style("view-type-manage-tags-custom-tag-action-promote-row").appendToWhen(G.truthy,L.content);(0,s.default)().text.use("view/manage-tags/custom-tags/action/promote/existing-tag-change").event.subscribe("click",(()=>{q.state.value.global_tags=[],q.state.emit()})).appendTo(F.right),(0,s.default)().type("primary").text.use("view/manage-tags/custom-tags/action/promote").event.subscribe("click",(async()=>{const e=M.value.slice();if(!e.length)return;const[o]=q.state.value.global_tags;if(!o)return;if(!await d.default.prompt(q,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/custom-tags/action/delete/confirm",tweak:t=>t.content.insert("after",t.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>(0,v.default)(e).style("tag--selected")))))}))return;const n=await a.default.query({body:{into_existing_tag:{id:o,aliases:U.state.value.custom_tags},promoted_from_tags:e}});if(toast.handleError(n))return;const i=M.value.slice();x.value.filterInPlace((t=>!e.includes(t.name))),k.default.remove(M.value,...e),x.emit(),M.emit(i),t.addAliases(o,...U.state.value.custom_tags)})).appendTo(F.right);const V=(0,h.default)().allowNoneVisible().addTab($).addTab(L).appendTo(N.content);(0,f.default)().text.use("view/manage-tags/custom-tags/hint/promote/into").prependTo(V.header);const H=(0,h.Tab)().text.use("view/manage-tags/custom-tags/action/delete"),Y=(0,l.default)().appendTo(H.content);return(0,f.default)().text.use("view/manage-tags/shared/hint/delete-tags").appendTo(Y.left),(0,s.default)().type("primary").text.use("view/manage-tags/custom-tags/action/delete").event.subscribe("click",(async()=>{const e=M.value.slice();if(!e.length)return;if(!await d.default.prompt(Y,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/custom-tags/action/delete/confirm",tweak:t=>t.content.insert("after",t.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>(0,v.default)(e).style("tag--selected")))))}))return;const t=await o.default.query({body:{tags:e}});if(toast.handleError(t))return;const a=M.value.slice();x.value.filterInPlace((t=>!e.includes(t.name))),k.default.remove(M.value,...e),x.emit(),M.emit(a)})).appendTo(Y.right),(0,h.default)().allowNoneVisible().addTabWhen(M.mapManual((e=>1===e.length)),R).addTab(N).addTab(H).appendToWhen(M.mapManual((e=>!!e.length)),D.footer.left),D}))})),define("endpoint/tag/EndpointTagCreateGlobal",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/create/global","post")})),define("endpoint/tag/EndpointTagDeleteGlobal",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/delete/global","post")})),define("endpoint/tag/EndpointTagGlobalRecategorise",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tags/global/recategorise","post")})),define("endpoint/tag/EndpointTagUpdateGlobal",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/update/global/{id}","post")})),define("ui/view/tags/ManageGlobalTags",["require","exports","endpoint/tag/EndpointTagCreateGlobal","endpoint/tag/EndpointTagDeleteGlobal","endpoint/tag/EndpointTagGlobalRecategorise","endpoint/tag/EndpointTagUpdateGlobal","model/Tags","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Dropdown","ui/component/core/Form","ui/component/core/Heading","ui/component/core/LabelledRow","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/Tag","ui/utility/StringApplicator","ui/view/tags/TagEditForm","utility/Arrays","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T,x){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importStar(y),b=__importDefault(b),_=__importDefault(_),k=__importDefault(k),T=__importStar(T),x=__importDefault(x),t.default=l.default.Builder(((e,t)=>{const D=e.and(s.default);D.content.style("view-type-manage-tags-tag-block");const O=(0,b.default)().placeholder.use("view/manage-tags/shared/hint/filter").appendTo(D.content),S=(0,l.default)().style("view-type-manage-tags-tag-list").appendTo(D.content),E=(0,x.default)([]);let M,I;x.default.Use(e,{manifest:t,filter:O.state}).use(e,(({manifest:e,filter:t})=>{if(S.removeContents(),!e)return;let[o,a]=t.toLowerCase().split(":");void 0===a&&(a=o,o="");const n=Object.entries(e.tags).filter((([e,n])=>!t||n.name.toLowerCase().includes(a)&&n.category.toLowerCase().includes(o))),i=n.map((([e])=>e));for(const[e,t]of n)(0,_.default)(t).tweak((t=>t.style.bind(E.map(t,(t=>t.includes(e))),"tag--selected","view-type-manage-tags-tag--selected"))).event.subscribeCapture("click",(t=>{t.preventDefault(),t.stopImmediatePropagation();const o=E.value.slice();if(E.value.includes(e)){if(t.shiftKey&&t.altKey&&I&&I!==e){const t=i.indexOf(I),a=i.indexOf(e),n=Math.min(t,a),r=Math.max(t,a);return T.default.remove(E.value,...i.slice(n,r+1)),void E.emit(o)}return I=e,T.default.remove(E.value,e),void E.emit(o)}if(t.shiftKey&&M&&M!==e){const t=i.indexOf(M),a=i.indexOf(e),n=Math.min(t,a),r=Math.max(t,a);return T.default.add(E.value,...i.slice(n,r+1)),void E.emit(o)}M=e,T.default.add(E.value,e),E.emit(o)})).appendTo(S)})),(0,l.default)().style("view-type-manage-tags-tag-list").append((0,m.default)().setAestheticStyle(!1).style("view-type-manage-tags-section-heading").text.use("view/manage-tags/shared/label/selected-tags")).append((0,v.default)().use(E,((e,o)=>{const a=o.map((e=>[e,t.value?.tags[e]])).filterInPlace((e=>!!e[1]));if(a.length)for(const[t,o]of a)(0,_.default)(o).style("tag--selected","view-type-manage-tags-tag--selected").event.subscribeCapture("click",(e=>{e.preventDefault(),e.stopImmediatePropagation(),T.default.remove(E.value,t),E.emit()})).appendTo(e)}))).appendToWhen(E.mapManual((e=>!!e.length)),D.content);const C=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/create"),R=(0,k.default)(t).appendTo(C.content);R.submit.text.use("view/manage-tags/global-tags/action/create").event.subscribe("click",(async()=>{const e=R.getFormData();if(!e)return;const a=await o.default.query({body:e});if(toast.handleError(a))return;if(!t.value)return;const n=r.default.toId(a.data);r.default.addTag(a.data),r.default.addRelationships(n,e.relationships_to),r.default.addRelationships(e.relationships_from,n)}));const P=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/recategorise"),A=(0,f.default)(null).appendTo(P.content);let j;(0,h.default)().tweak((e=>e.label.text.use("view/manage-tags/global-tag-form/category/label"))).tweak((e=>e.content.append(j=(0,p.RadioDropdown)().setLabel(e.label).setRequired().tweak((e=>{t.use(e,(t=>{if(e.clear(),t)for(const o of Object.values(t.categories))e.add(o.nameLowercase,{translation:e=>w.Quilt.fake(o.name)})}))}))))).appendTo(A.content),A.submit.text.use("view/manage-tags/global-tags/action/recategorise").event.subscribe("click",(async()=>{const e=E.value.slice();if(!e.length)return;const t=j.selection.value;if(!t)return;if(!await c.default.ensureDangerToken(j,{dangerToken:"tag-modify"}))return;const o=await n.default.query({body:{tags:e,category:t}});toast.handleError(o)||r.default.recategoriseTags(t,...e)}));const N=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/modify");(0,v.default)().appendTo(N.content).use(E,((e,o)=>{if(!o.length||o.length>1)return;const a=o[0],n=(0,k.default)(t,a).appendTo(e);n.submit.text.use("view/manage-tags/global-tags/action/save").event.subscribe("click",(async()=>{const e=n.getFormData();if(!e)return;if(!await c.default.ensureDangerToken(n,{dangerToken:"tag-modify"}))return;const o=await i.default.query({params:{id:a},body:e});if(toast.handleError(o))return;if(!t.value)return;const l=r.default.toId(o.data);r.default.removeTags(a),r.default.addTag(o.data),r.default.addRelationships(l,e.relationships_to),r.default.addRelationships(e.relationships_from,l)}))}));const $=(0,y.Tab)().text.use("view/manage-tags/global-tags/action/delete"),B=(0,u.default)().appendTo($.content);(0,g.default)().text.use("view/manage-tags/shared/hint/delete-tags").appendTo(B.left),(0,d.default)().type("primary").text.use("view/manage-tags/global-tags/action/delete").event.subscribe("click",(async()=>{const e=E.value.slice();if(!e.length)return;if(!await c.default.prompt(B,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/global-tags/action/delete/confirm",tweak:o=>o.content.insert("after",o.body,(0,l.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(...e.map((e=>t.value?.tags[e])).filterInPlace(T.NonNullish).map((e=>(0,_.default)(e).style("tag--selected")))))}))return;const o=await a.default.query({body:{tags:e}});if(toast.handleError(o))return;r.default.removeTags(...e);const n=E.value.slice();T.default.remove(E.value,...e),E.emit(n)})).appendTo(B.right);const L=E.mapManual((e=>!e.length)),q=E.mapManual((e=>!!e.length)),G=E.mapManual((e=>1===e.length)),W=(0,y.default)().allowNoneVisible().addTabWhen(L,C).addTabWhen(G,N).addTabWhen(q,P).addTabWhen(q,$).appendTo(D.footer.left);return(0,g.default)().text.use("view/manage-tags/shared/hint/select-tags").appendToWhen(E.mapManual((e=>!e.length)),W.header),D}))})),define("endpoint/tag/EndpointTagCreateCategory",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/create/category","post")})),define("endpoint/tag/EndpointTagDeleteCategory",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/delete/category/{name}","post")})),define("endpoint/tag/EndpointTagUpdateCategory",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/update/category/{name}","post")})),define("ui/view/tags/CategoryEditForm",["require","exports","model/FormInputLengths","ui/Component","ui/component/core/Form","ui/component/core/LabelledTable","ui/component/core/Textarea","ui/component/core/TextInput"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=a.default.Builder(((e,t,a)=>{const u=t.map(e,(e=>e?.categories[a]));let s,d;const c=e.and(n.default,null);return c.content.and(i.default).label((e=>e.text.use("view/manage-tags/global-tag-form/name/label"))).content(((e,t)=>e.append(s=(0,l.default)().setLabel(t).setRequired().setMaxLength(o.default.map(e,(e=>e?.global_tag?.name))).default.bind(u.mapManual((e=>e?.name)))))).label((e=>e.text.use("view/manage-tags/global-tag-form/description/label"))).content(((e,t)=>e.append(d=(0,r.default)().setLabel(t).setRequired().setMaxLength(o.default.map(e,(e=>e?.global_tag?.description))).default.bind(u.mapManual((e=>e?.description)))))),c.footer.style("tag-edit-form-footer"),c.extend((e=>({nameInput:s,descriptionEditor:d,getFormData:()=>({name:s.state.value,description:d.state.value})})))}))})),define("ui/view/tags/ManageTagCategories",["require","exports","endpoint/tag/EndpointTagCreateCategory","endpoint/tag/EndpointTagDeleteCategory","endpoint/tag/EndpointTagUpdateCategory","model/Tags","ui/Component","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/component/core/ConfirmDialog","ui/component/core/Heading","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Tabinator","ui/component/core/TextInput","ui/component/Tag","ui/view/tags/CategoryEditForm","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importStar(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y);const b=r.default.Builder(((e,t)=>e.and(g.default,t.name).style("view-type-manage-tags-tag","view-type-manage-tags-category","view-type-manage-tags-category--has-description").tweak((e=>e.removeContents())).append((0,r.default)().style("tag-category","tag-category--standalone").text.set(t.name)).append((0,p.default)().style("tag-category-description").text.set(t.description))));t.default=r.default.Builder(((e,t)=>{const g=e.and(u.default);g.content.style("view-type-manage-tags-tag-block");const _=(0,h.default)().placeholder.use("view/manage-tags/shared/hint/filter").appendTo(g.content),w=(0,r.default)().style("view-type-manage-tags-tag-list").appendTo(g.content),k=(0,y.default)(void 0);y.default.Use(e,{manifest:t,filter:_.state}).use(e,(({manifest:e,filter:t})=>{if(w.removeContents(),e){t=t.toLowerCase();for(const[,o]of Object.entries(e.categories))t&&!o.name.toLowerCase().includes(t.toLowerCase())||b(o).tweak((e=>e.style.bind(k.map(e,(e=>e===o.name)),"tag--selected","view-type-manage-tags-tag--selected"))).event.subscribe("click",(()=>{k.value===o.name?k.value=void 0:k.value=o.name})).appendTo(w)}}));const T=k.mapManual((e=>!!e));(0,r.default)().style("view-type-manage-tags-tag-list").append((0,c.default)().setAestheticStyle(!1).style("view-type-manage-tags-section-heading").text.use("view/manage-tags/categories/label/selected")).append((0,f.default)().use(k,((e,o)=>{const a=t.value?.categories[o];a&&b(a).style("tag--selected","view-type-manage-tags-tag--selected").event.subscribe("click",(()=>{k.value=void 0})).appendTo(e)}))).appendToWhen(T,g.content);const x=(0,m.Tab)().text.use("view/manage-tags/categories/action/create"),D=(0,v.default)(t).appendTo(x.content);D.submit.text.use("view/manage-tags/categories/action/create").event.subscribe("click",(async e=>{const a=D.getFormData();if(!a)return;const n=await o.default.query({body:a});toast.handleError(n)||t.value&&i.default.addCategory(n.data)}));const O=(0,m.Tab)().text.use("view/manage-tags/categories/action/modify");(0,f.default)().appendTo(O.content).use(k,((e,o)=>{if(!o)return;const a=(0,v.default)(t,o).appendTo(e);a.submit.text.use("view/manage-tags/categories/action/save").event.subscribe("click",(async e=>{const r=a.getFormData();if(!r)return;if(!await d.default.ensureDangerToken(a,{dangerToken:"tag-modify"}))return;const l=await n.default.query({params:{name:o},body:r});toast.handleError(l)||t.value&&(i.default.removeCategory(o),i.default.addCategory(l.data))}))}));const S=(0,m.Tab)().text.use("view/manage-tags/categories/action/delete"),E=(0,l.default)().appendTo(S.content),M=y.default.Map(E,[t,k],((e,t)=>!!e&&!Object.values(e.tags).some((e=>e.category===t))));(0,p.default)().text.use("view/manage-tags/categories/hint/no-delete").appendToWhen(M.falsy,E.left),(0,p.default)().text.use("view/manage-tags/categories/hint/delete").appendToWhen(M,E.left),(0,s.default)().type("primary").text.use("view/manage-tags/categories/action/delete").event.subscribe("click",(async()=>{const e=k.value;if(!e)return;const o=t.value?.categories[e];if(!o)return;if(!await d.default.prompt(E,{dangerToken:"tag-modify",bodyTranslation:"view/manage-tags/categories/action/delete/confirm",tweak:e=>e.content.insert("after",e.body,(0,r.default)().style("view-type-manage-tags-tag-list","view-type-manage-tags-tag-list--confirm-dialog").append(b(o).style("tag--selected","view-type-manage-tags-tag--selected").insertTo(e.content,"after",e.body)))}))return;const n=await a.default.query({params:{name:e}});toast.handleError(n)||i.default.removeCategory(e)})).appendTo(E.right);const I=(0,m.default)().allowNoneVisible().addTabWhen(T.falsy,x).addTabWhen(T,O).addTabWhen(T,S).appendTo(g.footer.left);return(0,p.default)().text.use("view/manage-tags/categories/hint/select-category").appendToWhen(T.falsy,I.header),g}))})),define("ui/view/ManageTagsView",["require","exports","endpoint/tag/EndpointTagCustomGetAll","model/Session","model/Tags","ui/component/core/Tabinator","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","ui/view/tags/ManageCustomTags","ui/view/tags/ManageGlobalTags","ui/view/tags/ManageTagCategories","utility/Errors","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importStar(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),t.default=(0,l.default)({async load(e){if(!a.default.Auth.privileged.TagGlobalDelete.value)throw c.default.Forbidden();const t=await o.default.query();if(toast.handleError(t))throw c.default.NotFound();return n.default.getManifest(),{customTags:t.data,manifest:n.default}},create:(e,{customTags:t,manifest:o})=>{const a=(0,r.default)("manage-tags");a.breadcrumbs.title.text.use("view/manage-tags/title"),a.breadcrumbs.description.text.use("view/manage-tags/description");const n=(0,p.default)(t);return(0,i.default)().addTab((0,i.Tab)().text.use("view/manage-tags/custom-tags/title").tweak((e=>(0,u.default)(o,n).appendTo(e.content)))).addTab((0,i.Tab)().text.use("view/manage-tags/categories/title").tweak((e=>(0,d.default)(o).appendTo(e.content)))).addTab((0,i.Tab)().text.use("view/manage-tags/global-tags/title").tweak((e=>(0,s.default)(o).appendTo(e.content)))).appendTo(a.content),a}})})),define("endpoint/feed/EndpointFeedGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/feed/get","get")})),define("ui/view/NewView",["require","exports","endpoint/feed/EndpointFeedGet","endpoint/feed/EndpointFeedGetAuthed","model/Session","ui/component/core/Slot","ui/component/WorkFeed","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Env","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),t.default=(0,u.default)({create:()=>{const e=(0,l.default)("new");e.breadcrumbs.title.text.use("view/new/main/title"),e.breadcrumbs.description.text.use("view/new/main/description");const t=(0,d.default)(void 0),u=d.default.Map(e,[t,n.default.Auth.loggedIn],((e,t)=>_??e??(t?void 0:`${s.default.API_ORIGIN}feed/get/rss.xml`)));return e.breadcrumbs.setRSSButton(u),(0,i.default)().use(n.default.Auth.loggedIn,((e,n)=>(0,r.default)().viewTransition("new-view-feed").setFromEndpoint(n?a.default:o.default).tweak((e=>e.state.use(e,(e=>t.value=e?.rss_url)))))).appendTo(e.content),e}})})),define("endpoint/notification/EndpointNotificationGetAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/notifications/get/all","get")})),define("endpoint/notification/EndpointNotificationGetCount",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/notifications/get/count","get")})),define("endpoint/notification/EndpointNotificationMarkRead",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/notifications/mark/read","post")})),define("endpoint/notification/EndpointNotificationMarkUnread",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/notifications/mark/unread","post")})),define("model/Notifications",["require","exports","endpoint/notification/EndpointNotificationGetAll","endpoint/notification/EndpointNotificationGetCount","endpoint/notification/EndpointNotificationMarkRead","endpoint/notification/EndpointNotificationMarkUnread","model/PagedListData","model/Session","ui/utility/PageListener","utility/State","utility/Store","utility/Time"],(function(e,t,o,a,n,i,r,l,u,s,d,c){var p;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),function(e){l.default.setClearedWithSessionChange("notifications",(()=>{e.cache.clear(),t=[],e.authors.value=[],e.works.value=[],e.chapters.value=[],e.comments.value=[],e.hasMore.value=!1,e.unreadCount.value=0,e.lastUpdate.value=0}));let t=d.default.items.notifications?.cache??[];function p(){d.default.items.notifications&&(d.default.items.notifications={...d.default.items.notifications,lastCheck:0,lastUpdate:0})}e.cache=(0,r.default)(25,{async get(a){const n=25*a,i=25*(a+1);if(t.length<n){const n=await o.default.query(void 0,{page:a,page_size:25});if(toast.handleError(n))return!1;const i=n.data;if(!i.notifications.length)return null;t.push(...i.notifications),t.sort(...f),e.authors.value=[...d.default.items.notifications?.authors??[],...i.authors],e.works.value=[...d.default.items.notifications?.works??[],...i.works],e.chapters.value=[...d.default.items.notifications?.chapters??[],...i.chapters],e.comments.value=[...d.default.items.notifications?.comments??[],...i.comments],d.default.items.notifications={...d.default.items.notifications,cache:t,authors:e.authors.value,works:e.works.value,chapters:e.chapters.value,comments:e.comments.value}}return t.slice(n,i)}}),e.authors=(0,s.default)(d.default.items.notifications?.authors??[]),e.works=(0,s.default)(d.default.items.notifications?.works??[]),e.chapters=(0,s.default)(d.default.items.notifications?.chapters??[]),e.comments=(0,s.default)(d.default.items.notifications?.comments??[]),e.hasMore=(0,s.default)(d.default.items.notifications?.hasMore??!1),e.unreadCount=(0,s.default)(d.default.items.notifications?.unreadCount??0),e.lastUpdate=(0,s.default)(d.default.items.notifications?.lastUpdate??0),e.clear=p,e.check=function(e=!1){return e&&p(),d.default.items.notifications&&(d.default.items.notifications={...d.default.items.notifications,lastCheck:0}),h()},e.await=async function(){await h()},e.markRead=async function(o,...a){const r=o?n.default:i.default,l=await r.query({body:{notification_ids:a}});if(toast.handleError(l))return!1;let u=0;for(const e of t)a.includes(e.id)&&e.read!==o&&(e.read=o,u++);if(!u)return!0;e.unreadCount.value+=o?-u:u,d.default.items.notifications={...d.default.items.notifications,cache:t,unreadCount:e.unreadCount.value};for(const t of e.cache.pages)Array.isArray(t.value)&&t.value.some((e=>a.includes(e.id)))&&t.emit();return!0};const f=[e=>-+e.read,e=>new Date(e.created_time).getTime()];let m;async function h(){if(m)return await m;if(!l.default.Auth.author.value)return;if(!u.default.visible.value)return;let n=d.default.items.notifications;if(Date.now()-(n?.lastCheck??0)<c.default.minutes(1))return;let i;n??={},n.lastCheck=Date.now(),d.default.items.notifications=n,m=new Promise((e=>i=e));try{const i=await a.default.query();if(toast.handleError(i))return;const r=new Date(i.data.notification_time_last_modified).getTime();if(r<=(n.lastUpdate??0))return;const l=await o.default.query();if(toast.handleError(l))return;const u=i.data.unread_notification_count;n.unreadCount=e.unreadCount.value=u,n.cache=t=l.data.notifications.sort(...f),n.authors=e.authors.value=l.data.authors,n.works=e.works.value=l.data.works,n.chapters=e.chapters.value=l.data.chapters,n.comments=e.comments.value=l.data.comments,n.hasMore=e.hasMore.value=l.has_more,n.lastUpdate=e.lastUpdate.value=r,e.cache.clear()}finally{n.lastCheck=Date.now(),d.default.items.notifications=n,i(),m=void 0}}setInterval(h,c.default.seconds(1))}(p||(p={})),Object.assign(window,{Notifications:p}),t.default=p})),define("model/Comments",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.resolve=function(e,t){return e?t.find((t=>t.comment_id===e)):void 0}}(o||(o={})),t.default=o})),define("ui/component/Notification",["require","exports","model/Authors","model/Chapters","model/Comments","model/Notifications","model/TextBody","model/Works","ui/Component","ui/component/core/Button","ui/component/core/Icon","ui/component/core/Link","ui/component/core/Slot","ui/component/core/Timestamp","ui/component/popover/AuthorPopover","ui/utility/StringApplicator","utility/State","utility/Type"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),g=__importDefault(g),(v=__importDefault(v)).default.assert();const y=u.default.Builder("a",((e,t)=>{const v=(0,g.default)(t.read),y=(0,g.default)(void 0);return e.and(p.default).use(h.Quilt.State,((p,h)=>{const b=h[`notification/${t.type}`];if(!b)return void console.warn(`Untranslated notification type ${t.type}`,t);const _=o.default.resolve(t.triggered_by,i.default.authors.value),w=_?(0,c.default)(`/author/${_.vanity}`).style.toggle(t.type.startsWith("report-"),"notification-reporter").text.set(_.name).setPopover("hover/longpress",(e=>e.and(m.default,_))):void 0,k=o.default.resolve(t.author,i.default.authors.value),T=k?(0,c.default)(`/author/${k.vanity}`).text.set(k.name).setPopover("hover/longpress",(e=>e.and(m.default,k))):void 0,x=l.default.resolve(t.work,i.default.works.value),D=x?(0,c.default)(`/work/${x.author}/${x.vanity}`).text.set(x.name):void 0,O=a.default.resolve(t.chapter,i.default.chapters.value),S=O?(0,c.default)(`/work/${O.author}/${O.work}/chapter/${O.url}`).text.set(O.name):void 0,E=!!t.comment,M=(0,u.default)().style("notification").style.bind(v,"notification--read"),I=(0,g.default)(!1),C=y.value=(0,s.default)().setIcon("check").type("icon").style("notification-read-button").style.bind(v,"notification-read-button--read").style.bind(I,"notification-read-button--just-marked-unread").tweak((e=>e.icon.style("notification-read-button-icon"))).event.subscribe("click",(async e=>{e.preventDefault(),e.stopImmediatePropagation(),await P()})).appendTo(M);(0,u.default)().style("notification-label").append(t.type.startsWith("report-")&&(0,d.default)("shield-halved").style("notification-type-icon"),(0,u.default)().style("notification-label-text").useMarkdownContent({body:e=>b({TRIGGERED_BY:w,AUTHOR:T,WORK:D,CHAPTER:S,COMMENT:E})}),document.createTextNode("   "),(0,f.default)(t.created_time).style("notification-label-timestamp")).appendTo(M);const R=n.default.resolve(t.comment,i.default.comments.value);return R&&((0,u.default)().style("markdown","notification-comment-wrapper").append(R.body&&(0,u.default)("blockquote").style("notification-comment").setMarkdownContent(r.default.resolve(R.body,i.default.authors.value),64)).appendTo(M),O&&M.and(c.default,`/work/${O.author}/${O.work}/chapter/${O.url}`).event.subscribe("Navigate",P)),t.type.startsWith("report-")&&t.string_128&&(0,u.default)().style("notification-report-reason").append((0,u.default)().style("notification-report-reason-label").text.use("notification/report/label/reason")).append((0,u.default)().style("notification-report-reason-text").text.set(t.string_128)).appendTo(M),M;async function P(){await i.default.markRead(!v.value,t.id)&&(v.value=!v.value,v.value||(I.value=!0,C.hoveredOrFocused.match(e,!1,(()=>I.value=!1))))}})).extend((e=>({readButton:y})))}));t.default=y})),define("ui/component/NotificationList",["require","exports","model/Notifications","ui/Component","ui/component/core/Button","ui/component/core/Paginator","ui/component/Notification"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=a.default.Builder((async(e,t,a)=>{const l=e.and(i.default).style("notification-list"),u=e.extend((e=>({paginator:l})));(0,n.default)().setIcon("check-double").type("icon").event.subscribe("click",(async()=>{const e=l.data.value;await o.default.markRead(!0,...e.map((e=>e.id)))})).appendTo(l.primaryActions),l.header.style("notification-list-header"),l.title.style("notification-list-title").text.use("masthead/user/notifications/title"),l.content.style("notification-list-content"),l.footer.style("notification-list-footer"),await o.default.await();const s=void 0===a?o.default.cache:o.default.cache.resized(a);return l.set(s,0,((e,t)=>{e.style("notification-list-page");for(const o of t)(0,r.default)(o)?.appendTo(e)})),u}));t.default=l})),define("ui/view/NotificationsView",["require","exports","ui/component/NotificationList","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.default=(0,n.default)({load:async()=>({list:await(0,o.default)()}),create(e,{list:t}){const o=(0,a.default)("notifications");return t.appendTo(o.content),o}})})),define("ui/view/TagView",["require","exports","endpoint/feed/EndpointFeedGet","endpoint/feed/EndpointFeedGetAuthed","model/Session","model/Tags","ui/component/TagBlock","ui/component/WorkFeed","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Errors"],(function(e,t,o,a,n,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d);const c=/(-|^)(.)/g,p=e=>e.replaceAll(c,((e,t,o)=>`${t?" ":""}${o}`));t.default=(0,s.default)({async load(e){const t=e.custom_name??await i.default.resolve(p(e.category),p(e.name));if(!t)throw d.default.NotFound();return{tag:t}},create(e,{tag:t}){const i=(0,u.default)("tag");return(0,r.default)(t).appendTo(i.content),(0,l.default)().setFromEndpoint((n.default.Auth.author.value?a.default:o.default).prep(void 0,{whitelist_tags:[`${t.category}: ${t.name}`]})).appendTo(i.content),i}})})),define("endpoint/work/EndpointWorkCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/create","post")})),define("endpoint/work/EndpointWorkUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{vanity}/update","post")})),define("ui/view/work/WorkEditForm",["require","exports","endpoint/work/EndpointWorkCreate","endpoint/work/EndpointWorkUpdate","lang/en-nz","model/FormInputLengths","model/Session","ui/Component","ui/component/core/Block","ui/component/core/Form","ui/component/core/GradientInput","ui/component/core/LabelledTable","ui/component/core/Textarea","ui/component/core/TextEditor","ui/component/core/TextInput","ui/component/core/toast/Toast","ui/component/LicenseFormFragment","ui/component/SupportersOnlyLabel","ui/component/TagsEditor","ui/component/VanityInput","ui/component/VisibilityOptions","ui/component/WorkStatusDropdown","ui/utility/License"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),_=__importDefault(_),w=__importDefault(w),t.default=l.default.Builder(((e,t)=>{const l=e.and(u.default),T=l.and(s.default,l.title);T.viewTransition("work-edit-form");const x=t.value?"update":"create";T.title.text.use(`view/work-edit/${x}/title`),T.setName(n.default[`view/work-edit/${x}/title`]().toString()),T.submit.textWrapper.text.use(`view/work-edit/${x}/submit`);const D=(0,c.default)().appendTo(T.content),O=(0,m.default)().setRequired().default.bind(t.map(e,(e=>e?.name))).hint.use("view/work-edit/shared/form/name/hint").setMaxLength(i.default.map(D,(e=>e?.work?.name)));D.label((e=>e.text.use("view/work-edit/shared/form/name/label"))).content(((e,t)=>e.append(O.setLabel(t))));const S=(0,m.default)().placeholder.bind(O.state.map(e,(e=>(0,b.FilterVanity)(e)))).default.bind(t.map(e,(e=>e?.vanity))).filter(b.FilterVanity).hint.use("view/work-edit/shared/form/vanity/hint").setMaxLength(i.default.map(D,(e=>e?.work?.vanity)));D.label((e=>e.text.use("view/work-edit/shared/form/vanity/label"))).content(((e,t)=>e.append(S.setLabel(t))));const E=(0,p.default)().setRequired().default.bind(t.map(e,(e=>e?.description))).hint.use("view/work-edit/shared/form/description/hint").setMaxLength(i.default.map(D,(e=>e?.work?.description)));D.label((e=>e.text.use("view/work-edit/shared/form/description/label"))).content(((e,t)=>e.append(E.setLabel(t))));const M=(0,f.default)().default.bind(t.map(e,(e=>e?.synopsis.body))).hint.use("view/work-edit/shared/form/synopsis/hint").setMaxLength(i.default.map(D,(e=>e?.work?.synopsis)));D.label((e=>e.text.use("view/work-edit/shared/form/synopsis/label"))).content(((e,t)=>e.append(M.setLabel(t))));const I=(0,g.default)(D,!0);I.dropdown.default.bind(t.map(e,(e=>{const t=e?.license?.name;return t?k.LICENSES.includes(t)?t:"custom":"inherit"}))),I.customLinkInput.default.bind(t.map(e,(e=>e?.license?.link))),I.customNameInput.default.bind(t.map(e,(e=>e?.license?.name)));const C=(0,y.default)().default.bind(t).setMaxLengthGlobal(i.default.map(D,(e=>e?.work_tags?.global))).setMaxLengthCustom(i.default.map(D,(e=>e?.work_tags?.custom)));D.label((e=>e.text.use("view/work-edit/shared/form/tags/label"))).content(((e,t)=>e.append(C.setLabel(t))));const{visibility:R,patreonTiers:P}=(0,_.default)(D,t.map(e,(e=>({visibility:e?.visibility??"Private",patreonTiers:e?.patreon?.tiers.map((e=>e.tier_id))}))));R.hint.use("view/work-edit/shared/form/visibility/hint");const A=w.default.Radio(t.map(e,(e=>e?.status??"Ongoing")));D.label((e=>e.text.use("view/work-edit/shared/form/status/label"))).content(((e,t)=>e.append(A.setLabel(t))));const j=(0,d.default)().default.bind(t.map(e,(e=>e?.card_colours)));return D.label((e=>e.and(v.default).text.use("view/work-edit/shared/form/card-colours/label"))).content(((e,t)=>e.append(j.setLabel(t)))),l.useGradient(j.value),T.onSubmit((async e=>{const n=O.value,i=await(()=>{switch(x){case"create":return o.default.query({body:{name:n,vanity:S.value,description:E.value,synopsis:M.useMarkdown(),visibility:R.selection.value??"Private",tier_ids:P.selection.value,...C.state.value,card_colours:j.value.value.slice(),status:A.selection.value}});case"update":{if(!t.value)return;const e=r.default.Auth.author.value?.vanity;return e?a.default.query({params:{author:e,vanity:t.value.vanity},body:{name:n,vanity:S.value,description:E.value,synopsis:M.useMarkdown(),visibility:R.selection.value??"Private",tier_ids:P.selection.value,...C.state.value,card_colours:j.value.value.slice(),license:I.getFormData(),status:A.selection.value}}):new Error("Cannot update a work when not signed in")}}})();toast.handleError(i,(e=>e["view/work-edit/shared/toast/failed-to-save"](n)))||(toast.success(h.TOAST_SUCCESS,(e=>e["view/work-edit/shared/toast/saved"](n))),t.value=i?.data)})),T}))})),define("ui/view/WorkEditView",["require","exports","endpoint/work/EndpointWorkGet","model/Works","ui/component/core/ActionRow","ui/component/core/Button","ui/component/core/Slot","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","ui/view/shared/ext/ViewTransition","ui/view/work/WorkEditForm","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),t.default=(0,u.default)({requiresLogin:!0,async load(e){const t=e&&await o.default.query({params:e});if(t instanceof Error)throw t;const a=t?.data;return{work:a}},create(e,{work:t}){const o="work-edit",u=(0,l.default)(o),p=(0,c.default)(t),f=(0,c.default)(t);return p.use(u,(e=>u.breadcrumbs.setBackButton(e&&`/work/${e.author}/${e.vanity}`,(t=>e&&t.subText.set(e.name))))),(0,r.default)().use(p,(()=>(0,d.default)(f).subviewTransition(o))).appendTo(u.content),(0,r.default)().use(p,(()=>function(){const e=p.value;if(!e)return;return(0,n.default)().viewTransition("work-edit-action-row").tweak((t=>t.left.append((0,i.default)().setIcon("plus").text.use("view/work-edit/update/action/new-chapter").event.subscribe("click",(()=>navigate.toURL(`/work/${e.author}/${e.vanity}/chapter/new`)))).append((0,i.default)().setIcon("plus").text.use("view/work-edit/update/action/bulk-chapters").event.subscribe("click",(()=>navigate.toURL(`/work/${e.author}/${e.vanity}/chapter/new/bulk`)))))).tweak((t=>t.right.append((0,i.default)().setIcon("trash").text.use("view/work-edit/update/action/delete").event.subscribe("click",(async()=>a.default.delete(e,u))))))}()?.subviewTransition(o))).appendTo(u.content),f.subscribe(u,(e=>s.default.perform("subview",o,(()=>p.value=e)))),u}})})),define("endpoint/chapter/EndpointChapterReorder",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapter/{url}/reorder","post")})),define("endpoint/history/EndpointHistoryAddWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/history/add/{author}/{vanity}","post")})),define("endpoint/history/EndpointHistoryBookmarksDeleteFurthestRead",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/history/bookmarks/{author}/{vanity}/delete/furthest-read","post")})),define("endpoint/history/EndpointHistoryBookmarksDeleteLastRead",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/history/bookmarks/{author}/{vanity}/delete/last-read","post")})),define("ui/view/WorkView",["require","exports","endpoint/chapter/EndpointChapterGetAll","endpoint/chapter/EndpointChapterReorder","endpoint/history/EndpointHistoryAddWork","endpoint/history/EndpointHistoryBookmarksDeleteFurthestRead","endpoint/history/EndpointHistoryBookmarksDeleteLastRead","endpoint/work/EndpointWorkGet","model/PagedListData","model/Session","model/Works","ui/Component","ui/component/Chapter","ui/component/core/Block","ui/component/core/Button","ui/component/core/ext/CanHasActionsMenu","ui/component/core/Paginator","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/Work","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Errors","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T){function x(){return(0,c.default)().and(m.default).ariaHidden().tabIndex("programmatic").setIcon("arrow-up-arrow-down").type("icon").style("view-type-work-chapter-reordering-icon")}Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),t.default=(0,w.default)({async load(e){const t=await l.default.query({params:e});if(t instanceof Error)throw t;return{work:t.data}},create(e,{work:t}){const l=(0,_.default)("work"),w=(0,T.default)(t);s.default.Auth.loggedIn.value&&n.default.query({params:e});const D=w.value.synopsis.mentions.find((e=>e.vanity===w.value.author));if(!D)throw k.default.BadData("Work author not in synopsis authors");const O=(0,b.default)(w,D).viewTransition("work-view-work").setContainsHeading().appendTo(l.content);O.actions.viewTransition("work-view-work-actions").style("view-type-work-actions").appendTo(l.content),O.bookmarkStatus.use(l,(e=>e?.style("view-type-work-bookmark-status"))),O.bookmarkAction.use(l,(e=>e?.style("view-type-work-bookmark-action").style.bind(w.map(l,(e=>!!e.bookmarks?.url_read_last&&!e.bookmarks.url_next)),"view-type-work-bookmark-action--irrelevant")));const S=(0,T.default)(void 0),E=(0,T.default)(null);return(0,y.default)().use(E,(()=>(0,g.default)().viewTransition("work-view-chapters").style("view-type-work-chapter-list").tweak((e=>{e.title.text.use("view/work/chapters/title"),(0,y.default)().use(S,((e,t)=>{t&&(0,p.default)(t,w.value,D).style("view-type-work-chapter-list-chapter-moving").append(x()).tweakActions((e=>e.insertAction("reorder","before","delete",s.default.Auth.author,((e,t)=>D.vanity===t?.vanity&&(0,m.default)().type("flush").setIcon("arrow-up-arrow-down").text.use("chapter/action/label/reorder-cancel").event.subscribe("click",(()=>S.value=void 0)))))).appendTo(e)})).appendTo(e.header)})).set(u.default.fromEndpoint(25,o.default.prep({params:{author:w.value.author,vanity:w.value.vanity}})),Math.floor((w.value.bookmarks?.url_next_page??0)/25),((e,t)=>{e.style("chapter-list").style.bind(S.truthy,"view-type-work-chapter-list--moving-chapter");const o=t.at(0);o&&n("before",o).appendTo(e);for(const o of t){const t=S.map(e,(e=>e===o)),a=c.default.Builder(((e,t)=>e.style("view-type-work-chapter-marker").and(h.default).setActionsMenu((e=>e.appendAction("clear",(e=>(0,m.default)().type("flush").setIcon("trash").text.use("view/work/chapters/marker/action/remove").event.subscribe("click",(async()=>{const e=await t.query({params:d.default.reference(w.value)});toast.handleError(e)||(w.value.bookmarks=e.data,w.emit(),E.emit())})))))))),l=w.value.bookmarks?.url_next,u=w.value.bookmarks?.url_next_furthest,f=l===u;o.url===l&&a(r.default).style(f?"view-type-work-chapter-marker--next-furthest":"view-type-work-chapter-marker--next").text.use("view/work/chapters/marker/next-chapter/next").appendTo(e),o.url===u&&l!==u&&a(i.default).style("view-type-work-chapter-marker--next-furthest").text.use("view/work/chapters/marker/next-chapter/furthest").appendTo(e),(0,p.default)(o,w.value,D).style("view-type-work-chapter").style.bind(t,"view-type-work-chapter--moving").style.bind(S.truthy,"view-type-work-chapter--has-moving-sibling").attributes.bind(S.truthy,"inert").tweak((e=>{e.number.style.bind(t,"view-type-work-chapter--moving-number"),e.chapterName.style.bind(t,"view-type-work-chapter--moving-name"),e.timestamp?.style.bind(t,"view-type-work-chapter--moving-timestamp"),(0,y.default)().if(t,(()=>x().style("view-type-work-chapter-reordering-icon--slot"))).appendTo(e)})).tweakActions((e=>e.insertAction("reorder","before","delete",s.default.Auth.author,((e,t)=>D.vanity===t?.vanity&&(0,y.default)().use(S,((e,t)=>{(0,m.default)().type("flush").setIcon("arrow-up-arrow-down").text.use(t===o?"chapter/action/label/reorder-cancel":"chapter/action/label/reorder").event.subscribe("click",(()=>S.value=S.value===o?void 0:o)).appendTo(e)})))))).appendTo(e),n("after",o).appendTo(e)}function n(e,t){return(0,c.default)().style("view-type-work-chapter-slot-wrapper").style.bind(S.truthy,"view-type-work-chapter-slot-wrapper--has-moving-chapter").append((0,m.default)().style("chapter","view-type-work-chapter-slot").event.subscribe("click",(async()=>{const o=S.value;if(!o)return;if(o.url===t.url)return void(S.value=void 0);const n=await a.default.query({params:o,body:{relative_to:t.url,position:e}});S.value=void 0,toast.handleError(n)||E.emit()})))}})).orElse((e=>(0,f.default)().type("flush").tweak((e=>(0,v.default)().text.use("view/work/chapters/content/empty").appendTo(e.content))).appendTo(e))).setActionsMenu((e=>e.append((0,y.default)().if(s.default.Auth.author.map(e,(e=>e?.vanity===w.value.author)),(()=>(0,m.default)().setIcon("plus").type("flush").text.use("view/work/chapters/action/label/new").event.subscribe("click",(()=>navigate.toURL(`/work/${w.value.author}/${w.value.vanity}/chapter/new`)))))))))).appendTo(l.content),l}})})),define("navigation/Routes",["require","exports","navigation/Route","navigation/RoutePath","ui/view/AboutView","ui/view/AccountView","ui/view/AuthorView","ui/view/ChapterEditView","ui/view/ChapterNewBulkView","ui/view/ChapterView","ui/view/ContactView","ui/view/DebugView","ui/view/FeedView","ui/view/FollowingView","ui/view/FundraiserView","ui/view/HistoryView","ui/view/IgnoringView","ui/view/LegalView","ui/view/LoginView","ui/view/ManageTagsView","ui/view/NewView","ui/view/NotificationsView","ui/view/SearchView","ui/view/TagView","ui/view/WorkEditView","ui/view/WorkView"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T,x,D){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D);const O=[(0,o.default)("/debug",c.default.navigate),(0,o.default)("/",_.default.navigate),(0,o.default)("/about",n.default.navigate),(0,o.default)("/about/$tab",n.default.navigate),(0,o.default)("/contact",d.default.navigate),(0,o.default)("/legal",v.default.navigate),(0,o.default)("/legal/$tab",v.default.navigate),(0,o.default)("/feed",p.default.navigate),(0,o.default)("/history",h.default.navigate),(0,o.default)("/search",k.default.navigate),(0,o.default)("/following",f.default.navigate),(0,o.default)("/ignoring",g.default.navigate),(0,o.default)("/login",y.default.navigate),(0,o.default)("/account",i.default.navigate),(0,o.default)("/account/$tab",i.default.navigate),(0,o.default)("/author/$vanity",r.default.navigate),(0,o.default)("/notifications",w.default.navigate),(0,o.default)("/work/new",x.default.navigate),(0,o.default)("/work/$author/$vanity",D.default.navigate),(0,o.default)("/work/$author/$vanity/edit",x.default.navigate),(0,o.default)("/work/$author/$work/chapter/new",l.default.navigate),(0,o.default)("/work/$author/$work/chapter/new/bulk",u.default.navigate),(0,o.default)("/work/$author/$work/chapter/$url",s.default.navigate),(0,o.default)("/work/$author/$work/chapter/$url/edit",l.default.navigate),(0,o.default)("/tag/$category/$name",T.default.navigate),(0,o.default)("/manage/tags",b.default.navigate),(0,o.default)("/fundraiser",m.default.navigate)];a.RoutePath.setRoutes(O),t.default=O})),define("navigation/RoutePath",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.RoutePath=void 0,function(e){let t;e.setRoutes=function(e){t=e},e.is=function(e){return!!e&&t.some((t=>t.path===e||!!t.match(e)))}}(o||(t.RoutePath=o={}))})),define("ui/utility/StringApplicator",["require","exports","lang/en-nz","ui/utility/StyleManipulator","utility/DevServer","utility/Env","utility/Script","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),t.QuiltHelper=t.Quilt=t.quilt=void 0,o=__importStar(o),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const u=(0,(l=__importDefault(l)).default)(o.default);var s,d;function c(e,t,o){let a,n,i,r=!1;const s=(0,l.default)(t),c=function e(o){return l.default.Owner.getOwnershipState(o)?.matchManual(!0,(()=>{r=!0,a?.(),a=void 0,n?.(),n=void 0,i?.(),i=void 0})),{state:s,set:e=>r?o:"function"==typeof e?(c.use(e),o):(a?.(),a=void 0,n?.(),n=void 0,i?.(),i=void 0,p(e),o),use:e=>r?o:(a?.(),a=void 0,n?.(),n=void 0,i?.(),i=void 0,"string"==typeof e?(n=u.useManual((t=>p(t[e]()))),o):(n=u.useManual((t=>p(e?.(t,d)))),o)),bind:e=>{if(r)return o;if(a?.(),a=void 0,n?.(),n=void 0,i?.(),i=void 0,null==e)return p(t),o;if("function"==typeof e){const t=e,o=l.default.Owner.create();n=o.remove,e=u.map(o,(e=>t(e,d)))}return l.default.is(e)?(a=e?.use(o,(e=>{if(i?.(),i=void 0,"function"!=typeof e)return p(e);const t=e,o=l.default.Owner.create();i=o.remove,u.use(o,(e=>p(t(e,d))))})),o):(p(e),o)},unbind:()=>(a?.(),a=void 0,n?.(),n=void 0,i?.(),i=void 0,p(t),o),rehost:e}}(e),p=o.bind(null,c);return c}function p(e,t,o){const a=o??t;return c(e,o?t:void 0,((e,t)=>{"object"==typeof t&&null!==t&&(t=t.toString()),e.state.value!==t&&(e.state.asMutable?.setValue(t),a(t??void 0))}))}Object.defineProperty(window,"quilt",{get:()=>u.value}),Object.defineProperty(t,"quilt",{get:()=>u.value}),n.default.onMessage("updateLang",(async()=>{r.default.allowModuleRedefinition("lang/en-nz"),await r.default.reload(`${i.default.URL_ORIGIN}lang/en-nz/index.js`),u.value=await new Promise(((t,o)=>{e(["lang/en-nz"],t,o)})).then(__importStar).then((e=>e.default))})),function(e){e.fake=function(e){const t={content:[{content:e}],toString:()=>e};return()=>t},e.State=u}(s||(t.Quilt=s={})),function(e){let n,i,r,u,s;function d(e){return Object.keys(e).includes("toString")}function c(e){return e.content.map(f)}function p(e){if((e=e.toLowerCase()).startsWith("link(")){const t=e.slice(5,-1);return(t.startsWith("/")?u(t):s(t)).element}if(e.startsWith(".")){const t=e.slice(1);if(t in a.style.value)return i().style(t).element}if(e.startsWith("icon.")){const t=`button-icon-${e.slice(5)}`;if(t in a.style.value)return i().style("button-icon",t,"button-icon--inline").element}switch(e){case"b":return document.createElement("strong");case"i":return document.createElement("em");case"u":return document.createElement("u");case"s":return document.createElement("s");case"sm":return i("small").style("small").element;case"supporters-only":return i().style("label-supporter").text.use("shared/term/supporters").element}}function f(e){if(function(e){return"string"==typeof e.content&&!e.content.includes("\n")&&!e.tag}(e))return document.createTextNode(e.content);const t=e.tag?.toLowerCase();let a=t?p(t):void 0;if(a??=document.createElement("span"),Array.isArray(e.content))a.append(...e.content.map(f));else if("object"==typeof e.content&&e.content)o.WeavingArg.isRenderable(e.content)?n(e.content)?a.append(e.content.element):e.content instanceof Node?a.append(e.content):console.warn("Unrenderable weave content:",e.content):d(e.content)?a.append(...c(e.content)):a.append(f(e.content));else{const t=`${e.content??""}`.split("\n");for(let e=0;e<t.length;e++)e>0&&a.append(r().element),a.append(document.createTextNode(t[e]))}return a}e.init=function(e){i=e.Component,u=e.Link,s=e.ExternalLink,r=i.Builder("br",(e=>e.style("break"))).setName("Break"),n=i.is},e.isWeave=d,e.renderWeave=c,e.arg=function(o){return"object"==typeof o&&o&&"map"in o&&(o=o.value),"function"==typeof o&&(o=o(t.quilt,e)),"string"==typeof o&&o in t.quilt&&(o=t.quilt[o]()),o},e.toString=function(o){if(l.default.is(o)&&(o=o.value),"function"!=typeof o){const e=o;o=()=>t.quilt[e]()}return o(t.quilt,e)?.toString()??""},e.createTagElement=p}(d||(t.QuiltHelper=d={})),function(e){function t(e){return"string"==typeof e&&(e={content:[{content:e}]}),e?d.renderWeave(e):[]}e.render=t,e.Nodes=function(e,o,a){const n=a??o;return c(e,a?o:void 0,((e,o)=>{const a="object"==typeof o&&null!==o?o.toString():o;e.state.value!==a&&(e.state.asMutable?.setValue(a),n(t(o)))}))}}(p||(p={})),t.default=p})),define("ui/utility/TextManipulator",["require","exports","ui/utility/StringApplicator"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=function(e,t=e){return function a(n){const i=n.rehost;return Object.assign(n,{prepend:a=>(t.prepend(...o.default.render(a)),e),append:a=>(t.append(...o.default.render(a)),e),rehost:e=>a(i(e))})}(o.default.Nodes(e,(e=>(t.removeContents(),t.append(...e),e))))}})),define("ui/component/core/Button",["require","exports","ui/Component","ui/InputBus","ui/utility/BrowserListener","ui/utility/FontsListener","ui/utility/TypeManipulator","utility/State","utility/Type"],(function(e,t,o,a,n,i,r,l,u){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u);const s=o.default.Builder("button",(e=>{const t=new Set,s=l.default.Generator((()=>!!t.size)),d=(0,l.default)(!1);let c;const p=(0,l.default)(null,!1),f=p.mapManual((e=>!!e?.length));let m,h;const g=new WeakMap,v=e.and(a.HandlesMouseEvents).attributes.set("type","button").style("button").style.bind(n.default.isWebkit,"button--webkit").style.bind(s,"button--disabled").style.bind(d,"button--has-subtext").attributes.bind(s,"disabled").extend((e=>({textWrapper:void 0,subTextWrapper:void 0,subText:void 0,disabled:s,type:r.default.Style(e,(e=>`button-type-${e}`)),setDisabled(o,a){const n=t.size;return o?t.add(a):t.delete(a),t.size!==n&&s.refresh(),e},bindDisabled:(t,o)=>(g.get(t)?.(),g.set(t,t.use(e,((t,a)=>{"string"==typeof t?e.setDisabled(!!t,t||a):e.setDisabled(!!t,o??"")}))),e),unbindDisabled:(t,o)=>(g.get(t)?.(),g.delete(t),e.setDisabled(!1,o??u.default.as("string",t.value)??""),e),setIcon:t=>(h?.(),h=void 0,y(t),e),bindIcon:t=>(h?.(),h=t.use(e,y),e),useGradient:t=>(c?.(),c=p.bind(e,l.default.get(t)),e)}))).style.bind(f,"button--gradient").style.bindVariable("button-gradient",p.map(e,(e=>e?.length?`${e.map((e=>`#${e.toString(16).padStart(6,"0")}`)).map((e=>`light-dark(\n\t\t\t\t\toklch(from ${e} max(var(--button-gradient-light-max), L) C H / var(--button-gradient-opacity)),\n\t\t\t\t\toklch(from ${e} min(var(--button-gradient-dark-min), L) C H / var(--button-gradient-opacity))\n\t\t\t\t)`)).join(", ")}`:void 0))).extendJIT("textWrapper",(e=>(0,o.default)().style("button-text").appendTo(e))).extendJIT("text",(e=>e.textWrapper.text.rehost(e))).extendJIT("subTextWrapper",(e=>(d.value=!0,(0,o.default)().style("button-subtext").appendTo(e)))).extendJIT("subText",(e=>e.subTextWrapper.text.rehost(e)));return v;function y(e){if(!e)return v.icon?.remove(),void delete v.icon;v.icon??=(0,o.default)().style("button-icon").style.bind(d,"button-icon--has-subtext").style.bind(i.default.loaded.not,"button-icon--no-icon").prependTo(v),v.icon.style.bind(v.type.state.map(v.icon,(e=>e.has("icon"))),"button-icon--type-icon"),m&&v.icon.style.remove(`button-icon-${m}`),m=e,m&&v.icon.style(`button-icon-${m}`)}}));t.default=s})),define("ui/component/core/Label",["require","exports","ui/Component","ui/component/core/Button","ui/component/core/Form","ui/view/shared/component/View","utility/State"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AutoLabel=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder("label",(e=>{e.style("label");const n=(0,o.default)().style("label-text").appendTo(e),i=(0,a.default)().style("label-info-button","label-info-button--hidden").type("icon").setIcon("circle-question").tweak((e=>e.icon?.style("label-info-button-icon"))).appendTo(e);let l,u;return e.extend((e=>({textWrapper:n,for:(0,r.default)(void 0),setFor:t=>(e.attributes.set("for",t),e.for.asMutable?.setValue(t),e),setRequired:(t=!0)=>(e.style.unbind(l),l=void 0,"boolean"==typeof t?n.style.toggle(t,"label-required"):n.style.bind(l=t,"label-required"),e),setInput:o=>{u?.(),u=void 0,e.is(t.AutoLabel)||e.setFor(o?.name.value),e.setRequired(o?.required);const a=r.default.Owner.create();o&&r.default.Use(a,{invalid:o.invalid,touched:o.touched}).use(a,(({invalid:t,touched:o})=>e.style.toggle(!!t&&(o??!0),"label--invalid")));const n=o?.hasPopover.use(e,(e=>{i.style.toggle(!e,"label-info-button--hidden")}));function l(){const e=o?.getPopover();(e?.lastStateChangeTime??1/0)+10>=Date.now()||o?.getPopover()?.toggle().anchor.apply()}return i.event.subscribe("click",l),u=o?()=>{a.remove(),n?.(),i.event.unsubscribe("click",l),u=void 0}:void 0,e}}))).extendJIT("text",(e=>e.textWrapper.text.rehost(e)))}));t.default=l;let u=0;t.AutoLabel=o.default.Builder("label",(e=>{const t=u++,o=e.and(l);let a,r,s;return o.receiveInsertEvents(),o.receiveAncestorInsertEvents(),o.event.subscribe(["insert","ancestorInsert"],(()=>{s?.();const e=o.closest(n.default);s=e?.name.use(o,(e=>a=e));const t=o.closest(i.default);r=t?t.hash:"_",d()})),o.text.state.use(o,(()=>d())),o.extend((e=>({})));function d(){const e=o.text.state.value?.toString().toLowerCase().replace(/\W+/g,"-");e?a?o.setFor(`${r}--${a}--${e}`):o.setFor(`${r}--${e}--${t}`):o.setFor()}}))})),define("ui/utility/AttributeManipulator",["require","exports","ui/utility/StringApplicator","utility/State"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),t.default=function(e){let t,n=!1;const i=new Map,r=new Map;return a.default.Owner.getOwnershipState(e)?.matchManual(!0,(()=>{n=!0;for(const e of Object.values(t??{}))e.unuse();t=void 0})),{has:t=>e.element.hasAttribute(t),get:t=>r.compute(t,(()=>(0,a.default)(e.element.getAttribute(t)??void 0))),append(...o){for(const a of o)t?.[a]?.unuse(),delete t?.[a],e.element.setAttribute(a,""),r.get(a)?.asMutable?.setValue("");return e},prepend(...t){const o={};for(const t of[...e.element.attributes])o[t.name]=t.value,e.element.removeAttribute(t.name);for(const a of t){const t=o[a]??"";e.element.setAttribute(a,t),r.get(a)?.asMutable?.setValue(t)}for(const t of Object.keys(o))e.element.setAttribute(t,o[t]);return e},insertBefore(t,...o){const a={};for(const t of[...e.element.attributes])a[t.name]=t.value,e.element.removeAttribute(t.name);for(const n of Object.keys(a)){if(n===t)for(const t of o){const o=a[t]??"";e.element.setAttribute(t,o),r.get(t)?.asMutable?.setValue(o)}e.element.setAttribute(n,a[n])}return e},insertAfter(t,...o){const a={};for(const t of[...e.element.attributes])a[t.name]=t.value,e.element.removeAttribute(t.name);if(!(t in a))for(const t of o){const o=a[t]??"";e.element.setAttribute(t,o),r.get(t)?.asMutable?.setValue(o)}for(const n of Object.keys(a))if(e.element.setAttribute(n,a[n]),n===t)for(const t of o){const o=a[t]??"";e.element.setAttribute(t,o),r.get(t)?.asMutable?.setValue(o)}return e},set:(o,a)=>(t?.[o]?.unuse(),delete t?.[o],void 0===a?(e.element.removeAttribute(o),r.get(o)?.asMutable?.setValue(void 0)):(e.element.setAttribute(o,a),r.get(o)?.asMutable?.setValue(a)),e),bind(...t){if("string"==typeof t[0]){let[o,n]=t;n=a.default.get(n),i.get(o)?.(),i.set(o,n.use(e,(t=>{void 0===t?(e.element.removeAttribute(o),r.get(o)?.asMutable?.setValue(void 0)):(e.element.setAttribute(o,t),r.get(o)?.asMutable?.setValue(t))})))}else{let[o,a,n,l]=t;i.get(a)?.(),i.set(a,o.use(e,(t=>{t?(n??="",e.element.setAttribute(a,n),r.get(a)?.asMutable?.setValue(n)):void 0!==l?(e.element.setAttribute(a,l),r.get(a)?.asMutable?.setValue(l)):(e.element.removeAttribute(a),r.get(a)?.asMutable?.setValue(void 0))})))}return e},compute(o,a){if(e.element.hasAttribute(o))return e;t?.[o]?.unuse(),delete t?.[o];const n=a(e);return void 0===n?(e.element.removeAttribute(o),r.get(o)?.asMutable?.setValue(void 0)):(e.element.setAttribute(o,n),r.get(o)?.asMutable?.setValue(n)),e},getUsing:e=>t?.[e]?.handler,use(a,i){if(n)return e;const l=o.Quilt.State.useManual((n=>{const i=t?.[a];if(!i)return;const l=i.handler,u="string"==typeof l?n[l]():l(n,o.QuiltHelper),s=u?.toString()??"";e.element.setAttribute(a,s),r.get(a)?.asMutable?.setValue(s)}));return t??={},t[a]={handler:i,unuse:l},e},remove(...o){for(const a of o)t?.[a]?.unuse(),delete t?.[a],e.element.removeAttribute(a),r.get(a)?.asMutable?.setValue(void 0);return e},toggle(e,t,o=""){return this[e?"set":"remove"](t,o)},copy(t){"element"in t&&(t=t.element);for(const o of t.attributes)e.element.setAttribute(o.name,o.value),r.get(o.name)?.asMutable?.setValue(o.value);return e}}}})),define("ui/utility/ClassManipulator",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{has:(...t)=>t.every((t=>e.element.classList.contains(t))),some:(...t)=>t.some((t=>e.element.classList.contains(t))),add:(...t)=>(e.element.classList.add(...t),e),remove:(...t)=>(e.element.classList.remove(...t),e),toggle(e,...t){return this[e?"add":"remove"](...t)},copy:t=>("element"in t&&(t=t.element),e.element.classList.add(...t.classList),e)}}})),define("utility/SelfScript",["require","exports","utility/State"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)(void 0)})),define("utility/Import",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e){return!!window.hasModule?.(e)}e.hasModule=t,e.getModule=function(e){const o=t(e)?window.getModule?.(e):void 0;return o&&"default"in o?o.default:o}}(o||(o={})),t.default=o})),define("utility/SourceMapping",["require","exports","utility/Import","utility/State"],(function(e,t,o,a){var n;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),function(e){const t=Error.prepareStackTrace;let n=t;e.init=function(){o.default.getModule("browser-source-map-support")?.install({environment:"browser"}),n=Error.prepareStackTrace},e.Enabled=(0,a.default)(!0),e.Enabled.useManual((e=>Error.prepareStackTrace=e?n:t))}(n||(n={})),t.default=n})),define("ui/Component",["require","exports","lang/en-nz","ui/utility/AnchorManipulator","ui/utility/AttributeManipulator","ui/utility/ClassManipulator","ui/utility/EventManipulator","ui/utility/FocusListener","ui/utility/StringApplicator","ui/utility/StyleManipulator","ui/utility/TextManipulator","ui/utility/Viewport","utility/Arrays","utility/Async","utility/Define","utility/Env","utility/Errors","utility/Objects","utility/SelfScript","utility/SourceMapping","utility/State","utility/string/Strings"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w){Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentInsertionDestination=void 0,a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importStar(v),y=__importDefault(y),b=__importDefault(b),_=__importDefault(_),w=__importDefault(w);Symbol("COMPONENT_BRAND");const k=new WeakMap;var T,x;m.default.magic(Element.prototype,"component",{get(){return k.get(this)},set(e){e?k.set(this,e):k.delete(this)}}),function(e){e.is=function(e){return"object"==typeof e&&!!e?.isInsertionDestination}}(T||(t.ComponentInsertionDestination=T={})),function(e){e.ReceiveRootedEvents="_receive-rooted-events",e.ReceiveAncestorInsertEvents="_receieve-ancestor-insert-events",e.ReceiveDescendantInsertEvents="_receieve-descendant-insert-events",e.ReceiveDescendantRemoveEvents="_receieve-descendant-remove-events",e.ReceiveAncestorRectDirtyEvents="_receieve-ancestor-rect-dirty-events",e.ReceiveChildrenInsertEvents="_receive-children-insert-events",e.ReceiveInsertEvents="_receive-insert-events",e.ReceiveScrollEvents="_receieve-scroll-events"}(x||(x={}));const D=[];function O(e="span"){if(!S)throw new Error("Components cannot be built yet");let t,f,h,y,b,E;const M=new Map,I={};let C={supers:(0,_.default)([]),isComponent:!0,isInsertionDestination:!0,element:document.createElement(e),removed:(0,_.default)(!1),rooted:(0,_.default)(!1),nojit:I,get tagName(){return C.element.tagName},setOwner:e=>(b?.(),b=_.default.Owner.getOwnershipState(e)?.use(C,(e=>e&&C.remove())),C),replaceElement:(t,o)=>{if("string"==typeof t&&t.toUpperCase()===C.element.tagName.toUpperCase())return C;"string"==typeof t&&(t=document.createElement(t));const a=C.element;return o||(O.removeContents(t),t.replaceChildren(...C.element.childNodes)),C.element.parentNode&&C.element.replaceWith(t),C.element=t,e=C.element.tagName,k.delete(a),k.set(t,C),C.attributes.copy(a),C.style.refresh(),C},is:e=>!e||(Array.isArray(e)?e:[e]).some((e=>C.supers.value.includes(e))),as:e=>!e||C.supers.value.includes(e)?C:void 0,cast:()=>C,and(e,...t){if(C.is(e))return C;const o=e.from(C,...t);return o instanceof Promise?o.then((t=>(C=t,C.supers.value.push(e),C.supers.emit(),e.name&&C.attributes.prepend(`:${e.name.kebabcase}`),C))):(C=o,C.supers.value.push(e),C.supers.emit(),e.name&&C.attributes.prepend(`:${e.name.kebabcase}`),C)},extend:e=>Object.assign(C,e(C)),override:(e,t)=>{const o=C[e];return C[e]=t(C,o),C},extendMagic:(e,t)=>(m.default.magic(C,e,t(C)),C),extendJIT:(e,t)=>(m.default.magic(C,e,{get:()=>{const o=t(C);m.default.set(C,e,o);const a=M.get(e);if(a&&!0!==a)for(const e of a)e(o,C);return M.set(e,!0),o},set:t=>{m.default.set(C,e,t),I[e]=t}}),C),tweakJIT:(e,t)=>{const o=M.compute(e,(()=>new Set));return!0===o?t(C[e],C):o.add(t),C},tweak:(e,...t)=>(e?.(C,...t),C),get style(){return m.default.set(C,"style",(0,s.default)(C))},get classes(){return m.default.set(C,"classes",(0,i.default)(C))},get attributes(){return m.default.set(C,"attributes",(0,n.default)(C))},get event(){return m.default.set(C,"event",(0,r.default)(C))},get text(){return m.default.set(C,"text",(0,d.default)(C))},get anchor(){return m.default.set(C,"anchor",(0,a.default)(C))},get hovered(){return m.default.set(C,"hovered",C.hoveredTime.mapManual((e=>!!e)))},get hoveredTime(){return m.default.set(C,"hoveredTime",(0,_.default)(void 0))},get focused(){return m.default.set(C,"focused",C.focusedTime.mapManual((e=>!!e)))},get focusedTime(){return m.default.set(C,"focusedTime",(0,_.default)(void 0))},get hasFocused(){return m.default.set(C,"hasFocused",C.hasFocusedTime.mapManual((e=>!!e)))},get hasFocusedTime(){return m.default.set(C,"hasFocusedTime",(0,_.default)(void 0))},get hadFocusedLast(){return m.default.set(C,"hadFocusedLast",(0,_.default)(!1))},get hoveredOrFocused(){return m.default.set(C,"hoveredOrFocused",C.hoveredOrFocusedTime.mapManual((e=>!!e)))},get hoveredOrFocusedTime(){return m.default.set(C,"hoveredOrFocusedTime",_.default.Generator((()=>Math.max(C.hoveredTime.value??0,C.focusedTime.value??0)||void 0)).observe(C,C.hoveredTime,C.focusedTime))},get hoveredOrHasFocused(){return m.default.set(C,"hoveredOrHasFocused",C.hoveredOrHasFocusedTime.mapManual((e=>!!e)))},get hoveredOrHasFocusedTime(){return m.default.set(C,"hoveredOrHasFocusedTime",_.default.Generator((()=>Math.max(C.hoveredTime.value??0,C.hasFocusedTime.value??0)||void 0)).observe(C,C.hoveredTime,C.hasFocusedTime))},get active(){return m.default.set(C,"active",C.activeTime.mapManual((e=>!!e)))},get activeTime(){return m.default.set(C,"activeTime",(0,_.default)(void 0))},get id(){return m.default.set(C,"id",(0,_.default)(void 0))},get name(){return m.default.set(C,"name",(0,_.default)(void 0))},get rect(){const e=_.default.JIT((()=>C.element.getBoundingClientRect())),t=e.markDirty;return e.markDirty=()=>{t();for(const e of this.element.getElementsByClassName(x.ReceiveAncestorRectDirtyEvents))e.component?.event.emit("ancestorRectDirty");return e},this.receiveInsertEvents(),this.receiveAncestorInsertEvents(),this.receiveAncestorScrollEvents(),this.classes.add(x.ReceiveAncestorRectDirtyEvents),this.event.subscribe(["insert","ancestorInsert","ancestorScroll","ancestorRectDirty"],e.markDirty),c.default.size.subscribe(C,e.markDirty),m.default.set(C,"rect",e)},get fullType(){return(C.tagName.startsWith(":")?"":`<${C.tagName}> `)+(C.supers.value.length?":"+C.supers.value.map((e=>e.name.kebabcase)).join(" :"):"")},setId:e=>{return t?.(),t=void 0,e&&"string"!=typeof e?t=e.use(C,o):o(e),C;function o(e){e?(C.element.setAttribute("id",e),C.id.asMutable?.setValue(e)):(C.element.removeAttribute("id"),C.id.asMutable?.setValue(void 0))}},setRandomId:()=>(C.setId(w.default.uid()),C),setName:e=>{return f?.(),f=void 0,e&&"string"!=typeof e?f=e.use(C,t):t(e),C;function t(e){e?(e=e.replace(/[^\w-]+/g,"-").toLowerCase(),C.element.setAttribute("name",e),C.name.asMutable?.setValue(e)):(C.element.removeAttribute("name"),C.name.asMutable?.setValue(void 0))}},disableInsertion:()=>C,remove(){C.removeContents(),C.removed.asMutable?.setValue(!0),C.rooted.asMutable?.setValue(!1),C.element.component=void 0,C.element.remove(),function(e){if(!e)return;let t=e.element.parentElement;for(;t;)t.classList.contains(x.ReceiveDescendantRemoveEvents)&&t.component?.event.emit("descendantRemove"),t=t.parentElement}(C),C.classes.has(x.ReceiveRootedEvents)&&C.event.emit("unroot"),b?.(),b=void 0,y?.(),y=void 0,h?.(),h=void 0,t?.(),t=void 0,f?.(),f=void 0},appendTo:e=>(e.append(C.element),C.emitInsert(),C),prependTo:e=>(e.prepend(C.element),C.emitInsert(),C),insertTo(e,t,o){if(T.is(e))return e.insert(t,o,C),C.emitInsert(),C;const a=o?O.element(o):null;return"before"===t?e.insertBefore(C.element,a):e.insertBefore(C.element,a?.nextSibling??null),C.emitInsert(),C},append(...e){const t=e.filter(p.Truthy).map(O.element);C.element.append(...t);for(const e of t)e.component?.emitInsert();return C.classes.has(x.ReceiveChildrenInsertEvents)&&C.event.emit("childrenInsert",t),C},prepend(...e){const t=e.filter(p.Truthy).map(O.element);C.element.prepend(...t);for(const e of t)e.component?.emitInsert();return C.classes.has(x.ReceiveChildrenInsertEvents)&&C.event.emit("childrenInsert",t),C},insert(e,t,...o){const a=t?O.element(t):null,n=o.filter(p.Truthy).map(O.element);if("before"===e)for(let e=n.length-1;e>=0;e--)C.element.insertBefore(n[e],a);else for(const e of n)C.element.insertBefore(e,a?.nextSibling??null);for(const e of n)e.component?.emitInsert();return C.classes.has(x.ReceiveChildrenInsertEvents)&&C.event.emit("childrenInsert",n),C},removeContents:()=>(O.removeContents(C.element),C),closest:e=>O.closest(e,C),getStateForClosest(e){const t=_.default.JIT((()=>C.closest(e)));return C.receiveAncestorInsertEvents(),C.onRooted((()=>{t.markDirty(),C.receiveInsertEvents(),C.event.subscribe(["insert","ancestorInsert"],(()=>t.markDirty()))})),t},get parent(){return C.element.parentElement?.component},get previousSibling(){return C.element.previousElementSibling?.component},getPreviousSibling(e){const[t]=C.getPreviousSiblings(e);return t},get nextSibling(){return C.element.nextElementSibling?.component},getNextSibling(e){const[t]=C.getNextSiblings(e);return t},*getAncestorComponents(e){let t=C.element;for(;t;){t=t.parentElement;const o=t?.component;o?.is(e)&&(yield o)}},*getChildren(e){for(const t of C.element.children){const o=t.component;o?.is(e)&&(yield o)}},*getSiblings(e){const t=C.element.parentElement;for(const o of t?.children??[])if(o!==C.element){const t=o.component;t?.is(e)&&(yield t)}},*getPreviousSiblings(e){const t=C.element.parentElement;for(const o of t?.children??[]){if(o===C.element)break;const t=o.component;t?.is(e)&&(yield t)}},*getNextSiblings(e){let t=C.element;for(;t=t.nextElementSibling;){const o=t.component;o?.is(e)&&(yield o)}},*getDescendants(e){const t=document.createTreeWalker(C.element,NodeFilter.SHOW_ELEMENT);let o;for(;o=t.nextNode();){const t=o.component;t?.is(e)&&(yield t)}},getFirstDescendant(e){const[t]=C.getDescendants(e);return t},receiveRootedEvents:()=>(C.element.classList.add(x.ReceiveRootedEvents),C),receiveAncestorInsertEvents:()=>(C.element.classList.add(x.ReceiveAncestorInsertEvents),C),receiveDescendantInsertEvents:()=>(C.element.classList.add(x.ReceiveDescendantInsertEvents),C),receiveDescendantRemoveEvents:()=>(C.element.classList.add(x.ReceiveDescendantRemoveEvents),C),receiveAncestorScrollEvents:()=>(C.element.classList.add(x.ReceiveScrollEvents),C),receiveChildrenInsertEvents:()=>(C.element.classList.add(x.ReceiveChildrenInsertEvents),C),receiveInsertEvents:()=>(C.element.classList.add(x.ReceiveInsertEvents),C),emitInsert:()=>(function(e){if(e){const t=document.documentElement.contains(e.element);if(e.rooted.value===t)return;e.rooted.asMutable?.setValue(t),e.classes.has(x.ReceiveRootedEvents)&&e.event.emit(t?"root":"unroot");for(const o of e.element.querySelectorAll("*")){const e=o.component;e&&(e.rooted.asMutable?.setValue(t),e.classes.has(x.ReceiveRootedEvents)&&e.event.emit(t?"root":"unroot"))}}}(C),function(e){if(!e)return;e.classes.has(x.ReceiveInsertEvents)&&e.event.emit("insert");const t=e.element.getElementsByClassName(x.ReceiveAncestorInsertEvents);for(const e of t)e.component?.event.emit("ancestorInsert");let o=e.element.parentElement;for(;o;)o.classList.contains(x.ReceiveDescendantInsertEvents)&&o.component?.event.emit("descendantInsert"),o=o.parentElement}(C),C),monitorScrollEvents:()=>(E??=(C.element===window?document.documentElement:C.element).getElementsByClassName(x.ReceiveScrollEvents),C.event.subscribe("scroll",(()=>{for(const e of[...E])e.component?.event.emit("ancestorScroll")})),C),onRooted:e=>(C.rooted.matchManual(!0,(()=>e(C))),C),onRemove:(e,t)=>(C.removed.match(e,!0,(()=>t(C))),C),onRemoveManual:e=>(C.removed.matchManual(!0,(()=>e(C))),C),ariaRole:e=>e?C.attributes.set("role",e):C.attributes.remove("role"),get ariaLabel(){return m.default.set(C,"ariaLabel",(0,u.default)(C,(e=>C.attributes.set("aria-label",e))))},ariaLabelledBy:e=>{if(h?.(),h=void 0,e){const t=_.default.Generator((()=>e.id.value??e.attributes.get("for"))).observe(C,e.id,e.cast()?.for);h=t.use(C,(e=>C.attributes.set("aria-labelledby",e)))}return C},ariaHidden:()=>C.attributes.set("aria-hidden","true"),ariaChecked:e=>(e.use(C,(e=>C.attributes.set("aria-checked",`${e}`))),C),ariaControls:e=>(y?.(),y=e?.id.use(C,(e=>C.attributes.set("aria-controls",e))),C),tabIndex:e=>(void 0===e?C.element.removeAttribute("tabindex"):"programmatic"===e?C.element.setAttribute("tabindex","-1"):"auto"===e?C.element.setAttribute("tabindex","0"):C.element.setAttribute("tabindex",`${e}`),C),focus:()=>(l.default.focus(C.element),C),blur:()=>(l.default.blur(C.element),C)};o.WeavingArg.setRenderable(C,(()=>C.element.textContent??"")),v.default.stringify.disable(C);for(const e of D)e(C);if(!O.is(C))throw g.default.Impossible();return C.element.component=C,C}let S=!1;!function(e){let t,o,a;function n(e){return"object"==typeof e&&!!e?.isComponent}function i(t){const o=e();return(0,v.mutable)(o).element=t,o}e.getBody=()=>t??=i(document.body),e.getDocument=()=>o??=i(document.documentElement),e.getWindow=()=>a??=i(window),e.allowBuilding=function(){S=!0},e.is=n,e.element=function(e){return n(e)?e.element:e},e.wrap=i,e.SYMBOL_COMPONENT_TYPE_BRAND=Symbol("COMPONENT_TYPE_BRAND");const r=t=>e(t);function l(e){return{name:T(),from:e,setName(e){return(0,v.mutable)(this).name=p(e),this}}}e.Builder=function(e,t){let o=T();const a="string"==typeof e?e:void 0,n=t&&"string"!=typeof e?e:r;t??=e;const i=(e=n(a),...o)=>{const i=t(e,...o);return i instanceof Promise?i.then((t=>(t!==e&&c(e),t))):(i!==e&&c(e),i)},l=(...e)=>{const t=i(void 0,...e);return t instanceof Promise?t.then(d):d(t)};Object.defineProperty(t,"name",{value:o,configurable:!0}),Object.defineProperty(t,Symbol.toStringTag,{value:o,configurable:!0}),Object.defineProperty(i,"name",{value:o,configurable:!0}),Object.defineProperty(i,Symbol.toStringTag,{value:o,configurable:!0}),Object.defineProperty(l,"name",{value:o,configurable:!0}),Object.defineProperty(l,Symbol.toStringTag,{value:o,configurable:!0});const u=[],s=Object.assign(l,{from:i,setName:e=>(o=p(e),Object.defineProperty(l,"name",{value:o}),s),extend:e=>(u.push(e),s)});return s;function d(e){if(!e)return e;for(const t of u)Object.assign(e,t(e));if(o&&h.default.isDev){e[Symbol.toStringTag]??=o.toString();const t=`:${o.kebabcase}`;"SPAN"===e.element.tagName?e.replaceElement(t):e.attributes.prepend(t)}return e.supers.value.push(l),e.supers.emit(),e}async function c(e){if(!e||!_.default.OwnerMetadata.hasSubscriptions(e))return;const t=new WeakRef(e);e=void 0,await f.default.sleep(1e3),!(e=t.deref())||e.rooted.value||e.removed.value||console.error(`${String(o??"Component")} builder returned a replacement component, but the original component was used as a subscription owner and is not in the tree!`)}},e.Extension=l,e.Tag=function(){return l((e=>e))},e.extend=function(e){D.push(e)},e.get=function(e){if(e&&("object"==typeof e||"function"==typeof e))return k.get(e)};const u=/\(http.*?\w+\.[tj]s:(\d+):\d+\)|@http.*?\w+\.[tj]s:(\d+):\d+/,s=/\s*(?:const |exports\.(?!default))(\w+) = /,d=/.*\bdefine\("(?:[^"]+\/)*(\w+)", /s,c=/(?<=[a-z0-9_-])(?=[A-Z])/g;function p(e){return Object.assign(String(e),{kebabcase:e.replaceAll(c,"-").toLowerCase()})}let m,g;function T(){if(!g){if(m??=document.currentScript?.text??y.default.value,!m)return;g=m.split("\n")}b.default.Enabled.value=!1;const e=(new Error).stack??"",t=w.default.shiftLine(e,e.includes("@")?2:3);b.default.Enabled.value=!0;const o=t.match(u),a=Number(o?.[1]??o?.[2]),n=g[a-1];if(!n)return;const i=n.match(s)?.[1];if(i)return p(i);const r=m.slice(0,m.indexOf(n)),l=r.match(d)?.[1];return l?p(l):void 0}e.removeContents=function e(t){for(const o of[...t.childNodes])o.component?o.component.remove():(e(o),o.remove())},e.closest=function(e,t){let o=n(t)?t.element:t??null;for(;o;){const t=o?.component;if(t?.is(e))return t;o=o.parentElement}}}(O||(O={})),t.default=O})),define("utility/State",["require","exports","utility/Arrays","utility/Define","utility/Functions","utility/Objects"],(function(e,t,o,a,n,i){Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),n=__importDefault(n),i=__importStar(i);const r=Symbol("VALUE"),l=Symbol("SUBSCRIBERS");function u(e,t){let o,s;const d={isState:!0,setId:e=>(d.id=e,d),[r]:e,[l]:[],get value(){return d[r]},set value(e){o?.(),c(e)},setValue:e=>(o?.(),c(e),d),setValueSilent:e=>(o?.(),p(e),d),comparator:e=>!1!==t&&(d[r]===e||t?.(d[r],e)||!1),emit:e=>{void 0!==d.id&&console.log("emit",d.id);for(const t of d[l].slice())t(d[r],e);return d},bind:(e,t)=>(t.id&&console.log("bind",t.id),o?.(),o=t.use(e,c),o),bindManual:e=>(e.id&&console.log("bind",e.id),o?.(),o=e.useManual(c),o),use:(e,t)=>{let o;return d.subscribe(e,a),a(d[r],void 0),()=>d.unsubscribe(a);function a(e,a){o?.remove(),o=u.Owner.create(),t(e,a,o)}},useManual:e=>{let t;return d.subscribeManual(o),o(d[r],void 0),()=>d.unsubscribe(o);function o(o,a){t?.remove(),t=u.Owner.create(),e(o,a,t)}},subscribe:(e,t)=>{const o=u.Owner.getOwnershipState(e);if(!o||o.value)return n.default.NO_OP;function a(){o.unsubscribe(a),d.unsubscribe(t)}return u.OwnerMetadata.setHasSubscriptions(e),o.subscribeManual(a),d.subscribeManual(t),a},subscribeManual:e=>(d[l].push(e),()=>d.unsubscribe(e)),unsubscribe:e=>(d[l].filterInPlace((t=>t!==e)),d),match:(e,t,o)=>d.use(e,(function e(a){(a===t||Array.isArray(t)&&t.includes(a))&&(d.unsubscribe(e),o(a))})),matchManual:(e,t)=>d.useManual((function o(a){(a===e||Array.isArray(e)&&e.includes(a))&&(d.unsubscribe(o),t(a))})),await:(e,t)=>new Promise((o=>d.match(e,t,(()=>{o(d.value)})))),map:(e,t,o)=>u.Map(e,[d],t,o),mapManual:(e,t)=>u.MapManual([d],e,t),get nonNullish(){return a.default.set(d,"nonNullish",u.Generator((()=>void 0!==d.value&&null!==d.value)).observeManual(d))},get truthy(){return a.default.set(d,"truthy",u.Generator((()=>!!d.value)).observeManual(d))},get not(){return f()},get falsy(){return f()},equals:e=>(s??=new Map,s.compute(e,(()=>u.Generator((()=>d.value===e)).observeManual(d)))),coalesce(e){const t=u.get(e);return u.Generator((()=>{const e=d.value;return null!=e?e:t.value})).observeManual(d,t)},delay(e,t,o,a){const i=u(o?o(d.value):d.value,a);let r;return d.subscribe(e,(e=>{window.clearTimeout(r);const a=n.default.resolve(t,e);if(!a)return i.value=o?o(e):e;r=window.setTimeout((()=>{i.value=o?o(e):e}),a)})),i}};return d.asMutable=d,i.default.stringify.disable(d);function c(e){const t=d[r];p(e)&&d.emit(t)}function p(e){return(!1===t||d[r]!==e&&!t?.(d[r],e))&&(d[r]=e,!0)}function f(){const e=u.Generator((()=>!d.value)).observeManual(d);return a.default.set(d,"not",e),a.default.set(d,"falsy",e),e}}!function(e){let t;function u(e){return"object"==typeof e&&!0===e?.isState}!function(t){t.getOwnershipState=function(e){const t=e;return t?.removed??t?.closed},t.create=function(){const t=e(!1);return{removed:t,remove:()=>t.value=!0}}}(t=e.Owner||(e.Owner={})),e.is=u,e.get=function(t){return u(t)?t:e(t)},e.value=function(e){return u(e)?e.value:e},e.getInternalValue=function(e){return u(e)?e[r]:e};const s=Symbol("HAS_SUBSCRIPTIONS");let d;function c(o,n){const i=e(void 0,n);delete i.asMutable,a.default.magic(i,"value",{get:()=>i[r]});let l,u=!0;return i.refresh=()=>s(),i.regenerate=()=>s(!0),i.refresh(),i.observe=(e,...o)=>{const a=t.getOwnershipState(e);if(!a||a.value)return i;d.setHasSubscriptions(e);for(const e of o)e?.subscribeManual(i.refresh);let n=a.subscribeManual((e=>e&&function(){n?.(),n=void 0;for(const e of o)e?.unsubscribe(i.refresh)}()));return i},i.observeManual=(...e)=>{for(const t of e)t?.subscribeManual(i.refresh);return i},i.unobserve=(...e)=>{for(const t of e)t?.unsubscribe(i.refresh);return i},i;function s(t){l?.(),l=void 0;const a=o();if(e.is(a))return l=a.useManual((e=>{if(i.comparator(e))return i;const t=i[r];i[r]=e,i.emit(t)})),i;if(i.comparator(a)&&!u&&!t)return i;u=!1;const n=i[r];return i[r]=a,i.emit(n),i}}function p(t,o,a){const n=e({settled:!1,value:void 0,lastValue:void 0,error:void 0,progress:void 0}),r=n.mapManual((e=>e.settled)),l=n.mapManual((e=>e.error)),u=n.mapManual((e=>e.value)),s=n.mapManual((e=>e.lastValue)),d=n.mapManual((e=>e.progress));let c,p;o.use(t,(async e=>{c?.abort();const t=n.value.value;n.value={settled:!1,value:void 0,lastValue:t,error:void 0,progress:void 0},c=new AbortController,p=Promise.resolve(a(e,c.signal,((e,t)=>{(0,i.mutable)(n.value).progress={progress:e,message:t},n.emit()})));const{value:o,error:r}=await p.then((e=>({value:e,error:void 0})),(e=>({error:new Error("Async state rejection:",{cause:e}),value:void 0})));c.signal.aborted||(n.value={settled:!0,value:o,lastValue:t,error:r,progress:void 0})}));const f=Object.assign(u,{settled:r,lastValue:s,error:l,state:n,progress:d});return Object.defineProperty(f,"promise",{get:()=>p}),f}!function(e){e.setHasSubscriptions=function(e){e[s]=!0},e.hasSubscriptions=function(e){return!0===e[s]}}(d=e.OwnerMetadata||(e.OwnerMetadata={})),e.Generator=c,e.JIT=function(o){const n=e(void 0);delete n.asMutable;let i,r,u,s=!1;a.default.magic(n,"value",{get:()=>{if(!s){r?.(),r=void 0,u?.remove(),u=void 0,s=!0,u=t.create();const a=o(u);e.is(a)?r=a.useManual((e=>i=e)):i=a}return i}});const d=()=>n.value;return n.emit=()=>{for(const e of n[l].slice())e(d,i);return n},n.use=(t,o)=>{let a;return n.subscribe(t,i),i(d,void 0),()=>n.unsubscribe(i);function i(t,n){a?.remove(),a=e.Owner.create(),o(t,n,a)}},n.useManual=t=>{let o;return n.subscribeManual(a),a(d,void 0),()=>n.unsubscribe(a);function a(a,n){o?.remove(),o=e.Owner.create(),t(a,n,o)}},n.markDirty=()=>{r?.(),r=void 0,u?.remove(),u=void 0;const e=i;return s=!1,i=void 0,n.emit(e),n},n.observe=(...e)=>{for(const t of e)t.subscribeManual(n.markDirty);return n},n.unobserve=(...e)=>{for(const t of e)t.unsubscribe(n.markDirty);return n},n},e.Async=p,function(t){t.fromEndpoint=function(o,a){const n=e(null);return Object.assign(t(o,n,(async(e,t)=>{const o=await a.query();if(o instanceof Error)throw o;return o?.data})),{refresh(){n.emit()}})}}(p=e.Async||(e.Async={})),e.Array=function(...t){const o=[],a=[],r=Object.assign(e(t),{length:void 0,set(e,a){t[e]=a;const n=o[e];return n.value.value=a,n.emit(),r.emit(),r},emitItem:e=>(o[e]?.emit(),r),modify(e,o){let a=t[e];return a=o(a,e,r)??a,r.set(e,a),r},clear:()=>(t.length=0,o.length=0,r.emit(),r),push(...e){const a=r.value.length;t.push(...e);for(let t=0;t<e.length;t++)o.push(l(e[t],a+t));return r.emit(),r},unshift(...e){t.unshift(...e);for(let t=0;t<e.length;t++)o.unshift(l(e[t],t));for(let t=e.length;t<o.length;t++)o[t].value.index=t;for(let t=e.length;t<o.length;t++)o[t].emit();return r.emit(),r},pop:()=>(t.pop(),o.pop(),r.emit(),r),shift(){t.shift(),o.shift();for(let e=0;e<o.length;e++)o[e].value.index=e;for(const e of o)e.emit();return r.emit(),r},splice(e,a,...n){t.splice(e,a,...n),o.splice(e,a,...n.map(((t,o)=>l(t,e+o))));for(let t=e+n.length;t<o.length;t++)o[t].value.index=t;for(let t=e+n.length;t<o.length;t++)o[t].emit();return r.emit(),r},filterInPlace(e){t.filterInPlace(e);let a=0;e:for(let e=0;e<t.length;e++)for(;a<o.length;){if(o[a].value.value===t[e]){o[e]=o[a],o[e].value.index=e,a++;continue e}o[a].value.removed.asMutable?.setValue(!0),a++}for(let e=a;e<o.length;e++)o[e].value.removed.asMutable?.setValue(!0);o.length=t.length;for(const e of o)e.emit();return r.emit(),r},move(e,n,i){if(e=Math.max(0,e),n=Math.min(n,t.length),i=Math.max(0,Math.min(i,t.length)),e>=n)return r;if(i>=e&&i<n)return r;const l=t.splice(e,n-e),u=o.splice(e,n-e),s=e<i?i-(n-e)+1:i;t.splice(s,0,...l),o.splice(s,0,...u);const d=[];for(let e=0;e<o.length;e++){o[e].value.index!==e&&(o[e].value.index=e,d.push(e))}for(const e of d)o[e]?.emit();for(const t of a)t.onMove(e,n,i);return r.emit(),r},moveAt(e,n){if(!e.length)return r;const i=t.length;e=e.map((e=>Math.max(0,Math.min(i-1,e)))).distinctInPlace().sort(((e,t)=>e-t)),n=Math.min(n,i-e.length);let l=0,u=0,s=0,d=0;const c=t.slice(),p=o.slice();let f;for(;s<i;)if(f=s>=n&&d<e.length?"moving":"static","static"===f){for(let t=l;t<i;t++)if(!e.includes(t)){l=t;break}t[s]=c[l],o[s]=p[l],l++,s++}else t[s]=c[e[u]],o[s]=p[e[u]],u++,d++,s++;const m=[];for(let e=0;e<o.length;e++){o[e].value.index!==e&&(o[e].value.index=e,m.push(e))}for(const e of m)o[e]?.emit();for(const t of a)t.onMoveAt(e,n);return r.emit(),r},useEach(t,i){const l=e.Owner.getOwnershipState(t);if(!l||l.value)return n.default.NO_OP;for(const e of o)i.onItem(e,r);return e.OwnerMetadata.setHasSubscriptions(t),l.subscribeManual(u),a.push(i),u;function u(){l.unsubscribe(u),a.filterInPlace((e=>e!==i))}}});return(0,i.mutable)(r).length=r.mapManual((e=>e.length)),r;function l(t,o){const n=e({value:t,index:o,removed:e(!1)});for(const e of a)e.onItem(n,r);return n}},e.Truthy=function(e,t){return c((()=>!!t.value)).observe(e,t)},e.NonNullish=function(e,t){return c((()=>void 0!==t.value&&null!==t.value)).observe(e,t)},e.Falsy=function(e,t){return c((()=>!!t.value)).observe(e,t)},e.Some=function(e,...t){return c((()=>t.some((e=>e.value)))).observe(e,...t)},e.Every=function(e,...t){return c((()=>t.every((e=>e.value)))).observe(e,...t)},e.Map=function(e,t,a,n){return c((()=>a(...t.map((e=>e?.value)))),n).observe(e,...t.filter(o.NonNullish))},e.MapManual=function(e,t,a){return c((()=>t(...e.map((e=>e?.value)))),a).observeManual(...e.filter(o.NonNullish))},e.Use=function(e,t){return c((()=>Object.entries(t).toObject((([e,t])=>[e,t?.value])))).observe(e,...Object.values(t).filter(o.NonNullish))},e.UseManual=function(e){return c((()=>Object.entries(e).toObject((([e,t])=>[e,t?.value])))).observeManual(...Object.values(e).filter(o.NonNullish))}}(u||(u={})),t.default=u})),define("utility/Env",["require","exports","utility/State","utility/string/Strings"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);t.default=new class{#t=!1;#o=[];state=(0,o.default)(void 0);get isDev(){return"dev"===this.ENVIRONMENT}get isNgrok(){return this.URL_ORIGIN.includes("ngrok")}async load(){const e=location.origin,t=location.pathname.startsWith("/beta/")?"/beta/":"/";Object.assign(this,_??a.default.optionalParseJSON(document.getElementById("env-json")?.textContent)??await fetch(e+t+"env.json").then((e=>e.json()))),document.documentElement.classList.add(`environment-${this.ENVIRONMENT}`),this.state.value=this,this.#t=!0;for(const e of this.#o)e();this.#o.length=0}onLoad(e,t){if("function"==typeof e)t=e,e=void 0;else if(e){const o=t;t=()=>this.ENVIRONMENT===e&&o?.()}this.#t?t?.():t&&this.#o.push(t)}}})),define("endpoint/Endpoint",["require","exports","utility/Env","utility/Objects","utility/Time"],(function(e,t,o,a,n){function i(e,t,r){let l,u="get"===t?3:1;const s={route:e,header:(e,t)=>(r??={},r[e]=t,s),headers:e=>(r={...r,...e},s),removeHeader:e=>(delete r?.[e],s),getPageSize:()=>l,setPageSize:e=>(l=e,s),setRetry:e=>(u=e,s),noResponse:()=>s.removeHeader("Accept"),query:d,prep:(o,n)=>{const u=i(e,t,r);return Object.assign(u,{query:(e,t,i)=>{e=a.default.merge(o,e),t=a.default.merge(n,t);const r=l;l=u.getPageSize();const s=d(e,t,i);return l=r,s}})}};return s;async function d(i,s,c){const p=i?.body?JSON.stringify(i.body):void 0,f=e.slice(1).replaceAll(/\{([^}]+)\}/g,((e,t)=>encodeURIComponent(String(i?.params?.[t]??"")))),m=Object.entries(s??{}).map((([e,t])=>[e,"string"==typeof t?t:JSON.stringify(t)])).collect((e=>new URLSearchParams(e)));l&&m.set("page_size",`${l}`);const h=m.size?"?"+m.toString():"";let g,v,y=!0;for(let e=0;y&&e<u;e++){g=void 0,v=void 0,y=!1;const e=AbortSignal.timeout(n.default.seconds(7));v=await fetch(`${o.default.API_ORIGIN}${f}${h}`,{method:t,headers:a.default.filterNullish({...o.default.API_ORIGIN.includes("ngrok")?{"ngrok-skip-browser-warning":"true"}:void 0,"Content-Type":p?"application/json":void 0,Accept:"application/json","App-Build-Number":o.default.BUILD_NUMBER,"App-Build-SHA":o.default.BUILD_SHA,...r}),credentials:"include",body:p,signal:c?AbortSignal.any([e,c]):e}).catch((e=>{if("AbortError"===e.name||"TimeoutError"===e.name)return y=!0,void(g=Object.assign(new Error("Request timed out"),{code:408,data:null,headers:new Headers}));if("TypeError"===e.name&&/invalid URL|Failed to construct/.test(e.message))throw e;if("TypeError"===e.name||"NetworkError"===e.name)return y=!0,void(g=Object.assign(new Error("Network connection failed"),{code:503,data:null,headers:new Headers}));if(!g)throw e}))}if(g||!v)return g;const b=v.status;200!==b&&(g=Object.assign(new Error(v.statusText),{code:b,retry:()=>d(i)}),delete g.stack);const _={headers:v.headers};if(!v.body)return Object.assign(g??{},_);const w=v.headers.get("Content-Type");if("application/json"===w){const e=await v.json().catch((e=>{const t=e instanceof Error?e:new Error("Failed to parse JSON");Object.defineProperty(t,"code",{value:b,configurable:!0,writable:!0}),Object.defineProperty(t,"retry",{value:()=>d(i),configurable:!0}),g??=t,delete g.stack}));if(g)return Object.assign(g,e,_);return e.has_more&&Object.assign(e,{next:()=>d(i,{...s,...[...m].toObject(),page:+(m.get("page")??s?.page??e.page??0)+1}),getPage:e=>d(i,{...s,page:e})}),Object.assign(e,_)}throw new Error(`Response type ${w} is not supported`)}}Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),function(e){e.path=function(e){return`${o.default.API_ORIGIN.slice(0,-1)}${e}`}}(i||(i={})),t.default=i})),define("endpoint/manifest/EndpointFormInputLengths",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/manifest/form/lengths","get")})),define("model/FormInputLengths",["require","exports","endpoint/manifest/EndpointFormInputLengths","model/Manifest","utility/Time"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.default=(0,a.default)({cacheId:"form-input-lengths",valid:n.default.minutes(5),get:()=>o.default.query(),orElse(){const e={};return new Proxy({},{get:(t,o,a)=>e})}})})),define("model/ToSManager",["require","exports","lang/en-nz","model/Session","ui/Component","ui/component/core/Button","utility/Settings","utility/State"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=r.default.registerHiddenGroup("footer/heading/legal",{termsOfService:r.default.number({name:"document/legal/terms-of-service/title",default:-1,min:-1,step:1}),privacyPolicy:r.default.number({name:"document/legal/privacy-policy/title",default:-1,min:-1,step:1})});var s;!function(e){function t(){return{"privacy-policy":r("privacy-policy").at(-1),"terms-of-service":r("terms-of-service").at(-1)}}function r(e){const t=`document/legal/${e}/v`;return Object.keys(o.default).map((e=>e.startsWith(t)?+e.slice(t.length):void 0)).filterInPlace((e=>!isNaN(e))).sort(((e,t)=>e-t))}e.getLatestVersionNumbers=t,e.getDocumentVersions=r,e.ensureAccepted=async function(){const e=u.termsOfService.state.value??-1,o=u.privacyPolicy.state.value??-1,r=t();(e<r["terms-of-service"]||o<r["privacy-policy"])&&(await banner.queue((t=>{t.body.append((0,n.default)().text.use(e<0?"banner/legal-notification/initial":a.default.Auth.loggedIn.value?"banner/legal-notification/update-logged-in":"banner/legal-notification/update-logged-out"),(0,i.default)().type("icon","flush").setIcon("xmark").event.subscribe("click",t.dismiss));const o=l.default.Use(t,{tos:u.termsOfService.state,privacy:u.privacyPolicy.state}).use(t,(({tos:e=-1,privacy:a=-1})=>{if(e>=r["terms-of-service"]&&a>=r["privacy-policy"])return t.dismiss(),void o()}))})),u.termsOfService.state.value=r["terms-of-service"],u.privacyPolicy.state.value=r["privacy-policy"])}}(s||(s={})),t.default=s})),define("ui/view/ErrorView",["require","exports","lang/en-nz","ui/component/core/Heading","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=(0,l.default)({create:e=>{const t=(0,r.default)("error");e.code>=500&&e.error&&console.error(e.error),(0,a.default)().text.use((t=>t["view/error/title"]({CODE:e.code}))).appendTo(t.content);const l=`view/error/description-${e.code}`;return l in o.default?(0,n.default)().and(i.default).text.use(l).appendTo(t.content):(0,n.default)().and(i.default).text.set(e.error?.message??(e=>e["view/error/description-unknown"]())).appendTo(t.content),t}})})),define("ui/view/RequireLoginView",["require","exports","ui/component/core/ActionRow","ui/component/core/Block","ui/component/core/Button","ui/view/LoginView","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),t.default=(0,l.default)({create:()=>{const e=(0,r.default)("require-login"),t=(0,a.default)().appendTo(e.content);t.title.text.use("view/shared/login-required/title"),t.description.text.use("view/shared/login-required/description");const l=(0,o.default)().appendTo(t);return(0,n.default)().type("primary").text.use("view/shared/login-required/action").event.subscribe("click",(()=>navigate.ephemeral(i.default,void 0))).appendTo(l.right),e}})})),define("ui/view/shared/component/ViewContainer",["require","exports","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Dialog","ui/component/core/Loading","ui/view/ErrorView","ui/view/LoginView","ui/view/RequireLoginView","ui/view/shared/ext/ViewTransition","utility/State","utility/Task"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p);let f=0;t.default=()=>{let e;const t=(0,c.default)(void 0),m=(0,c.default)(!0);let h;const g=(0,a.default)().style("view-container").style.bind(m.falsy,"view-container--no-wrapper").tabIndex("programmatic").ariaRole("main").ariaLabel.use("view/container/alt").extend((a=>({state:t,wrapped:m,show:async(n,i)=>{const g=++f;let b,_;h?.remove(),h=c.default.Owner.create(),m.value=!1!==n.wrapper;const w=n.requiresLogin&&!o.default.Auth.loggedIn.value;if(w||n.load){let t;const a=d.default.perform("view",(async()=>{if(D(),!w)return;const a=function(){if(o.default.Auth.author.value)return;const t=v(u.default,void 0),a=t.then((async t=>{if(!t)return!1;const a=new Promise((t=>e=t));return await Promise.race([o.default.Auth.await(t),a]),e=void 0,o.default.Auth.loggedIn.value}));return{loginViewShown:t,authed:a}}();t=a?.authed,await(a?.loginViewShown)}));if(await a.updateCallbackDone,await t,w&&!o.default.Auth.loggedIn.value){let e;const t=new Promise((t=>e=t));d.default.perform("view",(async()=>{y();const t=await O(s.default);t&&o.default.Auth.loggedIn.subscribe(t,(t=>t&&e()))})),await t}}let k,T;if(a.style("view-container--loading"),n.load&&(k=(0,r.default)().setOwner(h).style("view-container-loading").prependTo(a)),await p.default.yield(),window.scrollTo({top:0,behavior:"smooth"}),n.load)try{const e=c.default.Async(h,(0,c.default)(i),n.load);k?.use(e),_=await e.promise}catch(e){T=e}if(k?.remove(),h?.remove(),h=void 0,a.style.remove("view-container--loading"),f===g&&"symbol"!=typeof _){if(a.state||g>1){const e=d.default.perform("view",x);await e.updateCallbackDone}else await x();return b}async function x(){D(),await O()}function D(){a.state?.value?.remove(),y()}async function O(e=n){const o=await(T?Promise.reject(T):Promise.resolve(e.create(i,_))).then((t=>(b=e===n?t:void 0,t))).catch((e=>l.default.create({code:(e.code<200?void 0:e.code)??600,error:e},{})));return o&&(o.prependTo(a),t.value=o,e===n&&(o.params=i)),o}},ephemeralDialog:(0,i.default)().style("view-container-ephemeral").tweak((e=>e.style.bind(e.opened,"view-container-ephemeral--open"))).setOwner(a).setNotModal().append((0,n.default)().setIcon("xmark").style("view-container-ephemeral-close").event.subscribe("click",(()=>{if(!e)return a.hideEphemeral();e()}))).appendTo(document.body),showEphemeral:async(e,t)=>{let o;const a=document.startViewTransition((async()=>o=await v(e,t)));return await a.updateCallbackDone,o},hideEphemeral:async()=>{const e=document.startViewTransition(y);await e.updateCallbackDone}})));return g;async function v(e,t){let o;g.ephemeral?.remove(),g.ephemeral=void 0,g.ephemeralOwner?.remove(),g.ephemeralOwner=c.default.Owner.create();const a=e.load?c.default.Async(g.ephemeralOwner,(0,c.default)(t),e.load).promise:void 0,n=await Promise.resolve(e.create(t,a)).then((e=>o=e)).catch((e=>l.default.create({code:e.code??600,error:e},{})));return n&&(n.prependTo(g.ephemeralDialog),g.ephemeral=n,g.ephemeralDialog.open(),g.attributes.append("inert"),g.ephemeralDialog.opened.subscribe(n,(e=>{e||y()}))),o}function y(){g.ephemeralDialog.close(),g.ephemeral?.remove(),g.ephemeral=void 0,g.ephemeralOwner?.remove(),g.ephemeralOwner=void 0,g.attributes.remove("inert")}}})),define("navigation/Navigate",["require","exports","navigation/Routes","ui/utility/EventManipulator","ui/view/ErrorView","utility/Env","utility/State"],(function(e,t,o,a,n,i,r){function l(){const e=(0,r.default)(location.href);let t;const l={state:e,event:void 0,isURL:e=>{const t=e.replace(/(?<=\/)\*(?!\*)/g,"[^/]*").replace(/\/\*\*/g,".*");return new RegExp(`^${t}$`).test(location.pathname)},fromURL:async()=>{if(location.href===t?.href)return;if(!u)throw new Error("Cannot navigate yet, no app instance");const a=t;let i;t=new URL(location.href),e.value=location.href;let r=!1;if(location.pathname!==a?.pathname){const e=location.pathname;let t=!1;for(const a of o.default){const o=a.match(e);if(o){i=a.path,await a.handler(u,Object.keys(o).length?o:void 0),t=!0;break}}t||(r=!0,await u.view.show(n.default,{code:404}))}if(location.hash&&!r){const e=location.hash.slice(1),t=document.getElementById(e);if(!t)return console.error(`No element by ID: "${e}"`),void(location.hash="");t.scrollIntoView(),t.focus()}l.event.emit("Navigate",i)},toURL:async e=>(l.setURL(e,!1),l.fromURL()),setURL:(e,o=!0)=>{const a=new URL(e,i.default.URL_ORIGIN);a.pathname===location.pathname&&a.search===location.search&&a.hash===location.hash||(history.pushState({},"",`${i.default.URL_ORIGIN}${a.pathname.slice(1)}${a.search}${a.hash}`),o&&(t=new URL(location.href)))},toRawURL:e=>{if(e.startsWith("http"))return location.href=e,!0;if(e.startsWith("/"))return l.toURL(e),!0;if(e.startsWith("#")){const t=e.slice(1);return document.getElementById(t)?(location.hash=e,!0):(console.error(`No element by ID: "${t}"`),!1)}return console.error(`Unsupported raw URL to navigate to: "${e}"`),!1},ephemeral:(...e)=>{if(!u)throw new Error("Cannot show ephemeral view yet, no app instance");return u.view.showEphemeral(...e)}};return Object.assign(l,{event:(0,a.default)(l)}),window.addEventListener("popstate",l.fromURL),Object.assign(window,{navigate:l}),l}let u;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),function(e){e.setApp=function(e){u=e}}(l||(l={})),t.default=l})),define("navigation/popup/PopupRoute",["require","exports"],(function(e,t){function o(e,t){return{route:e,handler:t}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.is=function(e){return"route"in e&&"handler"in e},e.match=function(e,t){return"string"==typeof e?e===t?[t]:void 0:t.match(e)??void 0},e.collect=function(...t){return t.reduce(((t,o)=>e.is(o)?(t.push(o),t):[...t,...o]),[])}}(o||(o={})),t.default=o})),define("navigation/popup/PopupAuthRoutes",["require","exports","model/DangerToken","navigation/popup/PopupRoute","utility/Store"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.default=a.default.collect((0,a.default)(/\/auth\/(.*)\/error/,(()=>{const e=new URLSearchParams(location.search);n.default.items.popupError={code:+(e.get("code")??"500"),message:e.get("message")??"Internal Server Error"},window.close()})),(0,a.default)(/\/auth\/(.*)\/ok/,(()=>{const e=new URLSearchParams(location.search);o.default.handleAuthParams(e),window.close()})))})),define("navigation/popup/PopupRoutes",["require","exports","navigation/popup/PopupAuthRoutes","navigation/popup/PopupRoute"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),t.default=a.default.collect(o.default)})),define("ui/component/AppBanner",["require","exports","ui/Component","utility/Async","utility/State"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),t.AppBannerQueue=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),t.AppBannerQueue=o.default.Builder((e=>{Object.assign(window,{banner:e});const t=(0,n.default)(!1),o=[];return e.style("app-banner-container").extend((e=>({state:t,queue:e=>{let n;const i=new Promise((e=>n=e));return o.push([e,n]),t.value||a(),i}})));function a(){const n=o.shift();if(!n)return void(t.value=!1);const[r,l]=n;t.value=!0;i().tweak(r).appendTo(e).dismissed.match(e,!0,(()=>{l(),a()}))}}));const i=o.default.Builder((e=>{const t=(0,n.default)(!1);e.onRemoveManual((()=>t.value=!0));const i=(0,o.default)().style("app-banner-body");return e.style("app-banner").style.bind(t,"app-banner--dismissed").append(i).extend((e=>({dismissed:t,body:i,dismiss:()=>{t.value=!0,a.default.sleep(500).then(e.remove)}})))}));t.default=i})),define("ui/component/PrimaryNav",["require","exports","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Slot","ui/utility/StringApplicator","utility/Env"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),s=__importDefault(s),t.default=a.default.Builder((e=>{e.style("primary-nav");const t=(0,a.default)().style("primary-nav-top").appendTo(e),d=(0,a.default)().style("primary-nav-bottom").appendTo(e);function c(e,o){return(0,a.default)().style("primary-nav-group").append((0,i.default)().style("primary-nav-group-heading").style.remove("heading").text.use(o)).extend((e=>({add:u(e),using:(t,o)=>((0,l.default)().use(t,((e,t)=>o(Object.assign(e,{add:u(e)}),t))).appendTo(e),e)}))).tweak((o=>null!==e&&o.appendTo("top"===e?t:d)));function u(e){return(t,o,a)=>((0,r.default)(t).and(n.default).style("primary-nav-link").type("flush").text.use(o).override("setIcon",((e,t)=>e=>t(e).tweak((e=>e.icon?.style("primary-nav-link-icon"))))).tweak((e=>e.style.bind(e.disabled,"button--disabled","primary-nav-link--disabled"))).tweak((e=>e.textWrapper.style("primary-nav-link-text"))).tweak(a).appendTo(e),e)}}return c("top","sidebar/section/browse").add("/","sidebar/link/new",(e=>e.setIcon("calendar-plus"))).using(o.default.Auth.author,((e,t)=>e.add("/feed","sidebar/link/feed",(e=>e.setIcon("heart").setDisabled(!t,"no author"))).add("/history","sidebar/link/history",(e=>e.setIcon("clock-rotate-left").setDisabled(!t,"no author"))).add("/search","sidebar/link/search",(e=>e.setIcon("magnifying-glass").setDisabled(!t,"no author"))))),(0,l.default)().use(o.default.Auth.account,((e,t)=>t&&c("top","sidebar/section/create").tweak((e=>{for(const o of t.works??[])e.add(`/work/${o.author}/${o.vanity}`,u.Quilt.fake(o.name),(e=>e.setIcon("book")))})).add("/work/new","sidebar/link/create-work",(e=>e.setIcon("plus"))))).appendTo(t),(0,l.default)().if(o.default.Auth.privileged.TagGlobalDelete,(()=>c("top","sidebar/section/manage").add("/manage/tags","sidebar/link/tags",(e=>e.setIcon("tag"))))).appendTo(t),c("bottom","sidebar/section/profile").using(o.default.Auth.author,((e,t)=>{t?e.add(`/author/${t.vanity}`,u.Quilt.fake(t.name),(e=>e.setIcon("circle-user").ariaLabel.use((e=>e["sidebar/link/profile"](t.name))))).add("/account","sidebar/link/settings",(e=>e.setIcon("id-card"))):e.add("/account","sidebar/link/login",(e=>e.setIcon("circle-user")))})),"dev"===s.default.ENVIRONMENT&&c("bottom","sidebar/section/dev").add("/debug","sidebar/link/debug",(e=>e.setIcon("bug"))),e}))})),define("endpoint/search/EndpointSearchGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/search","get")})),define("ui/component/Search",["require","exports","endpoint/search/EndpointSearchGet","model/Session","model/Tags","ui/Component","ui/component/Author","ui/component/AuthorLink","ui/component/core/Button","ui/component/core/ext/GradientText","ui/component/core/Heading","ui/component/core/Icon","ui/component/core/Link","ui/component/core/Loading","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Slot","ui/component/core/Small","ui/component/core/TextInput","ui/component/popover/PopoverBlock","ui/component/Work","ui/utility/Viewport","utility/AbortPromise","utility/Async","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T,x){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importDefault(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),t.default=i.default.Builder((e=>{const t=(0,y.default)().style("search-input").placeholder.use("masthead/placeholder/search"),D=(0,x.default)(void 0),O=(0,x.default)(!1),S=(0,b.default)().style("search-popover").setOwner(e).anchor.from(e).anchor.reset().anchor.add("sticky centre","off bottom").anchor.orElseHide().tweak((e=>{e.header.style("search-popover-header");const o=(0,i.default)().style("search-popover-state-wrapper").appendTo(e);(0,u.default)().style("search-popover-retry-button").text.bind(w.default.mobile.map(e,(e=>t=>t[e?"search/action/again/short":"search/action/again"]()))).event.subscribe("click",(()=>I())).appendToWhen(O.falsy,o),(0,f.default)().style("search-popover-loading").tweak((e=>e.enabled.bind(e,O))).tweak((e=>e.flag.style("search-popover-loading-flag"))).appendToWhen(O,o);const c=(0,i.default)().style("search-popover-sections-wrapper").appendTo(e),y=i.default.Builder((e=>{e.style("search-popover-section");const t=(0,d.default)().setAestheticStyle(!1).style("search-popover-section-title").appendTo(e),o=(0,g.default)().style("search-popover-section-content").appendTo(e);return e.extend((e=>({title:t,titleText:t.text.rehost(e),content:o,handle:t=>(o.use(D,t),e)})))})),b=i.default.Builder("a",((e,t)=>e.and(u.default).and(p.default,t).type("flush").style("search-popover-result").extend((e=>({title:void 0,titleText:void 0,subtitle:void 0,subtitleText:void 0,description:void 0,descriptionText:void 0,details:void 0}))).extendJIT("title",(e=>(0,d.default)().setAestheticStyle(!1).style("search-popover-result-title").prependTo(e))).extendJIT("titleText",(e=>e.title.text.rehost(e))).extendJIT("subtitle",(t=>(0,i.default)().style("search-popover-result-subtitle").insertTo(e,"after",t.title))).extendJIT("subtitleText",(e=>e.subtitle.text.rehost(e))).extendJIT("description",(t=>(0,m.default)().and(h.default).style("search-popover-result-description").appendTo(e))).extendJIT("descriptionText",(e=>e.description.text.rehost(e))).extendJIT("details",(t=>(0,i.default)().style("search-popover-result-details").appendTo(e))))),T=i.default.Builder((e=>e.and(m.default).and(v.default).and(h.default).style("search-popover-no-results").text.use("search/none")));y().titleText.use("search/section/works/title").tweak((e=>(0,p.default)(t.state.map(e,(e=>`/search?search=${encodeURIComponent(e)}`))).and(u.default).style("search-popover-advanced-link").text.use("search/action/advanced").appendToWhen(a.default.Auth.loggedIn,e.title))).handle(((e,t)=>{if(!t?.works.length)return T();for(const o of t?.works??[]){const a=t.authorData.find((e=>e.vanity===o.author));b(`/work/${o.author}/${o.vanity}`).titleText.set(o.name).tweak((e=>a&&e.subtitle.append((0,l.default)(a)))).descriptionText.set(o.description).tweak((e=>e.description.style("search-popover-result-description--work"))).tweak((e=>e.details.and(_.WorkFooter,o).tweak((t=>{t.left.style("search-popover-result-details-left"),t.right.style("search-popover-result-details-right"),t.status.use(t,(e=>e.style("search-popover-result-work-status"))),t.statusIcon.use(t,(e=>e.style("search-popover-result-work-status-icon"))),t.chapterCount.style("search-popover-result-work-chapter-count"),t.wordCount?.style("search-popover-result-work-word-count"),t.timestamp.use(t,(e=>e?.style("search-popover-result-work-timestamp"))),x.default.Map(t,[t.timestamp,t.timestampAlternative],((e,t)=>e??t)).use(t,(t=>t?.appendTo(e.subtitle)))})))).appendTo(e)}})).appendTo(c),y().titleText.use("search/section/authors/title").handle(((e,t)=>{const o=t?.authors.map((e=>t.authorData.find((t=>t.vanity===e)))).filter((e=>void 0!==e));if(!o?.length)return T();for(const t of o)b(`/author/${t.vanity}`).titleText.set(t.name).tweak((e=>e.title.textWrapper.and(s.default).useGradient(t.supporter?.username_colours))).tweak((e=>e.subtitle.append((0,r.AuthorSubtitle)(t)))).tweak((e=>e.details.and(r.AuthorFooter,t).tweak((e=>{e.left.style("search-popover-result-details-left"),e.right.style("search-popover-result-details-right"),e.workCount?.style("search-popover-result-author-work-count"),e.wordCount?.style("search-popover-result-author-word-count"),e.timeJoin.remove()})))).appendTo(e)})).appendTo(c),y().style("search-popover-section--tags").titleText.use("search/section/tags/title").handle(k.default.asyncFunction((async(e,o)=>{const a=await n.default.getManifest();if(e.aborted)return;const i=t.value.toLowerCase(),r=Object.keys(a.tags).filter((e=>e.toLowerCase().includes(i))).map((e=>a.tags[e]));if(!r.length)return T();for(const e of r)b(`/tag/${e.categoryLowercase}/${e.nameLowercase}`).titleText.set(`${e.category}: ${e.name}`).tweak((t=>t.description.style("search-popover-result-description--tag").setMarkdownContent(e.description))).appendTo(o)}))).appendTo(c)})).appendTo(document.body);let E,M;return navigate.state.subscribe(e,(()=>{t.value="",S.hide()})),t.event.subscribe("keydown",(e=>{"Enter"===e.key&&S.focus()})),t.state.subscribeManual((e=>{e.length<3||function(){if(!E)return void I();const e=Math.max(0,E+1e3-Date.now());if(!e)return void I();clearTimeout(M),M=window.setTimeout(I,e)}()})),x.default.UseManual({focused:t.hasFocused,longEnough:t.state.mapManual((e=>e.length>2))}).useManual((async({focused:e,longEnough:t})=>{e&&t?(S.show(),S.anchor.apply(),await T.default.sleep(50),S.anchor.apply(),C()):t||S.hide()})),e.style("search").append((0,c.default)("magnifying-glass").style("search-icon")).append(t).onRooted((()=>{w.default.size.use(S,C)}));async function I(){E=Date.now(),O.value=!0,D.value=t.value.length<3?void 0:await o.default.query(void 0,{text:t.value}).then((e=>e.data??void 0)).catch((()=>{})),O.value=!1}function C(){S.style.setProperty("width",`${e.element.clientWidth}px`)}}))})),define("ui/component/SettingsDialog",["require","exports","ui/Component","ui/component/core/BlockDialog","ui/component/core/Button","ui/component/core/Checkbutton","ui/component/core/Heading","ui/component/core/LabelledTable","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/RangeInput","ui/component/core/TextInput","utility/maths/Vector2","utility/Settings"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f);const m=o.default.Builder((e=>{const t=e.and(a.default);t.title.text.use("settings/title"),t.description.text.use("settings/description"),(0,u.default)().and(s.default).style("settings-dialog-hint").text.use("settings/hint/account").appendTo(t.content);for(const h of f.default.get()){if(h.hidden)continue;const g=(0,o.default)().style("settings-dialog-group").appendTo(t.content);(0,r.default)().style("settings-dialog-group-heading").text.use(h.name).appendTo(g);const v=(0,l.default)().style("settings-dialog-group-content").appendTo(g);for(const y of h.settings){function b(){switch(y.type){case"boolean":return(0,i.default)().style("settings-dialog-setting-button").setChecked(y.state.value??y.default).text.use(y.description).event.subscribe("SetChecked",((e,t)=>y.state.value=t)).tweak((e=>{y.state.subscribe(e,(t=>e.setChecked(t??y.default)))}));case"number":return y.max?(0,d.default)(y.min??0,y.max,y.step).default.set(y.default).tweak((e=>{e.state.value=y.state.value??y.default,e.state.useManual((e=>y.state.value=e)),y.state.subscribe(e,(t=>e.state.value=t))})):(0,c.default)().filter(((...e)=>e.map((e=>e.replace(/[^0-9]/g,"")))));case"string":return(0,c.default)()}}v.label((e=>e.text.use(y.name))).content(((e,t,o)=>{o.style("settings-dialog-setting"),e.style("settings-dialog-setting-content"),b().setLabel(t).appendTo(e),(0,n.default)().setIcon("rotate-reverse").event.subscribe("click",(()=>y.state.value=void 0)).appendTo(e)}))}}return(0,n.default)().type("primary").text.use("shared/action/done").event.subscribe("click",(()=>t.close())).appendTo(t.footer.right),t.opened.useManual((e=>{e?document.addEventListener("mousedown",m):document.removeEventListener("mousedown",m)})),t.extend((e=>({})));function m(e){t.rect.value.intersects(p.default.fromClient(e))||t.close()}}));t.default=m})),define("ui/component/Sidebar",["require","exports","ui/Component","utility/State","utility/Store"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder("nav",(e=>{e.style("sidebar").ariaLabel.use("masthead/primary-nav/alt");const t=a.default.Generator((()=>!!n.default.items.sidebar));return o(),e.extend((e=>({state:t,toggle:()=>(n.default.items.sidebar=!n.default.items.sidebar,t.refresh(),o(),e)})));function o(){e.style.toggle(!!n.default.items.sidebar,"sidebar--visible")}}));t.default=i})),define("ui/component/Masthead",["require","exports","model/Notifications","model/Session","ui/Component","ui/component/core/Button","ui/component/core/Dialog","ui/component/core/Flag","ui/component/core/Link","ui/component/core/Slot","ui/component/NotificationList","ui/component/PrimaryNav","ui/component/Search","ui/component/SettingsDialog","ui/component/Sidebar","ui/utility/Viewport","utility/AbortPromise","utility/Env","utility/State"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y){Object.defineProperty(t,"__esModule",{value:!0}),t.MastheadFlush=t.HomeLink=void 0,o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y);const b="_masthead",_=n.default.Builder("header",((e,l)=>{e.style("masthead").classes.add(b).style.bind(l.wrapped.falsy,"masthead--view-no-wrapper");const v=(0,m.default)().style.bind(l.wrapped.falsy,"sidebar--view-no-wrapper"),_=(0,c.default)();(0,i.default)().style("masthead-skip-nav").text.use("masthead/skip-navigation").event.subscribe("click",l.focus).appendTo(e);const w=(0,y.default)(void 0),k=(0,n.default)().append((0,n.default)().and(i.default).setIcon("bars").type("icon").style("masthead-left-hamburger","masthead-left-hamburger-sidebar").ariaHidden().event.subscribe("click",v.toggle)).append((0,i.default)().setIcon("bars").type("icon").style("masthead-left-hamburger","masthead-left-hamburger-popover").ariaLabel.use("masthead/primary-nav/alt").clearPopover().setPopover("hover/click",(e=>w.value=e.style("primary-nav-popover").anchor.add("aligned left","off bottom").anchor.add("aligned left","off top").ariaRole("navigation")))).style("masthead-left").appendTo(e);let T;v.style.bind(e.hasFocused,"sidebar--visible-due-to-keyboard-navigation");const x=(0,n.default)(),D=(e=!!v.element.clientWidth)=>_.style.toggle(e,"primary-nav--sidebar").appendTo(e?v:w.value??x);return h.default.size.use(e,(()=>{window.clearTimeout(T),T=window.setTimeout(D,1)})),w.subscribeManual((()=>D())),(0,t.HomeLink)().style("masthead-home-wrapper").appendTo(k),(0,p.default)().style("masthead-search").appendTo(e),(0,s.default)().style.remove("slot").style("masthead-user").if(a.default.Auth.loggedIn,(e=>e.append((0,i.default)().setIcon("bell").type("icon").style("masthead-user-notifications").clearPopover().ariaLabel.use("masthead/user/notifications/alt").append((0,s.default)().use(o.default.unreadCount,((e,t)=>t?(0,n.default)().style("masthead-user-notifications-badge").text.set(`${t}`):void 0))).setPopover("hover/click",(e=>e.style("masthead-user-notifications-popover").anchor.add("aligned right","off bottom").anchor.add("aligned left",`.${b}`,"off top").append((0,s.default)().use(o.default.cache,g.default.asyncFunction((async(e,t,o)=>{const a=await(0,d.default)(!0,5);if(!e.aborted){a.paginator.type("flush").style("masthead-user-notifications-list"),a.paginator.header.style("masthead-user-notifications-list-header"),a.paginator.title.style("masthead-user-notifications-list-title"),a.paginator.content.style("masthead-user-notifications-list-content"),a.paginator.footer.style("masthead-user-notifications-list-footer");for(const e of a.paginator.primaryActions.getChildren())e.is(i.default)&&e.style("masthead-user-notifications-list-action");(0,u.default)("/notifications").and(i.default).type("flush").text.use("masthead/user/notifications/link/label").appendTo(a.paginator.footer.middle),a.appendTo(t)}}))))))).append((0,i.default)().setIcon("circle-user").type("icon").clearPopover().ariaLabel.use("masthead/user/profile/alt").setPopover("hover/click",(e=>e.anchor.add("aligned right","off bottom").anchor.add("aligned right","off top").ariaRole("navigation").append((0,s.default)().style("action-group").style.remove("slot").use(a.default.Auth.author,((e,t)=>{t&&((0,u.default)(`/author/${t.vanity}`).and(i.default).type("flush").style("masthead-popover-link-button").tweak((e=>e.textWrapper.style("masthead-popover-link-button-text"))).setIcon("circle-user").text.set(t.name).ariaLabel.use((e=>e["masthead/user/profile/popover/profile"](t.name))).appendTo(e),(0,u.default)("/account").and(i.default).type("flush").style("masthead-popover-link-button").setIcon("id-card").text.use("masthead/user/profile/popover/account").appendTo(e),(0,i.default)().type("flush").style("masthead-popover-link-button").setIcon("arrow-right-from-bracket").text.use("view/account/action/logout").event.subscribe("click",(()=>a.default.reset())).appendTo(e))})))))).append((0,i.default)().setIcon("gear").type("icon").clearPopover().ariaLabel.use("masthead/user/settings/alt").event.subscribe("click",(()=>(0,f.default)().tweak(r.default.await)))))).else((()=>(0,i.default)().style("masthead-user-action-login").type("primary").setIcon("circle-user").text.use("masthead/action/login").event.subscribe("click",(()=>navigate.toURL("/login"))))).appendTo(e),e.extend((e=>({sidebar:v,flush:(0,t.MastheadFlush)().style.bind(l.wrapped.falsy,"masthead--view-no-wrapper")})))}));t.default=_,t.HomeLink=n.default.Builder("a",(e=>{const t=(0,l.default)().style("masthead-home-logo"),o=e.and(u.default,"/").ariaLabel.use("home/label").style("masthead-home-link").clearPopover(),a=(0,n.default)().and(i.default).style("masthead-home","heading").append(t).append((0,n.default)("img").style("masthead-home-logo-wordmark").ariaHidden().attributes.set("src",`${v.default.URL_ORIGIN}image/logo-wordmark.svg`)).append((0,n.default)().style("masthead-home-logo-beta").text.use("masthead/label/beta")).appendTo(o);return t.style.bind(o.hoveredOrFocused,"flag--focused"),t.style.bind(o.active,"flag--active"),o.hoveredOrFocused.subscribeManual((e=>t.wave("home link focus",e))),o.extend((e=>({button:a})))})),t.MastheadFlush=n.default.Builder("header",(e=>e.style("masthead-flush").append((0,t.HomeLink)())))})),define("ui/component/AppFooter",["require","exports","ui/Component","ui/component/core/ExternalLink","ui/component/core/Heading","ui/component/core/Link","ui/component/core/Paragraph","ui/component/core/Placeholder","ui/component/core/Small","ui/component/Masthead","utility/Env"],(function(e,t,o,a,n,i,r,l,u,s,d){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),d=__importDefault(d),t.default=o.default.Builder((e=>{const t=()=>(0,o.default)().style("app-footer-column"),c=()=>(0,o.default)().style("app-footer-column-section"),p=()=>(0,n.default)().setAestheticStyle(!1).style("app-footer-column-heading"),f=e=>(0,i.default)(e).style("app-footer-column-link"),m=e=>(0,a.default)(e).style("app-footer-column-link");return t().style("app-footer-column-site").append(c().append((0,s.HomeLink)().style("app-footer-wordmark").tweak((e=>e.button.style("app-footer-wordmark-button")))).append((0,r.default)().and(l.default).text.use("fluff4me/tagline"))).append(c().append((0,l.default)().and(u.default).text.use((e=>e["footer/other/copyright"]({YEAR:(new Date).getFullYear()}))))).append((0,a.default)(void 0).style("app-version").attributes.bind("href",d.default.state.mapManual((e=>e?.BUILD_SHA?`https://github.com/fluff4me/fluff4.me/commit/${e.BUILD_SHA}`:void 0))).text.bind(d.default.state.mapManual((e=>e?e.BUILD_SHA?`v${e.BUILD_NUMBER} (${e.BUILD_SHA?.slice(0,7)})`:"dev":"")))).appendTo(e),t().append(p().text.use("footer/heading/site")).append(c().append(f("/about").text.use("footer/link/about")).append(f("/about/roadmap").text.use("footer/link/roadmap")).append(f("/about/supporters").text.use("footer/link/supporters"))).appendTo(e),t().append(p().text.use("footer/heading/support")).append(c().append(f("/contact").text.use("footer/link/contact")).append(m("https://discord.gg/KrXfDtn").text.use("footer/link/bug-reports")).append(m("https://discord.gg/KrXfDtn").text.use("footer/link/feature-requests")).append(f("/contact").text.use("footer/link/responsible-disclosure"))).appendTo(e),t().append(p().text.use("footer/heading/legal")).append(c().append(f("/legal/terms").text.use("footer/link/terms-of-service")).append(f("/legal/privacy").text.use("footer/link/privacy-policy"))).appendTo(e),e.style("app-footer")}))})),define("ui/component/core/HashLink",["require","exports","ui/Component","ui/utility/MarkdownContent"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=o.default.Builder((e=>e.style("link","link-hash")));a.default.handle(((e,t)=>{if("A"!==e.tagName)return;const a=e.getAttribute("href");return a?.startsWith("#")?()=>{(0,o.default)().replaceElement(e,!0).and(n)}:void 0})),t.default=n})),define("ui/component/core/Tooltip",["require","exports","ui/Component","ui/component/core/Popover"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a);const n=Object.assign(o.default.Builder((e=>e.and(a.default).setDelay(300).setMousePadding(0).style("tooltip").anchor.add("aligned left","off bottom").anchor.add("aligned left","off top").anchor.add("aligned right","off bottom").anchor.add("aligned right","off top"))),{initExtension(){o.default.extend((e=>{e.extend((e=>({setTooltip:t=>e.setPopover("hover/longpress",((e,o)=>t(e.and(n),o)))})))}))}});t.default=n})),define("ui/component/Mention",["require","exports","ui/Component","ui/component/core/ext/GradientText","ui/component/core/Link","ui/component/popover/AuthorPopover","ui/utility/MarkdownContent","utility/string/MarkdownItHTML"],(function(e,t,o,a,n,i,r,l){Object.defineProperty(t,"__esModule",{value:!0}),t.registerMarkdownMentionHandler=function(){l.default.defaultOptions.voidElements.push("mention"),l.default.defaultOptions.allowedTags.push("mention"),l.default.defaultOptions.perTagAllowedAttributes.mention=["vanity"],r.default.handle(((e,t)=>{if("MENTION"===e.tagName)return()=>{const o=e.getAttribute("vanity"),a=t.mentions?.find((e=>e.vanity===o)),n=u(a);e.replaceWith(n.element)}}))},o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l);const u=o.default.Builder("a",((e,t)=>e.and(n.default,t&&`/author/${t.vanity}`).append((0,o.default)().style("mention-punctuation").text.set("@")).append((0,o.default)().style("mention-author-name").text.set(t?.name??(e=>e["shared/mention/unresolved"]()))).setPopover("hover/longpress",(e=>t&&e.and(i.default,t))).style("mention").and(a.default).useGradient(t?.supporter?.username_colours)));t.default=u})),define("ui/component/popover/TagPopover",["require","exports","ui/Component","ui/component/core/Popover","ui/component/popover/PopoverBlock","ui/component/Tag","ui/component/TagBlock"],(function(e,t,o,a,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r);const l=o.default.Builder(((e,t)=>e.and(a.default).setDelay(500).and(n.default).tweak((e=>e.visible.matchManual(!0,(()=>{e.and(r.default,t)}))))));t.default=Object.assign(l,{register(){i.default.extend((e=>{if("object"==typeof e.tag){const t=e.tag;e.clearPopover().setPopover("hover/longpress",(e=>e.and(l,t)))}return{}}))}})})),define("ui/utility/ActiveListener",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t=[];e.allActive=function(){return t},e.active=function(){return t.at(-1)},e.allActiveComponents=function*(){for(const e of t){const t=e.component;t&&(yield t)}},e.activeComponent=function(){return t.at(-1)?.component},e.listen=function(){function e(){const e=document.querySelectorAll(":active");if(e[e.length-1]===t[t.length-1])return;const o=[...e];for(const e of t)e.component&&!o.includes(e)&&e.component.activeTime.asMutable?.setValue(void 0);for(const e of o)e.component&&!t.includes(e)&&e.component.activeTime.asMutable?.setValue(Date.now());t=o}document.addEventListener("mousedown",e),document.addEventListener("mouseup",e)}}(o||(o={})),t.default=o,Object.assign(window,{ActiveListener:o})})),define("ui/utility/SiteStatusListener",["require","exports","model/SiteStatus","ui/Component","ui/component/core/Button","ui/component/core/Link","ui/component/core/Slot","ui/component/FundraiserBar","ui/utility/PageListener","utility/Env","utility/State","utility/Store","utility/Time"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p){var f;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),p=__importDefault(p),function(e){const t=(0,d.default)(!c.default.items.status?.dismissed);function f(){const e=c.default.items.status??{dismissed:!1,lastActive:Date.now()};e.dismissed&&Date.now()-e.lastActive>p.default.hours(2)&&(e.dismissed=!1,t.value=!0),e.lastActive=Date.now(),c.default.items.status=e}e.listen=function(){f(),u.default.visible.subscribeManual(f),navigate.state.subscribeManual(f),t.useManual((async e=>{e&&(s.default.isDev||(await o.default.getManifest(),await banner.queue((e=>{e.body.style("view-type-fundraiser-banner"),(0,r.default)().appendTo(e.body).use(o.default,((t,o)=>{const n=o?.fundraisers[0];n&&((0,i.default)("/fundraiser").text.use("fundraiser/title").event.subscribe("Navigate",(()=>{e.dismiss()})).appendTo(t),(0,a.default)().style("view-type-fundraiser-progress-bar-wrapper").append((0,l.default)(n.monthly_income,1e5,"monthly")).append((0,l.default)(n.funds_raised,n.thresholds[0],"total").style("view-type-fundraiser-progress-bar--total")).appendTo(t))})),(0,n.default)().style("view-type-fundraiser-banner-dismiss-button").type("icon","flush").setIcon("xmark").event.subscribe("click",e.dismiss).appendTo(e.body),e.dismissed.matchManual(!0,(()=>{c.default.items.status={dismissed:!0,lastActive:Date.now()},t.value=!1}))}))))}))}}(f||(f={})),t.default=f})),define("App",["require","exports","lang/en-nz","model/FormInputLengths","model/Notifications","model/Session","model/ToSManager","navigation/Navigate","navigation/popup/PopupRoute","navigation/popup/PopupRoutes","style","ui/Component","ui/component/AppBanner","ui/component/AppFooter","ui/component/core/ExternalLink","ui/component/core/HashLink","ui/component/core/Link","ui/component/core/toast/ToastList","ui/component/core/Tooltip","ui/component/Masthead","ui/component/Mention","ui/component/popover/TagPopover","ui/InputBus","ui/utility/ActiveListener","ui/utility/FocusListener","ui/utility/FontsListener","ui/utility/HoverListener","ui/utility/MarkdownContent","ui/utility/Mouse","ui/utility/SiteStatusListener","ui/utility/StringApplicator","ui/utility/Viewport","ui/view/shared/component/ViewContainer","utility/DevServer","utility/Env","utility/State","utility/string/Strings"],(function(e,t,o,a,n,i,r,l,u,s,d,c,p,f,m,h,g,v,y,b,_,w,k,T,x,D,O,S,E,M,I,C,R,P,A,j,N){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),d=__importDefault(d),c=__importDefault(c),f=__importDefault(f),m=__importDefault(m),h=__importDefault(h),g=__importDefault(g),v=__importDefault(v),y=__importDefault(y),b=__importStar(b),w=__importDefault(w),k=__importDefault(k),T=__importDefault(T),x=__importDefault(x),D=__importDefault(D),O=__importDefault(O),S=__importDefault(S),E=__importDefault(E),M=__importDefault(M),C=__importDefault(C),R=__importDefault(R),P=__importDefault(P),A=__importDefault(A),j=__importDefault(j),N=__importDefault(N),location.href.includes("localhost")&&A.default.isNgrok&&(location.href=A.default.URL_ORIGIN+location.pathname.slice(1)),I.QuiltHelper.init({Component:c.default,Link:g.default,ExternalLink:m.default}),h.default,S.default.registerMarkdownHandlers(),(0,_.registerMarkdownMentionHandler)(),w.default.register(),y.default.initExtension(),t.default=async function(){for(const{route:e,handler:t}of s.default){const o=u.default.match(e,location.pathname);o&&t(o)}await(screen?.orientation?.lock?.("portrait-primary").catch((()=>{}))),k.default.subscribe("down",(e=>{if(e.use("F6"))for(const e of document.querySelectorAll("link[rel=stylesheet]")){const t=e.getAttribute("href"),o=`${t.slice(0,Math.max(0,t.indexOf("?"))||1/0)}?${Math.random().toString().slice(2)}`;e.setAttribute("href",o)}e.use("F4")&&document.documentElement.classList.add("persist-tooltips")})),k.default.subscribe("up",(e=>{e.use("F4")&&document.documentElement.classList.remove("persist-tooltips")})),c.default.allowBuilding(),a.default.getManifest(),i.default.init();const e=(0,l.default)();O.default.listen(),T.default.listen(),x.default.listen(),E.default.listen(),C.default.listen(),D.default.listen(),P.default.connect(),document.title=o.default["fluff4me/title"]().toString(),document.body.classList.add(...d.default.body);const t=(0,R.default)(),m=(0,b.default)(t);j.default.UseManual({viewTitle:t.state.mapManual((e=>e?.titleComponent)).mapManual((e=>e?.text.state)),returnTo:t.state.mapManual((e=>e?.breadcrumbs.backButton)).mapManual((e=>e?.subText.state)),notificationCount:n.default.unreadCount}).mapManual((({viewTitle:e,returnTo:t,notificationCount:a})=>{document.title=o.default["fluff4me/title"]({NOTIFICATIONS:a,PAGE:e,PAGE2:N.default.areSameWords(e??void 0,t??void 0)?void 0:t}).toString()}));const h=(0,c.default)().style("app-content-related");(0,f.default)().style.bind(m.sidebar.state.falsy,"app-footer--no-sidebar").style.bind(t.wrapped.falsy,"app-footer--view-no-wrapper").appendTo(t);const g=(0,c.default)().style("app-content").append(t,h);c.default.getBody().monitorScrollEvents(),c.default.getDocument().monitorScrollEvents(),c.default.getWindow().monitorScrollEvents();const y=(0,p.AppBannerQueue)().style.bind(t.wrapped.falsy,"app-banner-container--view-no-wrapper"),_=(0,b.HomeLink)().style("app-no-wrapper-home-link").tweak((e=>e.button.style("app-no-wrapper-home-link-button"))),w=(0,c.default)().style("app").style.bind(y.state,"app--has-banner").style.bind(t.wrapped.falsy,"app--view-no-wrapper").appendWhen(t.wrapped.falsy,_).append(m.flush,m,y,m.sidebar,g).append((0,v.default)()).extend((o=>({navigate:e,view:t}))).tweak(l.default.setApp).appendTo(document.body);return Object.assign(window,{app:w}),A.default.isNgrok&&(0,c.default)().style("app-qrcode").tweak((async e=>{const t=await QRCode.toDataURL(A.default.URL_ORIGIN,{color:{dark:"#fff",light:"#0000"}});e.style.setProperty("background-image",`url(${t})`)})).appendTo(document.body),r.default.ensureAccepted(),M.default.listen(),await w.navigate.fromURL(),w}})),define("Constants",["require","exports"],(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.APP_NAME=void 0,t.APP_NAME="fluff4.me / Queer Webnovels"})),define("utility/DOMRect",["require","exports","utility/Define","utility/maths/Vector2"],(function(e,t,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){o.default.magic(DOMRect.prototype,"centreX",{get(){return this.left+this.width/2}}),o.default.magic(DOMRect.prototype,"centreY",{get(){return this.top+this.height/2}}),o.default.magic(DOMRect.prototype,"centre",{get(){return(0,a.default)(this.left+this.width/2,this.top+this.height/2)}}),o.default.magic(DOMRect.prototype,"position",{get(){return(0,a.default)(this.left,this.top)}}),(0,o.default)(DOMRect.prototype,"expand",(function(e){return new DOMRect(this.x-e,this.y-e,this.width+2*e,this.height+2*e)})),(0,o.default)(DOMRect.prototype,"contract",(function(e){return new DOMRect(Math.min(this.x+e,this.centreX),Math.min(this.y-e,this.centreY),Math.max(0,this.width-2*e),Math.max(0,this.height-2*e))})),(0,o.default)(DOMRect.prototype,"intersects",(function(e){return"width"in e?this.left>=e.right&&this.right<=e.left&&this.top>=e.bottom&&this.bottom<=e.top:this.left<=e.x&&this.right>=e.x&&this.top<=e.y&&this.bottom>=e.y}))},o=__importDefault(o),a=__importDefault(a)})),define("utility/Elements",["require","exports","utility/Define"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.applyPrototypes=function(){o.default.set(Element.prototype,"asType",(function(e){return this.tagName.toLowerCase()===e?this:void 0})),Element.prototype.computedStyleMap||o.default.set(Element.prototype,"computedStyleMap",(function(){const e=getComputedStyle(this);return{get(t){const o=e.getPropertyValue(t);return o?{toString:()=>o}:void 0}}}))}}(a||(a={})),t.default=a})),define("utility/Maps",["require","exports","utility/Define"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.applyPrototypes=function(){(0,o.default)(Map.prototype,"compute",(function(e,t){if(this.has(e))return this.get(e);const o=t(e);return this.set(e,o),o}))}}(a||(a={})),t.default=a})),define("utility/Ranges",["require","exports","utility/Define"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){e.applyPrototypes=function(){(0,o.default)(Range.prototype,"replaceContents",(function(...e){this.deleteContents();let t=this.endContainer;const o=[];for(const a of e.reverse()){const e=t.nextSibling;t=a,this.insertNode(a);const n=a.nextSibling;n&&n!==e&&o.push(n)}for(const e of o)e.remove()}))}}(a||(a={})),t.default=a})),define("index",["require","exports","utility/Arrays","utility/DOMRect","utility/Elements","utility/Env","utility/Maps","utility/Ranges","utility/SelfScript","utility/SourceMapping"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),Object.assign(window,{_:void 0,select:e=>e()}),s.default.init();const d={types:new Set,finished:Promise.resolve(void 0),ready:Promise.resolve(void 0),updateCallbackDone:Promise.resolve(void 0),skipTransition:()=>{}};document.startViewTransition??=e=>(e?.(),d),(0,a.default)(),o.default.applyPrototypes(),r.default.applyPrototypes(),n.default.applyPrototypes(),l.default.applyPrototypes(),(async()=>{await i.default.load(),i.default.isDev&&(u.default.value=await fetch(`${i.default.URL_ORIGIN}index.js`).then((e=>e.text())));const t=await new Promise(((t,o)=>{e(["App"],t,o)})).then(__importStar);await t.default()})()})),define("endpoint/chapter/EndpointChapterSetVisibility",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/work/{author}/{work}/chapters/setvisibility","post")})),define("endpoint/follow/EndpointFollowGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default={Author:(0,o.default)("/follows/author/{id}","get"),Work:(0,o.default)("/follows/work/{id}","get"),Tag:(0,o.default)("/follows/tag/{id}","get"),Category:(0,o.default)("/follows/category/{id}","get")}})),define("endpoint/follow/EndpointFollowGetAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/following/{type}","get")})),define("endpoint/follow/EndpointFollowGetWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/follows/work/{author}/{vanity}","get")})),define("endpoint/follow/EndpointIgnoreGet",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default={Author:(0,o.default)("/ignores/author/{id}","get"),Work:(0,o.default)("/ignores/work/{id}","get"),Tag:(0,o.default)("/ignores/tag/{id}","get"),Category:(0,o.default)("/ignores/category/{id}","get")}})),define("endpoint/follow/EndpointIgnoreGetAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/ignoring/{type}","get")})),define("endpoint/follow/EndpointIgnoreGetWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/ignores/work/{author}/{vanity}","get")})),define("endpoint/history/EndpointHistoryDeleteChapter",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/history/delete/{author}/{work}/chapter/{url}","post")})),define("endpoint/history/EndpointHistoryDeleteWork",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/history/delete/{author}/{vanity}","post")})),define("endpoint/notification/EndpointNotificationGetUnread",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/notifications/get/unread","get")})),define("endpoint/patreon/EndpointPatreonGetTiers",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/patreon/campaign/tiers/get","get")})),define("endpoint/privilege/EndpointPrivilegeGetAllAuthor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/privilege/get/{vanity}","get")})),define("endpoint/privilege/EndpointPrivilegeGrantAuthor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/privilege/grant/author/{vanity}","post")})),define("endpoint/privilege/EndpointPrivilegeGrantRole",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/privilege/grant/role/{vanity}","post")})),define("endpoint/privilege/EndpointPrivilegeRevokeAuthor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/privilege/revoke/author/{vanity}","post")})),define("endpoint/privilege/EndpointPrivilegeRevokeRole",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/privilege/revoke/role/{vanity}","post")})),define("endpoint/role/EndpointRoleCreate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/role/create","post")})),define("endpoint/role/EndpointRoleDelete",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/role/delete/{role}","post")})),define("endpoint/role/EndpointRoleGrantAuthor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/role/grant/{role}/{author}","post")})),define("endpoint/role/EndpointRoleListAll",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/roles/get","get")})),define("endpoint/role/EndpointRoleReorder",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/role/reorder","post")})),define("endpoint/role/EndpointRoleRevokeAuthor",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/role/revoke/{role}/{author}","post")})),define("endpoint/role/EndpointRoleUpdate",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/role/update/{role}","post")})),define("endpoint/tag/EndpointTagGlobalDemote",["require","exports","endpoint/Endpoint"],(function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),t.default=(0,o.default)("/tag/demote/{id}","post")})),define("ui/component/CurrencyInput",["require","exports","ui/Component","ui/component/core/PrefixedInput","ui/component/core/TextInput"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),t.FilterCurrency=void 0,o=__importDefault(o),a=__importDefault(a);const i=o.default.Builder((e=>e.and(a.default,"shared/prefix/currency").filter(t.FilterCurrency)));t.default=i,t.FilterCurrency=(0,n.FilterFunction)(((e,t,o)=>{if([e,t,o]=n.FilterFunction.DECIMAL(e,t,o),!e&&!t&&!o)return[e,t,o];let a=e.indexOf(".")+1;e=a?e.slice(0,a+2):e,a||(a=t.indexOf(".")+1,a&&(a+=e.length)),t=a?t.slice(0,a+2-e.length):t,a||(a=o.indexOf(".")+1,a&&(a+=e.length+t.length));const i=a+2-e.length-t.length;return[e,t,o=a?o.slice(0,i).padEnd(i,"0"):`${o}.00`]}))})),define("ui/component/core/ActionHeading",["require","exports","ui/Component","ui/component/core/ActionRow","ui/component/core/Heading"],(function(e,t,o,a,n){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n);const i=o.default.Builder((e=>{const t=e.and(a.default).viewTransition("action-heading").style("action-heading"),o=t.left.and(n.default).style("action-heading-heading");return t.extend((e=>({heading:o})))}));t.default=i})),define("ui/view/TestView",["require","exports","markdown-it","ui/Component","ui/component/core/Block","ui/component/core/TextEditor","ui/view/shared/component/View","ui/view/shared/component/ViewDefinition","utility/Env","utility/string/MarkdownItHTML"],(function(e,t,o,a,n,i,r,l,u,s){Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),a=__importDefault(a),n=__importDefault(n),i=__importDefault(i),r=__importDefault(r),l=__importDefault(l),u=__importDefault(u),s=__importDefault(s),t.default=(0,l.default)({create:()=>{const e=(0,r.default)("home"),t=(0,n.default)().appendTo(e.content);if(t.title.text.set("Test the text editor"),t.description.text.set("fluff4.me is still a work-in-progress. In the meantime, feel free to play with this!"),(0,i.default)().appendTo(t.content),u.default.isDev){(0,a.default)("br").appendTo(t.content);const e=(0,a.default)("div");(0,a.default)("div").attributes.set("contenteditable","plaintext-only").style.setProperty("white-space","pre-wrap").style.setProperty("font","inherit").style.setProperty("background","#222").style.setProperty("width","100%").style.setProperty("height","400px").style.setProperty("padding","0.5em").style.setProperty("box-sizing","border-box").event.subscribe("input",(t=>{const a=t.host.element.textContent??"",n=new o.default("commonmark",{html:!0,breaks:!0});s.default.use(n,s.default.Options().disallowTags("img","figure","figcaption","map","area")),console.log(n.parse(a,{})),e.element.innerHTML=n.render(a)})).appendTo(t.content),e.style.setProperty("font","inherit").style.setProperty("background","#222").style.setProperty("width","100%").style.setProperty("padding","0.5em").style.setProperty("margin-top","1em").style.setProperty("box-sizing","border-box").appendTo(t.content)}return e}})})),define("utility/Debug",["require","exports"],(function(e,t){var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Debug=void 0,function(e){e.placeholder=!1}(o||(t.Debug=o={})),Object.assign(window,{Debug:o})})),define("utility/Tuples",["require","exports","utility/Arrays"],(function(e,t,o){var a;Object.defineProperty(t,"__esModule",{value:!0}),o=__importDefault(o),function(e){function t(...e){return e}e.make=t;const a=Object.fromEntries(o.default.range(6).map((e=>t(e,(t=>void 0!==t[e]&&null!==t[e])))));e.filterNullish=function(e){return a[e]};const n=Object.fromEntries(o.default.range(6).map((e=>t(e,(t=>t[e])))));e.filterFalsy=function(e){return n[e]},e.getter=function(e){return t=>t[e]},e.filter=function(e,t){return(o,a)=>t(o[e],a)}}(a||(a={})),t.default=a}));